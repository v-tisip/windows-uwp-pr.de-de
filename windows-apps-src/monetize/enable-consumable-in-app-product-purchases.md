---
author: mcleanbyron
Description: "Sie können konsumierbare In-App-Produkte – Artikel, die gekauft, verwendet und wieder gekauft werden können – über die Store-Handelsplattform anbieten, um Ihren Kunden eine stabile und zuverlässige Kaufumgebung bereitzustellen."
title: "Unterstützen von Endverbraucher-Add-On-Käufen"
ms.assetid: F79EE369-ACFC-4156-AF6A-72D1C7D3BDA4
keywords: "UWP, konsumierbar, Add-Ons, In-App-Käufe, IAPs Windows.ApplicationModel.Store"
ms.author: mcleans
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
ms.openlocfilehash: 9190000a2c5a35a0b7125429a19e4743b388d503
ms.sourcegitcommit: 6c6f3c265498d7651fcc4081c04c41fafcbaa5e7
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 08/09/2017
---
# <a name="enable-consumable-in-app-product-purchases"></a><span data-ttu-id="a7023-104">Unterstützen von Käufen konsumierbarer In-App-Produkte</span><span class="sxs-lookup"><span data-stu-id="a7023-104">Enable consumable in-app product purchases</span></span>


> [!NOTE]
> <span data-ttu-id="a7023-105">In diesem Artikel wird veranschaulicht, wie Mitglieder des [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx)-Namespace verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a7023-105">This article demonstrates how to use members of the [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx) namespace.</span></span> <span data-ttu-id="a7023-106">Wenn Ihre App für Windows10, Version 1607, oder höher entwickelt wurde, empfehlen wir Ihnen, Member des [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx)-Namespace und nicht des **Windows.ApplicationModel.Store**-Namespace zur Verwaltung von Add-Ons zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="a7023-106">If your app targets Windows 10, version 1607, or later, we recommend that you use members of the [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx) namespace to manage add-ons instead of the **Windows.ApplicationModel.Store** namespace.</span></span> <span data-ttu-id="a7023-107">Weitere Informationen finden Sie in [diesem Artikel](enable-consumable-add-on-purchases.md).</span><span class="sxs-lookup"><span data-stu-id="a7023-107">For more information, see [this article](enable-consumable-add-on-purchases.md).</span></span>

<span data-ttu-id="a7023-108">Sie können In-App-Käufe von konsumierbaren Produkten – Artikel, die gekauft, verwendet und wieder gekauft werden können – über die Store-Handelsplattform anbieten, um den Kunden beim Kauf Stabilität und Zuverlässigkeit zu bieten.</span><span class="sxs-lookup"><span data-stu-id="a7023-108">Offer consumable in-app products—items that can be purchased, used, and purchased again—through the Store commerce platform to provide your customers with a purchase experience that is both robust and reliable.</span></span> <span data-ttu-id="a7023-109">Dies ist besonders nützlich für Dinge wie spielinterne Währungen (Gold, Münzen usw.), die gekauft und dann zum Erwerben bestimmter Power-Ups verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="a7023-109">This is especially useful for things like in-game currency (gold, coins, etc.) that can be purchased and then used to purchase specific power-ups.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a7023-110">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="a7023-110">Prerequisites</span></span>

-   <span data-ttu-id="a7023-111">In diesem Thema erfahren Sie, wie In-App-Produktkäufe von Consumables erfüllt und gemeldet werden.</span><span class="sxs-lookup"><span data-stu-id="a7023-111">This topic covers the purchase and fulfillment reporting of consumable in-app products.</span></span> <span data-ttu-id="a7023-112">Wenn Sie mit In-App-Produkten noch nicht vertraut sind, lesen Sie [Aktivieren von In-App-Produktkäufen](enable-in-app-product-purchases.md). Dort finden Sie Lizenzinformationen und eine Anleitung zur richtigen Eintragung Ihrer In-App-Produkte im Store.</span><span class="sxs-lookup"><span data-stu-id="a7023-112">If you are unfamiliar with in-app products, please review [Enable in-app product purchases](enable-in-app-product-purchases.md) to learn about license information, and how to properly list in-app products in the Store.</span></span>
-   <span data-ttu-id="a7023-113">Wenn Sie zum ersten Mal Code für neue In-App-Produkte schreiben und testen, müssen Sie anstelle des [CurrentAppSimulator](https://msdn.microsoft.com/library/windows/apps/hh779766)-Objekts das [CurrentApp](https://msdn.microsoft.com/library/windows/apps/hh779765)-Objekt verwenden.</span><span class="sxs-lookup"><span data-stu-id="a7023-113">When you code and test new in-app products for the first time, you must use the [CurrentAppSimulator](https://msdn.microsoft.com/library/windows/apps/hh779766) object instead of the [CurrentApp](https://msdn.microsoft.com/library/windows/apps/hh779765) object.</span></span> <span data-ttu-id="a7023-114">Auf diese Weise können Sie überprüfen, ob die Lizenzlogik simulierte Aufrufe an den Lizenzserver und nicht an den Liveserver verwendet.</span><span class="sxs-lookup"><span data-stu-id="a7023-114">This way you can verify your license logic using simulated calls to the license server instead of calling the live server.</span></span> <span data-ttu-id="a7023-115">Dazu müssen Sie die Datei mit dem Namen „WindowsStoreProxy.xml“ in %userprofile%\\AppData\\local\\packages\\&lt;Paketname&gt;\\LocalState\\Microsoft\\Windows Store\\ApiData anpassen.</span><span class="sxs-lookup"><span data-stu-id="a7023-115">To do this, you need to customize the file named WindowsStoreProxy.xml in %userprofile%\\AppData\\local\\packages\\&lt;package name&gt;\\LocalState\\Microsoft\\Windows Store\\ApiData.</span></span> <span data-ttu-id="a7023-116">Diese Datei wird vom Simulator in Microsoft Visual Studio erstellt, wenn Sie Ihre App zum ersten Mal ausführen. Sie können jedoch auch eine benutzerdefinierte Version dieser Datei zur Laufzeit laden.</span><span class="sxs-lookup"><span data-stu-id="a7023-116">The Microsoft Visual Studio simulator creates this file when you run your app for the first time—or you can also load a custom one at runtime.</span></span> <span data-ttu-id="a7023-117">Weitere Informationen finden Sie unter [Verwenden der Datei „WindowsStoreProxy.xml“ mit CurrentAppSimulator](in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md#proxy).</span><span class="sxs-lookup"><span data-stu-id="a7023-117">For more info, see [Using the WindowsStoreProxy.xml file with CurrentAppSimulator](in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md#proxy).</span></span>
-   <span data-ttu-id="a7023-118">In diesem Thema wird auch auf Codebeispiele verwiesen, die im [Store-Beispiel](https://github.com/Microsoft/Windows-universal-samples/tree/win10-1507/Samples/Store) zu finden sind.</span><span class="sxs-lookup"><span data-stu-id="a7023-118">This topic also references code examples provided in the [Store sample](https://github.com/Microsoft/Windows-universal-samples/tree/win10-1507/Samples/Store).</span></span> <span data-ttu-id="a7023-119">Dieses Beispiel bietet eine hervorragende Möglichkeit, die verschiedenen Monetarisierungsoptionen zu testen, die für Universelle Windows-Plattform (UWP)-Apps verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="a7023-119">This sample is a great way to get hands-on experience with the different monetization options provided for Universal Windows Platform (UWP) apps.</span></span>

## <a name="step-1-making-the-purchase-request"></a><span data-ttu-id="a7023-120">Schritt 1: Durchführen der Kaufanforderung</span><span class="sxs-lookup"><span data-stu-id="a7023-120">Step 1: Making the purchase request</span></span>

<span data-ttu-id="a7023-121">Die erste Kaufanforderung wird wie bei jedem Kauf über den Store mit [RequestProductPurchaseAsync](https://msdn.microsoft.com/library/windows/apps/dn263381) durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="a7023-121">The initial purchase request is made with [RequestProductPurchaseAsync](https://msdn.microsoft.com/library/windows/apps/dn263381) like any other purchase made through the Store.</span></span> <span data-ttu-id="a7023-122">Der Unterschied bei konsumierbaren In-App-Produkten besteht darin, dass ein Kunde nach einem erfolgreichen Kauf das gleiche Produkt erst dann erneut kaufen kann, wenn die App den Store benachrichtigt hat, dass der vorige Kauf des Produkts erfolgreich erfüllt wurde.</span><span class="sxs-lookup"><span data-stu-id="a7023-122">The difference for consumable in-app products is that after a successful purchase, a customer cannot purchase the same product again until the app has notified the Store that the previous purchase was successfully fulfilled.</span></span> <span data-ttu-id="a7023-123">Ihre App ist dafür verantwortlich, gekaufte Consumables zu erfüllen und den Store über die Erfüllung in Kenntnis zu setzen.</span><span class="sxs-lookup"><span data-stu-id="a7023-123">It's your app's responsibility to fulfill purchased consumables and notify the Store of the fulfillment.</span></span>

<span data-ttu-id="a7023-124">Im nächsten Beispiel wird eine In-App-Kaufanforderung für ein Consumable gezeigt.</span><span class="sxs-lookup"><span data-stu-id="a7023-124">The following example shows a consumable in-app product purchase request.</span></span> <span data-ttu-id="a7023-125">Sie sehen Codekommentare, die angeben, wann Ihre App den Kauf des konsumierbaren In-App-Produkts lokal erfüllen sollte, und zwar für zwei verschiedene Szenarien – eine erfolgreiche Kaufanforderung und eine nicht erfolgreiche Kaufanforderung aufgrund eines nicht erfüllten Kaufs desselben Produkts.</span><span class="sxs-lookup"><span data-stu-id="a7023-125">You'll notice code comments indicating when your app should conduct its local fulfillment of the consumable in-app product for two different scenarios—when the request is successful, and when the request is not successful because of an unfulfilled purchase of that same product.</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[<span data-ttu-id="a7023-126">EnableConsumablePurchases</span><span class="sxs-lookup"><span data-stu-id="a7023-126">EnableConsumablePurchases</span></span>](./code/InAppPurchasesAndLicenses/cs/EnableConsumablePurchases.cs#MakePurchaseRequest)]

## <a name="step-2-tracking-local-fulfillment-of-the-consumable"></a><span data-ttu-id="a7023-127">Schritt 2: Verfolgen der lokalen Kauferfüllung des Verbrauchsartikels</span><span class="sxs-lookup"><span data-stu-id="a7023-127">Step 2: Tracking local fulfillment of the consumable</span></span>

<span data-ttu-id="a7023-128">Wenn Sie dem Kunden Zugriff auf das konsumierbare In-App-Produkt gewähren, müssen Sie dokumentieren, für welches Produkt der Kauf erfüllt wird (*productId*) und mit welcher Transaktion diese Erfüllung verbunden ist (*transactionId*).</span><span class="sxs-lookup"><span data-stu-id="a7023-128">When granting your customer access to the consumable in-app product, it's important to keep track of which product is fulfilled (*productId*), and which transaction that fulfillment is associated with (*transactionId*).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a7023-129">Ihre App ist verantwortlich dafür, dass der Store ordnungsgemäß von der Erfüllung in Kenntnis gesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="a7023-129">Your app is responsible for the accurately reporting fulfillment to the Store.</span></span> <span data-ttu-id="a7023-130">Dieser Schritt ist die Grundlage dafür, dass der Kauf von den Kunden als fair und zuverlässig wahrgenommen wird.</span><span class="sxs-lookup"><span data-stu-id="a7023-130">This step is essential to maintaining a fair and reliable purchase experience for your customers.</span></span>

<span data-ttu-id="a7023-131">Im folgenden Beispiel wird die Verwendung von [PurchaseResults](https://msdn.microsoft.com/library/windows/apps/dn263392)-Eigenschaften aus dem [RequestProductPurchaseAsync](https://msdn.microsoft.com/library/windows/apps/dn263381)-Aufruf im vorangehenden Schritt zum Identifizieren des Produktkaufs gezeigt, der erfüllt werden muss.</span><span class="sxs-lookup"><span data-stu-id="a7023-131">The following example demonstrates use of the [PurchaseResults](https://msdn.microsoft.com/library/windows/apps/dn263392) properties from the [RequestProductPurchaseAsync](https://msdn.microsoft.com/library/windows/apps/dn263381) call in the previous step to identify the purchased product for fulfillment.</span></span> <span data-ttu-id="a7023-132">Es wird eine Sammlung verwendet, um die Produktinformationen an einem Ort zu speichern, auf den später verwiesen werden kann, um zu bestätigen, dass die lokale Erfüllung erfolgreich war.</span><span class="sxs-lookup"><span data-stu-id="a7023-132">A collection is used to store the product information in a location that can later be referenced to confirm that local fulfillment was successful.</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[<span data-ttu-id="a7023-133">EnableConsumablePurchases</span><span class="sxs-lookup"><span data-stu-id="a7023-133">EnableConsumablePurchases</span></span>](./code/InAppPurchasesAndLicenses/cs/EnableConsumablePurchases.cs#GrantFeatureLocally)]

<span data-ttu-id="a7023-134">Im folgenden Beispiel wird die Verwendung des Arrays aus dem vorhergehenden Beispiel gezeigt, um auf Produkt-ID/Transaktions-ID-Paare zuzugreifen, die später beim Melden der Erfüllung an den Store verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a7023-134">This next example shows how to use the array from the previous example to access product ID/transaction ID pairs that are later used when reporting fulfillment to the Store.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a7023-135">Ganz gleich, welche Methode Ihre App verwendet, um die Erfüllung nachzuverfolgen und zu bestätigen – die App muss gebührende Sorgfalt demonstrieren, um sicherzustellen, dass Ihren Kunden keine Produkte in Rechnung gestellt werden, die sie nicht erhalten haben.</span><span class="sxs-lookup"><span data-stu-id="a7023-135">Whatever methodology your app uses to track and confirm fulfillment, your app must demonstrate due diligence to ensure that your customers are not charged for items they haven't received.</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[<span data-ttu-id="a7023-136">EnableConsumablePurchases</span><span class="sxs-lookup"><span data-stu-id="a7023-136">EnableConsumablePurchases</span></span>](./code/InAppPurchasesAndLicenses/cs/EnableConsumablePurchases.cs#IsLocallyFulfilled)]

## <a name="step-3-reporting-product-fulfillment-to-the-store"></a><span data-ttu-id="a7023-137">Schritt 3: Melden der Produkterfüllung an den Store</span><span class="sxs-lookup"><span data-stu-id="a7023-137">Step 3: Reporting product fulfillment to the Store</span></span>

<span data-ttu-id="a7023-138">Nachdem die lokale Erfüllung abgeschlossen wurde, muss Ihre App einen [ReportConsumableFulfillmentAsync](https://msdn.microsoft.com/library/windows/apps/dn263380)-Aufruf ausführen, der die *productId* und die Transaktion des Produktkaufs enthält.</span><span class="sxs-lookup"><span data-stu-id="a7023-138">After local fulfillment is completed, your app must make a [ReportConsumableFulfillmentAsync](https://msdn.microsoft.com/library/windows/apps/dn263380) call that includes the *productId* and the transaction the product purchase is included in.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a7023-139">Wenn erfüllte Käufe konsumierbarer In-App-Produkte nicht an den Store gemeldet werden, kann der Benutzer das Produkt erst dann erneut kaufen, wenn die Erfüllung des vorangehenden Kaufs gemeldet wird.</span><span class="sxs-lookup"><span data-stu-id="a7023-139">Failure to report fulfilled consumable in-app products to the Store will result in the user being unable to purchase that product again until fulfillment for the previous purchase is reported.</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[<span data-ttu-id="a7023-140">EnableConsumablePurchases</span><span class="sxs-lookup"><span data-stu-id="a7023-140">EnableConsumablePurchases</span></span>](./code/InAppPurchasesAndLicenses/cs/EnableConsumablePurchases.cs#ReportFulfillment)]

## <a name="step-4-identifying-unfulfilled-purchases"></a><span data-ttu-id="a7023-141">Schritt 4: Identifizieren nicht erfüllter Käufe</span><span class="sxs-lookup"><span data-stu-id="a7023-141">Step 4: Identifying unfulfilled purchases</span></span>

<span data-ttu-id="a7023-142">Ihre App kann jederzeit mithilfe der [GetUnfulfilledConsumablesAsync](https://msdn.microsoft.com/library/windows/apps/dn263379)-Methode eine Überprüfung auf nicht erfüllte Käufe konsumierbarer In-App-Produkte durchführen.</span><span class="sxs-lookup"><span data-stu-id="a7023-142">Your app can use the [GetUnfulfilledConsumablesAsync](https://msdn.microsoft.com/library/windows/apps/dn263379) method to check for unfulfilled consumable in-app products at any time.</span></span> <span data-ttu-id="a7023-143">Diese Methode sollte regelmäßig aufgerufen werden, um nicht erfüllte Käufe konsumierbarer Produkte zu ermitteln, die aufgrund unerwarteter Ereignisse in der App aufgetreten sind, beispielsweise Unterbrechungen der Netzwerkverbindung oder Beenden der App.</span><span class="sxs-lookup"><span data-stu-id="a7023-143">This method should be called on a regular basis to check for unfulfilled consumables that exist due to unanticipated app events like an interruption in network connectivity or app termination.</span></span>

<span data-ttu-id="a7023-144">Im folgenden Beispiel wird gezeigt, auf welche Weise [GetUnfulfilledConsumablesAsync](https://msdn.microsoft.com/library/windows/apps/dn263379) verwendet werden kann, um nicht erfüllte Käufe konsumierbarer Produkte aufzuzählen, und wie Ihre App diese Liste iterieren kann, um die lokale Erfüllung abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="a7023-144">The following example demonstrates how [GetUnfulfilledConsumablesAsync](https://msdn.microsoft.com/library/windows/apps/dn263379) can be used to enumerate unfulfilled consumables, and how your app can iterate through this list to complete local fulfillment.</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[<span data-ttu-id="a7023-145">EnableConsumablePurchases</span><span class="sxs-lookup"><span data-stu-id="a7023-145">EnableConsumablePurchases</span></span>](./code/InAppPurchasesAndLicenses/cs/EnableConsumablePurchases.cs#GetUnfulfilledConsumables)]

## <a name="related-topics"></a><span data-ttu-id="a7023-146">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="a7023-146">Related topics</span></span>

* [<span data-ttu-id="a7023-147">Unterstützen des Kaufs von In-App-Produkten</span><span class="sxs-lookup"><span data-stu-id="a7023-147">Enable in-app product purchases</span></span>](enable-in-app-product-purchases.md)
* [<span data-ttu-id="a7023-148">Store-Beispiel (zeigt Testversionen und In-App-Käufe)</span><span class="sxs-lookup"><span data-stu-id="a7023-148">Store sample (demonstrates trials and in-app purchases)</span></span>](https://github.com/Microsoft/Windows-universal-samples/tree/win10-1507/Samples/Store)
* [<span data-ttu-id="a7023-149">Windows.ApplicationModel.Store</span><span class="sxs-lookup"><span data-stu-id="a7023-149">Windows.ApplicationModel.Store</span></span>](https://msdn.microsoft.com/library/windows/apps/br225197)
 

 
