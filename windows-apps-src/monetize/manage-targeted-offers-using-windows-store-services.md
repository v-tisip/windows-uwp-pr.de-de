---
author: mcleanbyron
ms.assetid: 9F0A59A1-FAD7-4AD5-B78B-C1280F215D23
description: "Verwenden Sie die Windows Store-API für gezielte Angebote, um die gezielten Angebote in Anspruch zu nehmen, die für eine App verfügbar sind."
title: Verwalten von gezielten Angeboten mithilfe von Store-Diensten
ms.author: mcleans
ms.date: 05/11/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: "Windows10, UWP, Store-Dienste, Windows Store-API für gezielte Angebote, gezielte Angebote"
ms.openlocfilehash: 684c37d4439f415ad607b7f3e6a166966cc9f835
ms.sourcegitcommit: eaacc472317eef343b764d17e57ef24389dd1cc3
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 07/17/2017
---
# <a name="manage-targeted-offers-using-store-services"></a><span data-ttu-id="e6b31-104">Verwalten von gezielten Angeboten mithilfe von Store-Diensten</span><span class="sxs-lookup"><span data-stu-id="e6b31-104">Manage targeted offers using Store services</span></span>

<span data-ttu-id="e6b31-105">Wenn Sie auf der Seite **Interaktion > Zielgerichtete Angebote** zu Ihrer App im Windows Dev Center-Dashboard ein *gezieltes Angebot* erstellen, verwenden Sie die *Windows Store-API für gezielte Angebote* in Ihrem App-Code, um die In-App-Umgebung für das gezielte Angebot zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="e6b31-105">If you create a *targeted offer* in the **Engage > Targeted offers** page for your app in the Windows Dev Center dashboard, use the *Windows Store targeted offers API* in your app's code to implement the in-app experience for the targeted offer.</span></span> <span data-ttu-id="e6b31-106">Weitere Informationen zu gezielten Angeboten und Anleitungen zu deren Erstellung im Dashboard finden Sie unter [Verwenden Sie gezielte Angebote, um Interaktionen und Abschlüsse zu maximieren.](../publish/use-targeted-offers-to-maximize-engagement-and-conversions.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-106">For more information about targeted offers and how to create them in the dashboard, see [Use targeted offers to maximize engagement and conversions](../publish/use-targeted-offers-to-maximize-engagement-and-conversions.md).</span></span>

<span data-ttu-id="e6b31-107">Die API für gezielte Angebote ist eine REST-API, die Sie zum Ausführen dieser Aufgaben verwenden können:</span><span class="sxs-lookup"><span data-stu-id="e6b31-107">The targeted offers API is a REST API that you can use to perform these tasks:</span></span>

* <span data-ttu-id="e6b31-108">Rufen Sie die gezielten Angebote ab, die für den aktuellen Benutzer verfügbar sind– basierend darauf, ob der Benutzer zum Kundensegment für das gezielte Angebot gehört.</span><span class="sxs-lookup"><span data-stu-id="e6b31-108">Get the targeted offers that are available for the current user, based on whether or not the user is part of the customer segment for the targeted offer.</span></span>
* <span data-ttu-id="e6b31-109">Wenn der Benutzer das gezielte Angebot erwirbt, können Sie einen entsprechenden Anspruch an den Store übermitteln, um Bonuspunkte erhalten zu können, die mit dem gezielten Angebot verknüpft sind.</span><span class="sxs-lookup"><span data-stu-id="e6b31-109">If the user purchases the targeted offer, you can submit a claim to the Store so you can receive the bonus that is associated with the targeted offer.</span></span> <span data-ttu-id="e6b31-110">Dies ist nur erforderlich, wenn das gezielte Angebot mit einer von Microsoft gesponserten Werbung verknüpft ist, bei der Entwickler für jede erfolgreiche Konvertierung einen Bonus erhalten.</span><span class="sxs-lookup"><span data-stu-id="e6b31-110">This is only necessary if the targeted offer is associated with a Microsoft-sponsored promotion that pays a bonus to developers for each successful conversion.</span></span>

<span data-ttu-id="e6b31-111">Gehen Sie folgendermaßen vor, um diese API in Ihrem App-Code zu verwenden:</span><span class="sxs-lookup"><span data-stu-id="e6b31-111">To use this API in your app's code, follow these steps:</span></span>

1.  <span data-ttu-id="e6b31-112">[Rufen Sie ein Microsoft-Kontotoken](#obtain-a-microsoft-account-token) für den aktuell angemeldeten Benutzer Ihrer App ab.</span><span class="sxs-lookup"><span data-stu-id="e6b31-112">[Get a Microsoft Account token](#obtain-a-microsoft-account-token) for the current signed-in user of your app.</span></span>
2.  <span data-ttu-id="e6b31-113">[Rufen Sie die gezielten Angebote für den aktuellen Benutzer ab](#get-targeted-offers).</span><span class="sxs-lookup"><span data-stu-id="e6b31-113">[Get the targeted offers for the current user](#get-targeted-offers).</span></span>
3.  <span data-ttu-id="e6b31-114">[Kaufen Sie das Add-On, das mit einem gezielten Angebot verknüpft ist](#purchase-add-on).</span><span class="sxs-lookup"><span data-stu-id="e6b31-114">[Purchase the add-on that is associated with a targeted offer](#purchase-add-on).</span></span>
3.  <span data-ttu-id="e6b31-115">[Nehmen Sie ein gezieltes Angebot in Anspruch](#claim-targeted-offer) (wenn das gezielte Angebot mit einer von Microsoft gesponserten Werbung verknüpft ist, bei der Entwickler für jede erfolgreiche Konvertierung einen Bonus erhalten).</span><span class="sxs-lookup"><span data-stu-id="e6b31-115">[Claim the targeted offer](#claim-targeted-offer) (if the targeted offer is associated with a Microsoft-sponsored promotion that pays a bonus to developers for each successful conversion).</span></span>

> [!NOTE]
> <span data-ttu-id="e6b31-116">Die Option zur Verknüpfung eines gezielten Angebots mit einer von Microsoft gesponserten Werbung und die anschließende Übermittlung ist derzeit nicht für alle Entwicklerkonten verfügbar.</span><span class="sxs-lookup"><span data-stu-id="e6b31-116">The ability to associate a targeted offer with a Microsoft-sponsored promotion and then submit a claim for the offer is currently not available to all developer accounts.</span></span>

<span data-ttu-id="e6b31-117">Ein vollständiges Codebeispiel, das alle diese Schritteveranschaulicht, finden Sie unter der [Codebeispiel](#code-example) am Ende dieses Artikels.</span><span class="sxs-lookup"><span data-stu-id="e6b31-117">For a complete code example that demonstrates all of these steps, see the [code example](#code-example) at the end of this article.</span></span> <span data-ttu-id="e6b31-118">Die folgenden Abschnitte enthalten weitere Details zu den einzelnen Schritten.</span><span class="sxs-lookup"><span data-stu-id="e6b31-118">The following sections provide more details about each step.</span></span>

<span id="obtain-a-microsoft-account-token" />
## <a name="get-a-microsoft-account-token-for-the-current-user"></a><span data-ttu-id="e6b31-119">Abrufen eines Microsoft-Kontotokens für den aktuellen Benutzer</span><span class="sxs-lookup"><span data-stu-id="e6b31-119">Get a Microsoft Account token for the current user</span></span>

<span data-ttu-id="e6b31-120">Rufen Sie in Ihrem App-Code ein Microsoft-Konto (MSA)-Token für den aktuell angemeldeten Benutzer ab.</span><span class="sxs-lookup"><span data-stu-id="e6b31-120">In your app's code, get a Microsoft Account (MSA) token for the current signed-in user.</span></span> <span data-ttu-id="e6b31-121">Sie müssen dieses Token im ```Authorization```-Anforderungsheader für jede Methode in der Windows Store-API für gezielte Angebote übergeben.</span><span class="sxs-lookup"><span data-stu-id="e6b31-121">You must pass this token in the ```Authorization``` request header for each of the methods in the Windows Store targeted offers API.</span></span> <span data-ttu-id="e6b31-122">Dieses Token wird vom Store verwendet, um die gezielten Angebote abzurufen, die für den aktuellen Benutzer verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="e6b31-122">This token is used by the Store to retrieve the targeted offers that are available for the current user.</span></span>

<span data-ttu-id="e6b31-123">Um das MSA-Token abzurufen, verwenden Sie die [WebAuthenticationCoreManager](https://docs.microsoft.com/uwp/api/windows.security.authentication.web.core.webauthenticationcoremanager)-Klasse, um ein Token unter Angabe des Bereichs anzufordern ```devcenter_implicit.basic,wl.basic```.</span><span class="sxs-lookup"><span data-stu-id="e6b31-123">To get the MSA token, use the [WebAuthenticationCoreManager](https://docs.microsoft.com/uwp/api/windows.security.authentication.web.core.webauthenticationcoremanager) class to request a token using the scope ```devcenter_implicit.basic,wl.basic```.</span></span> <span data-ttu-id="e6b31-124">Das folgende Beispiel veranschaulicht die Vorgehensweise.</span><span class="sxs-lookup"><span data-stu-id="e6b31-124">The following example demonstrates how to do this.</span></span> <span data-ttu-id="e6b31-125">In diesem Beispiel wird ein Auszug aus dem [vollständige Beispiel](#code-example) verwendet. Es erfordert **using**-Anweisungen, die im vollständigen Beispiel bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="e6b31-125">This example is an excerpt from the [complete example](#code-example), and it requires **using** statements that are provided in the complete example.</span></span>

[!code-cs[<span data-ttu-id="e6b31-126">TargetedOffers</span><span class="sxs-lookup"><span data-stu-id="e6b31-126">TargetedOffers</span></span>](./code/StoreServicesExamples_TargetedOffers/cs/TargetedOffers.cs#GetMSAToken)]

<span data-ttu-id="e6b31-127">Weitere Informationen zum Abrufen von MSA-Token finden Sie unter [Web Account Manager](../security/web-account-manager.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-127">For more information about getting MSA tokens, see [Web account manager](../security/web-account-manager.md).</span></span>

<span id="get-targeted-offers" />
## <a name="get-the-targeted-offers-for-the-current-user"></a><span data-ttu-id="e6b31-128">Abrufen der gezielten Angebote für den aktuellen Benutzer</span><span class="sxs-lookup"><span data-stu-id="e6b31-128">Get the targeted offers for the current user</span></span>

<span data-ttu-id="e6b31-129">Rufen Sie nach Erhalt des MSA-Tokens für den aktuellen Benutzer die GET-Methode zum ```https://manage.devcenter.microsoft.com/v2.0/my/storeoffers/user```-URI auf, um die für den aktuellen Benutzer verfügbaren Angebote abzurufen.</span><span class="sxs-lookup"><span data-stu-id="e6b31-129">After you have an MSA token for the current user, call the GET method of the ```https://manage.devcenter.microsoft.com/v2.0/my/storeoffers/user``` URI to get the available targeted offers for the current user.</span></span> <span data-ttu-id="e6b31-130">Weitere Informationen zu dieser REST-Methode finden Sie unter [Abrufen gezielter Angebote](get-targeted-offers.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-130">For more information about this REST method, see [Get targeted offers](get-targeted-offers.md).</span></span>

<span data-ttu-id="e6b31-131">Bei dieser Methode wird ein Array mit Produkt-IDs für die Add-Ons zurückgegeben, die den gezielten Angeboten zugeordnet sind, die für den aktuellen Benutzer verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="e6b31-131">This method returns the product IDs of the add-ons that that are associated with the targeted offers that are available for the current user.</span></span> <span data-ttu-id="e6b31-132">Mit diesen Informationen können Sie ein oder mehrere gezielte Angebote als In-App-Einkauf für den Benutzer erstellen.</span><span class="sxs-lookup"><span data-stu-id="e6b31-132">With this information, you can offer one or more of the targeted offers as an in-app purchase to the user.</span></span> <span data-ttu-id="e6b31-133">Bei dieser Methode wird außerdem eine Tracking-ID zur [Übermittlung eines Anspruchs](#claim-targeted-offer) an den Store zurückgegeben, damit Sie alle Boni erhalten können, die mit einem der gezielten Angebote verknüpft sind.</span><span class="sxs-lookup"><span data-stu-id="e6b31-133">This method also returns a tracking ID that you can use to [submit a claim](#claim-targeted-offer) to the Store so you can receive any bonus that is associated with one of the targeted offers.</span></span>

<span data-ttu-id="e6b31-134">Im folgenden Beispiel wird veranschaulicht, wie Sie die entsprechenden Angebote für den aktuellen Benutzer erhalten.</span><span class="sxs-lookup"><span data-stu-id="e6b31-134">The following example demonstrates how to get the targeted offers for the current user.</span></span> <span data-ttu-id="e6b31-135">Dieses Beispiel ist ein Auszug aus dem [vollständige Beispiel](#code-example).</span><span class="sxs-lookup"><span data-stu-id="e6b31-135">This example is an excerpt from the [complete example](#code-example).</span></span> <span data-ttu-id="e6b31-136">Erfordert die [Json.NET](http://www.newtonsoft.com/json)-Bibliothek von Newtonsoft und zusätzliche Klassen und **using**-Anweisungen, die im vollständigen Beispiel bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="e6b31-136">It requires the [Json.NET](http://www.newtonsoft.com/json) library from Newtonsoft and additional classes and **using** statements that are provided in the complete example.</span></span>

[!code-cs[<span data-ttu-id="e6b31-137">TargetedOffers</span><span class="sxs-lookup"><span data-stu-id="e6b31-137">TargetedOffers</span></span>](./code/StoreServicesExamples_TargetedOffers/cs/TargetedOffers.cs#GetTargetedOffers)]

<span id="purchase-add-on" />
## <a name="purchase-the-add-on-that-is-associated-with-a-targeted-offer"></a><span data-ttu-id="e6b31-138">Kaufen des Add-Ons, das mit einem gezielten Angebot verknüpft ist</span><span class="sxs-lookup"><span data-stu-id="e6b31-138">Purchase the add-on that is associated with a targeted offer</span></span>

<span data-ttu-id="e6b31-139">Bieten Sie als Nächstes dem Benutzer ein gezieltes Angebot zum Kauf an.</span><span class="sxs-lookup"><span data-stu-id="e6b31-139">Next, offer one of the targeted offers for purchase to the user.</span></span> <span data-ttu-id="e6b31-140">Wenn der Benutzer dem Kauf des gezielten Angebots zustimmt, verwenden Sie eine der folgenden Methoden, um das mit dem gezielten Angebot verknüpfte Add-On programmgesteuert zu erwerben.</span><span class="sxs-lookup"><span data-stu-id="e6b31-140">If the user agrees to purchase the targeted offer, use one of the following methods to programmatically purchase the add-on that is associated with the targeted offer.</span></span> <span data-ttu-id="e6b31-141">Verwenden Sie die Produkt-ID-Werte, die Sie im vorherigen Schritt zu Identifizierung des Add-Ons abgerufen haben, das Sie kaufen möchten.</span><span class="sxs-lookup"><span data-stu-id="e6b31-141">Use the product ID values that you retrieved in the previous step to identify the add-on you want to purchase.</span></span>

* <span data-ttu-id="e6b31-142">Wenn Ihre App auf Windows10 ab Version1607 ausgerichtet ist, wird empfohlen, eine der **RequestPurchaseAsync**-Methoden im [Windows.Services.Store](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store)-Namespace zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="e6b31-142">If your app targets Windows 10, version 1607, or later, we recommend that you use one of the **RequestPurchaseAsync** methods in the [Windows.Services.Store](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store) namespace.</span></span> <span data-ttu-id="e6b31-143">Weitere Informationen zur Verwendung dieser Methoden finden Sie unter [Unterstützen von In-App-Einkäufen von Apps und Add-Ons](enable-in-app-purchases-of-apps-and-add-ons.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-143">For more information about using these methods, see [Enable in-app purchases of apps and add-ons](enable-in-app-purchases-of-apps-and-add-ons.md).</span></span>

* <span data-ttu-id="e6b31-144">Wenn Ihre App auf eine frühere Version von Windows10 ausgerichtet ist, verwenden Sie die [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp#Windows_ApplicationModel_Store_CurrentApp_RequestProductPurchaseAsync_System_String_)-Methode im [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx)-Namespace, um das Add-On zu erwerben.</span><span class="sxs-lookup"><span data-stu-id="e6b31-144">If your app targets an earlier version of Windows 10, use the [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp#Windows_ApplicationModel_Store_CurrentApp_RequestProductPurchaseAsync_System_String_) method in the [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx) namespace to purchase the add-on.</span></span> <span data-ttu-id="e6b31-145">Weitere Informationen zur Verwendung dieser Methode finden Sie unter [Unterstützen von In-App-Produktkäufen](enable-in-app-product-purchases.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-145">For more information about using this method, see [Enable in-app product purchases](enable-in-app-product-purchases.md).</span></span>

<span data-ttu-id="e6b31-146">Codebeispiel, die jede Option veranschaulicht, finden Sie unter der [Codebeispiel](#code-example) am Ende dieses Artikels.</span><span class="sxs-lookup"><span data-stu-id="e6b31-146">For code examples that demonstrate each option, see the [code example](#code-example) at the end of this article.</span></span>

> [!NOTE]
> <span data-ttu-id="e6b31-147">Es gibt zwei verschiedene Namespaces für die Implementierung von In-App-Einkäufen in einer UWP-App: [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx) (eingeführt in Windows10, Version 1607) und [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx) (in allen Versionen von Windows10 verfügbar).</span><span class="sxs-lookup"><span data-stu-id="e6b31-147">There are two different namespaces for implementing in-app purchases in a UWP app: [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx) (introduced in Windows 10, version 1607) and [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx) (available in all versions of Windows 10).</span></span> <span data-ttu-id="e6b31-148">Weitere Informationen zu den Unterschieden zwischen diesen Namespaces finden Sie unter [In-App-Käufe und Testversionen](in-app-purchases-and-trials.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-148">For more information about the differences between these namespaces, see [In-app purchases and trials](in-app-purchases-and-trials.md).</span></span>

<span id="claim-targeted-offer" />
## <a name="submit-a-claim-for-a-targeted-offer"></a><span data-ttu-id="e6b31-149">Übermitteln eines Anspruchs für ein gezieltes Angebot</span><span class="sxs-lookup"><span data-stu-id="e6b31-149">Submit a claim for a targeted offer</span></span>

<span data-ttu-id="e6b31-150">Wenn der Benutzer ein gezieltes Angebot erwirbt, das mit einer von Microsoft gesponserten Werbung verknüpft ist, bei der Entwickler für jeden erfolgreichen Abschluss einen Bonus erhalten, müssen Sie einen Anspruch an den Store übermitteln, um Ihre Boni zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="e6b31-150">If the user purchases a targeted offer that is associated with a Microsoft-sponsored promotion that pays a bonus to developers for each successful conversion, you must submit a claim to the Store so you can receive your bonus.</span></span> <span data-ttu-id="e6b31-151">Wenn Sie Ihren Anspruch übermitteln, müssen Sie einen Wert angeben, der den Kaufbeleg darstellt.</span><span class="sxs-lookup"><span data-stu-id="e6b31-151">When you submit your claim, you must provide a value that represents the purchase confirmation.</span></span> <span data-ttu-id="e6b31-152">Wie Sie diese Kaufbestätigung erhalten, hängt davon ab, ob Ihre App die APIs im **Windows.ApplicationModel.Store** Namespace oder im **Windows.Services.Store** Namespace verwendet, um das Add-On kaufen.</span><span class="sxs-lookup"><span data-stu-id="e6b31-152">The way you obtain this purchase confirmation depends on whether your app uses APIs in the **Windows.ApplicationModel.Store** namespace or **Windows.Services.Store** namespace to purchase the add-on.</span></span>

> [!NOTE]
> <span data-ttu-id="e6b31-153">Die Option zur Verknüpfung eines gezielten Angebots mit einer von Microsoft gesponserten Werbung und die anschließende Übermittlung ist derzeit nicht für alle Entwicklerkonten verfügbar.</span><span class="sxs-lookup"><span data-stu-id="e6b31-153">The ability to associate a targeted offer with a Microsoft-sponsored promotion and then submit a claim for the offer is currently not available to all developer accounts.</span></span>

### <a name="apps-that-use-the-windowsapplicationmodelstore-namespace"></a><span data-ttu-id="e6b31-154">Apps, die den Windows.ApplicationModel.Store-Namespace verwenden</span><span class="sxs-lookup"><span data-stu-id="e6b31-154">Apps that use the Windows.ApplicationModel.Store namespace</span></span>

1. <span data-ttu-id="e6b31-155">Wenn Sie das Add-On über die [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp#Windows_ApplicationModel_Store_CurrentApp_RequestProductPurchaseAsync_System_String_)-Methode im **Windows.ApplicationModel.Store**-Namespace gekauft haben, achten Sie darauf, einen [Kaufbeleg](use-receipts-to-verify-product-purchases.md) abzurufen.</span><span class="sxs-lookup"><span data-stu-id="e6b31-155">After you purchase the add-on by using the [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp#Windows_ApplicationModel_Store_CurrentApp_RequestProductPurchaseAsync_System_String_) method in the **Windows.ApplicationModel.Store** namespace, make sure that you retrieve a [purchase receipt](use-receipts-to-verify-product-purchases.md).</span></span> <span data-ttu-id="e6b31-156">Diesen Beleg finden Sie im [PurchaseResults.ReceiptXml](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.purchaseresults#Windows_ApplicationModel_Store_PurchaseResults_ReceiptXml_)-Objekt, das mittels der **RequestProductPurchaseAsync**-Methode zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="e6b31-156">This receipt is available in the [PurchaseResults.ReceiptXml](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.purchaseresults#Windows_ApplicationModel_Store_PurchaseResults_ReceiptXml_) object that is returned by the **RequestProductPurchaseAsync** method.</span></span> <span data-ttu-id="e6b31-157">Dieser Beleg stellt die Kaufbestätigung dar, die Sie im nächsten Schritt verwendet.</span><span class="sxs-lookup"><span data-stu-id="e6b31-157">This receipt represents the purchase confirmation that you will use in the following step.</span></span>

2. <span data-ttu-id="e6b31-158">Senden Sie eine POST-Nachricht an den ```https://manage.devcenter.microsoft.com/v2.0/my/storeoffers/user```-URI, um einen Anspruch zur Konvertierung des gezielten Angebots zu übermitteln.</span><span class="sxs-lookup"><span data-stu-id="e6b31-158">Send a POST message to the ```https://manage.devcenter.microsoft.com/v2.0/my/storeoffers/user``` URI to submit a claim for the conversion of the targeted offer.</span></span> <span data-ttu-id="e6b31-159">Weitere Informationen zu dieser REST-Methode finden Sie unter [Inanspruchnahme eines gezielten Angebots](claim-a-targeted-offer.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-159">For more information about this REST method, see [Claim a targeted offer](claim-a-targeted-offer.md).</span></span> <span data-ttu-id="e6b31-160">Der Anforderungstext übergeben Sie die folgenden Daten:</span><span class="sxs-lookup"><span data-stu-id="e6b31-160">In the request body, pass the following data:</span></span>

  * <span data-ttu-id="e6b31-161">*storeOffer*-Feld: Übergeben Sie im Anforderungstext eines der JSON-Objekte, die Sie über die Methode zum [Abrufen gezielter Angebote](get-targeted-offers.md) erhalten haben (dieses Objekt sollte die Felder *offers* und *trackingId* enthalten).</span><span class="sxs-lookup"><span data-stu-id="e6b31-161">*storeOffer* field: Pass one of the JSON objects you received in the response body of the [Get targeted offers](get-targeted-offers.md) method (this object should include *offers* and *trackingId* fields).</span></span>

  * <span data-ttu-id="e6b31-162">*receipt*-Feld: Übergeben Sie die Beleg-Zeichenfolge, die Sie im vorherigen Schrittabgerufen haben (diese Option ist im **PurchaseResults.ReceiptXml**-Objekt verfügbar, das von der **RequestProductPurchaseAsync** Methode zurückgegeben wird).</span><span class="sxs-lookup"><span data-stu-id="e6b31-162">*receipt* field: Pass the receipt string that you retrieved in the previous step (this is available in the **PurchaseResults.ReceiptXml** object that is returned by the **RequestProductPurchaseAsync** method).</span></span>

<span data-ttu-id="e6b31-163">Im folgende Beispiel wird veranschaulicht, wie Sie ein gezieltes Angebot mithilfe der APIs im **Windows.ApplicationModel.Store** Namespace erwerben und in und in Anspruch nehmen.</span><span class="sxs-lookup"><span data-stu-id="e6b31-163">The following example demonstrates how to purchase and claim a targeted offer by using the APIs in the **Windows.ApplicationModel.Store** namespace.</span></span> <span data-ttu-id="e6b31-164">Dieses Beispiel ist ein Auszug aus dem [vollständige Beispiel](#code-example).</span><span class="sxs-lookup"><span data-stu-id="e6b31-164">This example is an excerpt from the [complete example](#code-example).</span></span> <span data-ttu-id="e6b31-165">Erfordert die [Json.NET](http://www.newtonsoft.com/json)-Bibliothek von Newtonsoft und zusätzliche Klassen und **using**-Anweisungen, die im vollständigen Beispiel bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="e6b31-165">It requires the [Json.NET](http://www.newtonsoft.com/json) library from Newtonsoft and additional classes and **using** statements that are provided in the complete example.</span></span>

[!code-cs[<span data-ttu-id="e6b31-166">TargetedOffers</span><span class="sxs-lookup"><span data-stu-id="e6b31-166">TargetedOffers</span></span>](./code/StoreServicesExamples_TargetedOffers/cs/TargetedOffers.cs#ClaimOfferOnAnyVersionWindows10)]

### <a name="apps-that-use-the-windowsservicesstore-namespace"></a><span data-ttu-id="e6b31-167">Apps, die den Windows.Services.Store-Namespace verwenden</span><span class="sxs-lookup"><span data-stu-id="e6b31-167">Apps that use the Windows.Services.Store namespace</span></span>

1. <span data-ttu-id="e6b31-168">Nachdem Sie das Add-On über eine der **RequestPurchaseAsync**-Methoden im [Windows.Services.Store](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store)-Namespace verwendet haben, nutzen Sie die *order-ID* für den Erwerb des Add-Ons über die folgenden Schritte.</span><span class="sxs-lookup"><span data-stu-id="e6b31-168">After you purchase the add-on by using one of the **RequestPurchaseAsync** methods in the [Windows.Services.Store](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store) namespace, get the *order ID* for the purchase by following these steps.</span></span> <span data-ttu-id="e6b31-169">Dieser Wert stellt die Kaufbestätigung dar.</span><span class="sxs-lookup"><span data-stu-id="e6b31-169">This value represents the purchase confirmation.</span></span>

  1. <span data-ttu-id="e6b31-170">Rufen Sie die [GetUserCollectionAsync](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext#Windows_Services_Store_StoreContext_GetUserCollectionAsync_Windows_Foundation_Collections_IIterable_System_String__) Methode auf, um die Sammlung der [StoreProduct](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storeproduct.aspx) Objekte zu erhalten, die die Add-Ons darstellen, die der Benutzer erworben hat.</span><span class="sxs-lookup"><span data-stu-id="e6b31-170">Call the [GetUserCollectionAsync](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext#Windows_Services_Store_StoreContext_GetUserCollectionAsync_Windows_Foundation_Collections_IIterable_System_String__) method to get the collection of [StoreProduct](https://msdn.microsoft.com/library/windows/apps/windows.services.store.storeproduct.aspx) objects that represent the add-ons that the user has acquired.</span></span>

  2. <span data-ttu-id="e6b31-171">In dieser Sammlung rufen Sie das **StoreProduct**-Objekt ab, das das Add-On darstellt, die für das gezielte Angebot gekauft wurde.</span><span class="sxs-lookup"><span data-stu-id="e6b31-171">In this collection, get the **StoreProduct** object that represents the add-on that was purchased for the targeted offer.</span></span>

  3. <span data-ttu-id="e6b31-172">Rufen Sie den Wert der [ExtendedJsonData](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreProduct#Windows_Services_Store_StoreProduct_ExtendedJsonData_)-Eigenschaft dieses **StoreProduct** Objekts ab.</span><span class="sxs-lookup"><span data-stu-id="e6b31-172">Get the value of the [ExtendedJsonData](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreProduct#Windows_Services_Store_StoreProduct_ExtendedJsonData_) property of this **StoreProduct** object.</span></span> <span data-ttu-id="e6b31-173">Diese Eigenschaft gibt eine JSON-formatierte Zeichenfolge zurück, die die vollständigen Store-Daten für das Add-On enthält.</span><span class="sxs-lookup"><span data-stu-id="e6b31-173">This property returns a JSON-formatted string that contains the complete Store-related data for the add-on.</span></span>

  4. <span data-ttu-id="e6b31-174">Analysieren Sie diese JSON-Zeichenfolge und rufen Sie den Wert des *Bestellnr* Felds in der Zeichenfolge ab.</span><span class="sxs-lookup"><span data-stu-id="e6b31-174">Parse this JSON string and retrieve the value of the *orderId* field in the string.</span></span>

2. <span data-ttu-id="e6b31-175">Senden Sie eine POST-Nachricht an den ```https://manage.devcenter.microsoft.com/v2.0/my/storeoffers/user```-URI, um einen Anspruch zur Konvertierung des gezielten Angebots zu übermitteln.</span><span class="sxs-lookup"><span data-stu-id="e6b31-175">Send a POST message to the ```https://manage.devcenter.microsoft.com/v2.0/my/storeoffers/user``` URI to submit a claim for the conversion of the targeted offer.</span></span> <span data-ttu-id="e6b31-176">Weitere Informationen zu dieser REST-Methode finden Sie unter [Inanspruchnahme eines gezielten Angebots](claim-a-targeted-offer.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-176">For more information about this REST method, see [Claim a targeted offer](claim-a-targeted-offer.md).</span></span> <span data-ttu-id="e6b31-177">Im Anforderungstext übergeben Sie die folgenden Objekte:</span><span class="sxs-lookup"><span data-stu-id="e6b31-177">In the request body, pass the following objects:</span></span>

  * <span data-ttu-id="e6b31-178">*storeOffer*-Feld: Übergeben Sie im Anforderungstext eines der JSON-Objekte, die Sie über die Methode zum [Abrufen gezielter Angebote](get-targeted-offers.md) erhalten haben (dieses Objekt sollte die Felder *offers* und *trackingId* enthalten).</span><span class="sxs-lookup"><span data-stu-id="e6b31-178">*storeOffer* field: Pass one of the JSON objects you received in the response body of the [Get targeted offers](get-targeted-offers.md) method (this object should include *offers* and *trackingId* fields).</span></span>

  * <span data-ttu-id="e6b31-179">*receipt* Feld: Übergeben den *orderId* Wert, den Sie im vorherigen Schrittabgerufen haben.</span><span class="sxs-lookup"><span data-stu-id="e6b31-179">*receipt* field: Pass the *orderId* value you retrieved in the previous step.</span></span>

<span data-ttu-id="e6b31-180">Im folgende Beispiel wird veranschaulicht, wie Sie ein gezieltes Angebot mithilfe der APIs im **Windows.Services.Store** Namespace erwerben und in und in Anspruch nehmen.</span><span class="sxs-lookup"><span data-stu-id="e6b31-180">The following example demonstrates how to purchase and claim a targeted offer by using the APIs in the **Windows.Services.Store** namespace.</span></span> <span data-ttu-id="e6b31-181">Dieses Beispiel ist ein Auszug aus dem [vollständige Beispiel](#code-example).</span><span class="sxs-lookup"><span data-stu-id="e6b31-181">This example is an excerpt from the [complete example](#code-example).</span></span> <span data-ttu-id="e6b31-182">Erfordert die [Json.NET](http://www.newtonsoft.com/json)-Bibliothek von Newtonsoft und zusätzliche Klassen und **using**-Anweisungen, die im vollständigen Beispiel bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="e6b31-182">It requires the [Json.NET](http://www.newtonsoft.com/json) library from Newtonsoft and additional classes and **using** statements that are provided in the complete example.</span></span>

[!code-cs[<span data-ttu-id="e6b31-183">TargetedOffers</span><span class="sxs-lookup"><span data-stu-id="e6b31-183">TargetedOffers</span></span>](./code/StoreServicesExamples_TargetedOffers/cs/TargetedOffers.cs#ClaimOfferOnWindows1607AndLater)]

<span id="code-example" />
## <a name="complete-code-example"></a><span data-ttu-id="e6b31-184">Vollständiger Beispielcode</span><span class="sxs-lookup"><span data-stu-id="e6b31-184">Complete code example</span></span>

<span data-ttu-id="e6b31-185">Das folgende Codebeispiel veranschaulicht die folgenden Aufgaben:</span><span class="sxs-lookup"><span data-stu-id="e6b31-185">The following code example demonstrates the following tasks:</span></span>

* <span data-ttu-id="e6b31-186">Abrufen eines MSA-Tokens für den aktuellen Benutzer</span><span class="sxs-lookup"><span data-stu-id="e6b31-186">Get an MSA token for the current user.</span></span>
* <span data-ttu-id="e6b31-187">Abrufen aller gezielten Angebote für den aktuellen Benutzer mithilfe der Methode zum [Abrufen gezielter Angebote](get-targeted-offers.md)</span><span class="sxs-lookup"><span data-stu-id="e6b31-187">Get all of the targeted offers for the current user by using the [Get targeted offers](get-targeted-offers.md) method.</span></span>
* <span data-ttu-id="e6b31-188">Kaufen Sie das Add-On, das mit einem gezielten Angebot verknüpft ist.</span><span class="sxs-lookup"><span data-stu-id="e6b31-188">Purchase the add-on that is associated with a targeted offer.</span></span>
* <span data-ttu-id="e6b31-189">Inanspruchnahme des gezielten Angebots mithilfe der Methode zur [Inanspruchnahme eines gezielten Angebots](claim-a-targeted-offer.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-189">Claim the targeted offer by using the [Claim a targeted offer](claim-a-targeted-offer.md) method.</span></span>

<span data-ttu-id="e6b31-190">Dieses Beispiel erfordert die [Json.NET](http://www.newtonsoft.com/json)-Bibliothek von Newtonsoft.</span><span class="sxs-lookup"><span data-stu-id="e6b31-190">This example requires the [Json.NET](http://www.newtonsoft.com/json) library from Newtonsoft.</span></span> <span data-ttu-id="e6b31-191">Im Beispiel wird diese Bibliothek verwendet, um Daten im JSON-Format zu serialisieren bzw. deserialisieren.</span><span class="sxs-lookup"><span data-stu-id="e6b31-191">The example uses this library to serialize and deserialize JSON-formatted data.</span></span>

> [!NOTE]
> <span data-ttu-id="e6b31-192">Es gibt zwei verschiedene Namespaces für die Implementierung von In-App-Einkäufen in einer UWP-App: [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx) (eingeführt in Windows10, Version 1607) und [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx) (in allen Versionen von Windows10 verfügbar).</span><span class="sxs-lookup"><span data-stu-id="e6b31-192">There are two different namespaces for implementing in-app purchases in a UWP app: [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx) (introduced in Windows 10, version 1607) and [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx) (available in all versions of Windows 10).</span></span> <span data-ttu-id="e6b31-193">Dieses Beispiel verwendet [versionsadaptiven Code](../debug-test-perf/version-adaptive-code.md), um beide Namespaces in derselben App zu verwenden, um ein Add-On zu kaufen und einen Anspruch für das gezielte Angebot zu senden.</span><span class="sxs-lookup"><span data-stu-id="e6b31-193">This example uses [version adaptive code](../debug-test-perf/version-adaptive-code.md) to use both of these namespaces in the same app to purchase an add-on and submit a claim for the targeted offer.</span></span> <span data-ttu-id="e6b31-194">Um diesen Code zu verwenden, muss mit die Ziel-Betriebssystemversion des Projekts **Windows 10 Anniversary Edition (10.0; Build 14394)** oder höher sein, auch wenn die minimale Betriebssystemversion eine frühere Version sein kann (falls Sie Ihre App auch unter älteren Versionen von Windows 10 ausführen möchten).</span><span class="sxs-lookup"><span data-stu-id="e6b31-194">To use this code, the target OS version of your project must be **Windows 10 Anniversary Edition (10.0; Build 14394)** or later, although the minimum OS version can be an earlier version if you want to your app to run on earlier versions of Windows 10.</span></span> <span data-ttu-id="e6b31-195">Weitere Informationen zu den Unterschieden zwischen diesen Namespaces finden Sie unter [In-App-Käufe und Testversionen](in-app-purchases-and-trials.md).</span><span class="sxs-lookup"><span data-stu-id="e6b31-195">For more information about the differences between these namespaces, see [In-app purchases and trials](in-app-purchases-and-trials.md).</span></span>

[!code-cs[<span data-ttu-id="e6b31-196">TargetedOffers</span><span class="sxs-lookup"><span data-stu-id="e6b31-196">TargetedOffers</span></span>](./code/StoreServicesExamples_TargetedOffers/cs/TargetedOffers.cs#GetTargetedOffersSample)]

## <a name="related-topics"></a><span data-ttu-id="e6b31-197">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="e6b31-197">Related topics</span></span>

* [<span data-ttu-id="e6b31-198">Verwenden Sie zielgerichtete Angebote, um Interaktionen und Abschlüsse zu maximieren.</span><span class="sxs-lookup"><span data-stu-id="e6b31-198">Use targeted offers to maximize engagement and conversions</span></span>](../publish/use-targeted-offers-to-maximize-engagement-and-conversions.md)
* [<span data-ttu-id="e6b31-199">Abrufen gezielter Angebote</span><span class="sxs-lookup"><span data-stu-id="e6b31-199">Get targeted offers</span></span>](get-targeted-offers.md)
* [<span data-ttu-id="e6b31-200">Inanspruchnahme eines gezielten Angebots</span><span class="sxs-lookup"><span data-stu-id="e6b31-200">Claim a targeted offer</span></span>](claim-a-targeted-offer.md)
