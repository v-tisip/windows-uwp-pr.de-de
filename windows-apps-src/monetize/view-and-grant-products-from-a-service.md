---
author: Xansky
ms.assetid: B071F6BC-49D3-4E74-98EA-0461A1A55EFB
description: Wenn Sie über einen Katalog mit Apps und Add-Ons verfügen, können Sie mithilfe der Microsoft Store-Sammlungs-API und der Microsoft Store-Einkaufs-API Besitzerinformationen zu diesen Produkten aus Ihren Diensten abrufen.
title: Verwalten von Produktansprüchen aus einem Dienst
ms.author: mhopkins
ms.date: 08/01/2018
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows10, UWP, Microsoft Store-Sammlungs-API, Microsoft Store-Einkaufs-API, Produkte anzeigen, Produkte gewähren
ms.localizationpriority: medium
ms.openlocfilehash: c159acb096730d59b4d2667d890187199c5bda0a
ms.sourcegitcommit: 106aec1e59ba41aae2ac00f909b81bf7121a6ef1
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/15/2018
ms.locfileid: "4618443"
---
# <a name="manage-product-entitlements-from-a-service"></a><span data-ttu-id="97337-104">Verwalten von Produktansprüchen aus einem Dienst</span><span class="sxs-lookup"><span data-stu-id="97337-104">Manage product entitlements from a service</span></span>

<span data-ttu-id="97337-105">Wenn Sie über einen Katalog mit Apps und Add-Ons verfügen, können Sie mithilfe der *Microsoft Store-Sammlungs-API* und der *Microsoft Store-Einkaufs-API* Besitzerinformationen zu diesen Produkten aus Ihren Diensten abrufen.</span><span class="sxs-lookup"><span data-stu-id="97337-105">If you have a catalog of apps and add-ons, you can use the *Microsoft Store collection API* and *Microsoft Store purchase API* to access entitlement information for these products from your services.</span></span> <span data-ttu-id="97337-106">Eine *Berechtigung* ist das Recht des Kunden zur Nutzung einer über den Microsoft Store veröffentlichten App oder eines Add-ons.</span><span class="sxs-lookup"><span data-stu-id="97337-106">An *entitlement* represents a customer's right to use an app or add-on that is published through the Microsoft Store.</span></span>

<span data-ttu-id="97337-107">Diese APIs bestehen aus REST-Methoden, die für Entwickler mit Add-on-Katalogen konzipiert sind, die von plattformübergreifenden Diensten unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="97337-107">These APIs consist of REST methods that are designed to be used by developers with add-on catalogs that are supported by cross-platform services.</span></span> <span data-ttu-id="97337-108">Diese APIs bieten folgende Möglichkeiten:</span><span class="sxs-lookup"><span data-stu-id="97337-108">These APIs enable you to do the following:</span></span>

-   <span data-ttu-id="97337-109">Microsoft Store-Sammlungs-API: [Abfrage von Produkten, die einem Benutzer gehören](query-for-products.md) sowie [Meldung eines Verbrauchsprodukts als erfüllt](report-consumable-products-as-fulfilled.md).</span><span class="sxs-lookup"><span data-stu-id="97337-109">Microsoft Store collection API: [Query for products owned by a user](query-for-products.md) and [report a consumable product as fulfilled](report-consumable-products-as-fulfilled.md).</span></span>
-   <span data-ttu-id="97337-110">Microsoft Store-Einkaufs-API: [Einem Benutzer ein kostenloses Produkt gewähren](grant-free-products.md), [Abonnements für einen Benutzer abrufen](get-subscriptions-for-a-user.md) und [Abrechnungszustand eines Abonnements für einen Benutzer ändern](change-the-billing-state-of-a-subscription-for-a-user.md).</span><span class="sxs-lookup"><span data-stu-id="97337-110">Microsoft Store purchase API: [Grant a free product to a user](grant-free-products.md), [get subscriptions for a user](get-subscriptions-for-a-user.md), and [change the billing state of a subscription for a user](change-the-billing-state-of-a-subscription-for-a-user.md).</span></span>

> [!NOTE]
> <span data-ttu-id="97337-111">Die Microsoft Store-Sammlungs-API und -Einkaufs-API nutzen die Azure Active Directory (AzureAD)-Authentifizierung, um auf Besitzerinformationen von Kunden zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="97337-111">The Microsoft Store collection API and purchase API use Azure Active Directory (Azure AD) authentication to access customer ownership information.</span></span> <span data-ttu-id="97337-112">Zur Verwendung dieser APIs müssen Sie (bzw. Ihre Organisation) über ein Azure AD-Verzeichnis und die Berechtigung [Globaler Administrator](http://go.microsoft.com/fwlink/?LinkId=746654) für das Verzeichnis verfügen.</span><span class="sxs-lookup"><span data-stu-id="97337-112">To use these APIs, you (or your organization) must have an Azure AD directory and you must have [Global administrator](http://go.microsoft.com/fwlink/?LinkId=746654) permission for the directory.</span></span> <span data-ttu-id="97337-113">Wenn Sie bereits mit Office 365oder anderen Business Services von Microsoft arbeiten, verfügen Sie schon über ein Azure AD-Verzeichnis.</span><span class="sxs-lookup"><span data-stu-id="97337-113">If you already use Office 365 or other business services from Microsoft, you already have Azure AD directory.</span></span>

## <a name="overview"></a><span data-ttu-id="97337-114">Übersicht</span><span class="sxs-lookup"><span data-stu-id="97337-114">Overview</span></span>

<span data-ttu-id="97337-115">Die folgenden Schrittebeschreiben den vollständigen Vorgang der Verwendung der Microsoft Store-Sammlungs-API und der Einkaufs-API.:</span><span class="sxs-lookup"><span data-stu-id="97337-115">The following steps describe the end-to-end process for using the Microsoft Store collection API and purchase API:</span></span>

1.  <span data-ttu-id="97337-116">[Eine Anwendung in Azure AD konfigurieren](#step-1).</span><span class="sxs-lookup"><span data-stu-id="97337-116">[Configure an application in Azure AD](#step-1).</span></span>
2.  <span data-ttu-id="97337-117">[Ordnen Sie Ihre Azure AD-Anwendungs-ID mit Ihrer app im Windows Dev Center-Dashboard](#step-2).</span><span class="sxs-lookup"><span data-stu-id="97337-117">[Associate your Azure AD application ID with your app in the Windows Dev Center dashboard](#step-2).</span></span>
3.  <span data-ttu-id="97337-118">In Ihrem Dienst: [Erstellen Sie Azure AD-Zugriffstokens](#step-3), die Ihre Herausgeberidentität darstellen.</span><span class="sxs-lookup"><span data-stu-id="97337-118">In your service, [create Azure AD access tokens](#step-3) that represent your publisher identity.</span></span>
4.  <span data-ttu-id="97337-119">In der Client-Windows-app zurück, die die Identität des aktuellen Benutzers, und übergeben Sie diesem Schlüssel darstellt, [Erstellen Sie einen Microsoft Store-ID-Schlüssel](#step-4) an Ihren Dienst.</span><span class="sxs-lookup"><span data-stu-id="97337-119">In your client Windows app, [create a Microsoft Store ID key](#step-4) that represents the identity of the current user, and pass this key back to your service.</span></span>
5.  <span data-ttu-id="97337-120">Sobald Sie über das erforderliche AzureAD-Zugriffstoken und den Microsoft Store-ID-Schlüssel verfügen, [rufen Sie die Microsoft Store-Sammlungs-API oder -Einkaufs-API aus Ihrem Dienst auf](#step-5).</span><span class="sxs-lookup"><span data-stu-id="97337-120">After you have the required Azure AD access token and Microsoft Store ID key, [call the Microsoft Store collection API or purchase API from your service](#step-5).</span></span>

<span data-ttu-id="97337-121">Dieser End-to-End-Prozess umfasst zwei Softwarekomponenten, die verschiedene Aufgaben ausführen:</span><span class="sxs-lookup"><span data-stu-id="97337-121">This end-to-end process involves two software components that perform different tasks:</span></span>

* <span data-ttu-id="97337-122">**Ihr Dienst**.</span><span class="sxs-lookup"><span data-stu-id="97337-122">**Your service**.</span></span> <span data-ttu-id="97337-123">Dies ist eine Anwendung, die sicher im Kontext Ihrer geschäftlichen Umgebung ausgeführt wird, und mit allen Entwicklungsplattform gewählte implementiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="97337-123">This is an application that runs securely in the context of your business environment, and it can be implemented using any development platform you choose.</span></span> <span data-ttu-id="97337-124">Ihr Dienst ist verantwortlich für die Azure AD-Zugriffstoken erstellen für das Szenario und für den Aufruf der REST-URIs für die Microsoft Store-Sammlungs-API und -Einkaufs-API benötigt.</span><span class="sxs-lookup"><span data-stu-id="97337-124">Your service is responsible for creating the Azure AD access tokens needed for the scenario and for calling the REST URIs for the Microsoft Store collection API and purchase API.</span></span>
* <span data-ttu-id="97337-125">**Der Client Windows-app**.</span><span class="sxs-lookup"><span data-stu-id="97337-125">**Your client Windows app**.</span></span> <span data-ttu-id="97337-126">Dies ist die app für die Sie zugreifen und diese Berechtigung Kundeninformationen (einschließlich für die app-Add-Ons) verwalten möchten.</span><span class="sxs-lookup"><span data-stu-id="97337-126">This is the app for which you want to access and manage customer entitlement information (including add-ons for the app).</span></span> <span data-ttu-id="97337-127">Diese app ist verantwortlich für das Erstellen der Microsoft Store-ID-Schlüssel, die Sie zum Aufrufen der Microsoft Store-Sammlungs-API und -Einkaufs-API aus Ihrem Dienst benötigen.</span><span class="sxs-lookup"><span data-stu-id="97337-127">This app is responsible for creating the Microsoft Store ID keys you need to call the Microsoft Store collection API and purchase API from your service.</span></span>

<span id="step-1"/>

## <a name="step-1-configure-an-application-in-azure-ad"></a><span data-ttu-id="97337-128">Schritt 1: Konfigurieren einer Anwendungs in Azure AD</span><span class="sxs-lookup"><span data-stu-id="97337-128">Step 1: Configure an application in Azure AD</span></span>

<span data-ttu-id="97337-129">Bevor Sie mit der Microsoft Store-Sammlungs-API oder --API Einkaufs, müssen Sie eine Azure AD-Webanwendung erstellen, die Mandanten-ID und Anwendungs-ID für die Anwendung abrufen und einen Schlüssel generieren.</span><span class="sxs-lookup"><span data-stu-id="97337-129">Before you can use the Microsoft Store collection API or purchase API, you must create an Azure AD Web application, retrieve the tenant ID and application ID for the application, and generate a key.</span></span> <span data-ttu-id="97337-130">Die Azure AD-Webanwendung stellt den Dienst, aus dem Sie Aufrufen der Microsoft Store-Sammlungs-API oder -Einkaufs-API möchten.</span><span class="sxs-lookup"><span data-stu-id="97337-130">The Azure AD Web application represents the service from which you want to call the Microsoft Store collection API or purchase API.</span></span> <span data-ttu-id="97337-131">Sie benötigen die Mandanten-ID, den Anwendungs-ID und die Schlüssel zu Azure AD-Zugriffstoken generieren, die Sie benötigen die API aufrufen.</span><span class="sxs-lookup"><span data-stu-id="97337-131">You need the tenant ID, application ID and key to generate Azure AD access tokens that you need to call the API.</span></span>

> [!NOTE]
> <span data-ttu-id="97337-132">Sie müssen die in diesem Abschnitt beschriebenen Vorgänge nur einmal durchführen.</span><span class="sxs-lookup"><span data-stu-id="97337-132">You only need to perform the tasks in this section one time.</span></span> <span data-ttu-id="97337-133">Nachdem Sie Ihre Azure AD-Anwendungsmanifest aktualisiert, und Ihre Mandanten-ID, die Anwendungs-ID und Client Secret haben, können Sie wiederverwenden diese Werte jederzeit Sie zum Erstellen eines neuen müssen Azure AD-Zugriffstoken.</span><span class="sxs-lookup"><span data-stu-id="97337-133">After you update your Azure AD application manifest and you have your tenant ID, application ID and client secret, you can reuse these values any time you need to create a new Azure AD access token.</span></span>

1.  <span data-ttu-id="97337-134">Wenn Sie dies noch nicht geschehen, folgen Sie den Anweisungen in [Integrieren von Anwendungen in Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications) Registrieren einer **Web-app / API** -Anwendung mit Azure AD.</span><span class="sxs-lookup"><span data-stu-id="97337-134">If you haven't done so already, follow the instructions in [Integrating Applications with Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications) to register a **Web app / API** application with Azure AD.</span></span>
    > [!NOTE]
    > <span data-ttu-id="97337-135">Wenn Sie Ihre Anwendung registrieren, müssen Sie auswählen **Web-app / API** wie die Anwendung geben, damit Sie für Ihre Anwendung einen Schlüssel (auch als einen *geheimen Clientschlüssel*bezeichnet) abrufen können.</span><span class="sxs-lookup"><span data-stu-id="97337-135">When you register your application, you must choose **Web app / API** as the application type so that you can retrieve a key (also called a *client secret*) for your application.</span></span> <span data-ttu-id="97337-136">Zum Aufrufen der Microsoft Store-Sammlungs-API oder -Einkaufs-API müssen Sie einen geheimen Clientschlüssel angeben, wenn Sie in einem späteren Schritt ein Zugriffstoken von AzureAD anfordern.</span><span class="sxs-lookup"><span data-stu-id="97337-136">In order to call the Microsoft Store collection API or purchase API, you must provide a client secret when you request an access token from Azure AD in a later step.</span></span>

2.  <span data-ttu-id="97337-137">Navigieren Sie im [Azure-Verwaltungsportal](https://portal.azure.com/)zu **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="97337-137">In the [Azure Management Portal](https://portal.azure.com/), navigate to **Azure Active Directory**.</span></span> <span data-ttu-id="97337-138">Wählen Sie Ihr Verzeichnis, klicken Sie im linken Navigationsbereich auf **App-Registrierung** , und wählen Sie Ihre Anwendung.</span><span class="sxs-lookup"><span data-stu-id="97337-138">Select your directory, click **App registrations** in the left navigation pane, and then select your application.</span></span>
3.  <span data-ttu-id="97337-139">Sie werden auf die Anwendung main Registrierungsseite weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="97337-139">You are taken to the application's main registration page.</span></span> <span data-ttu-id="97337-140">Kopieren Sie auf dieser Seite die **Anwendungs-ID** -Wert zur späteren Verwendung.</span><span class="sxs-lookup"><span data-stu-id="97337-140">On this page, copy the **Application ID** value for use later.</span></span>
4.  <span data-ttu-id="97337-141">Erstellen Sie einen Schlüssel, die Sie später müssen (Dies wird alle bezeichnet einen *geheimen Clientschlüssel*).</span><span class="sxs-lookup"><span data-stu-id="97337-141">Create a key that you will need later (this is all called a *client secret*).</span></span> <span data-ttu-id="97337-142">Klicken Sie im linken Bereich auf **Einstellungen** und dann **Schlüssel**.</span><span class="sxs-lookup"><span data-stu-id="97337-142">In the left pane, click **Settings** and then **Keys**.</span></span> <span data-ttu-id="97337-143">Auf dieser Seite die Schritte zum [Erstellen eines Schlüssels](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications#to-add-application-credentials-or-permissions-to-access-web-apis).</span><span class="sxs-lookup"><span data-stu-id="97337-143">On this page, complete the steps to [create a key](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications#to-add-application-credentials-or-permissions-to-access-web-apis).</span></span> <span data-ttu-id="97337-144">Kopieren Sie diesen Schlüssel zur späteren Verwendung.</span><span class="sxs-lookup"><span data-stu-id="97337-144">Copy this key for later use.</span></span>
5.  <span data-ttu-id="97337-145">Fügen Sie Ihrem [Anwendungsmanifest](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-manifest)mehrere erforderliche Zielgruppen-URIs hinzu.</span><span class="sxs-lookup"><span data-stu-id="97337-145">Add several required audience URIs to your [application manifest](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-manifest).</span></span> <span data-ttu-id="97337-146">Klicken Sie im linken Bereich auf **Manifest**.</span><span class="sxs-lookup"><span data-stu-id="97337-146">In the left pane, click **Manifest**.</span></span> <span data-ttu-id="97337-147">Klicken Sie auf **Bearbeiten**, ersetzen Sie die `"identifierUris"` Abschnitt mit den folgenden Text, und klicken Sie dann auf **Speichern**.</span><span class="sxs-lookup"><span data-stu-id="97337-147">Click **Edit**, replace the `"identifierUris"` section with the following text, and then click **Save**.</span></span>

    ```json
    "identifierUris" : [                                
            "https://onestore.microsoft.com",
            "https://onestore.microsoft.com/b2b/keys/create/collections",
            "https://onestore.microsoft.com/b2b/keys/create/purchase"
        ],
    ```

    <span data-ttu-id="97337-148">Diese Zeichenfolgen stellen die von der Anwendung unterstützten Zielgruppen dar.</span><span class="sxs-lookup"><span data-stu-id="97337-148">These strings represent the audiences supported by your application.</span></span> <span data-ttu-id="97337-149">In einem späteren Schritt erstellen Sie Azure AD-Zugriffstoken, die den einzelnen Zielgruppenwerten zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="97337-149">In a later step, you will create Azure AD access tokens that are associated with each of these audience values.</span></span>

<span id="step-2"/>

## <a name="step-2-associate-your-azure-ad-application-id-with-your-client-app-in-windows-dev-center"></a><span data-ttu-id="97337-150">Schritt 2: Ordnen Sie Ihrer Azure AD-Anwendungs-ID mit der Client-app im Windows Dev Center zu</span><span class="sxs-lookup"><span data-stu-id="97337-150">Step 2: Associate your Azure AD application ID with your client app in Windows Dev Center</span></span>

<span data-ttu-id="97337-151">Bevor Sie mit der Microsoft Store-Sammlungs-API oder --API Einkaufs, um die Gesamtbetriebskosten und für Ihre app oder Add-on-Käufe konfigurieren, müssen Sie zuordnen Ihrer Azure AD-Anwendungs-ID der app (oder die app, die das Add-on enthält) im Dev Center-Dashboard.</span><span class="sxs-lookup"><span data-stu-id="97337-151">Before you can use the Microsoft Store collection API or purchase API to configure the ownership and purchases for your app or add-on, you must associate your Azure AD application ID with the app (or the app that contains the add-on) in the Dev Center dashboard.</span></span>

> [!NOTE]
> <span data-ttu-id="97337-152">Sie müssen diesen Schritt nur einmal ausführen.</span><span class="sxs-lookup"><span data-stu-id="97337-152">You only need to perform this task one time.</span></span>

1.  <span data-ttu-id="97337-153">Melden Sie sich beim [DevCenter-Dashboard](https://dev.windows.com/overview) an, und wählen Sie Ihre App aus.</span><span class="sxs-lookup"><span data-stu-id="97337-153">Sign in to the [Dev Center dashboard](https://dev.windows.com/overview) and select your app.</span></span>
2.  <span data-ttu-id="97337-154">Wechseln Sie zu den **Diensten** &gt; **produktsammlungen und Einkäufe** Seite, und geben Sie Ihre Azure AD-Anwendungs-ID in eines der verfügbaren **Client-ID** -Felder.</span><span class="sxs-lookup"><span data-stu-id="97337-154">Go to the **Services** &gt; **Product collections and purchases** page and enter your Azure AD application ID into one of the available **Client ID** fields.</span></span>

<span id="step-3"/>

## <a name="step-3-create-azure-ad-access-tokens"></a><span data-ttu-id="97337-155">Schritt3: Erstellen von Azure AD-Zugriffstokens</span><span class="sxs-lookup"><span data-stu-id="97337-155">Step 3: Create Azure AD access tokens</span></span>

<span data-ttu-id="97337-156">Bevor Sie einen Microsoft Store-ID-Schlüssel abrufen oder die Microsoft Store-Sammlungs-API oder -Einkaufs-API aufrufen können, muss Ihr Dienst mehrere verschiedene Azure AD-Zugriffstokens erstellen, die Ihre Herausgeberidentität darstellen.</span><span class="sxs-lookup"><span data-stu-id="97337-156">Before you can retrieve a Microsoft Store ID key or call the Microsoft Store collection API or purchase API, your service must create several different Azure AD access tokens that represent your publisher identity.</span></span> <span data-ttu-id="97337-157">Jedes Token wird mit einer anderen API verwendet.</span><span class="sxs-lookup"><span data-stu-id="97337-157">Each token will be used with a different API.</span></span> <span data-ttu-id="97337-158">Jedes Token ist 60Minuten gültig und kann nach Ablauf aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="97337-158">The lifetime of each token is 60 minutes, and you can refresh them after they expire.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="97337-159">Erstellen Sie Azure AD-Zugriffstoken nur im Kontext Ihres Diensts und nicht in Ihrer App.</span><span class="sxs-lookup"><span data-stu-id="97337-159">Create Azure AD access tokens only in the context of your service, not in your app.</span></span> <span data-ttu-id="97337-160">Ihr Clientgeheimnis könnte gefährdet sein, wenn es an Ihre App gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="97337-160">Your client secret could be compromised if it is sent to your app.</span></span>

<span id="access-tokens" />

### <a name="understanding-the-different-tokens-and-audience-uris"></a><span data-ttu-id="97337-161">Grundlegendes zu den unterschiedlichen Tokens und Zielgruppen-URIs</span><span class="sxs-lookup"><span data-stu-id="97337-161">Understanding the different tokens and audience URIs</span></span>

<span data-ttu-id="97337-162">Je nach den Methoden, die Sie in der Microsoft Store-Sammlungs-API oder -Einkaufs-API aufrufen möchten, müssen Sie zwei oder drei unterschiedliche Tokens erstellen.</span><span class="sxs-lookup"><span data-stu-id="97337-162">Depending on which methods you want to call in the Microsoft Store collection API or purchase API, you must create either two or three different tokens.</span></span> <span data-ttu-id="97337-163">Jedes Zugriffstoken ist einem anderen Zielgruppen-URI zugeordnet (Hierbei handelt es sich um die gleichen URIs, die Sie zuvor dem `"identifierUris"`-Abschnitt des Azure AD-Anwendungsmanifests hinzugefügt haben).</span><span class="sxs-lookup"><span data-stu-id="97337-163">Each access token is associated with a different audience URI (these are the same URIs that you previously added to the `"identifierUris"` section of the Azure AD application manifest).</span></span>

  * <span data-ttu-id="97337-164">In allen Fällen müssen Sie ein Token mit dem `https://onestore.microsoft.com`-Zielgruppen-URI erstellen.</span><span class="sxs-lookup"><span data-stu-id="97337-164">In all cases, you must create a token with the `https://onestore.microsoft.com` audience URI.</span></span> <span data-ttu-id="97337-165">In einem späteren Schritt übergeben Sie dieses Token an den **Autorisierung**-Kopf der Methoden in der Microsoft Store-Sammlungs- oder -Einkaufs-API.</span><span class="sxs-lookup"><span data-stu-id="97337-165">In a later step, you will pass this token to the **Authorization** header of methods in the Microsoft Store collection API or purchase API.</span></span>
      > [!IMPORTANT]
      > <span data-ttu-id="97337-166">Verwenden Sie die Zielgruppe `https://onestore.microsoft.com` nur mit Zugriffstoken, die sicher in Ihrem Dienst gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="97337-166">Use the `https://onestore.microsoft.com` audience only with access tokens that are stored securely within your service.</span></span> <span data-ttu-id="97337-167">Durch das Verfügbarmachen von Zugriffstokens mit dieser Zielgruppe außerhalb Ihres Diensts kann dieser anfällig für Replay-Angriffe werden.</span><span class="sxs-lookup"><span data-stu-id="97337-167">Exposing access tokens with this audience outside your service could make your service vulnerable to replay attacks.</span></span>

  * <span data-ttu-id="97337-168">Wenn Sie eine Methode in der Microsoft Store-Sammlungs-API zur [Abfrage von Produkten, die einem Benutzer gehören](query-for-products.md) oder zum [Melden eines Verbrauchsprodukts als erfüllt](report-consumable-products-as-fulfilled.md) aufrufen möchten, müssen Sie auch ein Token mit dem `https://onestore.microsoft.com/b2b/keys/create/collections`-Zielgruppen-URI erstellen.</span><span class="sxs-lookup"><span data-stu-id="97337-168">If you want to call a method in the Microsoft Store collection API to [query for products owned by a user](query-for-products.md) or [report a consumable product as fulfilled](report-consumable-products-as-fulfilled.md), you must also create a token with the `https://onestore.microsoft.com/b2b/keys/create/collections` audience URI.</span></span> <span data-ttu-id="97337-169">In einem späteren Schritt übergeben Sie dieses Token an eine Client-Methode im Windows SDK zur Abfrage eines MicrosoftStore-ID-Schlüssels, den Sie mit der Microsoft Store-Sammlungs-API verwenden können.</span><span class="sxs-lookup"><span data-stu-id="97337-169">In a later step, you will pass this token to a client method in the Windows SDK to request a Microsoft Store ID key that you can use with the Microsoft Store collection API.</span></span>

  * <span data-ttu-id="97337-170">Wenn Sie eine Methode in der Microsoft Store-Einkaufs-API aufrufen möchten, um [einem Benutzer ein kostenloses Produkt zu gewähren](grant-free-products.md), [Abonnements für einen Benutzer abzurufen](get-subscriptions-for-a-user.md) oder [den Abrechnungszustand eines Abonnements für einen Benutzer zu ändern](change-the-billing-state-of-a-subscription-for-a-user.md), müssen Sie auch ein Token mit dem `https://onestore.microsoft.com/b2b/keys/create/purchase`-Zielgruppen-URI erstellen.</span><span class="sxs-lookup"><span data-stu-id="97337-170">If you want to call a method in the Microsoft Store purchase API to [grant a free product to a user](grant-free-products.md), [get subscriptions for a user](get-subscriptions-for-a-user.md), or [change the billing state of a subscription for a user](change-the-billing-state-of-a-subscription-for-a-user.md), you must also create a token with the `https://onestore.microsoft.com/b2b/keys/create/purchase` audience URI.</span></span> <span data-ttu-id="97337-171">In einem späteren Schritt übergeben Sie dieses Token an eine Client-Methode im Windows SDK zur Abfrage eines MicrosoftStore-ID-Schlüssels, den Sie mit der Microsoft Store-Einkaufs-API verwenden können.</span><span class="sxs-lookup"><span data-stu-id="97337-171">In a later step, you will pass this token to a client method in the Windows SDK to request a Microsoft Store ID key that you can use with the Microsoft Store purchase API.</span></span>

<span />

### <a name="create-the-tokens"></a><span data-ttu-id="97337-172">Erstellen Sie Token</span><span class="sxs-lookup"><span data-stu-id="97337-172">Create the tokens</span></span>

<span data-ttu-id="97337-173">Verwenden Sie zum Erstellen der Zugriffstokens die OAuth 2.0-API in Ihrem Dienst gemäß den Anweisungen in [Aufrufe zwischen Diensten mithilfe von Clientanmeldeinformationen](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-service-to-service), um einen HTTP POST an den ```https://login.microsoftonline.com/<tenant_id>/oauth2/token```-Endpunkt zu senden.</span><span class="sxs-lookup"><span data-stu-id="97337-173">To create the access tokens, use the OAuth 2.0 API in your service by following the instructions in [Service to Service Calls Using Client Credentials](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-service-to-service) to send an HTTP POST to the ```https://login.microsoftonline.com/<tenant_id>/oauth2/token``` endpoint.</span></span> <span data-ttu-id="97337-174">Hier ist ein Beispiel für eine Anforderung angegeben.</span><span class="sxs-lookup"><span data-stu-id="97337-174">Here is a sample request.</span></span>

``` syntax
POST https://login.microsoftonline.com/<tenant_id>/oauth2/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded; charset=utf-8

grant_type=client_credentials
&client_id=<your_client_id>
&client_secret=<your_client_secret>
&resource=https://onestore.microsoft.com
```

<span data-ttu-id="97337-175">Geben Sie für jedes Token die folgenden Parameterdaten an:</span><span class="sxs-lookup"><span data-stu-id="97337-175">For each token, specify the following parameter data:</span></span>

* <span data-ttu-id="97337-176">Geben Sie für die Parameter *Client\_id* und *Client\_secret* die Anwendungs-ID und den geheimen Clientschlüssel Ihrer Anwendung, die Sie aus dem [Azure-Verwaltungsportal](http://manage.windowsazure.com)abgerufen haben.</span><span class="sxs-lookup"><span data-stu-id="97337-176">For the *client\_id* and *client\_secret* parameters, specify the application ID and the client secret for your application that you retrieved from the [Azure Management Portal](http://manage.windowsazure.com).</span></span> <span data-ttu-id="97337-177">Beide Parameter sind erforderlich, um ein Zugriffstoken mit der Authentifizierungsebene zu erstellen, die für die Microsoft Store-Sammlungs-API oder -Einkaufs-API benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="97337-177">Both of these parameters are required in order to create an access token with the level of authentication required by the Microsoft Store collection API or purchase API.</span></span>

* <span data-ttu-id="97337-178">Geben Sie für den Parameter *Ressource* einen der Zielgruppen-URIs aus dem [vorherigen Abschnitt](#access-tokens) an, je nach der Art des Zugriffstokens, den Sie erstellen.</span><span class="sxs-lookup"><span data-stu-id="97337-178">For the *resource* parameter, specify one of the audience URIs listed in the [previous section](#access-tokens), depending on the type of access token you are creating.</span></span>

<span data-ttu-id="97337-179">Nachdem das Zugriffstoken abgelaufen ist, können Sie es aktualisieren, indem Sie [diese Anleitung](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-code/#refreshing-the-access-tokens) befolgen.</span><span class="sxs-lookup"><span data-stu-id="97337-179">After your access token expires, you can refresh it by following the instructions [here](https://azure.microsoft.com/documentation/articles/active-directory-protocols-oauth-code/#refreshing-the-access-tokens).</span></span> <span data-ttu-id="97337-180">Weitere Informationen zur Struktur eines Zugriffstokens finden Sie unter [Unterstützte Token- und Anspruchstypen](http://go.microsoft.com/fwlink/?LinkId=722501).</span><span class="sxs-lookup"><span data-stu-id="97337-180">For more details about the structure of an access token, see [Supported Token and Claim Types](http://go.microsoft.com/fwlink/?LinkId=722501).</span></span>

<span id="step-4"/>

## <a name="step-4-create-a-microsoft-store-id-key"></a><span data-ttu-id="97337-181">Schritt4: Erstellen eines Microsoft Store-ID-Schlüssels</span><span class="sxs-lookup"><span data-stu-id="97337-181">Step 4: Create a Microsoft Store ID key</span></span>

<span data-ttu-id="97337-182">Bevor Sie eine Methode in der Microsoft Store-Sammlungs- oder -Einkaufs-API aufrufen können, muss Ihre App einen Microsoft Store-ID-Schlüssel erstellen und an Ihren Dienst senden.</span><span class="sxs-lookup"><span data-stu-id="97337-182">Before you can call any method in the Microsoft Store collection API or purchase API, your app must create a Microsoft Store ID key and send it to your service.</span></span> <span data-ttu-id="97337-183">Bei diesem Schlüssel handelt es sich um ein JSON Web Token (JWT), das die Identität des Benutzers darstellt, auf dessen Produktbesitzerinformationen Sie zugreifen möchten.</span><span class="sxs-lookup"><span data-stu-id="97337-183">This key is a JSON Web Token (JWT) that represents the identity of the user whose product ownership information you want to access.</span></span> <span data-ttu-id="97337-184">Weitere Informationen zu den Ansprüchen in diesem Schlüssel finden Sie unter [Ansprüche in einem Microsoft Store-ID-Schlüssel](#claims-in-a-microsoft-store-id-key).</span><span class="sxs-lookup"><span data-stu-id="97337-184">For more information about the claims in this key, see [Claims in a Microsoft Store ID key](#claims-in-a-microsoft-store-id-key).</span></span>

<span data-ttu-id="97337-185">Derzeit kann ein Microsoft Store-ID-Schlüssel ausschließlich durch Aufrufen einer UWP-API im clientseitigen Code Ihrer App erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="97337-185">Currently, the only way to create a Microsoft Store ID key is by calling a Universal Windows Platform (UWP) API from client code in your app.</span></span> <span data-ttu-id="97337-186">Der generierte Schlüssel repräsentiert die Identität des Benutzers, der derzeit auf dem Gerät beim Microsoft Store angemeldet ist.</span><span class="sxs-lookup"><span data-stu-id="97337-186">The generated key represents the identity of the user who is currently signed in to the Microsoft Store on the device.</span></span>

> [!NOTE]
> <span data-ttu-id="97337-187">Jeder Microsoft Store-ID-Schlüssel ist 90Tage gültig.</span><span class="sxs-lookup"><span data-stu-id="97337-187">Each Microsoft Store ID key is valid for 90 days.</span></span> <span data-ttu-id="97337-188">Nach dem Ablauf eines Schlüssels können Sie [den Schlüssel verlängern](renew-a-windows-store-id-key.md).</span><span class="sxs-lookup"><span data-stu-id="97337-188">After a key expires, you can [renew the key](renew-a-windows-store-id-key.md).</span></span> <span data-ttu-id="97337-189">Wir empfehlen, Microsoft Store-ID-Schlüssel zu verlängern, anstatt neue zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="97337-189">We recommend that you renew your Microsoft Store ID keys rather than creating new ones.</span></span>

<span />

### <a name="to-create-a-microsoft-store-id-key-for-the-microsoft-store-collection-api"></a><span data-ttu-id="97337-190">So erstellen Sie einen Microsoft Store-ID-Schlüssel für die Microsoft Store-Sammlungs-API</span><span class="sxs-lookup"><span data-stu-id="97337-190">To create a Microsoft Store ID key for the Microsoft Store collection API</span></span>

<span data-ttu-id="97337-191">Gehen Sie wie folgt vor, um einen Microsoft Store-ID-Schlüssel zu erstellen, den Sie mit der Microsoft Store-Sammlungs-API zur [Abfrage von Produkten, die einem Benutzer gehören](query-for-products.md) oder zum [Melden eines Verbrauchsprodukts als erfüllt](report-consumable-products-as-fulfilled.md) verwenden können.</span><span class="sxs-lookup"><span data-stu-id="97337-191">Follow these steps to create a Microsoft Store ID key that you can use with the Microsoft Store collection API to [query for products owned by a user](query-for-products.md) or [report a consumable product as fulfilled](report-consumable-products-as-fulfilled.md).</span></span>

1.  <span data-ttu-id="97337-192">Übergeben Sie das Azure AD-Zugriffstoken, das den `https://onestore.microsoft.com/b2b/keys/create/collections`-Zielgruppen-URI-Wert hat, aus Ihrem Dienst an Ihre Client-App.</span><span class="sxs-lookup"><span data-stu-id="97337-192">Pass the Azure AD access token that has the audience URI value `https://onestore.microsoft.com/b2b/keys/create/collections` from your service to your client app.</span></span> <span data-ttu-id="97337-193">Dies ist eines der von Ihnen [weiter oben in Schritt3](#step-3) erstellten Token.</span><span class="sxs-lookup"><span data-stu-id="97337-193">This is one of the tokens you created [earlier in step 3](#step-3).</span></span>

2.  <span data-ttu-id="97337-194">Rufen Sie in Ihrem App-Code diese Methoden auf, um einen Microsoft Store-ID-Schlüssel abzurufen:</span><span class="sxs-lookup"><span data-stu-id="97337-194">In your app code, call one of these methods to retrieve a Microsoft Store ID key:</span></span>

  * <span data-ttu-id="97337-195">Wenn Ihre App die [StoreContext](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext)-Klasse im [Windows.Services.Store](https://docs.microsoft.com/uwp/api/windows.services.store)-Namespace zur Verwaltung von In-App-Käufen verwendet, verwenden Sie die Methode [StoreContext.GetCustomerCollectionsIdAsync](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getcustomercollectionsidasync).</span><span class="sxs-lookup"><span data-stu-id="97337-195">If your app uses the [StoreContext](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext) class in the [Windows.Services.Store](https://docs.microsoft.com/uwp/api/windows.services.store) namespace to manage in-app purchases, use the [StoreContext.GetCustomerCollectionsIdAsync](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getcustomercollectionsidasync) method.</span></span>

  * <span data-ttu-id="97337-196">Wenn Ihre App die [CurrentApp](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp) -Klasse im [Windows.ApplicationModel.Store](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store) -Namespace zur Verwaltung von In-App-Käufen verwendet, verwenden Sie die Methode [CurrentApp.GetCustomerCollectionsIdAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.getcustomercollectionsidasync).</span><span class="sxs-lookup"><span data-stu-id="97337-196">If your app uses the [CurrentApp](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp) class in the [Windows.ApplicationModel.Store](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store) namespace to manage in-app purchases, use the [CurrentApp.GetCustomerCollectionsIdAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.getcustomercollectionsidasync) method.</span></span>

    <span data-ttu-id="97337-197">Übergeben Sie Ihr AzureAD-Zugriffstoken an den *serviceTicket*-Parameter der Methode.</span><span class="sxs-lookup"><span data-stu-id="97337-197">Pass your Azure AD access token to the *serviceTicket* parameter of the method.</span></span> <span data-ttu-id="97337-198">Wenn Sie anonymen Benutzer-IDs im Kontext der Dienste, die Sie als der Herausgeber der aktuellen app verwalten verwalten, können Sie auch eine Benutzer-ID an den *PublisherUserId* Parameter übergeben, den neuen Microsoft Store-ID-Schlüssel des aktuellen Benutzers zugeordnet (die Benutzer-ID Em sein eingelaufen im Schlüssel).</span><span class="sxs-lookup"><span data-stu-id="97337-198">If you maintain anonymous user IDs in the context of services that you manage as the publisher of the current app, you can also pass a user ID to the *publisherUserId* parameter to associate the current user with the new Microsoft Store ID key (the user ID will be embedded in the key).</span></span> <span data-ttu-id="97337-199">Wenn Sie keine Benutzer-ID mit dem Microsoft Store-ID-Schlüssel zuordnen möchten, können Sie andernfalls einen Zeichenfolgenwert an den *PublisherUserId* -Parameter übergeben.</span><span class="sxs-lookup"><span data-stu-id="97337-199">Otherwise, if you don't need to associate a user ID with the Microsoft Store ID key, you can pass any string value to the *publisherUserId* parameter.</span></span>

3.  <span data-ttu-id="97337-200">Übergeben Sie den von Ihrer App erfolgreich erstellten Microsoft Store-ID-Schlüssel zurück an Ihren Dienst.</span><span class="sxs-lookup"><span data-stu-id="97337-200">After your app successfully creates a Microsoft Store ID key, pass the key back to your service.</span></span>

<span />

### <a name="to-create-a-microsoft-store-id-key-for-the-microsoft-store-purchase-api"></a><span data-ttu-id="97337-201">So erstellen Sie einen Microsoft Store-ID-Schlüssel für die Microsoft Store-Einkaufs-API</span><span class="sxs-lookup"><span data-stu-id="97337-201">To create a Microsoft Store ID key for the Microsoft Store purchase API</span></span>

<span data-ttu-id="97337-202">Befolgen Sie diese Schritte zur Erstellung eines Microsoft Store-ID-Schlüssels, mit dem Sie– in Kombination mir der Microsoft Store-Einkaufs-API– [einem Benutzer ein kostenloses Produkt gewähren](grant-free-products.md), [Abonnements für einen Benutzer abrufen](get-subscriptions-for-a-user.md) oder [den Abrechnungszustand eines Abonnements für einen Benutzer ändern](change-the-billing-state-of-a-subscription-for-a-user.md) können.</span><span class="sxs-lookup"><span data-stu-id="97337-202">Follow these steps to create a Microsoft Store ID key that you can use with the Microsoft Store purchase API to [grant a free product to a user](grant-free-products.md), [get subscriptions for a user](get-subscriptions-for-a-user.md), or [change the billing state of a subscription for a user](change-the-billing-state-of-a-subscription-for-a-user.md).</span></span>

1.  <span data-ttu-id="97337-203">Übergeben Sie das Azure AD-Zugriffstoken, das den `https://onestore.microsoft.com/b2b/keys/create/purchase`-Zielgruppen-URI-Wert hat, aus Ihrem Dienst an Ihre Client-App.</span><span class="sxs-lookup"><span data-stu-id="97337-203">Pass the Azure AD access token that has the audience URI value `https://onestore.microsoft.com/b2b/keys/create/purchase` from your service to your client app.</span></span> <span data-ttu-id="97337-204">Dies ist eines der von Ihnen [weiter oben in Schritt3](#step-3) erstellten Token.</span><span class="sxs-lookup"><span data-stu-id="97337-204">This is one of the tokens you created [earlier in step 3](#step-3).</span></span>

2.  <span data-ttu-id="97337-205">Rufen Sie in Ihrem App-Code diese Methoden auf, um einen Microsoft Store-ID-Schlüssel abzurufen:</span><span class="sxs-lookup"><span data-stu-id="97337-205">In your app code, call one of these methods to retrieve a Microsoft Store ID key:</span></span>

  * <span data-ttu-id="97337-206">Wenn Ihre App die [StoreContext](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext)-Klasse im [Windows.Services.Store](https://docs.microsoft.com/uwp/api/windows.services.store)-Namespace zur Verwaltung von In-App-Käufen verwendet, verwenden Sie die Methode [StoreContext.GetCustomerPurchaseIdAsync](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getcustomerpurchaseidasync).</span><span class="sxs-lookup"><span data-stu-id="97337-206">If your app uses the [StoreContext](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext) class in the [Windows.Services.Store](https://docs.microsoft.com/uwp/api/windows.services.store) namespace to manage in-app purchases, use the [StoreContext.GetCustomerPurchaseIdAsync](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.getcustomerpurchaseidasync) method.</span></span>

  * <span data-ttu-id="97337-207">Wenn Ihre App die [CurrentApp](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp) -Klasse im [Windows.ApplicationModel.Store](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store) -Namespace zur Verwaltung von In-App-Käufen verwendet, verwenden Sie die Methode [CurrentApp.GetCustomerPurchaseIdAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.getcustomerpurchaseidasync).</span><span class="sxs-lookup"><span data-stu-id="97337-207">If your app uses the [CurrentApp](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp) class in the [Windows.ApplicationModel.Store](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store) namespace to manage in-app purchases, use the [CurrentApp.GetCustomerPurchaseIdAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.getcustomerpurchaseidasync) method.</span></span>

    <span data-ttu-id="97337-208">Übergeben Sie Ihr AzureAD-Zugriffstoken an den *serviceTicket*-Parameter der Methode.</span><span class="sxs-lookup"><span data-stu-id="97337-208">Pass your Azure AD access token to the *serviceTicket* parameter of the method.</span></span> <span data-ttu-id="97337-209">Wenn Sie anonymen Benutzer-IDs im Kontext der Dienste, die Sie als der Herausgeber der aktuellen app verwalten verwalten, können Sie auch eine Benutzer-ID an den *PublisherUserId* Parameter übergeben, den neuen Microsoft Store-ID-Schlüssel des aktuellen Benutzers zugeordnet (die Benutzer-ID Em sein eingelaufen im Schlüssel).</span><span class="sxs-lookup"><span data-stu-id="97337-209">If you maintain anonymous user IDs in the context of services that you manage as the publisher of the current app, you can also pass a user ID to the *publisherUserId* parameter to associate the current user with the new Microsoft Store ID key (the user ID will be embedded in the key).</span></span> <span data-ttu-id="97337-210">Wenn Sie keine Benutzer-ID mit dem Microsoft Store-ID-Schlüssel zuordnen möchten, können Sie andernfalls einen Zeichenfolgenwert an den *PublisherUserId* -Parameter übergeben.</span><span class="sxs-lookup"><span data-stu-id="97337-210">Otherwise, if you don't need to associate a user ID with the Microsoft Store ID key, you can pass any string value to the *publisherUserId* parameter.</span></span>

3.  <span data-ttu-id="97337-211">Übergeben Sie den von Ihrer App erfolgreich erstellten Microsoft Store-ID-Schlüssel zurück an Ihren Dienst.</span><span class="sxs-lookup"><span data-stu-id="97337-211">After your app successfully creates a Microsoft Store ID key, pass the key back to your service.</span></span>

### <a name="diagram"></a><span data-ttu-id="97337-212">Diagramm</span><span class="sxs-lookup"><span data-stu-id="97337-212">Diagram</span></span>

<span data-ttu-id="97337-213">Das folgende Diagramm zeigt den Prozess zum Erstellen eines Microsoft Store-ID-Schlüssels.</span><span class="sxs-lookup"><span data-stu-id="97337-213">The following diagram illustrates the process of creating a Microsoft Store ID key.</span></span>

  ![Windows Store-ID-Schlüssel erstellen](images/b2b-1.png)

<span id="step-5"/>

## <a name="step-5-call-the-microsoft-store-collection-api-or-purchase-api-from-your-service"></a><span data-ttu-id="97337-215">Schritt5: Aufrufen der Microsoft Store-Sammlungs-API oder -Einkaufs-API aus Ihrem Dienst</span><span class="sxs-lookup"><span data-stu-id="97337-215">Step 5: Call the Microsoft Store collection API or purchase API from your service</span></span>

<span data-ttu-id="97337-216">Wenn Ihr Dienst über einen Microsoft Store-ID-Schlüssel verfügt, der den Zugriff auf die Produkteigentümerinformationen eines bestimmten Benutzers ermöglicht, kann der Dienst wie folgt die Microsoft Store-Sammlungs-API oder -Einkaufs-API aufrufen:</span><span class="sxs-lookup"><span data-stu-id="97337-216">After your service has a Microsoft Store ID key that enables it to access a specific user's product ownership information, your service can call the Microsoft Store collection API or purchase API by following these instructions:</span></span>

* [<span data-ttu-id="97337-217">Produktabfrage</span><span class="sxs-lookup"><span data-stu-id="97337-217">Query for products</span></span>](query-for-products.md)
* [<span data-ttu-id="97337-218">Melden von Verbrauchsprodukten als erfüllt</span><span class="sxs-lookup"><span data-stu-id="97337-218">Report consumable products as fulfilled</span></span>](report-consumable-products-as-fulfilled.md)
* [<span data-ttu-id="97337-219">Gewähren von kostenlosen Produkten</span><span class="sxs-lookup"><span data-stu-id="97337-219">Grant free products</span></span>](grant-free-products.md)
* [<span data-ttu-id="97337-220">Abrufen von Abonnements für einen Benutzer</span><span class="sxs-lookup"><span data-stu-id="97337-220">Get subscriptions for a user</span></span>](get-subscriptions-for-a-user.md)
* [<span data-ttu-id="97337-221">Ändern des Abrechnungszustands eines Abonnements für Benutzer</span><span class="sxs-lookup"><span data-stu-id="97337-221">Change the billing state of a subscription for a user</span></span>](change-the-billing-state-of-a-subscription-for-a-user.md)

<span data-ttu-id="97337-222">Übergeben Sie bei jedem Szenario die folgenden Informationen an die API:</span><span class="sxs-lookup"><span data-stu-id="97337-222">For each scenario, pass the following information to the API:</span></span>

-   <span data-ttu-id="97337-223">Übergeben Sie im Anforderungsheader das Azure AD-Zugriffstoken, das den Zielgruppen-URI-Wert `https://onestore.microsoft.com` hat.</span><span class="sxs-lookup"><span data-stu-id="97337-223">In the request header, pass the Azure AD access token that has the audience URI value `https://onestore.microsoft.com`.</span></span> <span data-ttu-id="97337-224">Dies ist eines der von Ihnen [weiter oben in Schritt3](#step-3) erstellten Token.</span><span class="sxs-lookup"><span data-stu-id="97337-224">This is one of the tokens you created [earlier in step 3](#step-3).</span></span> <span data-ttu-id="97337-225">Dieses Token stellt die Herausgeberidentität dar.</span><span class="sxs-lookup"><span data-stu-id="97337-225">This token represents your publisher identity.</span></span>
-   <span data-ttu-id="97337-226">Geben Sie den Microsoft Store-ID-Schlüssel im Anforderungstext ein, den Sie [weiter oben in Schritt4](#step-4) aus dem clientseitigen Code in Ihrer App erhalten haben.</span><span class="sxs-lookup"><span data-stu-id="97337-226">In the request body, pass the Microsoft Store ID key you retrieved [earlier in step 4](#step-4) from client-side code in your app.</span></span> <span data-ttu-id="97337-227">Dieser Schlüssel stellt die Identität des Benutzers dar, auf dessen Produktbesitzerinformationen Sie zugreifen möchten.</span><span class="sxs-lookup"><span data-stu-id="97337-227">This key represents the identity of the user whose product ownership information you want to access.</span></span>

### <a name="diagram"></a><span data-ttu-id="97337-228">Diagramm</span><span class="sxs-lookup"><span data-stu-id="97337-228">Diagram</span></span>

<span data-ttu-id="97337-229">Im folgende Diagramm wird das Aufrufen einer Methode in der Microsoft Store-Sammlungs-API oder -Einkaufs-API aus Ihrem Dienst beschrieben.</span><span class="sxs-lookup"><span data-stu-id="97337-229">The following diagram describes the process of calling a method in the Microsoft Store collection API or purchase API from your service.</span></span>

  ![Rufen Sie Sammlungen oder Kauf API](images/b2b-2.png)

## <a name="claims-in-a-microsoft-store-id-key"></a><span data-ttu-id="97337-231">Ansprüche in einem Microsoft Store-ID-Schlüssel</span><span class="sxs-lookup"><span data-stu-id="97337-231">Claims in a Microsoft Store ID key</span></span>

<span data-ttu-id="97337-232">Ein Microsoft Store-ID-Schlüssel ist ein JSON Web Token (JWT), das die Identität des Benutzers darstellt, auf dessen Produktbesitzerinformationen Sie zugreifen möchten.</span><span class="sxs-lookup"><span data-stu-id="97337-232">A Microsoft Store ID key is a JSON Web Token (JWT) that represents the identity of the user whose product ownership information you want to access.</span></span> <span data-ttu-id="97337-233">Bei der Decodierung unter Verwendung von Base64 enthält ein Microsoft Store-ID-Schlüssel die folgenden Ansprüche.</span><span class="sxs-lookup"><span data-stu-id="97337-233">When decoded using Base64, a Microsoft Store ID key contains the following claims.</span></span>

* `iat`<span data-ttu-id="97337-234">:&nbsp;&nbsp;&nbsp;Gibt den Ausgabezeitpunkt des Schlüssels an.</span><span class="sxs-lookup"><span data-stu-id="97337-234">:&nbsp;&nbsp;&nbsp;Identifies the time at which the key was issued.</span></span> <span data-ttu-id="97337-235">Mit diesem Anspruch kann das Alter des Tokens bestimmt werden.</span><span class="sxs-lookup"><span data-stu-id="97337-235">This claim can be used to determine the age of the token.</span></span> <span data-ttu-id="97337-236">Dieser Wert wird als Epoche ausgedrückt.</span><span class="sxs-lookup"><span data-stu-id="97337-236">This value is expressed as epoch time.</span></span>
* `iss`<span data-ttu-id="97337-237">:&nbsp;&nbsp;&nbsp;Gibt den Aussteller an.</span><span class="sxs-lookup"><span data-stu-id="97337-237">:&nbsp;&nbsp;&nbsp;Identifies the issuer.</span></span> <span data-ttu-id="97337-238">Dieser hat den gleichen Wert wie der `aud`-Anspruch.</span><span class="sxs-lookup"><span data-stu-id="97337-238">This has the same value as the `aud` claim.</span></span>
* `aud`<span data-ttu-id="97337-239">:&nbsp;&nbsp;&nbsp;Gibt die Zielgruppe an.</span><span class="sxs-lookup"><span data-stu-id="97337-239">:&nbsp;&nbsp;&nbsp;Identifies the audience.</span></span> <span data-ttu-id="97337-240">Muss einem der folgenden Werte entsprechen: `https://collections.mp.microsoft.com/v6.0/keys` oder `https://purchase.mp.microsoft.com/v6.0/keys`.</span><span class="sxs-lookup"><span data-stu-id="97337-240">Must be one of the following values: `https://collections.mp.microsoft.com/v6.0/keys` or `https://purchase.mp.microsoft.com/v6.0/keys`.</span></span>
* `exp`<span data-ttu-id="97337-241">:&nbsp;&nbsp;&nbsp;Gibt die Ablaufzeit an, nach der der Schlüssel nicht mehr für Verarbeitungsvorgänge akzeptiert wird, außer für die Verlängerung von Schlüsseln.</span><span class="sxs-lookup"><span data-stu-id="97337-241">:&nbsp;&nbsp;&nbsp;Identifies the expiration time on or after which the key will no longer be accepted for processing anything except for renewing keys.</span></span> <span data-ttu-id="97337-242">Der Wert dieses Anspruchs wird als Epoche ausgedrückt.</span><span class="sxs-lookup"><span data-stu-id="97337-242">The value of this claim is expressed as epoch time.</span></span>
* `nbf`<span data-ttu-id="97337-243">&nbsp;&nbsp;&nbsp;Gibt die Zeit an, zu der das Token für die Verarbeitung akzeptiert wird.</span><span class="sxs-lookup"><span data-stu-id="97337-243">:&nbsp;&nbsp;&nbsp;Identifies the time at which the token will be accepted for processing.</span></span> <span data-ttu-id="97337-244">Der Wert dieses Anspruchs wird als Epoche ausgedrückt.</span><span class="sxs-lookup"><span data-stu-id="97337-244">The value of this claim is expressed as epoch time.</span></span>
* `http://schemas.microsoft.com/marketplace/2015/08/claims/key/clientId`<span data-ttu-id="97337-245">:&nbsp;&nbsp;&nbsp;Die Client-ID, die den Entwickler angibt.</span><span class="sxs-lookup"><span data-stu-id="97337-245">:&nbsp;&nbsp;&nbsp;The client ID that identifies the developer.</span></span>
* `http://schemas.microsoft.com/marketplace/2015/08/claims/key/payload`<span data-ttu-id="97337-246">:&nbsp;&nbsp;&nbsp;Eine opake (verschlüsselte und Base64-codierte) Nutzlast mit Informationen, die ausschließlich von Microsoft Store-Diensten verwendet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="97337-246">:&nbsp;&nbsp;&nbsp;An opaque payload (encrypted and Base64 encoded) that contains information that is intended only for use by Microsoft Store services.</span></span>
* `http://schemas.microsoft.com/marketplace/2015/08/claims/key/userId`<span data-ttu-id="97337-247">:&nbsp;&nbsp;&nbsp;Eine Benutzer-ID, die den aktuellen Benutzer im Kontext Ihrer Dienste angibt.</span><span class="sxs-lookup"><span data-stu-id="97337-247">:&nbsp;&nbsp;&nbsp;A user ID that identifies the current user in the context of your services.</span></span> <span data-ttu-id="97337-248">Dies ist der gleiche Wert, den Sie an den optionalen *publisherUserId*-Parameter der [Methode zum Erstellen des Schlüssels](#step-4) übergeben.</span><span class="sxs-lookup"><span data-stu-id="97337-248">This is the same value you pass into the optional *publisherUserId* parameter of the [method you use to create the key](#step-4).</span></span>
* `http://schemas.microsoft.com/marketplace/2015/08/claims/key/refreshUri`<span data-ttu-id="97337-249">:&nbsp;&nbsp;&nbsp;Der URI, mit dem Sie den Schlüssel verlängern können.</span><span class="sxs-lookup"><span data-stu-id="97337-249">:&nbsp;&nbsp;&nbsp;The URI that you can use to renew the key.</span></span>

<span data-ttu-id="97337-250">Hier ist ein Beispiel für einen decodierten MicrosoftStore-ID-Schlüsselkopf.</span><span class="sxs-lookup"><span data-stu-id="97337-250">Here is an example of a decoded Microsoft Store ID key header.</span></span>

```json
{
    "typ":"JWT",
    "alg":"RS256",
    "x5t":"agA_pgJ7Twx_Ex2_rEeQ2o5fZ5g"
}
```

<span data-ttu-id="97337-251">Hier ein Beispiel für einen decodierten Satz von Microsoft Store-ID-Schlüsselansprüchen.</span><span class="sxs-lookup"><span data-stu-id="97337-251">Here is an example of a decoded Microsoft Store ID key claim set.</span></span>

```json
{
    "http://schemas.microsoft.com/marketplace/2015/08/claims/key/clientId": "1d5773695a3b44928227393bfef1e13d",
    "http://schemas.microsoft.com/marketplace/2015/08/claims/key/payload": "ZdcOq0/N2rjytCRzCHSqnfczv3f0343wfSydx7hghfu0snWzMqyoAGy5DSJ5rMSsKoQFAccs1iNlwlGrX+/eIwh/VlUhLrncyP8c18mNAzAGK+lTAd2oiMQWRRAZxPwGrJrwiq2fTq5NOVDnQS9Za6/GdRjeiQrv6c0x+WNKxSQ7LV/uH1x+IEhYVtDu53GiXIwekltwaV6EkQGphYy7tbNsW2GqxgcoLLMUVOsQjI+FYBA3MdQpalV/aFN4UrJDkMWJBnmz3vrxBNGEApLWTS4Bd3cMswXsV9m+VhOEfnv+6PrL2jq8OZFoF3FUUpY8Fet2DfFr6xjZs3CBS1095J2yyNFWKBZxAXXNjn+zkvqqiVRjjkjNajhuaNKJk4MGHfk2rZiMy/aosyaEpCyncdisHVSx/S4JwIuxTnfnlY24vS0OXy7mFiZjjB8qL03cLsBXM4utCyXSIggb90GAx0+EFlVoJD7+ZKlm1M90xO/QSMDlrzFyuqcXXDBOnt7rPynPTrOZLVF+ODI5HhWEqArkVnc5MYnrZD06YEwClmTDkHQcxCvU+XUEvTbEk69qR2sfnuXV4cJRRWseUTfYoGyuxkQ2eWAAI1BXGxYECIaAnWF0W6ThweL5ZZDdadW9Ug5U3fZd4WxiDlB/EZ3aTy8kYXTW4Uo0adTkCmdLibw=",
    "http://schemas.microsoft.com/marketplace/2015/08/claims/key/userId": "infusQMLaYCrgtC0d/SZWoPB4FqLEwHXgZFuMJ6TuTY=",
    "http://schemas.microsoft.com/marketplace/2015/08/claims/key/refreshUri": "https://collections.mp.microsoft.com/v6.0/b2b/keys/renew",
    "iat": 1442395542,
    "iss": "https://collections.mp.microsoft.com/v6.0/keys",
    "aud": "https://collections.mp.microsoft.com/v6.0/keys",
    "exp": 1450171541,
    "nbf": 1442391941
}
```

## <a name="related-topics"></a><span data-ttu-id="97337-252">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="97337-252">Related topics</span></span>

* [<span data-ttu-id="97337-253">Produktabfrage</span><span class="sxs-lookup"><span data-stu-id="97337-253">Query for products</span></span>](query-for-products.md)
* [<span data-ttu-id="97337-254">Melden von Verbrauchsprodukten als erfüllt</span><span class="sxs-lookup"><span data-stu-id="97337-254">Report consumable products as fulfilled</span></span>](report-consumable-products-as-fulfilled.md)
* [<span data-ttu-id="97337-255">Gewähren von kostenlosen Produkten</span><span class="sxs-lookup"><span data-stu-id="97337-255">Grant free products</span></span>](grant-free-products.md)
* [<span data-ttu-id="97337-256">Abrufen von Abonnements für einen Benutzer</span><span class="sxs-lookup"><span data-stu-id="97337-256">Get subscriptions for a user</span></span>](get-subscriptions-for-a-user.md)
* [<span data-ttu-id="97337-257">Ändern des Abrechnungszustands eines Abonnements für einen Benutzer</span><span class="sxs-lookup"><span data-stu-id="97337-257">Change the billing state of a subscription for a user</span></span>](change-the-billing-state-of-a-subscription-for-a-user.md)
* [<span data-ttu-id="97337-258">Verlängern eines Microsoft Store-ID-Schlüssels</span><span class="sxs-lookup"><span data-stu-id="97337-258">Renew a Microsoft Store ID key</span></span>](renew-a-windows-store-id-key.md)
* [<span data-ttu-id="97337-259">Integrieren von Anwendungen in Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="97337-259">Integrating Applications with Azure Active Directory</span></span>](http://go.microsoft.com/fwlink/?LinkId=722502)
* [<span data-ttu-id="97337-260">Grundlegendes zum AzureActiveDirectory-Anwendungsmanifest</span><span class="sxs-lookup"><span data-stu-id="97337-260">Understanding the Azure Active Directory application manifest</span></span>]( http://go.microsoft.com/fwlink/?LinkId=722500)
* [<span data-ttu-id="97337-261">Unterstützte Token- und Anspruchstypen</span><span class="sxs-lookup"><span data-stu-id="97337-261">Supported Token and Claim Types</span></span>](http://go.microsoft.com/fwlink/?LinkId=722501)
