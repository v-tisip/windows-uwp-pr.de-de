---
author: drewbatgit
ms.assetid: a128edc8-8a80-4645-ac29-908ede2d1c72
description: "In diesem Artikel wird beschrieben, wie Sie mit „MediaFrameReader“ und „MediaCapture“ Medienframes aus einer oder mehreren verfügbaren Quellen abrufen. Hierzu zählen Farb-, Tiefen- und Infrarotkameras sowie Audiogeräte und sogar benutzerdefinierte Framequellen (etwa für Skeletal-Tracking-Frames)."
title: "Verarbeiten von Medienframes mit „MediaFrameReader“"
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows10, UWP
ms.openlocfilehash: bc0cfc468613429d7989c9c0d93bd98246c0195b
ms.sourcegitcommit: 7540962003b38811e6336451bb03d46538b35671
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 05/26/2017
---
# <a name="process-media-frames-with-mediaframereader"></a><span data-ttu-id="c827b-104">Verarbeiten von Medienframes mit „MediaFrameReader“</span><span class="sxs-lookup"><span data-stu-id="c827b-104">Process media frames with MediaFrameReader</span></span>

<span data-ttu-id="c827b-105">In diesem Artikel wird beschrieben, wie Sie mit [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader) und [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture) Medienframes aus einer oder mehreren verfügbaren Quellen abrufen. Hierzu zählen Farb-, Tiefen- und Infrarotkameras sowie Audiogeräte und sogar benutzerdefinierte Framequellen (etwa für Skeletal-Tracking-Frames).</span><span class="sxs-lookup"><span data-stu-id="c827b-105">This article shows you how to use a [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader) with [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture) to get media frames from one or more available sources, including color, depth, and infrared cameras, audio devices, or even custom frame sources such as those that produce skeletal tracking frames.</span></span> <span data-ttu-id="c827b-106">Dieses Feature wurde für die Verwendung von Apps entworfen, die Medienframes in Echtzeit verarbeiten, wie beispielsweise Augmented-Reality- und Tiefenkamera-Apps.</span><span class="sxs-lookup"><span data-stu-id="c827b-106">This feature is designed to be used by apps that perform real-time processing of media frames, such as augmented reality and depth-aware camera apps.</span></span>

<span data-ttu-id="c827b-107">Wenn Sie normale Videos oder Fotos aufnehmen möchten, wie mit einer typischen Foto-App, sollten Sie möglicherweise eine der anderen Aufnahmemethoden verwenden, die von [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture) unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="c827b-107">If you are interested in simply capturing video or photos, such as a typical photography app, then you probably want to use one of the other capture techniques supported by [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture).</span></span> <span data-ttu-id="c827b-108">Eine Liste der verfügbaren Methoden zur Medienaufnahme und Artikel zu ihrer Verwendung finden Sie unter [**Kamera**](camera.md).</span><span class="sxs-lookup"><span data-stu-id="c827b-108">For a list of available media capture techniques and articles showing how to use them, see [**Camera**](camera.md).</span></span>

> [!NOTE] 
> <span data-ttu-id="c827b-109">Die in diesem Artikel besprochenen Features sind erst ab Windows10, Version1607, verfügbar.</span><span class="sxs-lookup"><span data-stu-id="c827b-109">The features discussed in this article are only available starting with Windows 10, version 1607.</span></span>

> [!NOTE] 
> <span data-ttu-id="c827b-110">Es gibt ein Beispiel für universelle Windows-Apps, in dem die Verwendung von **MediaFrameReader** zum Anzeigen von Frames aus unterschiedlichen Framequellen demonstriert wird, unter anderem Farb-, Tiefen- und Infrarotkameras.</span><span class="sxs-lookup"><span data-stu-id="c827b-110">There is an Universal Windows app sample that demonstrates using **MediaFrameReader** to display frames from different frame sources, including color, depth, and infrared camreas.</span></span> <span data-ttu-id="c827b-111">Weitere Informationen finden Sie unter [Beispiel für Kameraframes](http://go.microsoft.com/fwlink/?LinkId=823230).</span><span class="sxs-lookup"><span data-stu-id="c827b-111">For more information, see [Camera frames sample](http://go.microsoft.com/fwlink/?LinkId=823230).</span></span>

## <a name="setting-up-your-project"></a><span data-ttu-id="c827b-112">Einrichten Ihres Projekts</span><span class="sxs-lookup"><span data-stu-id="c827b-112">Setting up your project</span></span>
<span data-ttu-id="c827b-113">Wie bei allen Apps, die **MediaCapture** verwenden, müssen Sie deklarieren, dass Ihre App die *Webcam*-Funktion verwendet. Erst dann können Sie auf Kamerageräte zugreifen.</span><span class="sxs-lookup"><span data-stu-id="c827b-113">As with any app that uses **MediaCapture**, you must declare that your app uses the *webcam* capability before attempting to access any camera device.</span></span> <span data-ttu-id="c827b-114">Wenn Ihre App von einem Audiogerät aufzeichnet, müssen Sie auch die *microphone*-Gerätefunktion deklarieren.</span><span class="sxs-lookup"><span data-stu-id="c827b-114">If your app will capture from an audio device, you should also declare the *microphone* device capability.</span></span> 

**<span data-ttu-id="c827b-115">Hinzufügen von Funktionen zum App-Manifest</span><span class="sxs-lookup"><span data-stu-id="c827b-115">Add capabilities to the app manifest</span></span>**

1.  <span data-ttu-id="c827b-116">Öffnen Sie in MicrosoftVisual Studio im **Projektmappen-Explorer** den Designer für das Anwendungsmanifest, indem Sie auf das Element **package.appxmanifest** doppelklicken.</span><span class="sxs-lookup"><span data-stu-id="c827b-116">In Microsoft Visual Studio, in **Solution Explorer**, open the designer for the application manifest by double-clicking the **package.appxmanifest** item.</span></span>
2.  <span data-ttu-id="c827b-117">Wählen Sie die Registerkarte **Funktionen** aus.</span><span class="sxs-lookup"><span data-stu-id="c827b-117">Select the **Capabilities** tab.</span></span>
3.  <span data-ttu-id="c827b-118">Aktivieren Sie die Kontrollkästchen für **Webcam** und **Mikrofon**.</span><span class="sxs-lookup"><span data-stu-id="c827b-118">Check the box for **Webcam** and the box for **Microphone**.</span></span>
4.  <span data-ttu-id="c827b-119">Für den Zugriff auf die Bibliothek „Bilder und Videos“ aktivieren Sie die Kontrollkästchen für **Bildbibliothek** und **Videobibliothek**.</span><span class="sxs-lookup"><span data-stu-id="c827b-119">For access to the Pictures and Videos library check the boxes for **Pictures Library** and the box for **Videos Library**.</span></span>

<span data-ttu-id="c827b-120">Im Beispielcode in diesem Artikel werden neben den in der Standard-Projektvorlage enthaltenen APIs auch APIs aus den folgenden Namespaces verwendet.</span><span class="sxs-lookup"><span data-stu-id="c827b-120">The example code in this article uses APIs from the following namespaces, in addition to those included by the default project template.</span></span>

[!code-cs[<span data-ttu-id="c827b-121">FramesUsing</span><span class="sxs-lookup"><span data-stu-id="c827b-121">FramesUsing</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetFramesUsing)]

## <a name="select-frame-sources-and-frame-source-groups"></a><span data-ttu-id="c827b-122">Auswählen von Framequellen und Framequellgruppen</span><span class="sxs-lookup"><span data-stu-id="c827b-122">Select frame sources and frame source groups</span></span>
<span data-ttu-id="c827b-123">Viele Apps, die Medienframes verarbeiten, müssen Frames aus mehreren Quellen gleichzeitig abrufen, z.B. die Farb- und Tiefenkameras eines Geräts.</span><span class="sxs-lookup"><span data-stu-id="c827b-123">Many apps that process media frames need to get frames from multiple sources at once, such as a device's color and depth cameras.</span></span> <span data-ttu-id="c827b-124">Das [**MediaFrameSourceGroup**] (https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup)-Objekt stellt einen Satz von Medienframequellen dar, die gleichzeitig verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="c827b-124">The [**MediaFrameSourceGroup**] (https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup) object represents a set of media frame sources that can be used simultaneously.</span></span> <span data-ttu-id="c827b-125">Rufen Sie die statische Methode [**MediaFrameSourceGroup.FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup.FindAllAsync) auf, um eine Liste aller vom aktuellen Gerät unterstützten Gruppen von Framequellen abzurufen.</span><span class="sxs-lookup"><span data-stu-id="c827b-125">Call the static method [**MediaFrameSourceGroup.FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup.FindAllAsync) to get a list of all of the groups of frame sources supported by the current device.</span></span>

[!code-cs[<span data-ttu-id="c827b-126">FindAllAsync</span><span class="sxs-lookup"><span data-stu-id="c827b-126">FindAllAsync</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetFindAllAsync)]

<span data-ttu-id="c827b-127">Sie können auch einen [**DeviceWatcher**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Enumeration.DeviceWatcher) erstellen, indem Sie mit [**DeviceInformation.CreateWatcher**](https://msdn.microsoft.com/library/windows/apps/br225427) und dem vom [**MediaFrameSourceGroup.GetDeviceSelector**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup.GetDeviceSelector) zurückgegebenen Wert Benachrichtigungen empfangen, wenn sich die verfügbaren Framequellgruppen für das Gerät ändern, z.B. bei Anschließen einer externen Kamera.</span><span class="sxs-lookup"><span data-stu-id="c827b-127">You can also create a [**DeviceWatcher**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Enumeration.DeviceWatcher) using [**DeviceInformation.CreateWatcher**](https://msdn.microsoft.com/library/windows/apps/br225427) and the value retuned from [**MediaFrameSourceGroup.GetDeviceSelector**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup.GetDeviceSelector) to receive notifications when the available frame source groups on the device changes, such as when an external camera is plugged in.</span></span> <span data-ttu-id="c827b-128">Weitere Informationen finden Sie unter [**Auflisten von Geräten**](https://msdn.microsoft.com/windows/uwp/devices-sensors/enumerate-devices).</span><span class="sxs-lookup"><span data-stu-id="c827b-128">For more information see [**Enumerate devices**](https://msdn.microsoft.com/windows/uwp/devices-sensors/enumerate-devices).</span></span>

<span data-ttu-id="c827b-129">Eine [**MediaFrameSourceGroup**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup) verfügt über eine Sammlung von [**MediaFrameSourceInfo**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo)-Objekten, die in der Gruppe enthaltene Framequellen beschreiben.</span><span class="sxs-lookup"><span data-stu-id="c827b-129">A [**MediaFrameSourceGroup**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup) has a collection of [**MediaFrameSourceInfo**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo) objects that describe the frame sources included in the group.</span></span> <span data-ttu-id="c827b-130">Nach dem Abrufen der auf dem Gerät verfügbaren Framequellgruppen können Sie die Gruppe auswählen, die die für Sie relevanten Framequellen verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="c827b-130">After retrieving the frame source groups available on the device, you can select the group that exposes the frame sources you are interested in.</span></span>

<span data-ttu-id="c827b-131">Das folgende Beispiel zeigt die einfachste Möglichkeit zum Auswählen einer Framequellgruppe.</span><span class="sxs-lookup"><span data-stu-id="c827b-131">The following example shows the simplest way to select a frame source group.</span></span> <span data-ttu-id="c827b-132">Vom Code werden dann einfach Schleifen durch alle verfügbaren Gruppen und anschließend durch die einzelnen Elemente in der [**SourceInfos**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup.SourceInfos)-Sammlung durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="c827b-132">This code simply loops over all of the available groups and then loops over each item in the [**SourceInfos**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup.SourceInfos) collection.</span></span> <span data-ttu-id="c827b-133">Für jede **MediaFrameSourceInfo** wird geprüft, ob sie die gewünschten Funktionen unterstützt.</span><span class="sxs-lookup"><span data-stu-id="c827b-133">Each **MediaFrameSourceInfo** is checked to see if it supports the features we are seeking.</span></span> <span data-ttu-id="c827b-134">In diesem Fall wird die [**MediaStreamType**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo.MediaStreamType)-Eigenschaft auf den Wert [**VideoPreview**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaStreamType) überprüft. D.h. das Gerät stellt einen Videovorschau-Stream bereit, und die [**SourceKind**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo.SourceKind)-Eigenschaft wird auf den Wert [**Farbe**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceKind) überprüft, um anzuzeigen, dass die Quelle Farbframes bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="c827b-134">In this case, the [**MediaStreamType**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo.MediaStreamType) property is checked for the value [**VideoPreview**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaStreamType), meaning the device provides a video preview stream, and the [**SourceKind**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo.SourceKind) property is checked for the value [**Color**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceKind), indicating that the source provides color frames.</span></span>

[!code-cs[<span data-ttu-id="c827b-135">SimpleSelect</span><span class="sxs-lookup"><span data-stu-id="c827b-135">SimpleSelect</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetSimpleSelect)]

<span data-ttu-id="c827b-136">Diese Methode zur Identifizierung der gewünschten Framequellgruppe und Framequellen ist für einfache Fälle geeignet. Wenn Sie jedoch anhand komplexerer Kriterien Framequellen auswählen möchten, wird dieses Verfahren unpraktisch.</span><span class="sxs-lookup"><span data-stu-id="c827b-136">This method of identifying the desired frame source group and frame sources works for simple cases, but if you want to select frame sources based on more complex criteria, it can quickly become cumbersome.</span></span> <span data-ttu-id="c827b-137">Eine weitere Methode ist die Auswahl mithilfe von Linq-Syntax und anonymen Objekten.</span><span class="sxs-lookup"><span data-stu-id="c827b-137">Another method is to use Linq syntax and anonymous objects to make the selection.</span></span> <span data-ttu-id="c827b-138">Im folgenden Beispiel wird die Erweiterungsmethode **Select** verwendet, um die **MediaFrameSourceGroup**-Objekte in der *FrameSourceGroups*-Liste in ein anonymes Objekt mit zwei Feldern umzuwandeln:*sourceGroup*, welches die Gruppe selbst darstellt, und *colorSourceInfo*, welches die Farbframequelle in der Gruppe repräsentiert.</span><span class="sxs-lookup"><span data-stu-id="c827b-138">The following example uses the **Select** extension method to transform the **MediaFrameSourceGroup** objects in the *frameSourceGroups* list into an anonymous object with two fields: *sourceGroup*, representing the group itself, and *colorSourceInfo*, which represents the color frame source in the group.</span></span> <span data-ttu-id="c827b-139">Für das Feld *colorSourceInfo* wird das Ergebnis der **FirstOrDefault**-Methode festgelegt, die das erste Objekt auswählt, für dessen bereitgestelltes Prädikat die Auflösung „true“ ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-139">The *colorSourceInfo* field is set to the result of **FirstOrDefault**, which selects the first object for which the provided predicate resolves to true.</span></span> <span data-ttu-id="c827b-140">In diesem Fall ist das Prädikat „true“, wenn der Datenstromtyp **VideoPreview** und die Art der Quelle **Color** ist und sich die Kamera an der Vorderseite des Geräts befindet.</span><span class="sxs-lookup"><span data-stu-id="c827b-140">In this case, the predicate is true if the stream type is **VideoPreview**, the source kind is **Color**, and if the camera is on the front panel of the device.</span></span>

<span data-ttu-id="c827b-141">Aus der Liste der von der oben beschriebenen Abfrage zurückgegebenen anonymen Objekte werden mit der **Where**-Erweiterungsmethode nur die Objekte ausgewählt, in denen das Feld *colorSourceInfo* nicht NULL ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-141">From the list of anonymous objects returned from the query described above, the **Where** extension method is used to select only those objects where the *colorSourceInfo* field is not null.</span></span> <span data-ttu-id="c827b-142">Schließlich wird **FirstOrDefault** aufgerufen, um das erste Element in der Liste auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="c827b-142">Finally, **FirstOrDefault** is called to select the first item in the list.</span></span>

<span data-ttu-id="c827b-143">Nun können Sie mithilfe der Felder des ausgewählten Objekts die Verweise auf das ausgewählte **MediaFrameSourceGroup**- und das **MediaFrameSourceInfo**-Objekt abrufen, die die Farbkamera darstellen.</span><span class="sxs-lookup"><span data-stu-id="c827b-143">Now you can use the fields of the selected object to get references to the selected **MediaFrameSourceGroup** and the **MediaFrameSourceInfo** object representing the color camera.</span></span> <span data-ttu-id="c827b-144">Diese werden später verwendet, um das **MediaCapture**-Objekt zu initialisieren und einen **MediaFrameReader** für die ausgewählte Quelle zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="c827b-144">These will be used later to initialize the **MediaCapture** object and create a **MediaFrameReader** for the selected source.</span></span> <span data-ttu-id="c827b-145">Abschließend sollten Sie testen, ob Quellgruppe NULL ist. Dies würde bedeuten, dass das aktuelle Gerät nicht über Ihre angeforderten Aufnahmequellen verfügt.</span><span class="sxs-lookup"><span data-stu-id="c827b-145">Finally, you should test to see if the source group is null, meaning the current device doesn't have your requested capture sources.</span></span>

[!code-cs[<span data-ttu-id="c827b-146">SelectColor</span><span class="sxs-lookup"><span data-stu-id="c827b-146">SelectColor</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetSelectColor)]

<span data-ttu-id="c827b-147">Im folgenden Beispiel wird mit einer ähnlichen Methode wie der oben beschriebenen eine Quellgruppe mit Farb-, Tiefen- und Infrarotkameras ausgewählt.</span><span class="sxs-lookup"><span data-stu-id="c827b-147">The following example uses a similar technique as described above to select a source group that contains color, depth, and infrared cameras.</span></span>

[!code-cs[<span data-ttu-id="c827b-148">ColorInfraredDepth</span><span class="sxs-lookup"><span data-stu-id="c827b-148">ColorInfraredDepth</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetColorInfraredDepth)]

## <a name="initialize-the-mediacapture-object-to-use-the-selected-frame-source-group"></a><span data-ttu-id="c827b-149">Initialisieren des MediaCapture-Objekts zum Verwenden der ausgewählten Framequellgruppe</span><span class="sxs-lookup"><span data-stu-id="c827b-149">Initialize the MediaCapture object to use the selected frame source group</span></span>
<span data-ttu-id="c827b-150">Im nächsten Schritt wird das **MediaCapture**-Objekt initialisiert, um die im vorherigen Schritt ausgewählte Framequellgruppe zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="c827b-150">The next step is to initialize the **MediaCapture** object to use the frame source group you selected in the previous step.</span></span>

<span data-ttu-id="c827b-151">Das **MediaCapture**-Objekt wird üblicherweise an mehreren Stellen in Ihrer App verwendet. Sie sollten daher eine Klassenmembervariable deklarieren, um es aufzunehmen.</span><span class="sxs-lookup"><span data-stu-id="c827b-151">The **MediaCapture** object is typically used from multiple locations within your app, so you should declare a class member variable to hold it.</span></span>

[!code-cs[<span data-ttu-id="c827b-152">DeclareMediaCapture</span><span class="sxs-lookup"><span data-stu-id="c827b-152">DeclareMediaCapture</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetDeclareMediaCapture)]

<span data-ttu-id="c827b-153">Erstellen Sie eine Instanz des **MediaCapture**-Objekts, indem Sie den Konstruktor aufrufen.</span><span class="sxs-lookup"><span data-stu-id="c827b-153">Create an instance of the **MediaCapture** object by calling the constructor.</span></span> <span data-ttu-id="c827b-154">Erstellen Sie als Nächstes ein [**MediaCaptureSettings**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureSettings)-Objekt, das zum Initialisieren des **MediaCapture**-Objekts verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-154">Next, create a [**MediaCaptureSettings**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureSettings) object that will be used to initialize the **MediaCapture** object.</span></span> <span data-ttu-id="c827b-155">In diesem Beispiel werden die folgenden Einstellungen verwendet:</span><span class="sxs-lookup"><span data-stu-id="c827b-155">In this example, the following settings are used:</span></span>

* <span data-ttu-id="c827b-156">[**SourceGroup**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.SourceGroup) – Damit wird dem System mitgeteilt, welche Quellgruppe zum Abrufen von Frames verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-156">[**SourceGroup**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.SourceGroup) - This tells the system which source group you will be using to get frames.</span></span> <span data-ttu-id="c827b-157">Bedenken Sie, dass die Quellgruppe einen Satz von Medienframequellen definiert, die gleichzeitig verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="c827b-157">Remember that the source group defines a set of media frame sources that can be used simultaneously.</span></span>
* <span data-ttu-id="c827b-158">[**SharingMode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.SharingMode) – Damit wird dem System mitgeteilt, ob exklusive Steuerung der Aufnahmequellgeräte erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-158">[**SharingMode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.SharingMode) - This tells the system whether you need exclusive control over the capture source devices.</span></span> <span data-ttu-id="c827b-159">Bei Festlegung auf [**ExclusiveControl**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureSharingMode) können Sie die Einstellungen für das Aufnahmegerät, z.B. das Format der von ihm erzeugten Frames, ändern. Wenn jedoch eine andere App bereits über die exklusive Steuerung verfügt, wird der Versuch Ihrer App, das Medienaufnahmegerät zu initialisieren, fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="c827b-159">If you set this to  [**ExclusiveControl**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureSharingMode), it means that you can change the settings of the capture device, such as the format of the frames it produces, but this means that if another app already has exclusive control, your app will fail when it tries to initialize the media capture device.</span></span> <span data-ttu-id="c827b-160">Bei Festlegung auf [**SharedReadOnly**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureSharingMode) können Sie Frames von den Framequellen empfangen, auch wenn diese gerade von einer anderen App verwendet werden. Sie können jedoch nicht die Einstellungen der Geräte ändern.</span><span class="sxs-lookup"><span data-stu-id="c827b-160">If you set this to [**SharedReadOnly**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureSharingMode), you can receive frames from the frame sources even if they are in use by another app, but you can't change the settings for the devices.</span></span>
* <span data-ttu-id="c827b-161">[**MemoryPreference**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.MemoryPreference) – Wenn Sie [**CPU**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureMemoryPreference) angeben, verwendet das Gerät den CPU-Speicher. Damit wird garantiert, dass eintreffende Frames als [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.SoftwareBitmap)-Objekte verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="c827b-161">[**MemoryPreference**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.MemoryPreference) - If you specify [**CPU**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureMemoryPreference), the system will use CPU memory which guarantees that when frames arrive, they will be available as [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.SoftwareBitmap) objects.</span></span> <span data-ttu-id="c827b-162">Wenn Sie [**Auto**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureMemoryPreference) angeben, wählt das System dynamisch den optimalen Speicherort zum Speichern der Frames aus.</span><span class="sxs-lookup"><span data-stu-id="c827b-162">If you specify [**Auto**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureMemoryPreference), the system will dynamically choose the optimal memory location to store frames.</span></span> <span data-ttu-id="c827b-163">Wenn das System die Verwendung des GPU-Speichers auswählt, werden die Medienframes als [**IDirect3DSurface**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.DirectX.Direct3D11.IDirect3DSurface)-Objekt und nicht als **SoftwareBitmap**-Objekt übermittelt.</span><span class="sxs-lookup"><span data-stu-id="c827b-163">If the system chooses to use GPU memory, the media frames will arrive as an [**IDirect3DSurface**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.DirectX.Direct3D11.IDirect3DSurface) object and not as a  **SoftwareBitmap**.</span></span>
* <span data-ttu-id="c827b-164">[**StreamingCaptureMode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.StreamingCaptureMode) – Legen Sie [**Video**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.StreamingCaptureMode) fest, um anzugeben, dass das Streamen von Audio nicht erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-164">[**StreamingCaptureMode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.StreamingCaptureMode) - Set this to [**Video**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.StreamingCaptureMode) to indicate that audio doesn't need to be streamed.</span></span>

<span data-ttu-id="c827b-165">Rufen Sie [**InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/br226598) auf, um **MediaCapture** mit ihren gewünschten Einstellungen zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="c827b-165">Call [**InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/br226598) to initialize the **MediaCapture** with your desired settings.</span></span> <span data-ttu-id="c827b-166">Achten Sie darauf, den Aufruf in einem *Try*-Block auszuführen, falls die Initialisierung fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="c827b-166">Be sure to call this within a *try* block in case initialization fails.</span></span>

[!code-cs[<span data-ttu-id="c827b-167">InitMediaCapture</span><span class="sxs-lookup"><span data-stu-id="c827b-167">InitMediaCapture</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetInitMediaCapture)]

## <a name="set-the-preferred-format-for-the-frame-source"></a><span data-ttu-id="c827b-168">Festlegen des bevorzugten Formats für die Framequelle</span><span class="sxs-lookup"><span data-stu-id="c827b-168">Set the preferred format for the frame source</span></span>
<span data-ttu-id="c827b-169">Zum Einstellen des bevorzugten Formats einer Framequelle benötigen Sie ein [**MediaFrameSource**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSource)-Objekt, das die Quelle darstellt.</span><span class="sxs-lookup"><span data-stu-id="c827b-169">To set the preferred format for a frame source, you need to get a [**MediaFrameSource**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSource) object representing the source.</span></span> <span data-ttu-id="c827b-170">Sie erhalten dieses Objekt, indem Sie auf das [**Frames**](https://msdn.microsoft.com/library/windows/apps/Windows.Phone.Media.Capture.CameraCaptureSequence.Frames)-Verzeichnis des initialisierten **MediaCapture** -Objekts zugreifen und dabei den Bezeichner der gewünschten Framequelle angeben.</span><span class="sxs-lookup"><span data-stu-id="c827b-170">You get this object by accessing the [**Frames**](https://msdn.microsoft.com/library/windows/apps/Windows.Phone.Media.Capture.CameraCaptureSequence.Frames) dictionary of the initialized **MediaCapture** object, specifying the identifier of the frame source you want to use.</span></span> <span data-ttu-id="c827b-171">Aus diesem Grund wurde das [**MediaFrameSourceInfo**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo)-Objekt bei der Auswahl einer Framequellgruppe gespeichert.</span><span class="sxs-lookup"><span data-stu-id="c827b-171">This is why we saved the [**MediaFrameSourceInfo**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo) object when we were selecting a frame source group.</span></span>

<span data-ttu-id="c827b-172">Die [**MediaFrameSource.SupportedFormats**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSource.SupportedFormats)-Eigenschaft enthält eine Liste von [**MediaFrameFormat**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameFormat)-Objekten, die die unterstützten Formate der Framequelle beschreiben.</span><span class="sxs-lookup"><span data-stu-id="c827b-172">The  [**MediaFrameSource.SupportedFormats**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSource.SupportedFormats) property contains a list of [**MediaFrameFormat**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameFormat) objects describing the supported formats for the frame source.</span></span> <span data-ttu-id="c827b-173">Verwenden Sie die Linq-Erweiterungsmethode **Where**, um basierend auf den gewünschten Eigenschaften ein Format auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="c827b-173">Use the **Where** Linq extension method to select a format based on desired properties.</span></span> <span data-ttu-id="c827b-174">In diesem Beispiel wird ein Format mit einer Breite von 1.080Pixeln ausgewählt, welches Frames im 32-Bit-RGB-Format bereitstellen kann.</span><span class="sxs-lookup"><span data-stu-id="c827b-174">In this example, a format is selected that has a width of 1080 pixels and can supply frames in 32-bit RGB format.</span></span> <span data-ttu-id="c827b-175">Die **FirstOrDefault**-Erweiterungsmethode wählt den ersten Eintrag in der Liste aus.</span><span class="sxs-lookup"><span data-stu-id="c827b-175">The **FirstOrDefault** extension method selects the first entry in the list.</span></span> <span data-ttu-id="c827b-176">Ist das ausgewählte Format NULL, wird das angeforderte Format nicht von der Framequelle unterstützt.</span><span class="sxs-lookup"><span data-stu-id="c827b-176">If the selected format is null, then the requested format is not supported by the frame source.</span></span> <span data-ttu-id="c827b-177">Wenn das Format unterstützt wird, können Sie [**SetFormatAsync**](https://msdn.microsoft.com/library/windows/apps/) aufrufen, um die Verwendung dieses Formats durch die Quelle anzufordern.</span><span class="sxs-lookup"><span data-stu-id="c827b-177">If the format is supported, you can request that the source use this format by calling [**SetFormatAsync**](https://msdn.microsoft.com/library/windows/apps/).</span></span>

[!code-cs[<span data-ttu-id="c827b-178">GetPreferredFormat</span><span class="sxs-lookup"><span data-stu-id="c827b-178">GetPreferredFormat</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetGetPreferredFormat)]

## <a name="create-a-frame-reader-for-the-frame-source"></a><span data-ttu-id="c827b-179">Erstellen eines Frame-Readers für die Framequelle</span><span class="sxs-lookup"><span data-stu-id="c827b-179">Create a frame reader for the frame source</span></span>
<span data-ttu-id="c827b-180">Verwenden Sie zum Empfangen von Frames für die Medienframequelle einen [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader).</span><span class="sxs-lookup"><span data-stu-id="c827b-180">To receive frames for a media frame source, use a [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader).</span></span>

[!code-cs[<span data-ttu-id="c827b-181">DeclareMediaFrameReader</span><span class="sxs-lookup"><span data-stu-id="c827b-181">DeclareMediaFrameReader</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetDeclareMediaFrameReader)]

<span data-ttu-id="c827b-182">Instanziieren Sie den Frame-Reader, indem Sie auf Ihrem initialisierten **MediaCapture**-Objekt [**CreateFrameReaderAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.CreateFrameReaderAsync) aufrufen.</span><span class="sxs-lookup"><span data-stu-id="c827b-182">Instantiate the frame reader by calling [**CreateFrameReaderAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.CreateFrameReaderAsync) on your initialized **MediaCapture** object.</span></span> <span data-ttu-id="c827b-183">Das erste Argument dieser Methode ist die Framequelle, von der Frames empfangen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="c827b-183">The first argument to this method is the frame source from which you want to receive frames.</span></span> <span data-ttu-id="c827b-184">Sie können für jede gewünschte Framequelle einen separaten Frame-Reader erstellen.</span><span class="sxs-lookup"><span data-stu-id="c827b-184">You can create a separate frame reader for each frame source you want to use.</span></span> <span data-ttu-id="c827b-185">Das zweite Argument gibt dem System das Ausgabeformat vor, in dem die Frames übermittelt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="c827b-185">The second argument tells the system the output format in which you want frames to arrive.</span></span> <span data-ttu-id="c827b-186">So entfällt das Konvertieren der übermittelten Frames.</span><span class="sxs-lookup"><span data-stu-id="c827b-186">This can save you from having to do your own conversions to frames as they arrive.</span></span> <span data-ttu-id="c827b-187">Beachten Sie, dass eine Ausnahme ausgelöst wird, wenn Sie ein von der Framequelle nicht unterstütztes Format festlegen. Stellen Sie daher sicher, dass dieser Wert in der [**SupportedFormats**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSource.SupportedFormats)-Sammlung enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-187">Note that if you specify a format that is not supported by the frame source, an exception will be thrown, so be sure that this value is in the [**SupportedFormats**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSource.SupportedFormats) collection.</span></span>  

<span data-ttu-id="c827b-188">Registrieren Sie nach dem Erstellen des Frame-Readers einen Handler für das [**FrameArrived**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.FrameArrived)-Ereignis, das immer dann ausgelöst wird, wenn ein neuer Frame von der Quelle verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-188">After creating the frame reader, register a handler for the [**FrameArrived**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.FrameArrived) event which is raised whenever a new frame is available from the source.</span></span>

<span data-ttu-id="c827b-189">Rufen Sie [**StartAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.StartAsync) auf, um dem System zu befehlen, mit dem Lesen von Frames aus der Quelle zu beginnen.</span><span class="sxs-lookup"><span data-stu-id="c827b-189">Tell the system to start reading frames from the source by calling [**StartAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.StartAsync).</span></span>

[!code-cs[<span data-ttu-id="c827b-190">CreateFrameReader</span><span class="sxs-lookup"><span data-stu-id="c827b-190">CreateFrameReader</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetCreateFrameReader)]

## <a name="handle-the-frame-arrived-event"></a><span data-ttu-id="c827b-191">Behandeln des „FrameArrived“-Ereignisses</span><span class="sxs-lookup"><span data-stu-id="c827b-191">Handle the frame arrived event</span></span>
<span data-ttu-id="c827b-192">Das [**MediaFrameReader.FrameArrived**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.FrameArrived)-Ereignis wird ausgelöst, wenn ein neuer Frame verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-192">The [**MediaFrameReader.FrameArrived**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.FrameArrived) event is raised whenever a new frame is available.</span></span> <span data-ttu-id="c827b-193">Sie können entweder jeden empfangenen Frame verarbeiten oder Frames nur bei Bedarf verwenden.</span><span class="sxs-lookup"><span data-stu-id="c827b-193">You can choose to process every frame that arrives or only use frames when you need them.</span></span> <span data-ttu-id="c827b-194">Der Frame-Reader löst das Ereignis in seinem eigenen Thread aus. Daher müssen Sie möglicherweise Synchronisierungslogik implementieren, damit Sie nicht aus mehreren Threads auf dieselben Daten zugreifen.</span><span class="sxs-lookup"><span data-stu-id="c827b-194">Because the frame reader raises the event on its own thread, you may need to implement some synchronization logic to make sure that you aren't attempting to access the same data from multiple threads.</span></span> <span data-ttu-id="c827b-195">In diesem Abschnitt wird das Synchronisieren von Zeichenfarbframes zu einem Image-Steuerelement in einer XAML-Seite veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="c827b-195">This section shows you how to synchronize drawing color frames to an image control in a XAML page.</span></span> <span data-ttu-id="c827b-196">Dieses Szenario behandelt die zusätzliche Synchronisierungseinschränkung, die erfordert, dass alle Updates für XAML-Steuerelemente im UI-Thread ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="c827b-196">This scenario addresses the additional synchronization constraint that requires all updates to XAML controls be performed on the UI thread.</span></span>

<span data-ttu-id="c827b-197">Als erster Schritt beim Anzeigen von Frames in XAML wird ein Bild-Steuerelement erstellt.</span><span class="sxs-lookup"><span data-stu-id="c827b-197">The first step in displaying frames in XAML is to create an Image control.</span></span> 

[!code-xml[<span data-ttu-id="c827b-198">ImageElementXAML</span><span class="sxs-lookup"><span data-stu-id="c827b-198">ImageElementXAML</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml#SnippetImageElementXAML)]

<span data-ttu-id="c827b-199">Deklarieren Sie auf der CodeBehind-Seite eine Klassenmembervariable vom Typ **SoftwareBitmap**. Diese wird als Hintergrundpuffer verwendet, in den alle eingehenden Bilder kopiert werden.</span><span class="sxs-lookup"><span data-stu-id="c827b-199">In your code behind page, declare a class member variable of type **SoftwareBitmap** which will be used as a back buffer that all incoming images will be copied to.</span></span> <span data-ttu-id="c827b-200">Beachten Sie, dass nicht die Bilddaten selbst kopiert werden, sondern nur die Objektverweise.</span><span class="sxs-lookup"><span data-stu-id="c827b-200">Note that the image data itself isn't copied, just the object references.</span></span> <span data-ttu-id="c827b-201">Deklarieren Sie außerdem einen booleschen Wert, um nachzuverfolgen, ob der UI-Vorgang aktuell ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-201">Also, declare a boolean to track whether our UI operation is currently running.</span></span>

[!code-cs[<span data-ttu-id="c827b-202">DeclareBackBuffer</span><span class="sxs-lookup"><span data-stu-id="c827b-202">DeclareBackBuffer</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetDeclareBackBuffer)]

<span data-ttu-id="c827b-203">Da Frames als **SoftwareBitmap**-Objekte übermittelt werden, müssen Sie ein [**SoftwareBitmapSource**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.Imaging.SoftwareBitmapSource)-Objekt erstellen, mit dem Sie eine **SoftwareBitmap** als Quelle für ein XAML-**Steuerelement** verwenden können.</span><span class="sxs-lookup"><span data-stu-id="c827b-203">Because the frames will arrive as **SoftwareBitmap** objects, you need to create a [**SoftwareBitmapSource**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.Imaging.SoftwareBitmapSource) object which allows you to use a **SoftwareBitmap** as the source for a XAML **Control**.</span></span> <span data-ttu-id="c827b-204">Sie sollten die Bildquelle in Ihrem Code festlegen, bevor Sie den Frame-Reader starten.</span><span class="sxs-lookup"><span data-stu-id="c827b-204">You should set the image source somewhere in your code before you start the frame reader.</span></span>

[!code-cs[<span data-ttu-id="c827b-205">ImageElementSource</span><span class="sxs-lookup"><span data-stu-id="c827b-205">ImageElementSource</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetImageElementSource)]

<span data-ttu-id="c827b-206">Nun wird der **FrameArrived**-Ereignishandler implementiert.</span><span class="sxs-lookup"><span data-stu-id="c827b-206">Now it's time to implement the **FrameArrived** event handler.</span></span> <span data-ttu-id="c827b-207">Wenn der Handler aufgerufen wird, enthält der *sender*-Parameter einen Verweis auf das **MediaFrameReader**-Objekt, welches das Ereignis ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="c827b-207">When the handler is called, the *sender* parameter contains a reference to the **MediaFrameReader** object which raised the event.</span></span> <span data-ttu-id="c827b-208">Rufen Sie [**TryAcquireLatestFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.TryAcquireLatestFrame) für dieses Objekt auf, um zu versuchen, den aktuellen Frame abzurufen.</span><span class="sxs-lookup"><span data-stu-id="c827b-208">Call [**TryAcquireLatestFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.TryAcquireLatestFrame) on this object to attempt to get the latest frame.</span></span> <span data-ttu-id="c827b-209">Wie der Name schon sagt, schlägt das Zurückgeben eines Frames über **TryAcquireLatestFrame** möglicherweise fehl.</span><span class="sxs-lookup"><span data-stu-id="c827b-209">As the name implies, **TryAcquireLatestFrame** may not succeed in returning a frame.</span></span> <span data-ttu-id="c827b-210">Testen Sie daher beim Zugreifen auf die VideoMediaFrame- und die SoftwareBitmap-Eigenschaften, ob diese auf NULL festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="c827b-210">So, when you access the VideoMediaFrame and then SoftwareBitmap properties, be sure to test for null.</span></span> <span data-ttu-id="c827b-211">In diesem Beispiel wird der Operator mit NULL-Bedingung ?</span><span class="sxs-lookup"><span data-stu-id="c827b-211">In this example the null condtional operator ?</span></span> <span data-ttu-id="c827b-212">verwendet, um auf die **SoftwareBitmap** zurückzugreifen. Anschließend wird geprüft, ob das abgerufene Objekt auf NULL festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-212">is used to access the **SoftwareBitmap** and then the retrieved object is checked for null.</span></span>

<span data-ttu-id="c827b-213">Das **Image**-Steuerelement kann nur Bilder in BRGA8 Format anzeigen, die entweder vormultipliziert sind oder kein Alpha aufweisen.</span><span class="sxs-lookup"><span data-stu-id="c827b-213">The **Image** control can only display images in BRGA8 format with either pre-multiplied or no alpha.</span></span> <span data-ttu-id="c827b-214">Weist der eingehende Frame nicht dieses Format auf, wird mit der statischen Methode [**Convert**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.SoftwareBitmap.Covert) die Software-Bitmap in das richtige Format konvertiert.</span><span class="sxs-lookup"><span data-stu-id="c827b-214">If the arriving frame is not in that format, the static method [**Convert**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.SoftwareBitmap.Covert) is used to convert the software bitmap to the correct format.</span></span>

<span data-ttu-id="c827b-215">Als Nächstes wird mit der [**Interlocked.Exchange**](https://msdn.microsoft.com/library/bb337971)-Methode der Verweis auf die eingehende Bitmap mit der Hintergrundpuffer-Bitmap ausgetauscht.</span><span class="sxs-lookup"><span data-stu-id="c827b-215">Next, the [**Interlocked.Exchange**](https://msdn.microsoft.com/library/bb337971) method is used to swap the reference of to arriving bitmap with the backbuffer bitmap.</span></span> <span data-ttu-id="c827b-216">Bei dieser Methode werden die Verweise in einer threadsicheren atomischen Operation ausgetauscht.</span><span class="sxs-lookup"><span data-stu-id="c827b-216">This method swaps these references in an atomic operation that is thread-safe.</span></span> <span data-ttu-id="c827b-217">Nach dem Austausch wird das alte Hintergrundpufferbild – jetzt in der *softwareBitmap*-Variablen – gelöscht, um seine Ressourcen zu bereinigen.</span><span class="sxs-lookup"><span data-stu-id="c827b-217">After swapping, the old backbuffer image, now in the *softwareBitmap* variable is disposed of to clean up its resources.</span></span>

<span data-ttu-id="c827b-218">Als Nächstes wird mit dem mit dem **Image**-Element verknüpften [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Core.CoreDispatcher) eine Aufgabe erstellt, die durch Aufrufen von [**RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) im UI-Thread ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-218">Next, the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Core.CoreDispatcher) associated with the **Image** element is used to create a task that will run on the UI thread by calling [**RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317).</span></span> <span data-ttu-id="c827b-219">Da die asynchronen Aufgaben in dieser Aufgabe ausgeführt werden, wird der an **RunAsync** weitergegebene Lambda-Ausdruck mit dem *async*- Schlagwort deklariert.</span><span class="sxs-lookup"><span data-stu-id="c827b-219">Because the asynchronous tasks will be performed within the task, the lambda expression passed to **RunAsync** is declared with the *async* keyword.</span></span>

<span data-ttu-id="c827b-220">Innerhalb der Aufgabe wird die *_taskRunning*-Variable überprüft, um sicherzustellen, dass zu jedem Zeitpunkt nur eine Instanz der Aufgabe ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-220">Within the task, the *_taskRunning* variable is checked to make sure that only one instance of the task is running at a time.</span></span> <span data-ttu-id="c827b-221">Wird die Aufgabe nicht bereits ausgeführt, wird *_taskRunning* auf „true“ festgelegt, um zu verhindern, dass die Aufgabe erneut ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-221">If the task isn't already running, *_taskRunning* is set to true to prevent the task from running again.</span></span> <span data-ttu-id="c827b-222">**Interlocked.Exchange** wird zum Kopieren aus dem Hintergrundpuffer in eine temporäre **SoftwareBitmap** in einer *while*-Schleife aufgerufen, bis das Hintergrundpufferbild NULL ist.</span><span class="sxs-lookup"><span data-stu-id="c827b-222">In a *while* loop, **Interlocked.Exchange** is called to copy from the backbuffer into a temporary **SoftwareBitmap** until the backbuffer image is null.</span></span> <span data-ttu-id="c827b-223">Bei jedem Auffüllen der temporären Bitmap wird die **Source**-Eigenschaft des **Bildes** in eine **SoftwareBitmapSource** umgewandelt. Anschließend wird [**SetBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/dn997856) aufgerufen, um die Bildquelle festzulegen.</span><span class="sxs-lookup"><span data-stu-id="c827b-223">For each time the temporary bitmap is populated, the **Source** property of the **Image** is cast to a **SoftwareBitmapSource**, and then [**SetBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/dn997856) is called to set the source of the image.</span></span>

<span data-ttu-id="c827b-224">Schließlich wird die *_taskRunning*-Variable wieder auf „false“ festgelegt, damit die Aufgabe beim nächsten Aufrufen des Handlers erneut ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="c827b-224">Finally, the *_taskRunning* variable is set back to false so that the task can be run again the next time the handler is called.</span></span>

> [!NOTE] 
> <span data-ttu-id="c827b-225">Wenn Sie auf das [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.VideoMediaFrame.SoftwareBitmap)- oder [**Direct3DSurface**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.VideoMediaFrame.Direct3DSurface)-Objekt zugreifen, das von der [**VideoMediaFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReference.VideoMediaFrame)-Eigenschaft eines [**MediaFrameReference**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReference) bereitgestellt wird, erstellt das System einen starken Verweis auf dieses Objekt. Das bedeutet, dass sie nicht entfernt werden, wenn Sie [**Dispose**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReference.Close) auf dem **MediaFrameReference** aufrufen, der das Objekt enthält.</span><span class="sxs-lookup"><span data-stu-id="c827b-225">If you access the [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.VideoMediaFrame.SoftwareBitmap) or [**Direct3DSurface**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.VideoMediaFrame.Direct3DSurface) objects provided by the [**VideoMediaFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReference.VideoMediaFrame) property of a [**MediaFrameReference**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReference), the system creates a strong reference to these objects, which means that they will not be disposed when you call [**Dispose**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReference.Close) on the containing **MediaFrameReference**.</span></span> <span data-ttu-id="c827b-226">Sie müssen die **Dispose**-Methode von **SoftwareBitmap** oder **Direct3DSurface** explizit direkt aufrufen, damit die Objekte sofort entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="c827b-226">You must explicitly call the **Dispose** method of the **SoftwareBitmap** or **Direct3DSurface** directly for the objects to be immediately disposed.</span></span> <span data-ttu-id="c827b-227">Andernfalls wird der Garbage Collector den Speicher für diese Objekte schließlich freigeben. Sie wissen jedoch nicht, wann dies sein wird. Wenn die Anzahl der zugeteilten Bitmaps oder Oberflächen die maximale, vom System zugelassene Menge überschreitet, wird der Fluss neuer Frames beendet.</span><span class="sxs-lookup"><span data-stu-id="c827b-227">Otherwise, the garbage collector will eventually free the memory for these objects, but you can't know when this will occur, and if the number of allocated bitmaps or surfaces exceeds the maximum amount allowed by the system, the flow of new frames will stop.</span></span>


[!code-cs[<span data-ttu-id="c827b-228">FrameArrived</span><span class="sxs-lookup"><span data-stu-id="c827b-228">FrameArrived</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetFrameArrived)]

## <a name="cleanup-resources"></a><span data-ttu-id="c827b-229">Bereinigen von Ressourcen</span><span class="sxs-lookup"><span data-stu-id="c827b-229">Cleanup resources</span></span>
<span data-ttu-id="c827b-230">Achten Sie darauf, nach dem Lesen der Frames den Medienframe-Reader zu beenden, indem Sie [**StopAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.StopAsync) aufrufen, die Registrierung des **FrameArrived**-Handlers aufheben und das **MediaCapture**-Objekt löschen.</span><span class="sxs-lookup"><span data-stu-id="c827b-230">When you are done reading frames, be sure to stop the media frame reader by calling [**StopAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.StopAsync), unregistering the **FrameArrived** handler, and disposing of the **MediaCapture** object.</span></span>

[!code-cs[<span data-ttu-id="c827b-231">Bereinigen</span><span class="sxs-lookup"><span data-stu-id="c827b-231">Cleanup</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetCleanup)]

<span data-ttu-id="c827b-232">Weitere Informationen zum Bereinigen von Medienaufnahmeobjekten bei angehaltener Anwendung finden Sie unter [**Anzeigen der Kameravorschau**](simple-camera-preview-access.md).</span><span class="sxs-lookup"><span data-stu-id="c827b-232">For more information about cleaning up media capture objects when your application is suspended, see [**Display the camera preview**](simple-camera-preview-access.md).</span></span>

## <a name="the-framerenderer-helper-class"></a><span data-ttu-id="c827b-233">Die FrameRenderer-Hilfsprogrammklasse</span><span class="sxs-lookup"><span data-stu-id="c827b-233">The FrameRenderer helper class</span></span>
<span data-ttu-id="c827b-234">Das Universal Windows-[Beispiel für Kameraframes](http://go.microsoft.com/fwlink/?LinkId=823230) stellt eine Hilfsprogrammklasse zum einfachen Anzeigen der Frames aus Farb-, Infrarot- und Tiefenquellen in Ihrer App bereit.</span><span class="sxs-lookup"><span data-stu-id="c827b-234">The Universal Windows [Camera frames sample](http://go.microsoft.com/fwlink/?LinkId=823230) provides a helper class that makes it easy to display the frames from color, infrared, and depth sources in your app.</span></span> <span data-ttu-id="c827b-235">In der Regel sollen Tiefen- und Infrarotdaten nicht nur auf dem Bildschirm angezeigt werden. Dennoch ist diese Hilfsprogrammklasse ein hilfreiches Tool zum Veranschaulichen der Frame-Reader-Funktion und zum Debuggen Ihrer eigenen Frame-Reader-Implementierung.</span><span class="sxs-lookup"><span data-stu-id="c827b-235">Typically, you will want to do something more with depth and infrared data than just display it to the screen, but this helper class is a helpful tool for demonstrating the frame reader feature and for debugging your own frame reader implementation.</span></span>

<span data-ttu-id="c827b-236">Die **FrameRenderer**-Hilfsprogrammklasse implementiert die folgenden Methoden.</span><span class="sxs-lookup"><span data-stu-id="c827b-236">The **FrameRenderer** helper class implements the following methods.</span></span>

* <span data-ttu-id="c827b-237">**FrameRenderer**-Konstruktor – Der Konstruktor initialisiert die Verwendung des übergebenen XAML-[**Bild**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.Image)-Elements durch die Hilfsprogrammklasse zum Anzeigen von Medienframes.</span><span class="sxs-lookup"><span data-stu-id="c827b-237">**FrameRenderer** constructor - The constructor initializes the helper class to use the XAML [**Image**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.Image) element you pass in for displaying media frames.</span></span>
* <span data-ttu-id="c827b-238">**ProcessFrame** – Bei dieser Methode wird ein durch eine [**MediaFrameReference**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReference) repräsentierter Medienframe in dem in den Konstruktor eingereichten **Bild**-Element angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c827b-238">**ProcessFrame** - This method displays a media frame, represented by a [**MediaFrameReference**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReference), in the **Image** element you passed into the constructor.</span></span> <span data-ttu-id="c827b-239">Üblicherweise sollten Sie diese Methode aus Ihrem [**FrameArrived**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.FrameArrived)-Ereignishandler aufrufen, wenn der von [**TryAcquireLatestFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.TryAcquireLatestFrame) zurückgegebene Frame übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-239">You should typically call this method from your [**FrameArrived**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.FrameArrived) event handler, passing in the frame returned by [**TryAcquireLatestFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader.TryAcquireLatestFrame).</span></span>
* <span data-ttu-id="c827b-240">**ConvertToDisplayableImage** – Bei dieser Methode wird das Format des Medienframes überprüft und ggf. in ein anzeigbares Format umgewandelt.</span><span class="sxs-lookup"><span data-stu-id="c827b-240">**ConvertToDisplayableImage** - This methods checks the format of the media frame and, if necessary, converts it to a displayable format.</span></span> <span data-ttu-id="c827b-241">Bei Farbbildern wird also überprüft, ob als Farbformat BGRA8 festgelegt ist und der Bitmap-Alphamodus prämultipliziert wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-241">For color images, this means making sure that the color format is BGRA8 and that the bitmap alpha mode is premultiplied.</span></span> <span data-ttu-id="c827b-242">Bei Tiefen- oder Infrarotframes wird jede Scanzeile verarbeitet, um die Tiefen- oder Infrarotwerte mithilfe der ebenfalls im Beispiel enthaltenen und unten aufgeführten **PsuedoColorHelper**-Klasse in einen Pseudo-Farbgradienten umzuwandeln</span><span class="sxs-lookup"><span data-stu-id="c827b-242">For depth or infrared frames, each scanline is processed to convert the depth or infrared values to a psuedocolor gradient, using the **PsuedoColorHelper** class that is also included in the sample and listed below.</span></span>

> [!NOTE] 
> <span data-ttu-id="c827b-243">Zum Ändern von Pixeln in **SoftwareBitmap**-Bildern müssen Sie auf einen nativen Speicherpuffer zugreifen.</span><span class="sxs-lookup"><span data-stu-id="c827b-243">In order to do pixel manipulation on **SoftwareBitmap** images, you must access a native memory buffer.</span></span> <span data-ttu-id="c827b-244">Zu diesem Zweck müssen Sie die in der untenstehenden Codeauflistung enthaltene IMemoryBufferByteAccess COM-Schnittstelle verwenden und die Projekteigenschaften aktualisieren, um die Kompilierung von unsicherem Code zuzulassen.</span><span class="sxs-lookup"><span data-stu-id="c827b-244">To do this, you must use the IMemoryBufferByteAccess COM interface included in the code listing below and you must update your project properties to allow compilation of unsafe code.</span></span> <span data-ttu-id="c827b-245">Weitere Informationen finden Sie unter [Erstellen, Bearbeiten und Speichern von Bitmapbildern](imaging.md).</span><span class="sxs-lookup"><span data-stu-id="c827b-245">For more information, see [Create, edit, and save bitmap images](imaging.md).</span></span>

[!code-cs[<span data-ttu-id="c827b-246">FrameArrived</span><span class="sxs-lookup"><span data-stu-id="c827b-246">FrameArrived</span></span>](./code/Frames_Win10/Frames_Win10/FrameRenderer.cs#SnippetFrameRenderer)]

## <a name="use-multisourcemediaframereader-to-get-time-corellated-frames-from-multiple-sources"></a><span data-ttu-id="c827b-247">Verwenden von MultiSourceMediaFrameReader zum Abrufen zeitkorrelierter Frames aus mehreren Quellen</span><span class="sxs-lookup"><span data-stu-id="c827b-247">Use MultiSourceMediaFrameReader to get time-corellated frames from multiple sources</span></span>
<span data-ttu-id="c827b-248">Ab Windows10, Version 1607, können Sie mit [**MultiSourceMediaFrameReader**](https://docs.microsoft.com/en-us/uwp/api/windows.media.capture.frames.multisourcemediaframereader) zeitkorrelierte Frames aus mehreren Quellen empfangen.</span><span class="sxs-lookup"><span data-stu-id="c827b-248">Starting with Windows 10, version 1607, you can use [**MultiSourceMediaFrameReader**](https://docs.microsoft.com/en-us/uwp/api/windows.media.capture.frames.multisourcemediaframereader) to receive time-corellated frames from multiple sources.</span></span> <span data-ttu-id="c827b-249">Diese API vereinfacht im Vergleich mit der [**DepthCorrelatedCoordinateMapper**](https://docs.microsoft.com/en-us/uwp/api/windows.media.devices.core.depthcorrelatedcoordinatemapper)-Klasse die Verarbeitung von Frames aus mehreren Quellen, die zeitlich eng aufeinanderfolgend erfasst wurden.</span><span class="sxs-lookup"><span data-stu-id="c827b-249">This API makes it easier to do processing that requires frames from multiple sources that were taken in close temporal proximity, such as using the [**DepthCorrelatedCoordinateMapper**](https://docs.microsoft.com/en-us/uwp/api/windows.media.devices.core.depthcorrelatedcoordinatemapper) class.</span></span> <span data-ttu-id="c827b-250">Eine Einschränkung bei der Verwendung dieser neuen Methode ist, das Ereignisse, die eine Frameankunft signalisieren, nur mit der Geschwindigkeit der langsamsten Erfassungsquelle ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="c827b-250">One limitation of using this new method is that frame-arrived events are only raised at the rate of the slowest capture source.</span></span> <span data-ttu-id="c827b-251">Zusätzliche Frames aus schneller Quellen werden gelöscht.</span><span class="sxs-lookup"><span data-stu-id="c827b-251">Extra frames from faster sources will be dropped.</span></span> <span data-ttu-id="c827b-252">Und da das System erwartet, dass Frames aus verschiedenen Quellen unterschiedlich schnell eintreffen, kann es nicht automatisch erkennen, wenn eine Quelle das Generieren von Frames endgültig beendet hat.</span><span class="sxs-lookup"><span data-stu-id="c827b-252">Also, because the system expects frames to arrive from different sources at different rates, it does not automatically recognize if a source has stopped generating frames altogether.</span></span> <span data-ttu-id="c827b-253">Der Beispielcode in diesem Abschnitt zeigt, wie Sie mit einem Ereignis Ihre eigene Timeoutlogik erstellen. Der Aufruf erfolgt, wenn korrelierte Frames nicht in einem von der App festgelegten Zeitlimit eintreffen.</span><span class="sxs-lookup"><span data-stu-id="c827b-253">The example code in this section shows how to use an event to create your own timeout logic that gets invoked if correlated frames don't arrive within an app-defined time limit.</span></span>

<span data-ttu-id="c827b-254">Die Schrittefür die Verwendung von [**MultiSourceMediaFrameReader**](https://docs.microsoft.com/en-us/uwp/api/windows.media.capture.frames.multisourcemediaframereader) ähneln den Schrittenfür die zuvor in diesem Artikel beschriebene Verwendung von [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader).</span><span class="sxs-lookup"><span data-stu-id="c827b-254">The steps for using [**MultiSourceMediaFrameReader**](https://docs.microsoft.com/en-us/uwp/api/windows.media.capture.frames.multisourcemediaframereader) are similar to the steps for using [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader) described previously in this article.</span></span> <span data-ttu-id="c827b-255">In diesem Beispiel wird eine Farbquelle und eine Tiefenquelle verwendet.</span><span class="sxs-lookup"><span data-stu-id="c827b-255">This example will use a color source and a depth source.</span></span> <span data-ttu-id="c827b-256">Deklarieren Sie einige Zeichenfolgenvariablen, um die Frame-IDs der Medienquelle zu speichern, die verwendet werden, um Frames aus jeder Quelle auswählen.</span><span class="sxs-lookup"><span data-stu-id="c827b-256">Declare some string variables to store the media frame source IDs that will be used to select frames from each source.</span></span> <span data-ttu-id="c827b-257">Deklarieren Sie dann ein [**ManualResetEventSlim**](https://docs.microsoft.com/dotnet/api/system.threading.manualreseteventslim?view=netframework-4.7), eine [**CancellationTokenSource**](https://msdn.microsoft.com/library/system.threading.cancellationtokensource.aspx) sowie einen [**EventHandler**](https://msdn.microsoft.com/library/system.eventhandler.aspx), der zur Implementierung von Timeoutlogik für das Beispiel verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-257">Next, declare a [**ManualResetEventSlim**](https://docs.microsoft.com/dotnet/api/system.threading.manualreseteventslim?view=netframework-4.7), a [**CancellationTokenSource**](https://msdn.microsoft.com/library/system.threading.cancellationtokensource.aspx), and an [**EventHandler**](https://msdn.microsoft.com/library/system.eventhandler.aspx) that will be used to implement timeout logic for the example.</span></span> 

[!code-cs[<span data-ttu-id="c827b-258">MultiFrameDeclarations</span><span class="sxs-lookup"><span data-stu-id="c827b-258">MultiFrameDeclarations</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetMultiFrameDeclarations)]

<span data-ttu-id="c827b-259">Ermitteln Sie mithilfe der in diesem Artikel beschriebenen Techniken eine [**MediaFrameSourceGroup**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup), welche die Farb- und Tiefenquellen enthält, die für dieses Beispielszenario erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="c827b-259">Using the techniques described previously in this article, query for a [**MediaFrameSourceGroup**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceGroup) that includes the color and depth sources required for this example scenario.</span></span> <span data-ttu-id="c827b-260">Nach Auswahl der gewünschten Framequellengruppe rufen Sie die [**MediaFrameSourceInfo**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo) für jede Framequelle ab.</span><span class="sxs-lookup"><span data-stu-id="c827b-260">After selecting the desired frame source group, get the [**MediaFrameSourceInfo**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameSourceInfo) for each frame source.</span></span>

[!code-cs[<span data-ttu-id="c827b-261">SelectColorAndDepth</span><span class="sxs-lookup"><span data-stu-id="c827b-261">SelectColorAndDepth</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetSelectColorAndDepth)]

<span data-ttu-id="c827b-262">Erstellen und Initialisieren Sie ein **MediaCapture**-Objekt, und übergeben Sie die gewählte Framequellengruppe in den Initialisierungseinstellungen.</span><span class="sxs-lookup"><span data-stu-id="c827b-262">Create and initialize a **MediaCapture** object, passing the selected frame source group in the initialization settings.</span></span>

[!code-cs[<span data-ttu-id="c827b-263">MultiFrameInitMediaCapture</span><span class="sxs-lookup"><span data-stu-id="c827b-263">MultiFrameInitMediaCapture</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetMultiFrameInitMediaCapture)]

<span data-ttu-id="c827b-264">Nach der Initialisierung des **MediaCapture**-Objekts rufen Sie die [**MediaFrameSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.Frames.MediaFrameSource)-Objekte für die Farb- und Tiefenkameras ab.</span><span class="sxs-lookup"><span data-stu-id="c827b-264">After initializing the **MediaCapture** object, retrieve [**MediaFrameSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.Frames.MediaFrameSource) objects for the color and depth cameras.</span></span> <span data-ttu-id="c827b-265">Speichern Sie die ID für jede Quelle, sodass Sie den eingehenden Frame für die entsprechende Quelle auswählen können.</span><span class="sxs-lookup"><span data-stu-id="c827b-265">Store the ID for each source so that you can select the arriving frame for the corresponding source.</span></span>

[!code-cs[<span data-ttu-id="c827b-266">GetColorAndDepthSource</span><span class="sxs-lookup"><span data-stu-id="c827b-266">GetColorAndDepthSource</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetGetColorAndDepthSource)]

<span data-ttu-id="c827b-267">Erstellen und initialisieren Sie den **MultiSourceMediaFrameReader** durch Aufrufen von [**CreateMultiSourceFrameReaderAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture#Windows_Media_Capture_MediaCapture_CreateMultiSourceFrameReaderAsync_Windows_Foundation_Collections_IIterable_Windows_Media_Capture_Frames_MediaFrameSource__). Übergeben Sie dabei ein Array mit Framequellen für den Reader.</span><span class="sxs-lookup"><span data-stu-id="c827b-267">Create and initialize the **MultiSourceMediaFrameReader** by calling [**CreateMultiSourceFrameReaderAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture#Windows_Media_Capture_MediaCapture_CreateMultiSourceFrameReaderAsync_Windows_Foundation_Collections_IIterable_Windows_Media_Capture_Frames_MediaFrameSource__) and passing an array of frame sources that the reader will use.</span></span> <span data-ttu-id="c827b-268">Registrieren Sie einen Ereignishandler für das Ereignis [**FrameArrived**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereader#Windows_Media_Capture_Frames_MultiSourceMediaFrameReader_FrameArrived).</span><span class="sxs-lookup"><span data-stu-id="c827b-268">Register an event handler for the [**FrameArrived**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereader#Windows_Media_Capture_Frames_MultiSourceMediaFrameReader_FrameArrived) event.</span></span> <span data-ttu-id="c827b-269">Dieses Beispiel erstellt eine Instanz der zuvor in diesem Artikel beschriebenen **FrameRenderer**-Hilfsklasse, die zum Rendern von Frames für ein **Image**-Steuerelement dient.</span><span class="sxs-lookup"><span data-stu-id="c827b-269">This example creates an instance the **FrameRenderer** helper class, described previously in this article, to render frames to an **Image** control.</span></span> <span data-ttu-id="c827b-270">Starten Sie die den Framereader durch Aufrufen von [**StartAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereader#Windows_Media_Capture_Frames_MultiSourceMediaFrameReader_StartAsync).</span><span class="sxs-lookup"><span data-stu-id="c827b-270">Start the frame reader by calling [**StartAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereader#Windows_Media_Capture_Frames_MultiSourceMediaFrameReader_StartAsync).</span></span>

<span data-ttu-id="c827b-271">Registrieren Sie einen Ereignishandler für das zuvor in diesem Beispiel deklarierte Ereignis **CorellationFailed**.</span><span class="sxs-lookup"><span data-stu-id="c827b-271">Register an event handler for the **CorellationFailed** event declared earlier in the example.</span></span> <span data-ttu-id="c827b-272">Dieses Ereignis signalisiert, wenn eine der verwendeten Medienframequellen die Produktion von Frames beendet.</span><span class="sxs-lookup"><span data-stu-id="c827b-272">We will signal this event if one of the media frame sources being used stops producing frames.</span></span> <span data-ttu-id="c827b-273">Rufen Sie schließlich mit [**Task.Run**](https://msdn.microsoft.com/en-us/library/hh195051.aspx) die Timeout-Hilfsmethode **NotifyAboutCorrelationFailure** in einem separaten Thread auf.</span><span class="sxs-lookup"><span data-stu-id="c827b-273">Finally, call [**Task.Run**](https://msdn.microsoft.com/en-us/library/hh195051.aspx) to call the timeout helper method, **NotifyAboutCorrelationFailure**, on a separate thread.</span></span> <span data-ttu-id="c827b-274">Die Implementierung dieser Methode wird später in diesem Artikel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="c827b-274">The implementation of this method is shown later in this article.</span></span>

[!code-cs[<span data-ttu-id="c827b-275">InitMultiFrameReader</span><span class="sxs-lookup"><span data-stu-id="c827b-275">InitMultiFrameReader</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetInitMultiFrameReader)]

<span data-ttu-id="c827b-276">Das Ereignis **FrameArrived** wird jedes Mal ausgelöst, wenn ein neuer Frame von einer der Medienframequellen verfügbar ist, die vom **MultiSourceMediaFrameReader** verwaltet werden.</span><span class="sxs-lookup"><span data-stu-id="c827b-276">The **FrameArrived** event is raised whenever a new frame is available from all of the media frame sources that are managed by the **MultiSourceMediaFrameReader**.</span></span> <span data-ttu-id="c827b-277">Dies bedeutet, dass das Ereignis mit der Geschwindigkeit der langsamsten Medienquelle ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-277">This means that the event will be raised on the cadence of the slowest media source.</span></span> <span data-ttu-id="c827b-278">Wenn eine Quelle mehrere Frames in der Zeit produziert, in der eine langsamere Quelle einen Frame fertigstellt, werden die zusätzlichen Frames aus der schnellen Quelle gelöscht.</span><span class="sxs-lookup"><span data-stu-id="c827b-278">If one source produces multiple frames in the time that a slower source produces one frame, the extra frames from the fast source will be dropped.</span></span> 

<span data-ttu-id="c827b-279">Rufen Sie die dem Ereignis zugeordnete [**MultiSourceMediaFrameReference**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereference) durch Aufrufen von [**TryAcquireLatestFrame**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereader#Windows_Media_Capture_Frames_MultiSourceMediaFrameReader_TryAcquireLatestFrame) ab.</span><span class="sxs-lookup"><span data-stu-id="c827b-279">Get the [**MultiSourceMediaFrameReference**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereference) associated with the event by calling [**TryAcquireLatestFrame**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereader#Windows_Media_Capture_Frames_MultiSourceMediaFrameReader_TryAcquireLatestFrame).</span></span> <span data-ttu-id="c827b-280">Rufen Sie die jeder Medienframequelle zugeordnete **MediaFrameReference** durch Aufrufen von [**TryGetFrameReferenceBySourceId**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereference#Windows_Media_Capture_Frames_MultiSourceMediaFrameReference_TryGetFrameReferenceBySourceId_System_String_) ab. Übergeben Sie dabei die ID-Zeichenfolgen, die Sie gespeichert haben, als der Framereader initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="c827b-280">Get the **MediaFrameReference** associated with each media frame source by calling [**TryGetFrameReferenceBySourceId**](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.multisourcemediaframereference#Windows_Media_Capture_Frames_MultiSourceMediaFrameReference_TryGetFrameReferenceBySourceId_System_String_), passing in the ID strings stored when the frame reader was initialized.</span></span>

<span data-ttu-id="c827b-281">Rufen Sie die [**Set**](https://msdn.microsoft.com/library/system.threading.manualreseteventslim.set.aspx)-Methode des **ManualResetEventSlim**-Objekts auf, um zu signalisieren, dass Frames angekommen sind.</span><span class="sxs-lookup"><span data-stu-id="c827b-281">Call the [**Set**](https://msdn.microsoft.com/library/system.threading.manualreseteventslim.set.aspx) method of the **ManualResetEventSlim** object to signal that frames have arrived.</span></span> <span data-ttu-id="c827b-282">Dieses Ereignis wird in der **NotifyCorrelationFailure**-Methode überprüft, die in einem separaten Thread ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c827b-282">We will check this event in the **NotifyCorrelationFailure** method that is running in a separate thread.</span></span> 

<span data-ttu-id="c827b-283">Schließlich verarbeiten Sie die zeitkorrelierten Medienframes.</span><span class="sxs-lookup"><span data-stu-id="c827b-283">Finally, perform any processing on the time-correlated media frames.</span></span> <span data-ttu-id="c827b-284">Dieses Beispiel zeigt einfach den Frame aus der Tiefenquelle an.</span><span class="sxs-lookup"><span data-stu-id="c827b-284">This example simply displays the frame from the depth source.</span></span>

[!code-cs[<span data-ttu-id="c827b-285">MultiFrameArrived</span><span class="sxs-lookup"><span data-stu-id="c827b-285">MultiFrameArrived</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetMultiFrameArrived)]

<span data-ttu-id="c827b-286">Die Hilfsmethode **NotifyCorrelationFailure** wurde nach dem Start des Framereaders in einem separaten Thread ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="c827b-286">The **NotifyCorrelationFailure** helper method was run on a separate thread after the frame reader was started.</span></span> <span data-ttu-id="c827b-287">Überprüfen Sie in dieser Methode, ob das Ereignis des Frameempfangs signalisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="c827b-287">In this method, check to see if the frame received event has been signaled.</span></span> <span data-ttu-id="c827b-288">Beachten Sie, dass dieses Ereignis im **FrameArrived**-Handler ausgelöst wird, sobald ein Satz korrelierter Frames ankommt.</span><span class="sxs-lookup"><span data-stu-id="c827b-288">Remember, in the **FrameArrived** handler, we set this event whenever a set of correlated frames arrive.</span></span> <span data-ttu-id="c827b-289">Wenn das Ereignis nicht innerhalb einer von der App definierten Zeit ausgelöst wurde (5Sekunden sind ein angemessener Wert), und der Task nicht mit der **CancellationToken**-Methode abgebrochen wurde, hat wahrscheinlich eine der Medienframequellen das Lesen von Frames beendet.</span><span class="sxs-lookup"><span data-stu-id="c827b-289">If the event hasn't been signaled for some app-defined period of time - 5 seconds is a reasonable value - and the task wasn't cancelled using the **CancellationToken**, then it's likely that one of the media frame sources has stopped reading frames.</span></span> <span data-ttu-id="c827b-290">In diesem Fall sollten Sie in der Regel den Framereader schließen, indem Sie das **CorrelationFailed**-Ereignis auslösen.</span><span class="sxs-lookup"><span data-stu-id="c827b-290">In this case you typically want to shut down the frame reader, so raise the app-defined **CorrelationFailed** event.</span></span> <span data-ttu-id="c827b-291">Im Handler für dieses Ereignis können Sie den Framereader beenden und die zugeordnet Ressourcen bereinigen (wie zuvor in diesem Artikel gezeigt).</span><span class="sxs-lookup"><span data-stu-id="c827b-291">In the handler for this event you can stop the frame reader and clean up it's associated resources as shown previously in this article.</span></span>

[!code-cs[<span data-ttu-id="c827b-292">NotifyCorrelationFailure</span><span class="sxs-lookup"><span data-stu-id="c827b-292">NotifyCorrelationFailure</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetNotifyCorrelationFailure)]

[!code-cs[<span data-ttu-id="c827b-293">CorrelationFailure</span><span class="sxs-lookup"><span data-stu-id="c827b-293">CorrelationFailure</span></span>](./code/Frames_Win10/Frames_Win10/MainPage.xaml.cs#SnippetCorrelationFailure)]

## <a name="related-topics"></a><span data-ttu-id="c827b-294">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="c827b-294">Related topics</span></span>

* [<span data-ttu-id="c827b-295">Kamera</span><span class="sxs-lookup"><span data-stu-id="c827b-295">Camera</span></span>](camera.md)
* [<span data-ttu-id="c827b-296">Allgemeine Foto-, Video- und Audioaufnahme mit „MediaCapture“</span><span class="sxs-lookup"><span data-stu-id="c827b-296">Basic photo, video, and audio capture with MediaCapture</span></span>](basic-photo-video-and-audio-capture-with-MediaCapture.md)
* [<span data-ttu-id="c827b-297">Beispiel für Kameraframes</span><span class="sxs-lookup"><span data-stu-id="c827b-297">Camera frames sample</span></span>](http://go.microsoft.com/fwlink/?LinkId=823230)
 

 




