---
author: drewbatgit
ms.assetid: B5E3A66D-0453-4D95-A3DB-8E650540A300
description: In diesem Artikel wird beschrieben, wie Sie den MediaProcessingTrigger und eine Hintergrundaufgabe verwenden, um Mediendateien im Hintergrund zu verarbeiten.
title: Verarbeiten von Mediendateien im Hintergrund
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows10, UWP
ms.openlocfilehash: 8d3166b40120799818598300a049a4148a40d2cc
ms.sourcegitcommit: 909d859a0f11981a8d1beac0da35f779786a6889
ms.translationtype: MT
ms.contentlocale: de-DE
ms.locfileid: "233828"
---
# <a name="process-media-files-in-the-background"></a><span data-ttu-id="e1ed5-104">Verarbeiten von Mediendateien im Hintergrund</span><span class="sxs-lookup"><span data-stu-id="e1ed5-104">Process media files in the background</span></span>

<span data-ttu-id="e1ed5-105">\[ Aktualisiert für UWP-Apps unter Windows 10.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-105">\[ Updated for UWP apps on Windows 10.</span></span> <span data-ttu-id="e1ed5-106">Artikel zu Windows 8.x finden Sie im [Archiv](http://go.microsoft.com/fwlink/p/?linkid=619132) \]</span><span class="sxs-lookup"><span data-stu-id="e1ed5-106">For Windows 8.x articles, see the [archive](http://go.microsoft.com/fwlink/p/?linkid=619132) \]</span></span>


<span data-ttu-id="e1ed5-107">In diesem Artikel wird beschrieben, wie Sie [**MediaProcessingTrigger**](https://msdn.microsoft.com/library/windows/apps/dn806005) und eine Hintergrundaufgabe verwenden, um Mediendateien im Hintergrund zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-107">This article shows you how to use the [**MediaProcessingTrigger**](https://msdn.microsoft.com/library/windows/apps/dn806005) and a background task to process media files in the background.</span></span>

<span data-ttu-id="e1ed5-108">Mit der in diesem Artikel beschriebenen Beispiel-App kann der Benutzer eine zu transcodierende Eingabemediendatei auswählen und eine Ausgabedatei für das Transcodierungsergebnis angeben.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-108">The example app described in this article allows the user to select an input media file to transcode and specify an output file for the transcoding result.</span></span> <span data-ttu-id="e1ed5-109">Anschließend wird eine Hintergrundaufgabe gestartet, um den Transcodierungsvorgang auszuführen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-109">Then, a background task is launched to perform the transcoding operation.</span></span> <span data-ttu-id="e1ed5-110">[**MediaProcessingTrigger**](https://msdn.microsoft.com/library/windows/apps/dn806005) unterstützt außer der Transcodierung noch viele andere Medienverarbeitungsszenarien, einschließlich Rendern von Medienkompositionen auf Datenträger und Hochladen von verarbeiteten Mediendateien nach Abschluss der Verarbeitung.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-110">The [**MediaProcessingTrigger**](https://msdn.microsoft.com/library/windows/apps/dn806005) is intended to support many different media processing scenarios besides transcoding, including rendering media compositions to disk and uploading processed media files after processing is complete.</span></span>

<span data-ttu-id="e1ed5-111">Ausführlichere Informationen zu den verschiedenen universellen Windows-App-Features in diesem Beispiel finden Sie unter:</span><span class="sxs-lookup"><span data-stu-id="e1ed5-111">For more detailed information on the different Universal Windows app features utilized in this sample, see:</span></span>

-   [<span data-ttu-id="e1ed5-112">Transcodieren von Mediendateien</span><span class="sxs-lookup"><span data-stu-id="e1ed5-112">Transcode media files</span></span>](transcode-media-files.md)
-   [<span data-ttu-id="e1ed5-113">Starten, Fortsetzen und Hintergrundaufgaben</span><span class="sxs-lookup"><span data-stu-id="e1ed5-113">Launching resuming and background tasks</span></span>](https://msdn.microsoft.com/library/windows/apps/mt227652)
-   [<span data-ttu-id="e1ed5-114">Kacheln, Signale und Benachrichtigungen</span><span class="sxs-lookup"><span data-stu-id="e1ed5-114">Tiles badges and notifications</span></span>](https://msdn.microsoft.com/library/windows/apps/mt185606)

## <a name="create-a-media-processing-background-task"></a><span data-ttu-id="e1ed5-115">Erstellen einer Hintergrundaufgabe für die Medienverarbeitung</span><span class="sxs-lookup"><span data-stu-id="e1ed5-115">Create a media processing background task</span></span>

<span data-ttu-id="e1ed5-116">Um Ihrer vorhandenen Microsoft Visual Studio-Projektmappe eine Hintergrundaufgabe hinzuzufügen, geben Sie einen Namen für die Komposition ein.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-116">To add a background task to your existing solution in Microsoft Visual Studio, Enter a name for your comp</span></span>

1.  <span data-ttu-id="e1ed5-117">Wählen Sie im Menü **Datei** die Option **Hinzufügen** und dann **Neues Projekt** aus.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-117">From the **File** menu, select **Add** and then **New Project...**.</span></span>
2.  <span data-ttu-id="e1ed5-118">Wählen Sie den Projekttyp **Komponente für Windows-Runtime (Universal Windows)** aus.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-118">Select the project type **Windows Runtime Component (Universal Windows)**.</span></span>
3.  <span data-ttu-id="e1ed5-119">Geben Sie einen Namen für das neue Komponentenprojekt ein.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-119">Enter a name for your new component project.</span></span> <span data-ttu-id="e1ed5-120">In diesem Beispiel wird der Projektname **MediaProcessingBackgroundTask** verwendet.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-120">This example uses the project name **MediaProcessingBackgroundTask**.</span></span>
4.  <span data-ttu-id="e1ed5-121">Klicken Sie auf „OK“.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-121">Click OK.</span></span>

<span data-ttu-id="e1ed5-122">Klicken Sie im **Projektmappen-Explorer**mit der rechten Maustaste auf das Symbol für die Datei „Class1.cs“, die standardmäßig erstellt wird, und wählen Sie **Umbenennen**aus.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-122">In **Solution Explorer**, right-click the icon for the "Class1.cs" file that is created by default and select **Rename**.</span></span> <span data-ttu-id="e1ed5-123">Benennen Sie die Datei in „MediaProcessingTask.cs“ um.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-123">Rename the file to "MediaProcessingTask.cs".</span></span> <span data-ttu-id="e1ed5-124">Wenn Sie von Visual Studio gefragt werden, ob Sie alle Verweise auf diese Klasse umbenennen möchten, klicken Sie auf **Ja**.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-124">When Visual Studio asks if you want to rename all of the references to this class, click **Yes**.</span></span>

<span data-ttu-id="e1ed5-125">Fügen Sie in der umbenannten Klassendatei die folgenden **using**-Direktiven hinzu, um diese Namespaces in Ihr Projekt einzuschließen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-125">In the renamed class file, add the following **using** directives to include these namespaces in your project.</span></span>
                                  
[!code-cs[<span data-ttu-id="e1ed5-126">BackgroundUsing</span><span class="sxs-lookup"><span data-stu-id="e1ed5-126">BackgroundUsing</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingBackgroundTask/MediaProcessingTask.cs#SnippetBackgroundUsing)]

<span data-ttu-id="e1ed5-127">Aktualisieren Sie die Klassendeklaration so, dass die Klasse von [**IBackgroundTask**](https://msdn.microsoft.com/library/windows/apps/br224794) erbt.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-127">Update your class declaration to make your class inherit from [**IBackgroundTask**](https://msdn.microsoft.com/library/windows/apps/br224794).</span></span>

[!code-cs[<span data-ttu-id="e1ed5-128">BackgroundClass</span><span class="sxs-lookup"><span data-stu-id="e1ed5-128">BackgroundClass</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingBackgroundTask/MediaProcessingTask.cs#SnippetBackgroundClass)]

<span data-ttu-id="e1ed5-129">Fügen Sie der Klasse die folgenden Membervariablen hinzu:</span><span class="sxs-lookup"><span data-stu-id="e1ed5-129">Add the following member variables to your class:</span></span>

-   <span data-ttu-id="e1ed5-130">Eine [**IBackgroundTaskInstance**](https://msdn.microsoft.com/library/windows/apps/br224797)-Schnittstelle, die verwendet wird, um die Vordergrund-App mit dem Status der Hintergrundaufgabe zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-130">An [**IBackgroundTaskInstance**](https://msdn.microsoft.com/library/windows/apps/br224797) that will be used to update the foreground app with the progress of the background task.</span></span>
-   <span data-ttu-id="e1ed5-131">Eine [**BackgroundTaskDeferral**](https://msdn.microsoft.com/library/windows/apps/hh700499)-Klasse, die verhindert, dass das System die Hintergrundaufgabe herunterfährt, während die Medientranscodierung asynchron ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-131">A [**BackgroundTaskDeferral**](https://msdn.microsoft.com/library/windows/apps/hh700499) that keeps the system from shutting down your background task while media transcoding is being performed asynchronously.</span></span>
-   <span data-ttu-id="e1ed5-132">Ein **CancellationTokenSource**-Objekt, mit dem der asynchrone Transcodierungsvorgang abgebrochen werden kann.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-132">A **CancellationTokenSource** object that can be used to cancel the asynchronous transcoding operation.</span></span>
-   <span data-ttu-id="e1ed5-133">Das [**MediaTranscoder**](https://msdn.microsoft.com/library/windows/apps/br207080)-Objekt, das zum Transcodieren von Mediendateien verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-133">The [**MediaTranscoder**](https://msdn.microsoft.com/library/windows/apps/br207080) object that will be used to transcode media files.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-134">BackgroundMembers</span><span class="sxs-lookup"><span data-stu-id="e1ed5-134">BackgroundMembers</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingBackgroundTask/MediaProcessingTask.cs#SnippetBackgroundMembers)]

<span data-ttu-id="e1ed5-135">Das System ruft die [**Run**](https://msdn.microsoft.com/library/windows/apps/br224811)-Methode einer Hintergrundaufgabe auf, wenn die Aufgabe gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-135">The system calls [**Run**](https://msdn.microsoft.com/library/windows/apps/br224811) method of a background task when the task is launched.</span></span> <span data-ttu-id="e1ed5-136">Legen Sie das an die Methode übergebene [**IBackgroundTask**](https://msdn.microsoft.com/library/windows/apps/br224794)-Objekt auf die entsprechende Membervariable fest.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-136">Set the [**IBackgroundTask**](https://msdn.microsoft.com/library/windows/apps/br224794) object passed into the method to the corresponding member variable.</span></span> <span data-ttu-id="e1ed5-137">Registrieren Sie einen Handler für das [**Canceled**](https://msdn.microsoft.com/library/windows/apps/br224798)-Ereignis, das ausgelöst wird, wenn das System die Hintergrundaufgabe herunterfahren muss.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-137">Register a handler for the [**Canceled**](https://msdn.microsoft.com/library/windows/apps/br224798) event, which will be raised if the system needs to shut down the background task.</span></span> <span data-ttu-id="e1ed5-138">Legen Sie anschließend die [**Progress**](https://msdn.microsoft.com/library/windows/apps/br224800)-Eigenschaft auf 0 (null) fest.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-138">Then, set the [**Progress**](https://msdn.microsoft.com/library/windows/apps/br224800) property to zero.</span></span>

<span data-ttu-id="e1ed5-139">Rufen Sie als Nächstes die [**GetDeferral**](https://msdn.microsoft.com/library/windows/apps/hh700507)-Methode des Hintergrundaufgabenobjekts auf, um eine Verzögerung abzurufen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-139">Next, call the background task object's [**GetDeferral**](https://msdn.microsoft.com/library/windows/apps/hh700507) method to obtain a deferral.</span></span> <span data-ttu-id="e1ed5-140">Dies weist das System an, die Aufgabe nicht herunterzufahren, da Sie asynchrone Vorgänge ausführen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-140">This tells the system not to shut down your task because you are performing asynchronous operations.</span></span>

<span data-ttu-id="e1ed5-141">Rufen Sie als Nächstes die **TranscodeFileAsync**-Hilfsmethode auf, die im nächsten Abschnitt definiert wird.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-141">Next, call the helper method **TranscodeFileAsync**, which is defined in the next section.</span></span> <span data-ttu-id="e1ed5-142">Wenn diese Methode erfolgreich abgeschlossen wird, wird eine Hilfsmethode aufgerufen, um eine Popupbenachrichtigung zu öffnen, die den Benutzer darauf hinweist, dass die Transcodierung abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-142">If that completes successfully, a helper method is called to launch a toast notification to alert the user that transcoding is complete.</span></span>

<span data-ttu-id="e1ed5-143">Rufen Sie am Ende der **Run**-Methode die [**Complete**](https://msdn.microsoft.com/library/windows/apps/hh700504)-Methode für das Verzögerungsobjekt auf, um dem System mitzuteilen, dass die Hintergrundaufgabe abgeschlossen ist und beendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-143">At the end of the **Run** method, call [**Complete**](https://msdn.microsoft.com/library/windows/apps/hh700504) on the deferral object to let the system know that your background task is complete and can be terminated.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-144">Run</span><span class="sxs-lookup"><span data-stu-id="e1ed5-144">Run</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingBackgroundTask/MediaProcessingTask.cs#SnippetRun)]

<span data-ttu-id="e1ed5-145">In der **TranscodeFileAsync**-Hilfsmethode werden die Dateinamen für die Eingabe- und Ausgabedateien für die Transcodierungsvorgänge aus der [**LocalSettings**](https://msdn.microsoft.com/library/windows/apps/br241622)-Eigenschaft für Ihre App abgerufen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-145">In the **TranscodeFileAsync** helper method, the file names for the input and output files for the transcoding operations are retrieved from the [**LocalSettings**](https://msdn.microsoft.com/library/windows/apps/br241622) for your app.</span></span> <span data-ttu-id="e1ed5-146">Diese Werte werden von der Vordergrund-App festgelegt.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-146">These values will be set by your foreground app.</span></span> <span data-ttu-id="e1ed5-147">Erstellen Sie ein [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171)-Objekt für die Eingabe- und Ausgabedateien, und erstellen Sie dann ein Codierungsprofil für die Transcodierung.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-147">Create a [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) object for the input and output files and then create an encoding profile to use for transcoding.</span></span>

<span data-ttu-id="e1ed5-148">Rufen Sie [**PrepareFileTranscodeAsync**](https://msdn.microsoft.com/library/windows/apps/hh700936) auf, und übergeben Sie die Eingabedatei, die Ausgabedatei und das Codierungsprofil.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-148">Call [**PrepareFileTranscodeAsync**](https://msdn.microsoft.com/library/windows/apps/hh700936), passing in the input file, output file, and encoding profile.</span></span> <span data-ttu-id="e1ed5-149">Das von diesem Aufruf zurückgegebene [**PrepareTranscodeResult**](https://msdn.microsoft.com/library/windows/apps/hh700941)-Objekt teilt Ihnen mit, ob die Transcodierung durchgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-149">The [**PrepareTranscodeResult**](https://msdn.microsoft.com/library/windows/apps/hh700941) object returned from this call lets you know if transcoding can be performed.</span></span> <span data-ttu-id="e1ed5-150">Wenn die [**CanTranscode**](https://msdn.microsoft.com/library/windows/apps/hh700942)-Eigenschaft „true“ ist, rufen Sie [**TranscodeAsync**](https://msdn.microsoft.com/library/windows/apps/hh700946) auf, um den Transcodierungsvorgang auszuführen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-150">If the [**CanTranscode**](https://msdn.microsoft.com/library/windows/apps/hh700942) property is true, call [**TranscodeAsync**](https://msdn.microsoft.com/library/windows/apps/hh700946) to perform the transcoding operation.</span></span>

<span data-ttu-id="e1ed5-151">Mit der **AsTask**-Methode können Sie den Status des asynchronen Vorgangs nachverfolgen oder den Vorgang abbrechen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-151">The **AsTask** method enables you to track the progress the asynchronous operation or cancel it.</span></span> <span data-ttu-id="e1ed5-152">Erstellen Sie ein neues **Progress**-Objekt, wobei Sie die gewünschten Statuseinheiten und den Namen der Methode angeben, die aufgerufen wird, um Sie über den aktuellen Status der Aufgabe zu informieren.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-152">Create a new **Progress** object, specifying the units of progress you desire and the name of the method that will be called to notify you of the current progress of the task.</span></span> <span data-ttu-id="e1ed5-153">Übergeben Sie das **Progress**-Objekt zusammen mit dem Abbruchtoken, das Ihnen das Abbrechen der Aufgabe ermöglicht, an die **AsTask**-Methode.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-153">Pass the **Progress** object into the **AsTask** method along with the cancellation token that allows you to cancel the task.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-154">TranscodeFileAsync</span><span class="sxs-lookup"><span data-stu-id="e1ed5-154">TranscodeFileAsync</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingBackgroundTask/MediaProcessingTask.cs#SnippetTranscodeFileAsync)]

<span data-ttu-id="e1ed5-155">Legen Sie in der Methode, die Sie zum Erstellen des Statusobjekts im vorherigen Schritt verwendet haben (**Progress**), den Status der Hintergrundaufgabeninstanz fest.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-155">In the method you used to create the Progress object in the previous step, **Progress**, set the progress of the background task instance.</span></span> <span data-ttu-id="e1ed5-156">Hierdurch wird der Status an die Vordergrund-App übergeben, sofern diese ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-156">This will pass the progress to the foreground app, if it is running.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-157">Progress</span><span class="sxs-lookup"><span data-stu-id="e1ed5-157">Progress</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingBackgroundTask/MediaProcessingTask.cs#SnippetProgress)]

<span data-ttu-id="e1ed5-158">Die **SendToastNotification**-Hilfsmethode erstellt eine neue Popupbenachrichtigung, indem ein XML-Vorlagendokument für ein Popup abgerufen wird, das nur Text enthält.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-158">The **SendToastNotification** helper method creates a new toast notification by getting a template XML document for a toast that only has text content.</span></span> <span data-ttu-id="e1ed5-159">Das Textelement des Popup-XML-Codes wird festgelegt. Anschließend wird ein neues [**ToastNotification**](https://msdn.microsoft.com/library/windows/apps/br208641)-Objekt aus dem XML-Dokument erstellt.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-159">The text element of the toast XML is set and then a new [**ToastNotification**](https://msdn.microsoft.com/library/windows/apps/br208641) object is created from the XML document.</span></span> <span data-ttu-id="e1ed5-160">Schließlich wird dem Benutzer das Popup durch Aufrufen von [**ToastNotifier.Show**](https://msdn.microsoft.com/library/windows/apps/br208659) angezeigt.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-160">Finally, the toast is shown to the user by calling [**ToastNotifier.Show**](https://msdn.microsoft.com/library/windows/apps/br208659).</span></span>

[!code-cs[<span data-ttu-id="e1ed5-161">SendToastNotification</span><span class="sxs-lookup"><span data-stu-id="e1ed5-161">SendToastNotification</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingBackgroundTask/MediaProcessingTask.cs#SnippetSendToastNotification)]

<span data-ttu-id="e1ed5-162">Im Handler für das [**Canceled**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Background.IBackgroundTaskInstance.Canceled)-Ereignis, das aufgerufen wird, wenn das System die Hintergrundaufgabe abbricht, können Sie den Fehler zu Telemetriezwecken protokollieren.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-162">In the handler for the [**Canceled**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Background.IBackgroundTaskInstance.Canceled) event, which is called when the system cancels your background task, you can log the error for telemetry purposes.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-163">OnCanceled</span><span class="sxs-lookup"><span data-stu-id="e1ed5-163">OnCanceled</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingBackgroundTask/MediaProcessingTask.cs#SnippetOnCanceled)]

## <a name="register-and-launch-the-background-task"></a><span data-ttu-id="e1ed5-164">Registrieren und Starten der Hintergrundaufgabe</span><span class="sxs-lookup"><span data-stu-id="e1ed5-164">Register and launch the background task</span></span>

<span data-ttu-id="e1ed5-165">Bevor die Hintergrundaufgabe aus der Vordergrund-App gestartet werden kann, müssen Sie die Datei „Package.appmanifest“ der Vordergrund-App aktualisieren, um dem System mitzuteilen, dass Ihre App eine Hintergrundaufgabe verwendet.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-165">Before you can launch the background task from your foreground app, you must update your foreground app's Package.appmanifest file to let the system know that your app uses a background task.</span></span>

1.  <span data-ttu-id="e1ed5-166">Doppelklicken Sie im **Projektmappen-Explorer** auf das Symbol der Datei „Package.appmanifest“, um den Manifest-Editor zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-166">In **Solution Explorer**, double-click the Package.appmanifest file icon to open the manifest editor.</span></span>
2.  <span data-ttu-id="e1ed5-167">Klicken Sie auf die Registerkarte **Deklarationen**.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-167">Select the **Declarations** tab.</span></span>
3.  <span data-ttu-id="e1ed5-168">Wählen Sie unter **Verfügbare Deklarationen** die Option **Hintergrundaufgaben** aus, und klicken Sie auf **Hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-168">From **Available Declarations**, select **Background Tasks** and click **Add**.</span></span>
4.  <span data-ttu-id="e1ed5-169">Vergewissern Sie sich, dass unter **Unterstützte Deklarationen** das Element **Hintergrundaufgaben** ausgewählt ist.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-169">Under **Supported Declarations** make sure that the **Background Tasks** item is selected.</span></span> <span data-ttu-id="e1ed5-170">Aktivieren Sie unter **Eigenschaften** das Kontrollkästchen für **Medienverarbeitung**.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-170">Under **Properties**, select the checkbox for **Media processing**.</span></span>
5.  <span data-ttu-id="e1ed5-171">Geben Sie im Textfeld **Einstiegspunkt** den Namespace und den Klassennamen für den Hintergrundtest durch einen Punkt getrennt an.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-171">In the **Entry Point** text box, specify the namespace and class name for your background test, separated by a period.</span></span> <span data-ttu-id="e1ed5-172">Für dieses Beispiel lautet die Eingabe:</span><span class="sxs-lookup"><span data-stu-id="e1ed5-172">For this example, the entry is:</span></span>
   ```csharp
   MediaProcessingBackgroundTask.MediaProcessingTask
   ```
<span data-ttu-id="e1ed5-173">Als Nächstes müssen Sie der Vordergrund-App einen Verweis auf die Hintergrundaufgabe hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-173">Next, you need to add a reference to your background task to your foreground app.</span></span>
1.  <span data-ttu-id="e1ed5-174">Klicken Sie im **Projektmappen-Explorer** unter dem Vordergrund-App-Projekt mit der rechten Maustaste auf den Ordner **Verweise**, und wählen Sie **Verweis hinzufügen** aus.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-174">In **Solution Explorer**, under your foreground app project, right-click the **References** folder and select **Add Reference...**.</span></span>
2.  <span data-ttu-id="e1ed5-175">Erweitern Sie den Knoten **Projekte**, und wählen Sie **Projektmappe** aus.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-175">Expand the **Projects** node and select **Solution**.</span></span>
3.  <span data-ttu-id="e1ed5-176">Aktivieren Sie das Kontrollkästchen neben dem Hintergrundaufgabenprojekt, und klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-176">Check the box next to your background task project and click **OK**.</span></span>

<span data-ttu-id="e1ed5-177">Fügen Sie den restlichen Code in diesem Beispiel der Vordergrund-App hinzu.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-177">The rest of the code in this example should be added to your foreground app.</span></span> <span data-ttu-id="e1ed5-178">Zunächst müssen Sie dem Projekt die folgenden Namespaces hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-178">First, you will need to add the following namespaces to your project.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-179">ForegroundUsing</span><span class="sxs-lookup"><span data-stu-id="e1ed5-179">ForegroundUsing</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingTriggerWin10/MainPage.xaml.cs#SnippetForegroundUsing)]

<span data-ttu-id="e1ed5-180">Als Nächstes fügen Sie die folgenden Membervariablen hinzu, die zum Registrieren der Hintergrundaufgabe benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-180">Next, add the following member variables that are needed to register the background task.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-181">ForegroundMembers</span><span class="sxs-lookup"><span data-stu-id="e1ed5-181">ForegroundMembers</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingTriggerWin10/MainPage.xaml.cs#SnippetForegroundMembers)]

<span data-ttu-id="e1ed5-182">Die **PickFilesToTranscode**-Hilfsmethode verwendet eine [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847)-Klasse und eine [**FileSavePicker**](https://msdn.microsoft.com/library/windows/apps/br207871)-Klasse, um die Eingabe- und Ausgabedateien für die Transcodierung zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-182">The **PickFilesToTranscode** helper method uses a [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847) and a [**FileSavePicker**](https://msdn.microsoft.com/library/windows/apps/br207871) to open the input and output files for transcoding.</span></span> <span data-ttu-id="e1ed5-183">Der Benutzer kann Dateien an einem Speicherort auswählen, auf den Ihre App keinen Zugriff auf.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-183">The user may select files in a location that your app does not have access to.</span></span> <span data-ttu-id="e1ed5-184">Um sicherzustellen, dass die Hintergrundaufgabe die Dateien öffnen kann, fügen Sie sie der [**FutureAccessList**](https://msdn.microsoft.com/library/windows/apps/br207457)-Eigenschaft für die App hinzu.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-184">To make sure your background task can open the files, add them to the [**FutureAccessList**](https://msdn.microsoft.com/library/windows/apps/br207457) for your app.</span></span>

<span data-ttu-id="e1ed5-185">Legen Sie abschließend Einträge für die Eingabe- und Ausgabedateinamen in der [**LocalSettings**](https://msdn.microsoft.com/library/windows/apps/br241622)-Eigenschaft für Ihre App fest.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-185">Finally, set entries for the input and output file names in the [**LocalSettings**](https://msdn.microsoft.com/library/windows/apps/br241622) for your app.</span></span> <span data-ttu-id="e1ed5-186">Die Hintergrundaufgabe ruft die Dateinamen von diesem Speicherort ab.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-186">The background task retrieves the file names from this location.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-187">PickFilesToTranscode</span><span class="sxs-lookup"><span data-stu-id="e1ed5-187">PickFilesToTranscode</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingTriggerWin10/MainPage.xaml.cs#SnippetPickFilesToTranscode)]

<span data-ttu-id="e1ed5-188">Um die Hintergrundaufgabe registrieren, erstellen Sie eine neue [**MediaProcessingTrigger**](https://msdn.microsoft.com/library/windows/apps/dn806005)-Klasse und eine neue [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768)-Klasse.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-188">To register the background task, create a new [**MediaProcessingTrigger**](https://msdn.microsoft.com/library/windows/apps/dn806005) and a new [**BackgroundTaskBuilder**](https://msdn.microsoft.com/library/windows/apps/br224768).</span></span> <span data-ttu-id="e1ed5-189">Legen Sie den Namen des Hintergrundaufgaben-Generators fest, damit Sie ihn später identifizieren können.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-189">Set the name of the background task builder so that you can identify it later.</span></span> <span data-ttu-id="e1ed5-190">Legen Sie die [**TaskEntryPoint**](https://msdn.microsoft.com/library/windows/apps/br224774)-Eigenschaft auf die gleiche Namespace- und Klassennamenszeichenfolge fest, die Sie in der Manifestdatei verwendet haben.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-190">Set the [**TaskEntryPoint**](https://msdn.microsoft.com/library/windows/apps/br224774) to the same namespace and class name string you used in the manifest file.</span></span> <span data-ttu-id="e1ed5-191">Legen Sie die [**Trigger**](https://msdn.microsoft.com/library/windows/apps/dn641725)-Eigenschaft auf die **MediaProcessingTrigger** Instanz fest.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-191">Set the [**Trigger**](https://msdn.microsoft.com/library/windows/apps/dn641725) property to the **MediaProcessingTrigger** instance.</span></span>

<span data-ttu-id="e1ed5-192">Stellen Sie vor dem Registrieren der Aufgabe sicher, dass Sie die Registrierung aller zuvor registrierten Aufgaben aufheben, indem Sie eine Schleife durch die [**AllTasks**](https://msdn.microsoft.com/library/windows/apps/br224787)-Sammlung durchführen. Rufen Sie zudem [**Unregister**](https://msdn.microsoft.com/library/windows/apps/br229870) für alle Aufgaben auf, die den in der [**BackgroundTaskBuilder.Name**](https://msdn.microsoft.com/library/windows/apps/br224771)-Eigenschaft angegebenen Namen aufweisen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-192">Before registering the task, make sure you unregister any previously registered tasks by looping through the [**AllTasks**](https://msdn.microsoft.com/library/windows/apps/br224787) collection and calling [**Unregister**](https://msdn.microsoft.com/library/windows/apps/br229870) on any tasks that have the name you specified in the [**BackgroundTaskBuilder.Name**](https://msdn.microsoft.com/library/windows/apps/br224771) property.</span></span>

<span data-ttu-id="e1ed5-193">Registrieren Sie die Hintergrundaufgabe durch Aufrufen von [**Register**](https://msdn.microsoft.com/library/windows/apps/br224772).</span><span class="sxs-lookup"><span data-stu-id="e1ed5-193">Register the background task by calling [**Register**](https://msdn.microsoft.com/library/windows/apps/br224772).</span></span> <span data-ttu-id="e1ed5-194">Registrieren Sie Handler für das [**Completed**](https://msdn.microsoft.com/library/windows/apps/br224788)-Ereignis und das [**Progress**](https://msdn.microsoft.com/library/windows/apps/br224808)-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-194">Register handlers for the [**Completed**](https://msdn.microsoft.com/library/windows/apps/br224788) and [**Progress**](https://msdn.microsoft.com/library/windows/apps/br224808) events.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-195">RegisterBackgroundTask</span><span class="sxs-lookup"><span data-stu-id="e1ed5-195">RegisterBackgroundTask</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingTriggerWin10/MainPage.xaml.cs#SnippetRegisterBackgroundTask)]

<span data-ttu-id="e1ed5-196">Starten Sie die Hintergrundaufgabe durch Aufrufen der [**RequestAsync**](https://msdn.microsoft.com/library/windows/apps/dn765071)-Methode des **MediaProcessingTrigger**-Objekts.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-196">Launch the background task by calling the **MediaProcessingTrigger** object's [**RequestAsync**](https://msdn.microsoft.com/library/windows/apps/dn765071) method.</span></span> <span data-ttu-id="e1ed5-197">Das von dieser Methode zurückgegebene [**MediaProcessingTriggerResult**](https://msdn.microsoft.com/library/windows/apps/dn806007)-Objekt informiert Sie darüber, ob die Hintergrundaufgabe erfolgreich gestartet wurde. Zudem teilt es Ihnen bei einem Fehler mit, warum die Hintergrundaufgabe nicht gestartet wurde.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-197">The [**MediaProcessingTriggerResult**](https://msdn.microsoft.com/library/windows/apps/dn806007) object returned by this method lets you know whether the background task was started successfully, and if not, lets you know why the background task wasn't launched.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-198">LaunchBackgroundTask</span><span class="sxs-lookup"><span data-stu-id="e1ed5-198">LaunchBackgroundTask</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingTriggerWin10/MainPage.xaml.cs#SnippetLaunchBackgroundTask)]

<span data-ttu-id="e1ed5-199">Der **OnProgress**-Ereignishandler wird aufgerufen, wenn die Hintergrundaufgabe den Vorgangsstatus aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-199">The **OnProgress** event handler is called when the background task updates the progress of the operation.</span></span> <span data-ttu-id="e1ed5-200">Sie können diese Möglichkeit nutzen, um die Benutzeroberfläche mit Statusinformationen zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-200">You can use this opportunity to update your UI with progress information.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-201">OnProgress</span><span class="sxs-lookup"><span data-stu-id="e1ed5-201">OnProgress</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingTriggerWin10/MainPage.xaml.cs#SnippetOnProgress)]

<span data-ttu-id="e1ed5-202">Der **OnCompleted**-Ereignishandler wird aufgerufen, wenn die Ausführung der Hintergrundaufgabe abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-202">The **OnCompleted** event handler is called when the background task has finished running.</span></span> <span data-ttu-id="e1ed5-203">Dies ist eine weitere Möglichkeit zum Aktualisieren der Benutzeroberfläche, um Statusinformationen für den Benutzer bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="e1ed5-203">This is another opportunity to update your UI to give status information to the user.</span></span>

[!code-cs[<span data-ttu-id="e1ed5-204">OnCompleted</span><span class="sxs-lookup"><span data-stu-id="e1ed5-204">OnCompleted</span></span>](./code/MediaProcessingTriggerWin10/cs/MediaProcessingTriggerWin10/MainPage.xaml.cs#SnippetOnCompleted)]


 

 




