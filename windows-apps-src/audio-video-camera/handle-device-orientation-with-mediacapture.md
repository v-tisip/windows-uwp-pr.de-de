---
author: drewbatgit
ms.assetid: af3941c0-3508-4ba2-a79e-fc71657c605f
description: In diesem Artikel wird beschrieben, wie Sie beim Aufnehmen von Fotos und Videos mit einer Hilfsklasse die Geräteausrichtung handhaben.
title: Handhaben der Geräte- und Bildschirmausrichtung mit „MediaCapture“
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
keywords: Windows10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: 1367c880bd6dde573ab4fc30733ed9d1fefa6b0b
ms.sourcegitcommit: d0e836dfc937ebf7dfa9c424620f93f3c8e0a7e8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/26/2018
ms.locfileid: "5665109"
---
# <a name="handle-device-orientation-with-mediacapture"></a><span data-ttu-id="b328b-104">Handhaben der Geräte- und Bildschirmausrichtung mit „MediaCapture“</span><span class="sxs-lookup"><span data-stu-id="b328b-104">Handle device orientation with MediaCapture</span></span>
<span data-ttu-id="b328b-105">Wenn Ihre App ein Foto oder Video aufnimmt, das außerhalb der App angezeigt werden soll, z.B. in eine Datei auf dem Gerät des Benutzers gespeichert oder online freigegeben werden soll, ist es wichtig, dass das Bild mit den richtigen Ausrichtungsmetadaten codiert wird. Dadurch wird bei der Anzeige durch eine andere App oder ein anderes Gerät das Bild korrekt ausgerichtet.</span><span class="sxs-lookup"><span data-stu-id="b328b-105">When your app captures a photo or video that is intended to be viewed outside of your app, such as saving to a file on the user's device or sharing online, it's important that you encode the image with the proper orientation metadata so that when another app or device displays the image, it is oriented correctly.</span></span> <span data-ttu-id="b328b-106">Die Bestimmung der korrekten Ausrichtungsdaten für eine Mediendatei kann eine komplexe Aufgabe sein, da verschiedene Variablen berücksichtigt werden müssen. Dazu zählen die Ausrichtung des Geräte-Chassis, die Ausrichtung der Anzeige und die Platzierung der Kamera (nach vorne oder nach hinten gerichtete Kamera).</span><span class="sxs-lookup"><span data-stu-id="b328b-106">Determining the correct orientation data to include in a media file can be a complex task because there are several variables to consider, including the orientation of the device chassis, the orientation of the display, and the placement of the camera on the chassis (whether it is a front or back-facing camera).</span></span> 

<span data-ttu-id="b328b-107">Um die Handhabung der Ausrichtung zu vereinfachen, empfehlen wir die Verwendung der Hilfsklasse **CameraRotationHelper**, deren vollständige Definition am Ende dieses Artikels bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="b328b-107">To simplify the process of handling orientation, we recommend using a helper class, **CameraRotationHelper**, for which the full definition is provided at the end of this article.</span></span> <span data-ttu-id="b328b-108">Sie können diese Klasse dem Projekt hinzufügen und dann die Schritte zum Hinzufügen von Ausrichtungsunterstützung zur Kamera-App in diesem Artikel ausführen.</span><span class="sxs-lookup"><span data-stu-id="b328b-108">You can add this class to your project and then follow the steps in this article to add orientation support to your camera app.</span></span> <span data-ttu-id="b328b-109">Die Hilfsklasse erleichtert auch das Drehen der Steuerelemente in der Kamera-UI, damit sie aus Sicht des Benutzers korrekt gerendert werden.</span><span class="sxs-lookup"><span data-stu-id="b328b-109">The helper class also makes it easier for you to rotate the controls in your camera UI so that they are rendered correctly from the user's point of view.</span></span>

> [!NOTE] 
> <span data-ttu-id="b328b-110">Dieser Artikel baut auf Konzepten und Code auf, die im Artikel [**Allgemeine Foto-, Video- und Audioaufnahme mit „MediaCapture“**](basic-photo-video-and-audio-capture-with-mediacapture.md) erläutert werden.</span><span class="sxs-lookup"><span data-stu-id="b328b-110">This article builds on the code and concepts discussed in the article [**Basic photo, video, and audio capture with MediaCapture**](basic-photo-video-and-audio-capture-with-mediacapture.md).</span></span> <span data-ttu-id="b328b-111">Es wird empfohlen, dass Sie sich mit den grundlegenden Konzepten der Verwendung der **MediaCapture**-Klasse vertraut machen, bevor Sie die Ausrichtungsunterstützung zur App hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="b328b-111">We recommend that you familiarize yourself with the basic concepts of using the **MediaCapture** class before adding orientation support to your app.</span></span>

## <a name="namespaces-used-in-this-article"></a><span data-ttu-id="b328b-112">In diesem Artikel verwendete Namespaces</span><span class="sxs-lookup"><span data-stu-id="b328b-112">Namespaces used in this article</span></span>
<span data-ttu-id="b328b-113">Der Beispielcode in diesem Artikel verwendet APIs aus den folgenden Namespaces, die Sie in den Code einschließen sollten.</span><span class="sxs-lookup"><span data-stu-id="b328b-113">The example code in this article uses APIs from the following namespaces that you should include in your code.</span></span> 

[!code-cs[OrientationUsing](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetOrientationUsing)]

<span data-ttu-id="b328b-114">Der erste Schritt beim Hinzufügen der Ausrichtungsunterstützung zur App ist das Sperren der Anzeige, sodass diese sich beim Drehen des Geräts nicht automatisch dreht.</span><span class="sxs-lookup"><span data-stu-id="b328b-114">The first step in adding orientation support to your app is to lock the display so that it doesn't automatically rotate when the device is rotated.</span></span> <span data-ttu-id="b328b-115">Die automatische UI-Drehung eignet sich gut für die meisten Arten von Apps. Es ist jedoch für Benutzer nicht intuitiv, wenn sich die Kameravorschau dreht.</span><span class="sxs-lookup"><span data-stu-id="b328b-115">Automatic UI rotation works well for most types of apps, but it is unintuitive for users when the camera preview rotates.</span></span> <span data-ttu-id="b328b-116">Sperren Sie die Bildschirmausrichtung, indem Sie die [**DisplayInformation.AutoRotationPreferences**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Display.DisplayInformation.AutoRotationPreferences)-Eigenschaft auf [**DisplayOrientations.Landscape**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Display.DisplayOrientations) festlegen.</span><span class="sxs-lookup"><span data-stu-id="b328b-116">Lock the display orientation by setting the [**DisplayInformation.AutoRotationPreferences**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Display.DisplayInformation.AutoRotationPreferences) property to [**DisplayOrientations.Landscape**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Display.DisplayOrientations).</span></span> 

[!code-cs[AutoRotationPreference](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetAutoRotationPreference)]

## <a name="tracking-the-camera-device-location"></a><span data-ttu-id="b328b-117">Nachverfolgen der Position des Kamerageräts</span><span class="sxs-lookup"><span data-stu-id="b328b-117">Tracking the camera device location</span></span>
<span data-ttu-id="b328b-118">Um die richtige Ausrichtung für aufgenommene Medien zu berechnen, muss die App die Position des Kamerageräts am Chassis ermitteln.</span><span class="sxs-lookup"><span data-stu-id="b328b-118">To calculate the correct orientation for captured media, you app must determine the location of the camera device on the chassis.</span></span> <span data-ttu-id="b328b-119">Fügen Sie eine boolesche Membervariable hinzu, um nachzuverfolgen, ob es sich um eine externe Kamera handelt, z.B. eine USB-Webcam.</span><span class="sxs-lookup"><span data-stu-id="b328b-119">Add a boolean member variable to track whether the camera is external to the device, such as a USB web cam.</span></span> <span data-ttu-id="b328b-120">Fügen Sie eine weitere boolesche Variable hinzu, um nachzuverfolgen, ob die Vorschau gespiegelt werden soll. Dies ist bei der Verwendung einer nach vorne gerichteten Kamera der Fall.</span><span class="sxs-lookup"><span data-stu-id="b328b-120">Add another boolean variable to track whether the preview should be mirrored, which is the case if a front-facing camera is used.</span></span> <span data-ttu-id="b328b-121">Fügen Sie außerdem eine Variable zum Speichern eines **DeviceInformation**-Objekts hinzu, das die ausgewählte Kamera darstellt.</span><span class="sxs-lookup"><span data-stu-id="b328b-121">Also, add a variable for storing a **DeviceInformation** object that represents the selected camera.</span></span>

[!code-cs[CameraDeviceLocationBools](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetCameraDeviceLocationBools)]
[!code-cs[DeclareCameraDevice](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetDeclareCameraDevice)]

## <a name="select-a-camera-device-and-initialize-the-mediacapture-object"></a><span data-ttu-id="b328b-122">Auswählen eines Kamerageräts und Initialisieren des MediaCapture-Objekts</span><span class="sxs-lookup"><span data-stu-id="b328b-122">Select a camera device and initialize the MediaCapture object</span></span>
<span data-ttu-id="b328b-123">Im Artikel [**Allgemeine Foto-, Video- und Audioaufnahme mit „MediaCapture“**](basic-photo-video-and-audio-capture-with-mediacapture.md) wird beschrieben, wie Sie das **MediaCapture**-Objekt mit nur wenigen Codezeilen initialisieren.</span><span class="sxs-lookup"><span data-stu-id="b328b-123">The article [**Basic photo, video, and audio capture with MediaCapture**](basic-photo-video-and-audio-capture-with-mediacapture.md) shows you how to initialize the **MediaCapture** object with just a couple of lines of code.</span></span> <span data-ttu-id="b328b-124">Um die Ausrichtung der Kamera zu unterstützen, fügen wir dem Initialisierungsprozess weitere Schritte hinzu.</span><span class="sxs-lookup"><span data-stu-id="b328b-124">To support camera orientation, we will add a few more steps to the initialization process.</span></span>

<span data-ttu-id="b328b-125">Rufen Sie zuerst [**DeviceInformation.FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Enumeration.DeviceInformation.FindAllAsync) auf, und übergeben Sie die Geräteauswahl [**DeviceClass.VideoCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Enumeration.DeviceClass), um eine Liste aller verfügbaren Videoaufzeichnungsgeräte abzurufen.</span><span class="sxs-lookup"><span data-stu-id="b328b-125">First, call [**DeviceInformation.FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Enumeration.DeviceInformation.FindAllAsync) passing in the device selector [**DeviceClass.VideoCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Enumeration.DeviceClass) to get a list of all available video capture devices.</span></span> <span data-ttu-id="b328b-126">Wählen Sie dann das erste Gerät in der Liste aus, für das die Bereichsposition der Kamera bekannt ist und das mit dem angegebenen Wert übereinstimmt, in diesem Beispiel eine nach vorne gerichtete Kamera.</span><span class="sxs-lookup"><span data-stu-id="b328b-126">Next, select the first device in the list where the panel location of the camera is known and where it matches the supplied value, which in this example is a front-facing camera.</span></span> <span data-ttu-id="b328b-127">Wird keine Kamera im gewünschten Bereich gefunden, wird die erste oder standardmäßig verfügbare Kamera verwendet.</span><span class="sxs-lookup"><span data-stu-id="b328b-127">If no camera is found on the desired panel, the first or default available camera is used.</span></span>

<span data-ttu-id="b328b-128">Wenn ein Kameragerät gefunden wird, wird ein neues [**MediaCaptureInitializationSettings**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings)-Objekt erstellt, und die [**VideoDeviceId**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.VideoDeviceId)-Eigenschaft wird auf das ausgewählte Gerät festgelegt.</span><span class="sxs-lookup"><span data-stu-id="b328b-128">If a camera device is found, a new [**MediaCaptureInitializationSettings**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings) object is created and the [**VideoDeviceId**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCaptureInitializationSettings.VideoDeviceId) property is set to the selected device.</span></span> <span data-ttu-id="b328b-129">Erstellen Sie als Nächstes das MediaCapture-Objekt, rufen Sie [**InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.InitializeAsync) auf, und übergeben Sie das Einstellungsobjekt, um dem System mitzuteilen, dass die ausgewählte Kamera verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="b328b-129">Next, create the MediaCapture object and call [**InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.InitializeAsync), passing in the settings object to tell the system to use the selected camera.</span></span>

<span data-ttu-id="b328b-130">Überprüfen Sie abschließend, ob der ausgewählte Gerätebereich null oder unbekannt ist.</span><span class="sxs-lookup"><span data-stu-id="b328b-130">Finally, check to see if the selected device panel is null or unknown.</span></span> <span data-ttu-id="b328b-131">In diesem Fall ist die Kamera extern. Dies bedeutet, dass ihre Drehung ohne Bezug auf die Drehung des Geräts ist.</span><span class="sxs-lookup"><span data-stu-id="b328b-131">If so, the camera is external, which means that its rotation is unrelated to the rotation of the device.</span></span> <span data-ttu-id="b328b-132">Wenn der Bereich bekannt ist und sich an der Vorderseite des Geräte-Chassis befindet, wissen wir, dass die Vorschau gespiegelt werden soll. Die Variable zur Nachverfolgung ist also festgelegt.</span><span class="sxs-lookup"><span data-stu-id="b328b-132">If the panel is known and is on the front of the device chassis, we know the preview should be mirrored, so the variable tracking this is set.</span></span>

[!code-cs[InitMediaCaptureWithOrientation](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetInitMediaCaptureWithOrientation)]
## <a name="initialize-the-camerarotationhelper-class"></a><span data-ttu-id="b328b-133">Initialisieren der CameraRotationHelper-Klasse</span><span class="sxs-lookup"><span data-stu-id="b328b-133">Initialize the CameraRotationHelper class</span></span>

<span data-ttu-id="b328b-134">Wir beginnen nun mit der Verwendung der **CameraRotationHelper**-Klasse.</span><span class="sxs-lookup"><span data-stu-id="b328b-134">Now we begin using the **CameraRotationHelper** class.</span></span> <span data-ttu-id="b328b-135">Deklarieren Sie eine Klassenmembervariable zum Speichern des Objekts.</span><span class="sxs-lookup"><span data-stu-id="b328b-135">Declare a class member variable to store the object.</span></span> <span data-ttu-id="b328b-136">Rufen Sie den Konstruktor auf, und übergeben Sie die Gehäuseposition der ausgewählten Kamera.</span><span class="sxs-lookup"><span data-stu-id="b328b-136">Call the constructor, passing in the enclosure location of the selected camera.</span></span> <span data-ttu-id="b328b-137">Die Hilfsklasse verwendet diese Informationen, um die richtige Ausrichtung für aufgenommene Medien, den Vorschaustream und die Benutzeroberfläche zu berechnen.</span><span class="sxs-lookup"><span data-stu-id="b328b-137">The helper class uses this information to calculate the correct orientation for captured media, the preview stream, and the UI.</span></span> <span data-ttu-id="b328b-138">Registrieren Sie einen Handler für das **OrientationChanged**-Ereignis der Hilfsklasse, das ausgelöst wird, wenn die Ausrichtung der Benutzeroberfläche oder des Vorschaustreams aktualisiert werden muss.</span><span class="sxs-lookup"><span data-stu-id="b328b-138">Register a handler for the helper class's **OrientationChanged** event, which will be raised when we need to update the orientation of the UI or the preview stream.</span></span>

[!code-cs[DeclareRotationHelper](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetDeclareRotationHelper)]

[!code-cs[InitRotationHelper](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetInitRotationHelper)]

## <a name="add-orientation-data-to-the-camera-preview-stream"></a><span data-ttu-id="b328b-139">Hinzufügen von Ausrichtungsdaten zum Kameravorschau-Stream</span><span class="sxs-lookup"><span data-stu-id="b328b-139">Add orientation data to the camera preview stream</span></span>
<span data-ttu-id="b328b-140">Das Hinzufügen der richtigen Ausrichtung zu den Metadaten des Vorschaustreams hat keinen Einfluss auf die Anzeige der Vorschau für Benutzer, erleichtert jedoch die richtige Codierung von aus dem Vorschaustream erfassten Frames durch das System.</span><span class="sxs-lookup"><span data-stu-id="b328b-140">Adding the correct orientation to the metadata of the preview stream does not affect how the preview appears to the user, but it helps the system encode any frames captured from the preview stream correctly.</span></span>

<span data-ttu-id="b328b-141">Starten Sie die Kameravorschau durch Aufrufen von [**MediaCapture.StartPreviewAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.StartPreviewAsync).</span><span class="sxs-lookup"><span data-stu-id="b328b-141">You start the camera preview by calling [**MediaCapture.StartPreviewAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.StartPreviewAsync).</span></span> <span data-ttu-id="b328b-142">Überprüfen Sie zuvor die Membervariable, um festzustellen, ob die Vorschau gespiegelt werden soll (für eine nach vorne gerichtete Kamera).</span><span class="sxs-lookup"><span data-stu-id="b328b-142">Before you do this, check the member variable to see if the preview should be mirrored (for a front-facing camera).</span></span> <span data-ttu-id="b328b-143">Wenn dies der Fall ist, legen Sie die [**FlowDirection**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.FrameworkElement.FlowDirection)-Eigenschaft von [**CaptureElement**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.CaptureElement), das in diesem Beispiel den Namen *PreviewControl* hat, auf [**FlowDirection.RightToLeft**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.FlowDirection) fest.</span><span class="sxs-lookup"><span data-stu-id="b328b-143">If so, set the [**FlowDirection**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.FrameworkElement.FlowDirection) property of the [**CaptureElement**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.CaptureElement), named *PreviewControl* in this example, to [**FlowDirection.RightToLeft**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.FlowDirection).</span></span> <span data-ttu-id="b328b-144">Rufen Sie nach dem Starten der Vorschau die Hilfsmethode **SetPreviewRotationAsync** auf, um die Drehung der Vorschau festzulegen.</span><span class="sxs-lookup"><span data-stu-id="b328b-144">After starting the preview, call the helper method **SetPreviewRotationAsync** to set the preview rotation.</span></span> <span data-ttu-id="b328b-145">Es folgt die Implementierung dieser Methode.</span><span class="sxs-lookup"><span data-stu-id="b328b-145">Following is the implementation of this method.</span></span>

[!code-cs[StartPreviewWithRotationAsync](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetStartPreviewWithRotationAsync)]

<span data-ttu-id="b328b-146">Wir legen die Vorschaudrehung in einer separaten Methode fest, sodass sie bei Änderung der Telefonausrichtung aktualisiert werden kann, ohne den Vorschaustream zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="b328b-146">We set the preview rotation in a separate method so that it can be updated when the phone orientation changes without reinitializing the preview stream.</span></span> <span data-ttu-id="b328b-147">Wenn es sich um eine externe Kamera handelt, wird keine Aktion ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="b328b-147">If the camera is external to the device, no action is taken.</span></span> <span data-ttu-id="b328b-148">Andernfalls wird die **CameraRotationHelper**-Methode **GetCameraPreviewOrientation** aufgerufen und gibt die richtige Ausrichtung für den Vorschaustream zurück.</span><span class="sxs-lookup"><span data-stu-id="b328b-148">Otherwise, the **CameraRotationHelper** method **GetCameraPreviewOrientation** is called and returns the proper orientation for the preview stream.</span></span> 

<span data-ttu-id="b328b-149">Zum Festlegen der Metadaten werden die Vorschaustreameigenschaften durch Aufrufen von [**VideoDeviceController.GetMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Devices.VideoDeviceController.GetMediaStreamProperties) abgerufen.</span><span class="sxs-lookup"><span data-stu-id="b328b-149">To set the metadata, the preview stream properties are retrieved by calling [**VideoDeviceController.GetMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Devices.VideoDeviceController.GetMediaStreamProperties).</span></span> <span data-ttu-id="b328b-150">Erstellen Sie als Nächstes die GUID, die das Media Foundation Transform (MFT)-Attribut für die Drehung des Videostreams darstellt.</span><span class="sxs-lookup"><span data-stu-id="b328b-150">Next, create the GUID representing the Media Foundation Transform (MFT) attribute for video stream rotation.</span></span> <span data-ttu-id="b328b-151">In C++ können Sie die Konstante [**MF_MT_VIDEO_ROTATION**](https://msdn.microsoft.com/library/windows/desktop/hh162880.aspx) verwenden, während Sie in C# den GUID-Wert manuell angeben müssen.</span><span class="sxs-lookup"><span data-stu-id="b328b-151">In C++ you can use the constant [**MF_MT_VIDEO_ROTATION**](https://msdn.microsoft.com/library/windows/desktop/hh162880.aspx), but in C# you must manually specify the GUID value.</span></span> 

<span data-ttu-id="b328b-152">Fügen Sie dem Datenstromeigenschaftenobjekt einen Eigenschaftswert hinzu, und geben Sie die GUID als Schlüssel und die Vorschaudrehung als Wert an.</span><span class="sxs-lookup"><span data-stu-id="b328b-152">Add a property value to the stream properties object, specifying the GUID as the key and the preview rotation as the value.</span></span> <span data-ttu-id="b328b-153">Diese Eigenschaft erwartet Werte in Einheiten von Grad entgegen dem Uhrzeigersinn, sodass mithilfe der **CameraRotationHelper**-Methode **ConvertSimpleOrientationToClockwiseDegrees** der einfache Ausrichtungswert konvertiert wird.</span><span class="sxs-lookup"><span data-stu-id="b328b-153">This property expects values to be in units of counterclockwise degrees, so the **CameraRotationHelper** method **ConvertSimpleOrientationToClockwiseDegrees** is used to convert the simple orientation value.</span></span> <span data-ttu-id="b328b-154">Rufen Sie abschließend [**SetEncodingPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.SetEncodingPropertiesAsync(Windows.Media.Capture.MediaStreamType,Windows.Media.MediaProperties.IMediaEncodingProperties,Windows.Media.MediaProperties.MediaPropertySet)) auf, um die neue Drehungseigenschaft auf den Stream anzuwenden.</span><span class="sxs-lookup"><span data-stu-id="b328b-154">Finally, call [**SetEncodingPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.SetEncodingPropertiesAsync(Windows.Media.Capture.MediaStreamType,Windows.Media.MediaProperties.IMediaEncodingProperties,Windows.Media.MediaProperties.MediaPropertySet)) to apply the new rotation property to the stream.</span></span>

[!code-cs[SetPreviewRotationAsync](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetSetPreviewRotationAsync)]

<span data-ttu-id="b328b-155">Fügen Sie als Nächstes den Handler für das **CameraRotationHelper.OrientationChanged**-Ereignis hinzu.</span><span class="sxs-lookup"><span data-stu-id="b328b-155">Next, add the handler for the **CameraRotationHelper.OrientationChanged** event.</span></span> <span data-ttu-id="b328b-156">Dieses Ereignis übergibt ein Argument, das Ihnen mitteilt, ob der Vorschaustream gedreht werden muss.</span><span class="sxs-lookup"><span data-stu-id="b328b-156">This event passes in an argument that lets you know whether the preview stream needs to be rotated.</span></span> <span data-ttu-id="b328b-157">Wenn die Ausrichtung des Geräts nach oben oder unten geändert wurde, ist dieser Wert „false“.</span><span class="sxs-lookup"><span data-stu-id="b328b-157">If the orientation of the device was changed to face up or face down, this value will be false.</span></span> <span data-ttu-id="b328b-158">Wenn die Vorschau gedreht werden muss, rufen Sie **SetPreviewRotationAsync** auf, die zuvor definiert wurde.</span><span class="sxs-lookup"><span data-stu-id="b328b-158">If the preview does need to be rotated, call **SetPreviewRotationAsync** which was defined previously.</span></span>

<span data-ttu-id="b328b-159">Aktualisieren Sie als Nächstes im **OrientationChanged**-Ereignishandler bei Bedarf die Benutzeroberfläche.</span><span class="sxs-lookup"><span data-stu-id="b328b-159">Next, in the **OrientationChanged** event handler, update your UI if needed.</span></span> <span data-ttu-id="b328b-160">Rufen Sie die aktuelle empfohlene UI-Ausrichtung durch Aufrufen von **GetUIOrientation** aus der Hilfsklasse ab, und konvertieren Sie den Wert in Grad im Uhrzeigersinn für XAML-Transformationen.</span><span class="sxs-lookup"><span data-stu-id="b328b-160">Get the current recommended UI orientation from the helper class by calling **GetUIOrientation** and convert the value to clockwise degrees, which is used for XAML transforms.</span></span> <span data-ttu-id="b328b-161">Erstellen Sie eine [**RotateTransform**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.RotateTransform) aus dem Ausrichtungswert, und legen Sie die [**RenderTransform**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.UIElement.RenderTransform)-Eigenschaft der XAML-Steuerelemente fest.</span><span class="sxs-lookup"><span data-stu-id="b328b-161">Create a [**RotateTransform**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.RotateTransform) from the orientation value and set the [**RenderTransform**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.UIElement.RenderTransform) property of your XAML controls.</span></span> <span data-ttu-id="b328b-162">Je nach dem UI-Layout müssen Sie möglicherweise zusätzliche Anpassungen zum einfachen Drehen der Steuerelemente vornehmen.</span><span class="sxs-lookup"><span data-stu-id="b328b-162">Depending on your UI layout, you may need to make additional adjustments here in addition to simply rotating the controls.</span></span> <span data-ttu-id="b328b-163">Beachten Sie außerdem, dass alle Aktualisierungen der Benutzeroberfläche im UI-Thread vorgenommen werden müssen. Daher sollten Sie diesen Code innerhalb eines Aufrufs von [**RunAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Core.CoreDispatcher.RunAsync(Windows.UI.Core.CoreDispatcherPriority,Windows.UI.Core.DispatchedHandler)) platzieren.</span><span class="sxs-lookup"><span data-stu-id="b328b-163">Also, remember that all updates to your UI must be made on the UI thread, so you should place this code inside a call to [**RunAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Core.CoreDispatcher.RunAsync(Windows.UI.Core.CoreDispatcherPriority,Windows.UI.Core.DispatchedHandler)).</span></span>  

[!code-cs[HelperOrientationChanged](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetHelperOrientationChanged)]

## <a name="capture-a-photo-with-orientation-data"></a><span data-ttu-id="b328b-164">Aufnehmen eines Fotos mit Ausrichtungsdaten</span><span class="sxs-lookup"><span data-stu-id="b328b-164">Capture a photo with orientation data</span></span>
<span data-ttu-id="b328b-165">Im Artikel [**Allgemeine Foto-, Video- und Audioaufnahme mit „MediaCapture“**](basic-photo-video-and-audio-capture-with-mediacapture.md) wird erläutert, wie Sie ein Foto in einer Datei aufnehmen, indem Sie zuerst in einen In-Memory-Datenstrom aufnehmen und dann mithilfe eines Decoders die Bilddaten aus dem Datenstrom lesen und mithilfe eines Encoders die Bilddaten in eine Datei transcodieren.</span><span class="sxs-lookup"><span data-stu-id="b328b-165">The article [**Basic photo, video, and audio capture with MediaCapture**](basic-photo-video-and-audio-capture-with-mediacapture.md) shows you how to capture a photo to a file by capturing first to an in-memory stream and then using a decoder to read the image data from the stream and an encoder to transcode the image data to a file.</span></span> <span data-ttu-id="b328b-166">Aus der **CameraRotationHelper**-Klasse abgerufene Ausrichtungsdaten können während des Transcodierungsvorgangs der Bilddatei hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="b328b-166">Orientation data, obtained from the **CameraRotationHelper** class, can be added to the image file during the transcoding operation.</span></span>

<span data-ttu-id="b328b-167">Im folgenden Beispiel wird ein Foto in einem [**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.Streams.InMemoryRandomAccessStream) mit einem Aufruf von [**CapturePhotoToStreamAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.CapturePhotoToStreamAsync) aufgenommen, und ein [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapDecoder) wird aus dem Stream erstellt.</span><span class="sxs-lookup"><span data-stu-id="b328b-167">In the following example, a photo is captured to an [**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.Streams.InMemoryRandomAccessStream) with a call to [**CapturePhotoToStreamAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.CapturePhotoToStreamAsync) and a [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapDecoder) is created from the stream.</span></span> <span data-ttu-id="b328b-168">Als Nächstes wird eine [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageFile) erstellt und geöffnet, um einen [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.Streams.IRandomAccessStream) zum Schreiben in die Datei abzurufen.</span><span class="sxs-lookup"><span data-stu-id="b328b-168">Next a [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageFile) is created and opened to retreive an [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.Streams.IRandomAccessStream) for writing to the file.</span></span> 

<span data-ttu-id="b328b-169">Vor dem Transcodieren der Datei wird die Ausrichtung des Fotos aus der Hilfsklassenmethode **GetCameraCaptureOrientation** abgerufen.</span><span class="sxs-lookup"><span data-stu-id="b328b-169">Before transcoding the file, the photo's orientation is retrieved from the helper class method **GetCameraCaptureOrientation**.</span></span> <span data-ttu-id="b328b-170">Diese Methode gibt ein [**SimpleOrientation**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Sensors.SimpleOrientation)-Objekt zurück, das mit der Hilfsmethode **ConvertSimpleOrientationToPhotoOrientation** in ein [**PhotoOrientation**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.FileProperties.PhotoOrientation)-Objekt konvertiert wird.</span><span class="sxs-lookup"><span data-stu-id="b328b-170">This method returns a [**SimpleOrientation**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Sensors.SimpleOrientation) object which is converted to a [**PhotoOrientation**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.FileProperties.PhotoOrientation) object with the helper method **ConvertSimpleOrientationToPhotoOrientation**.</span></span> <span data-ttu-id="b328b-171">Als Nächstes wird ein neues **BitmapPropertySet**-Objekt erstellt und eine Eigenschaft hinzugefügt, wobei der Schlüssel „System.Photo.Orientation“ und der Wert die Fotoausrichtung ist, ausgedrückt als **BitmapTypedValue**.</span><span class="sxs-lookup"><span data-stu-id="b328b-171">Next, a new **BitmapPropertySet** object is created and a property is added where the key is "System.Photo.Orientation" and the value is the photo orientation, expressed as a **BitmapTypedValue**.</span></span> <span data-ttu-id="b328b-172">„System.Photo.Orientation“ ist eine der vielen Windows-Eigenschaften, die als Metadaten einer Bilddatei hinzugefügt werden können.</span><span class="sxs-lookup"><span data-stu-id="b328b-172">"System.Photo.Orientation" is one of many Windows properties that can be added as metadata to an image file.</span></span> <span data-ttu-id="b328b-173">Eine Liste aller fotobezogenen Eigenschaften finden Sie unter [**Windows-Eigenschaften – Foto**](https://msdn.microsoft.com/library/windows/desktop/ff516600).</span><span class="sxs-lookup"><span data-stu-id="b328b-173">For a list of all of the photo-related properties, see [**Windows Properties - Photo**](https://msdn.microsoft.com/library/windows/desktop/ff516600).</span></span> <span data-ttu-id="b328b-174">Weitere Informationen zum Arbeiten mit Metadaten in Bildern finden Sie unter [**Bildmetadaten**](image-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="b328b-174">For more information about workine with metadata in images, see [**Image metadata**](image-metadata.md).</span></span>

<span data-ttu-id="b328b-175">Schließlich wird der Eigenschaftensatz, der die Ausrichtungsdaten enthält, für den Encoder mit einem Aufruf von [**SetPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/) festgelegt, und das Bild wird mit einem Aufruf von [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapEncoder.FlushAsync) transcodiert.</span><span class="sxs-lookup"><span data-stu-id="b328b-175">Finally, the property set which includes the orientation data is set for the encoder by with a call to [**SetPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/) and the image is transcoded with a call to [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapEncoder.FlushAsync).</span></span>

[!code-cs[CapturePhotoWithOrientation](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetCapturePhotoWithOrientation)]

## <a name="capture-a-video-with-orientation-data"></a><span data-ttu-id="b328b-176">Aufnehmen eines Videos mit Ausrichtungsdaten</span><span class="sxs-lookup"><span data-stu-id="b328b-176">Capture a video with orientation data</span></span>
<span data-ttu-id="b328b-177">Die allgemeine Videoaufnahme wird im Artikel [**Allgemeine Foto-, Video- und Audioaufnahme mit „MediaCapture“**](basic-photo-video-and-audio-capture-with-mediacapture.md) beschrieben.</span><span class="sxs-lookup"><span data-stu-id="b328b-177">Basic video capture is described in the article [**Basic photo, video, and audio capture with MediaCapture**](basic-photo-video-and-audio-capture-with-mediacapture.md).</span></span> <span data-ttu-id="b328b-178">Das Hinzufügen von Ausrichtungsdaten zur Codierung des aufgenommenen Videos erfolgt mit dem gleichen Verfahrens wie weiter oben im Abschnitt zum Hinzufügen von Ausrichtungsdaten zum Vorschaustream beschrieben.</span><span class="sxs-lookup"><span data-stu-id="b328b-178">Adding orientation data to the encoding of the captured video is done using the same technique as described earlier in the section about adding orientation data to the preview stream.</span></span>

<span data-ttu-id="b328b-179">Im folgenden Beispiel wird eine Datei erstellt, in die das aufgenommene Video geschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="b328b-179">In the following example, a file is created to which the captured video will be written.</span></span> <span data-ttu-id="b328b-180">Ein MP4-Codierungsprofil wird mithilfe der statischen [**CreateMp4**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile.CreateMp4)-Methode erstellt.</span><span class="sxs-lookup"><span data-stu-id="b328b-180">An MP4 encoding profile is create using the static method [**CreateMp4**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile.CreateMp4).</span></span> <span data-ttu-id="b328b-181">Die richtige Ausrichtung für das Video wird aus der **CameraRotationHelper**-Klasse mit einem Aufruf von **GetCameraCaptureOrientation** abgerufen. Da die Drehungseigenschaft erfordert, dass die Ausrichtung in Grad gegen den Uhrzeigersinn ausgedrückt wird, wird die **ConvertSimpleOrientationToClockwiseDegrees**-Hilfsmethode zum Konvertieren des Ausrichtungswerts aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="b328b-181">The proper orientation for the video is obtained from the **CameraRotationHelper** class with a call to **GetCameraCaptureOrientation** Because the rotation property requires the orientation to be expressed in counterclockwise degrees, the **ConvertSimpleOrientationToClockwiseDegrees** helper method is called to convert the orientation value.</span></span> <span data-ttu-id="b328b-182">Erstellen Sie als Nächstes die GUID, die das Media Foundation Transform (MFT)-Attribut für die Drehung des Videostreams darstellt.</span><span class="sxs-lookup"><span data-stu-id="b328b-182">Next, create the GUID representing the Media Foundation Transform (MFT) attribute for video stream rotation.</span></span> <span data-ttu-id="b328b-183">In C++ können Sie die Konstante [**MF_MT_VIDEO_ROTATION**](https://msdn.microsoft.com/library/windows/desktop/hh162880.aspx) verwenden, während Sie in C# den GUID-Wert manuell angeben müssen.</span><span class="sxs-lookup"><span data-stu-id="b328b-183">In C++ you can use the constant [**MF_MT_VIDEO_ROTATION**](https://msdn.microsoft.com/library/windows/desktop/hh162880.aspx), but in C# you must manually specify the GUID value.</span></span> <span data-ttu-id="b328b-184">Fügen Sie dem Datenstromeigenschaftenobjekt einen Eigenschaftswert hinzu, und geben Sie die GUID als Schlüssel und die Drehung als Wert an.</span><span class="sxs-lookup"><span data-stu-id="b328b-184">Add a property value to the stream properties object, specifying the GUID as the key and the rotation as the value.</span></span> <span data-ttu-id="b328b-185">Rufen Sie schließlich [**StartRecordToStorageFileAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.StartRecordToStorageFileAsync(Windows.Media.MediaProperties.MediaEncodingProfile,Windows.Storage.IStorageFile)) auf, um die mit Ausrichtungsdaten codierte Videoaufnahme zu beginnen.</span><span class="sxs-lookup"><span data-stu-id="b328b-185">Finally call [**StartRecordToStorageFileAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.StartRecordToStorageFileAsync(Windows.Media.MediaProperties.MediaEncodingProfile,Windows.Storage.IStorageFile)) to begin recording video encoded with orientation data.</span></span>

[!code-cs[StartRecordingWithOrientationAsync](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetStartRecordingWithOrientationAsync)]

## <a name="camerarotationhelper-full-code-listing"></a><span data-ttu-id="b328b-186">Vollständiger Code für CameraRotationHelper</span><span class="sxs-lookup"><span data-stu-id="b328b-186">CameraRotationHelper full code listing</span></span>
<span data-ttu-id="b328b-187">Der folgende Codeausschnitt führt den vollständigen Code für die **CameraRotationHelper**-Klasse auf, mit der die Hardwareausrichtungssensoren verwaltet, die richtigen Ausrichtungswerte für Fotos und Videos berechnet und Hilfsmethoden zum Konvertieren zwischen den unterschiedlichen Darstellungsformen der Ausrichtung bereitgestellt werden, die von verschiedenen Windows-Features verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="b328b-187">The following code snippet lists the full code for the **CameraRotationHelper** class that manages the hardware orientation sensors, calculates the proper orientation values for photos and videos, and provides helper methods to convert between the different representations of orientation that are used by different Windows features.</span></span> <span data-ttu-id="b328b-188">Wenn Sie die im oben genannten Artikel gezeigten Anleitungen befolgen, können Sie diese Klasse dem Projekt in der vorliegenden Form hinzufügen, ohne Änderungen vornehmen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="b328b-188">If you follow the guidance shown in the article above, you can add this class to your project as-is without having to make any changes.</span></span> <span data-ttu-id="b328b-189">Natürlich können Sie den folgenden Code an die Anforderungen des jeweiligen Szenarios anpassen.</span><span class="sxs-lookup"><span data-stu-id="b328b-189">Of course, you can feel free to customize the following code to meet the needs of your particular scenario.</span></span>

<span data-ttu-id="b328b-190">Diese Hilfsklasse verwendet den [**SimpleOrientationSensor**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Sensors.SimpleOrientationSensor) des Geräts zum Ermitteln der aktuellen Ausrichtung des Geräte-Chassis und die [**DisplayInformation**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Display.DisplayInformation)-Klasse zum Ermitteln der aktuellen Ausrichtung der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="b328b-190">This helper class uses the device's [**SimpleOrientationSensor**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Sensors.SimpleOrientationSensor) to determine the current orientation of the device chassis and the [**DisplayInformation**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Display.DisplayInformation) class to determine the current orientation of the display.</span></span> <span data-ttu-id="b328b-191">Alle diese Klassen bieten Ereignisse, die ausgelöst werden, wenn sich die aktuelle Ausrichtung ändert.</span><span class="sxs-lookup"><span data-stu-id="b328b-191">Each of these classes provide events that are raised when the current orientation changes.</span></span> <span data-ttu-id="b328b-192">Die Seite, auf der sich das Aufnahmegerät befindet – nach vorne gerichtet, nach hinten gerichtet oder extern –, wird verwendet, um festzustellen, ob der Vorschaustream gespiegelt werden soll.</span><span class="sxs-lookup"><span data-stu-id="b328b-192">The panel on which the capture device is mounted - front-facing, back-facing, or external - is used to determine whether the preview stream should be mirrored.</span></span> <span data-ttu-id="b328b-193">Darüber hinaus wird mithilfe der von einigen Geräten unterstützten [**EnclosureLocation.RotationAngleInDegreesClockwise**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Enumeration.EnclosureLocation.RotationAngleInDegreesClockwise)-Eigenschaft die Ausrichtung ermittelt, mit der die Kamera auf dem Chassis montiert wird.</span><span class="sxs-lookup"><span data-stu-id="b328b-193">Also, the [**EnclosureLocation.RotationAngleInDegreesClockwise**](https://msdn.microsoft.com/library/windows/apps/Windows.Devices.Enumeration.EnclosureLocation.RotationAngleInDegreesClockwise) property, supported by some devices, is used to determine the orientation in which the camera is mounted on the chasses.</span></span>

<span data-ttu-id="b328b-194">Mit den folgenden Methoden können empfohlene Ausrichtungswerte für die angegebenen Kamera-App-Aufgaben abgerufen werden:</span><span class="sxs-lookup"><span data-stu-id="b328b-194">The following methods can be used to get recommended orientation values for the specified camera app tasks:</span></span>

* <span data-ttu-id="b328b-195">**GetUIOrientation** – Gibt die vorgeschlagene Ausrichtung für Kamera-UI-Elemente zurück.</span><span class="sxs-lookup"><span data-stu-id="b328b-195">**GetUIOrientation** - Returns the suggested orientation for camera UI elements.</span></span>
* <span data-ttu-id="b328b-196">**GetCameraCaptureOrientation** – Gibt die vorgeschlagene Ausrichtung für die Codierung in Bildmetadaten zurück.</span><span class="sxs-lookup"><span data-stu-id="b328b-196">**GetCameraCaptureOrientation** - Returns the suggested orientation for encoding into image metadata.</span></span>
* <span data-ttu-id="b328b-197">**GetCameraPreviewOrientation** – Gibt die vorgeschlagene Ausrichtung für den Vorschaustream zum Bereitstellen einer natürlicheren Benutzererfahrung zurück.</span><span class="sxs-lookup"><span data-stu-id="b328b-197">**GetCameraPreviewOrientation** - Returns the suggested orientation for the preview stream to provide a natural user experience.</span></span>

[!code-cs[CameraRotationHelperFull](./code/SimpleCameraPreview_Win10/cs/CameraRotationHelper.cs#SnippetCameraRotationHelperFull)]



## <a name="related-topics"></a><span data-ttu-id="b328b-198">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="b328b-198">Related topics</span></span>

* [<span data-ttu-id="b328b-199">Kamera</span><span class="sxs-lookup"><span data-stu-id="b328b-199">Camera</span></span>](camera.md)
* [<span data-ttu-id="b328b-200">Allgemeine Foto-, Video- und Audioaufnahme mit „MediaCapture“</span><span class="sxs-lookup"><span data-stu-id="b328b-200">Basic photo, video, and audio capture with MediaCapture</span></span>](basic-photo-video-and-audio-capture-with-MediaCapture.md)
 

 




