---
ms.assetid: F28162D4-AACC-4EE0-B243-5878F870F87F
description: Behandlung vom System unterstützter Metadaten-Marker während der Medienwiedergabe
title: Vom System unterstützte, zeitbasierte Metadaten-Marker
ms.date: 04/18/2017
ms.topic: article
keywords: Windows10, Uwp, Metadaten, Marker, Spracherkennung, Kapitel
ms.localizationpriority: medium
ms.openlocfilehash: 2f461bb70c1319352c66b8d12775dc7fa1db0edf
ms.sourcegitcommit: 8921a9cc0dd3e5665345ae8eca7ab7aeb83ccc6f
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/11/2018
ms.locfileid: "8887315"
---
# <a name="system-supported-timed-metadata-cues"></a><span data-ttu-id="92d2b-104">Vom System unterstützte, zeitbasierte Metadaten-Marker</span><span class="sxs-lookup"><span data-stu-id="92d2b-104">System-supported timed metadata cues</span></span>
<span data-ttu-id="92d2b-105">Dieser Artikel beschreibt, wie verschiedene Formate zeitbasierter Metadaten genutzt werden, die in Mediendateien oder -streams eingebettet sein können.</span><span class="sxs-lookup"><span data-stu-id="92d2b-105">This article describes how to take advantage of several formats of timed metadata that may be embedded in media files or streams.</span></span> <span data-ttu-id="92d2b-106">UWP-Apps können Ereignisse registrieren, die von der Medienpipeline während der Wiedergabe ausgelöst werden, wenn diese Metadaten-Marker erkannt werden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-106">UWP apps can register for events that are raised by the media pipeline during playback whenever these metadata cues are encountered.</span></span> <span data-ttu-id="92d2b-107">Mithilfe der [**DataCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.DataCue)-Klasse können Apps eigene, benutzerdefinierte Metadaten-Marker implementieren; dieser Artikel behandelt mehrere Metadatenstandards, die von der Medienpipeline automatisch erkannt werden, z. B.:</span><span class="sxs-lookup"><span data-stu-id="92d2b-107">Using the [**DataCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.DataCue) class, apps can implement their own custom metadata cues, but this article focuses on several metadata standards that are automatically detected by the media pipeline, including:</span></span>

* <span data-ttu-id="92d2b-108">Bildbasierte Untertitel im VobSub-Format</span><span class="sxs-lookup"><span data-stu-id="92d2b-108">Image-based subtitles in VobSub format</span></span>
* <span data-ttu-id="92d2b-109">Spracherkennungs-Marker wie Wort-, Satzgrenzen und Lesezeichen der Speech Synthesis Markup Language (SSML)</span><span class="sxs-lookup"><span data-stu-id="92d2b-109">Speech cues, including word boundaries, sentence boundaries, and Speech Synthesis Markup Language (SSML) bookmarks</span></span>
* <span data-ttu-id="92d2b-110">Kapitelmarker</span><span class="sxs-lookup"><span data-stu-id="92d2b-110">Chapter cues</span></span>
* <span data-ttu-id="92d2b-111">Erweiterte M3U-Kommentare</span><span class="sxs-lookup"><span data-stu-id="92d2b-111">Extended M3U comments</span></span>
* <span data-ttu-id="92d2b-112">ID3-Tags</span><span class="sxs-lookup"><span data-stu-id="92d2b-112">ID3 tags</span></span>
* <span data-ttu-id="92d2b-113">Fragmentierte MP4-Emsg-Felder</span><span class="sxs-lookup"><span data-stu-id="92d2b-113">Fragmented mp4 emsg boxes</span></span>


<span data-ttu-id="92d2b-114">Dieser Artikel setzt die Konzepte des Artikels [Media-Elemente, Wiedergabelisten und Titel](media-playback-with-mediasource.md) fort, liefert Grundlagen für die Arbeit mit den Klassen [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource), [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) und [**TimedMetadataTrack**](https://msdn.microsoft.com/library/windows/apps/dn956580) sowie allgemeine Richtlinien für die Verwendung zeitgesteuerter Metadaten in Ihrer App.</span><span class="sxs-lookup"><span data-stu-id="92d2b-114">This article builds on the concepts discussed  in the article [Media items, playlists, and tracks](media-playback-with-mediasource.md), which includes the basics of working with the [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource), [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem), and [**TimedMetadataTrack**](https://msdn.microsoft.com/library/windows/apps/dn956580) classes and general guidance for using timed metadata in your app.</span></span>

<span data-ttu-id="92d2b-115">Die grundlegenden Implementierungsschritte sind für alle in diesem Artikel beschriebenen zeitgesteuerten Metadatentypen gleich:</span><span class="sxs-lookup"><span data-stu-id="92d2b-115">The basic implementation steps are the same for all of the different types of timed metadata described in this article:</span></span>

1. <span data-ttu-id="92d2b-116">Erstellen Sie für den Inhalt, der wiedergegeben werden soll, eine [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) und dann ein [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem).</span><span class="sxs-lookup"><span data-stu-id="92d2b-116">Create a [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) and then a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) for the content to be played.</span></span>
2. <span data-ttu-id="92d2b-117">Registrieren Sie das [**MediaPlaybackItem.TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged)-Ereignis, das eintritt, wenn untergeordnete Spuren des Medienelements durch die Medienpipeline aufgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-117">Register for the [**MediaPlaybackItem.TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged) event, which occurs as the sub-tracks of the media item are resolved by the media pipeline.</span></span>
3. <span data-ttu-id="92d2b-118">Wenn Sie zeitgesteuerte Metadatenspuren verwenden möchten, registrieren Sie dafür die Ereignisse [**TimedMetadataTrack.CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) und [**TimedMetadataTrack.CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited).</span><span class="sxs-lookup"><span data-stu-id="92d2b-118">Register for the [**TimedMetadataTrack.CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) and [**TimedMetadataTrack.CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) events for the timed metadata tracks you want to use.</span></span>
4. <span data-ttu-id="92d2b-119">Aktualisieren Sie im **CueEntered**-Ereignishandler die Benutzeroberfläche anhand der Metadaten, die in den Ereignisargumenten übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-119">In the **CueEntered** event handler, update your UI based on the metadata passed in the event args.</span></span> <span data-ttu-id="92d2b-120">Sie können die UI erneut im **CueExited**-Ereignis aktualisieren, z.B. um aktuelle Untertiteltexte zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-120">You can update the UI again, to remove the current subtitle text for example, in the **CueExited** event.</span></span>

<span data-ttu-id="92d2b-121">Dieser Artikel zeigt die Behandlung jedes Metadatentyps als eindeutiges Szenario; Sie können jedoch mithilfe von gemeinsam genutztem Code verschiedene Metadatentypen behandeln (oder ignorieren).</span><span class="sxs-lookup"><span data-stu-id="92d2b-121">In this article, handling each type of metadata is shown as a distinct scenario, but it's possible to handle (or ignore) different types of metadata using mostly shared code.</span></span> <span data-ttu-id="92d2b-122">Die [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind)-Eigenschaft des [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Objekts kann während des Vorgangs an mehreren Punkten geprüft werden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-122">You can check the [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) property of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) object at multiple points in the process.</span></span> <span data-ttu-id="92d2b-123">So können Sie z. B. das **CueEntered**-Ereignis für Metadatenspuren mit dem Wert **TimedMetadataKind.ImageSubtitle** registrieren, jedoch nicht für Spuren mit dem Wert **TimedMetadataKind.Speech**.</span><span class="sxs-lookup"><span data-stu-id="92d2b-123">So, for example, you could choose to register for the **CueEntered** event for metadata tracks that have the value **TimedMetadataKind.ImageSubtitle**, but not for tracks that have the value **TimedMetadataKind.Speech**.</span></span> <span data-ttu-id="92d2b-124">Oder Sie können für alle Metadatenspurtypen einen Handler registrieren, um anhand des **TimedMetadataKind**-Werts im **CueEntered**-Ereignishandler festzustellen, wie auf den Marker reagiert werden soll.</span><span class="sxs-lookup"><span data-stu-id="92d2b-124">Or instead, you could register a handler for all metadata track types and then check the **TimedMetadataKind** value inside the **CueEntered** handler to determine what action to take in response to the cue.</span></span>

## <a name="image-based-subtitles"></a><span data-ttu-id="92d2b-125">Bildbasierte Untertitel</span><span class="sxs-lookup"><span data-stu-id="92d2b-125">Image-based subtitles</span></span>
<span data-ttu-id="92d2b-126">Ab Windows10 Version 1703 können UWP-Apps externe bildbasierte Untertitel im VobSub-Format unterstützen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-126">Starting with Windows 10, version 1703, UWP apps can support external image-based subtitles in VobSub format.</span></span> <span data-ttu-id="92d2b-127">Um dieses Feature zu nutzen, erstellen Sie ein [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource)-Objekt für den Medieninhalt, der bildbasierte Untertitel enthält.</span><span class="sxs-lookup"><span data-stu-id="92d2b-127">To use this feature, first create a [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) object for the media content for which image subtitles will be displayed.</span></span> <span data-ttu-id="92d2b-128">Dann erstellen Sie ein [**TimedTextSource**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource)-Objekt, indem Sie mit dem Aufruf von [**CreateFromUriWithIndex**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.CreateFromUriWithIndex) oder [**CreateFromStreamWithIndex**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.CreateFromStreamWithIndex) den URI für die .sub- und .idx-Dateien übergeben, welche die Untertitel-Bild- und Zeitdaten enthalten.</span><span class="sxs-lookup"><span data-stu-id="92d2b-128">Next, create a [**TimedTextSource**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource) object by calling [**CreateFromUriWithIndex**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.CreateFromUriWithIndex) or [**CreateFromStreamWithIndex**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.CreateFromStreamWithIndex), passing in the Uri of the .sub file containing the subtitle image data and the .idx file containing the timing information for the subtitles.</span></span> <span data-ttu-id="92d2b-129">Fügen Sie die **TimedTextSource** Ihrer **MediaSource** und der [**ExternalTimedTextSources**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.ExternalTimedTextSources)-Sammlung Ihrer Quelle hinzu.</span><span class="sxs-lookup"><span data-stu-id="92d2b-129">Add the **TimedTextSource** to the **MediaSource** by adding it to the source's [**ExternalTimedTextSources**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.ExternalTimedTextSources) collection.</span></span> <span data-ttu-id="92d2b-130">Erstellen Sie ein [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) aus der **MediaSource**.</span><span class="sxs-lookup"><span data-stu-id="92d2b-130">Create a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) from the **MediaSource**.</span></span>

[!code-cs[ImageSubtitleLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleLoadContent)]

<span data-ttu-id="92d2b-131">Registrieren Sie mithilfe des im vorherigen Schritterstellten **MediaPlaybackItem**-Objekts die Metadaten-Ereignisse für die bildbasierten Untertitel.</span><span class="sxs-lookup"><span data-stu-id="92d2b-131">Register for the image subtitle metadata events using the **MediaPlaybackItem** object created in the previous step.</span></span> <span data-ttu-id="92d2b-132">Dieses Beispiel verwendet die Hilfsmethode **RegisterMetadataHandlerForImageSubtitles**, um die Ereignisse zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-132">This example uses a helper method, **RegisterMetadataHandlerForImageSubtitles**, to register for the events.</span></span> <span data-ttu-id="92d2b-133">Mithilfe eines Lambda-Ausdrucks implementieren wir einen Handler für das [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged)-Ereignis, das auftritt, wenn das System die Änderung einer dem **MediaPlaybackItem** zugeordneten Metadatenspuren bemerkt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-133">A lambda expression is used to implement a handler for the [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged) event, which occurs when the system detects a change in the metadata tracks associated with a **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-134">Falls Metadatenspuren schon verfügbar sind, weil das Wiedergabeelement zu Beginn aufgelöst wurde, durchsuchen Sie außer dem **TimedMetadataTracksChanged**-Ereignishandler alle verfügbaren Metadatenspuren und rufen **RegisterMetadataHandlerForImageSubtitles** auf.</span><span class="sxs-lookup"><span data-stu-id="92d2b-134">In some cases, the metadata tracks may be available when the playback item is initially resolved, so outside of the **TimedMetadataTracksChanged** handler, we also loop through the available metadata tracks and call **RegisterMetadataHandlerForImageSubtitles**.</span></span>

[!code-cs[ImageSubtitleTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleTracksChanged)]

<span data-ttu-id="92d2b-135">Nach der Registrierung der Metadaten-Ereignisse für bildbasierte Untertitel wird das **MediaItem** für die Wiedergabe einem [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) als [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement) zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-135">After registering for the image subtitle metadata events, the **MediaItem** is assigned to a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) for playback within a [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).</span></span>

[!code-cs[ImageSubtitlePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitlePlay)]

<span data-ttu-id="92d2b-136">Rufen Sie in der **RegisterMetadataHandlerForImageSubtitles**-Hilfsmethode eine Instanz der [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Klasse ab, indem Sie es in der **TimedMetadataTracks**-Sammlung des **MediaPlaybackItem** indizieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-136">In the **RegisterMetadataHandlerForImageSubtitles** helper method, get an instance of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) class by indexing into the **TimedMetadataTracks** collection of the **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-137">Registrieren Sie die Ereignisse [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) und [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited).</span><span class="sxs-lookup"><span data-stu-id="92d2b-137">Register for the [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) event and the [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) event.</span></span> <span data-ttu-id="92d2b-138">Anschließend müssen Sie [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) in der **TimedMetadataTracks**-Sammlung des Wiedergabeelements aufrufen, um das System anzuweisen, für dieses Wiedergabeelement Metadaten-Marker-Ereignisse an die App zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-138">Then, you must call [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) on the playback item's **TimedMetadataTracks** collection, to instruct the system that the app wants to receive metadata cue events for this playback item.</span></span>

[!code-cs[RegisterMetadataHandlerForImageSubtitles](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForImageSubtitles)]

<span data-ttu-id="92d2b-139">Prüfen Sie im Handler für das **CueEntered**-Ereignis die [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind)-Eigenschaft des im Ereignishandler übergebenen [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Objekts, um festzustellen, ob die Metadaten bildbasierte Untertitel betreffen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-139">In the handler for the **CueEntered** event, you can check the [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) propery of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) object passed into the handler to see if the metadata is for image subtitles.</span></span> <span data-ttu-id="92d2b-140">Dies ist notwendig, wenn Sie für mehrere Metadatentypen den gleichen Datenmarker-Ereignishandler verwenden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-140">This is necessary if you are using the same data cue event handler for multiple types of metadata.</span></span> <span data-ttu-id="92d2b-141">Falls die zugeordnete Metadatenspur vom Typ **TimedMetadataKind.ImageSubtitle** ist, übertragen Sie den in der **Cue**-Eigenschaft enthaltenen Datenmarker der [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) auf einen [**ImageCue**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue).</span><span class="sxs-lookup"><span data-stu-id="92d2b-141">If the associated metadata track is of type **TimedMetadataKind.ImageSubtitle**, cast the data cue contained in the **Cue** property of the [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) to an [**ImageCue**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue).</span></span> <span data-ttu-id="92d2b-142">Die [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.SoftwareBitmap)-Eigenschaft der **ImageCue** enthält eine [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap)-Darstellung des Untertitel-Bildes.</span><span class="sxs-lookup"><span data-stu-id="92d2b-142">The [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.SoftwareBitmap) property of the **ImageCue** contains a [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap) representation of the subtitle image.</span></span> <span data-ttu-id="92d2b-143">Erstellen Sie eine [**SoftwareBitmapSource**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource) und rufen Sie [**SetBitmapAsync**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource.SetBitmapAsync) auf, um das Bild einem XAML-[**Image**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.image)-Steuerelement zuzuweisen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-143">Create a [**SoftwareBitmapSource**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource) and call [**SetBitmapAsync**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource.SetBitmapAsync) to assign the image to a XAML [**Image**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.image) control.</span></span> <span data-ttu-id="92d2b-144">Die Eigenschaften [**Extent**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.Extent) und [**Position**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.Position) der **ImageCue** liefern Informationen über die Größe und Position des Untertitel-Bildes.</span><span class="sxs-lookup"><span data-stu-id="92d2b-144">The [**Extent**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.Extent) and [**Position**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.Position) properties of the **ImageCue** provide information about the size and position of the subtitle image.</span></span>

[!code-cs[ImageSubtitleCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleCueEntered)]

## <a name="speech-cues"></a><span data-ttu-id="92d2b-145">Spracherkennungs-Marker</span><span class="sxs-lookup"><span data-stu-id="92d2b-145">Speech cues</span></span>
<span data-ttu-id="92d2b-146">Ab Windows10 Version 1703 können UWP-Apps Handler für empfangene Wort- und Satzgrenzen sowie für Lesezeichen der Speech Synthesis Markup Language (SSML) in wiedergegebenen Medien registrieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-146">Starting with Windows 10, version 1703, UWP apps can register to receive events in response to word boundaries, sentence boundaries, and Speech Synthesis Markup Language (SSML) bookmarks in played media.</span></span> <span data-ttu-id="92d2b-147">Durch diese Ereignisse können Sie Audiodatenstroms wiedergeben, die mit der [**SpeechSynthesizer**](https://docs.microsoft.com/uwp/api/Windows.Media.SpeechSynthesis.SpeechSynthesizer)-Klasse generiert wurden, und Ihre Benutzeroberfläche aktualisieren, um z.B. aktuell wiedergegebenen Text anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-147">This allows you to play audio streams generated with the [**SpeechSynthesizer**](https://docs.microsoft.com/uwp/api/Windows.Media.SpeechSynthesis.SpeechSynthesizer) class and update your UI based on these events, such as displaying the text of the currently playing word or sentence.</span></span>

<span data-ttu-id="92d2b-148">Das Beispiel in diesem Abschnittverwendet eine Klassenmembervariable, um eine Zeichenfolge zu speichern, die synthetisiert und wiedergegeben wird.</span><span class="sxs-lookup"><span data-stu-id="92d2b-148">The example shown in this section uses a class member variable to store a text string that will be synthesized and played back.</span></span>

[!code-cs[SpeechInputText](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechInputText)]

<span data-ttu-id="92d2b-149">Erstellen Sie eine neue Instanz der **SpeechSynthesizer**-Klasse.</span><span class="sxs-lookup"><span data-stu-id="92d2b-149">Create a new instance of the **SpeechSynthesizer** class.</span></span> <span data-ttu-id="92d2b-150">Legen Sie die Optionen [**IncludeWordBoundaryMetadata**](https://docs.microsoft.com/uwp/api/windows.media.speechsynthesis.speechsynthesizeroptions.IncludeWordBoundaryMetadata) und [**IncludeSentenceBoundaryMetadata**](https://docs.microsoft.com/uwp/api/windows.media.speechsynthesis.speechsynthesizeroptions.IncludeSentenceBoundaryMetadata) für den Synthesizer auf **true** fest, um die Metadaten in den generierten Datenstrom einzubinden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-150">Set the [**IncludeWordBoundaryMetadata**](https://docs.microsoft.com/uwp/api/windows.media.speechsynthesis.speechsynthesizeroptions.IncludeWordBoundaryMetadata) and [**IncludeSentenceBoundaryMetadata**](https://docs.microsoft.com/uwp/api/windows.media.speechsynthesis.speechsynthesizeroptions.IncludeSentenceBoundaryMetadata) options for the synthesizer to **true** to specify that the metadata should be included in the generated media stream.</span></span> <span data-ttu-id="92d2b-151">Durch den Aufruf [**SynthesizeTextToStreamAsync**](https://docs.microsoft.com/uwp/api/Windows.Media.SpeechSynthesis.SpeechSynthesizer.SynthesizeTextToStreamAsync) erzeugen Sie einen Datenstrom, der die synthetisierte Spracherkennung und zugehörige Metadaten enthält.</span><span class="sxs-lookup"><span data-stu-id="92d2b-151">Call [**SynthesizeTextToStreamAsync**](https://docs.microsoft.com/uwp/api/Windows.Media.SpeechSynthesis.SpeechSynthesizer.SynthesizeTextToStreamAsync) to generate a stream containing the synthesized speech and corresponding metadata.</span></span> <span data-ttu-id="92d2b-152">Erstellen Sie aus dem synthetisierten Datenstrom eine [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) und ein [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem).</span><span class="sxs-lookup"><span data-stu-id="92d2b-152">Create a [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) and a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) from the synthesized stream.</span></span>

[!code-cs[SynthesizeSpeech](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSynthesizeSpeech)]

<span data-ttu-id="92d2b-153">Registrieren Sie die Spracherkennungs-Metadaten-Ereignisse mithilfe des **MediaPlaybackItem**-Objekts.</span><span class="sxs-lookup"><span data-stu-id="92d2b-153">Register for the speech metadata events using the **MediaPlaybackItem** object.</span></span> <span data-ttu-id="92d2b-154">Dieses Beispiel verwendet die Hilfsmethode **RegisterMetadataHandlerForSpeech**, um die Ereignisse zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-154">This example uses a helper method, **RegisterMetadataHandlerForSpeech**, to register for the events.</span></span> <span data-ttu-id="92d2b-155">Mithilfe eines Lambda-Ausdrucks implementieren wir einen Handler für das [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged)-Ereignis, das auftritt, wenn das System die Änderung einer dem **MediaPlaybackItem** zugeordneten Metadatenspuren bemerkt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-155">A lambda expression is used to implement a handler for the [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged) event, which occurs when the system detects a change in the metadata tracks associated with a **MediaPlaybackItem**.</span></span>  <span data-ttu-id="92d2b-156">Falls Metadatenspuren schon verfügbar sind, weil das Wiedergabeelement zu Beginn aufgelöst wurde, durchsuchen Sie außer dem **TimedMetadataTracksChanged**-Ereignishandler alle verfügbaren Metadatenspuren und rufen **RegisterMetadataHandlerForSpeech** auf.</span><span class="sxs-lookup"><span data-stu-id="92d2b-156">In some cases, the metadata tracks may be available when the playback item is initially resolved, so outside of the **TimedMetadataTracksChanged** handler, we also loop through the available metadata tracks and call **RegisterMetadataHandlerForSpeech**.</span></span>

[!code-cs[SpeechTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechTracksChanged)]

<span data-ttu-id="92d2b-157">Nach der Registrierung der Spracherkennungs-Metadaten-Ereignisse wird das **MediaItem** für die Wiedergabe einem [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) als [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement) zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-157">After registering for the speech metadata events, the **MediaItem** is assigned to a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) for playback within a [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).</span></span>

[!code-cs[SpeechPlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechPlay)]

<span data-ttu-id="92d2b-158">Rufen Sie in der **RegisterMetadataHandlerForSpeech**-Hilfsmethode eine Instanz der [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Klasse ab, indem Sie es in der **TimedMetadataTracks**-Sammlung des **MediaPlaybackItem** indizieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-158">In the **RegisterMetadataHandlerForSpeech** helper method, get an instance of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) class by indexing into the **TimedMetadataTracks** collection of the **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-159">Registrieren Sie die Ereignisse [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) und [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited).</span><span class="sxs-lookup"><span data-stu-id="92d2b-159">Register for the [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) event and the [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) event.</span></span> <span data-ttu-id="92d2b-160">Anschließend müssen Sie [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) in der **TimedMetadataTracks**-Sammlung des Wiedergabeelements aufrufen, um das System anzuweisen, für dieses Wiedergabeelement Metadaten-Marker-Ereignisse an die App zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-160">Then, you must call [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) on the playback item's **TimedMetadataTracks** collection, to instruct the system that the app wants to receive metadata cue events for this playback item.</span></span>

[!code-cs[RegisterMetadataHandlerForWords](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForWords)]

<span data-ttu-id="92d2b-161">Prüfen Sie im Handler für das **CueEntered**-Ereignis die [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind)-Eigenschaft des im Ereignishandler übergebenen [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Objekts, um festzustellen, ob die Metadaten sprachbasierte Untertitel betreffen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-161">In the handler for the **CueEntered** event, you can check the [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) propery of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) object passed into the handler to see if the metadata is speech.</span></span> <span data-ttu-id="92d2b-162">Dies ist notwendig, wenn Sie für mehrere Metadatentypen den gleichen Datenmarker-Ereignishandler verwenden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-162">This is necessary if you are using the same data cue event handler for multiple types of metadata.</span></span> <span data-ttu-id="92d2b-163">Falls die zugeordnete Metadatenspur vom Typ **TimedMetadataKind.Speech** ist, übertragen Sie den in der **Cue**-Eigenschaft enthaltenen Datenmarker der [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) auf einen [**SpeechCue**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue).</span><span class="sxs-lookup"><span data-stu-id="92d2b-163">If the associated metadata track is of type **TimedMetadataKind.Speech**, cast the data cue contained in the **Cue** property of the [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) to a [**SpeechCue**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue).</span></span> <span data-ttu-id="92d2b-164">Der Typ der in Metadatenspuren enthaltenen Spracherkennungs-Marker wird durch die **Label**-Eigenschaft bestimmt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-164">For speech cues, the type of speech cue included in the metadata track is determined by checking the **Label** property.</span></span> <span data-ttu-id="92d2b-165">Mögliche Werte dieser Eigenschaft sind „SpeechWord“ für Wortgrenzen, „SpeechSentence” für Satzgrenzen oder „SpeechBookmark“ für SSML-Lesezeichen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-165">The value of this property will be "SpeechWord" for word boundaries, "SpeechSentence" for sentence boundaries, or "SpeechBookmark" for SSML bookmarks.</span></span> <span data-ttu-id="92d2b-166">In diesem Beispiel prüfen wir den Wert „SpeechWord”; ist dieser Wert vorhanden, wird durch die Eigenschaften [**StartPositionInInput**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue.StartPositionInInput) und [**EndPositionInInput**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue.EndPositionInInput) der **SpeechCue** die Position des aktuell wiedergegebenen Wortes im eingegebenen Text ermittelt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-166">In this example, we check for the "SpeechWord" value, and if this value is found, the [**StartPositionInInput**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue.StartPositionInInput) and [**EndPositionInInput**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue.EndPositionInInput) properties of the **SpeechCue** are used to determine location within the input text of the word currently being played back.</span></span> <span data-ttu-id="92d2b-167">Dieses Beispiel übergibt jedes Wort einfach an die Debugausgabe.</span><span class="sxs-lookup"><span data-stu-id="92d2b-167">This example simply outputs each word to the debug output.</span></span>

[!code-cs[SpeechWordCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechWordCueEntered)]

## <a name="chapter-cues"></a><span data-ttu-id="92d2b-168">Kapitelmarker</span><span class="sxs-lookup"><span data-stu-id="92d2b-168">Chapter cues</span></span>
<span data-ttu-id="92d2b-169">Ab Windows10 Version 1703 können UWP-Apps Marker registrieren, um die Kapitel eines Medienelements zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-169">Starting with Windows 10, version 1703, UWP apps can register for cues that correspond to chapters within a media item.</span></span> <span data-ttu-id="92d2b-170">Um dieses Feature zu nutzen, erstellen Sie für den Medieninhalt zuerst ein [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource)-Objekt und dann ein [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) aus der **MediaSource**.</span><span class="sxs-lookup"><span data-stu-id="92d2b-170">To use this feature, create a [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) object for the media content and then create a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) from the **MediaSource**.</span></span>

[!code-cs[ChapterCueLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueLoadContent)]

<span data-ttu-id="92d2b-171">Registrieren Sie mithilfe des im vorherigen Schritterstellten **MediaPlaybackItem**-Objekts die Metadaten-Ereignisse für Kapitel.</span><span class="sxs-lookup"><span data-stu-id="92d2b-171">Register for the chapter metadata events using the **MediaPlaybackItem** object created in the previous step.</span></span> <span data-ttu-id="92d2b-172">Dieses Beispiel verwendet die Hilfsmethode **RegisterMetadataHandlerForChapterCues**, um die Ereignisse zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-172">This example uses a helper method, **RegisterMetadataHandlerForChapterCues**, to register for the events.</span></span> <span data-ttu-id="92d2b-173">Mithilfe eines Lambda-Ausdrucks implementieren wir einen Handler für das [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged)-Ereignis, das auftritt, wenn das System die Änderung einer dem **MediaPlaybackItem** zugeordneten Metadatenspuren bemerkt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-173">A lambda expression is used to implement a handler for the [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged) event, which occurs when the system detects a change in the metadata tracks associated with a **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-174">Falls Metadatenspuren schon verfügbar sind, weil das Wiedergabeelement zu Beginn aufgelöst wurde, durchsuchen Sie außer dem **TimedMetadataTracksChanged**-Ereignishandler alle verfügbaren Metadatenspuren und rufen **RegisterMetadataHandlerForChapterCues** auf.</span><span class="sxs-lookup"><span data-stu-id="92d2b-174">In some cases, the metadata tracks may be available when the playback item is initially resolved, so outside of the **TimedMetadataTracksChanged** handler, we also loop through the available metadata tracks and call **RegisterMetadataHandlerForChapterCues**.</span></span>

[!code-cs[ChapterCueTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueTracksChanged)]

<span data-ttu-id="92d2b-175">Nach der Registrierung der Kapitel-Metadaten-Ereignisse wird das **MediaItem** für die Wiedergabe einem [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) als [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement) zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-175">After registering for the chapter metadata events, the **MediaItem** is assigned to a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) for playback within a [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).</span></span>

[!code-cs[ChapterCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCuePlay)]

<span data-ttu-id="92d2b-176">Rufen Sie in der **RegisterMetadataHandlerForChapterCues**-Hilfsmethode eine Instanz der [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Klasse ab, indem Sie es in der **TimedMetadataTracks**-Sammlung des **MediaPlaybackItem** indizieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-176">In the **RegisterMetadataHandlerForChapterCues** helper method, get an instance of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) class by indexing into the **TimedMetadataTracks** collection of the **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-177">Registrieren Sie die Ereignisse [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) und [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited).</span><span class="sxs-lookup"><span data-stu-id="92d2b-177">Register for the [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) event and the [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) event.</span></span> <span data-ttu-id="92d2b-178">Anschließend müssen Sie [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) in der **TimedMetadataTracks**-Sammlung des Wiedergabeelements aufrufen, um das System anzuweisen, für dieses Wiedergabeelement Metadaten-Marker-Ereignisse an die App zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-178">Then, you must call [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) on the playback item's **TimedMetadataTracks** collection, to instruct the system that the app wants to receive metadata cue events for this playback item.</span></span>

[!code-cs[RegisterMetadataHandlerForChapterCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForChapterCues)]

<span data-ttu-id="92d2b-179">Prüfen Sie im Handler für das **CueEntered**-Ereignis die [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind)-Eigenschaft des im Ereignishandler übergebenen [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Objekts, um festzustellen, ob die Metadaten Kapitel betreffen. Dies ist notwendig, wenn Sie für mehrere Metadatentypen den gleichen Datenmarker-Ereignishandler verwenden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-179">In the handler for the **CueEntered** event, you can check the [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) propery of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) object passed into the handler to see if the metadata is for chapter cues. This is necessary if you are using the same data cue event handler for multiple types of metadata.</span></span> <span data-ttu-id="92d2b-180">Falls die zugeordnete Metadatenspur vom Typ **TimedMetadataKind.Chapter** ist, übertragen Sie den in der **Cue**-Eigenschaft enthaltenen Datenmarker der [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) auf einen [**ChapterCue**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue).</span><span class="sxs-lookup"><span data-stu-id="92d2b-180">If the associated metadata track is of type **TimedMetadataKind.Chapter**, cast the data cue contained in the **Cue** property of the [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) to an [**ChapterCue**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue).</span></span> <span data-ttu-id="92d2b-181">Die [**Title**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue.Title)-Eigenschaft des **ChapterCue** enthält den Titel des Kapitels, das in der Wiedergabe aktuell erreicht wurde.</span><span class="sxs-lookup"><span data-stu-id="92d2b-181">The [**Title**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue.Title) property of the **ChapterCue** contains the title of the chapter that has just been reached in playback.</span></span>

[!code-cs[ChapterCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueEntered)]

### <a name="seek-to-the-next-chapter-using-chapter-cues"></a><span data-ttu-id="92d2b-182">Suchen des nächsten Kapitelsdurch Kapitelmarker</span><span class="sxs-lookup"><span data-stu-id="92d2b-182">Seek to the next chapter using chapter cues</span></span>
<span data-ttu-id="92d2b-183">Außer Benachrichtigungen zu erhalten, wenn sich das aktuelle Kapiteleines Wiedergabeelements ändert, können Sie durch Kapitelmarker auch zum nächsten Kapitelinnerhalb des Wiedergabeelements springen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-183">In addition to receiving notifications when the current chapter changes in a playing item, you can also use chapter cues to seek to the next chapter within a playing item.</span></span> <span data-ttu-id="92d2b-184">Die folgende Beispielmethode akzeptiert die Argumente [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) sowie für das aktuell wiedergegebene Medienelement ein [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem).</span><span class="sxs-lookup"><span data-stu-id="92d2b-184">The example method shown below takes as arguments a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) and a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) representing the currently playing media item.</span></span> <span data-ttu-id="92d2b-185">In der [**TimedMetadataTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracks)-Sammlung wird gesucht, ob einer der Titel die Eigenschaft [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) des Werts [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) von **TimedMetadataKind.Chapter** aufweist.</span><span class="sxs-lookup"><span data-stu-id="92d2b-185">The [**TimedMetadataTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracks) collection is searched to see if any of the tracks have [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) propery of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) value of **TimedMetadataKind.Chapter**.</span></span>  <span data-ttu-id="92d2b-186">Wird eine Kapitelspur gefunden, durchsucht die Methode alle Marker in der [**Cues**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.Cues)-Sammlung des Titels nach dem ersten Marker, dessen [**StartTime**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue.StartTime)-Wert größer ist als die aktuelle [**Position**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacksession.Position) in der MediaPlayer-Wiedergabe.</span><span class="sxs-lookup"><span data-stu-id="92d2b-186">If a chapter track is found, the method loops through each cue in the track's [**Cues**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.Cues) collection to find the first cue that has a [**StartTime**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue.StartTime) greater than the current [**Position**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacksession.Position) of the media player's playback session.</span></span> <span data-ttu-id="92d2b-187">Sobald der korrekte Marker gefunden ist, werden die aktuelle Wiedergabeposition und die Kapitel auf der Benutzeroberfläche aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="92d2b-187">Once the correct cue is found, the position of the playback session is updated and the chapter title is updated in the UI.</span></span>

[!code-cs[GoToNextChapter](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetGoToNextChapter)]

## <a name="extended-m3u-comments"></a><span data-ttu-id="92d2b-188">Erweiterte M3U-Kommentare</span><span class="sxs-lookup"><span data-stu-id="92d2b-188">Extended M3U comments</span></span>
<span data-ttu-id="92d2b-189">Ab Windows10 Version 1703 können UWP-Apps Marker registrieren, die Kommentaren in erweiterten M3U-Manifestdateien zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="92d2b-189">Starting with Windows 10, version 1703, UWP apps can register for cues that correspond to comments within a Extended M3U manifest file.</span></span> <span data-ttu-id="92d2b-190">Dieses Beispiel verwendet [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource), um Medieninhalte wiederzugeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-190">This example uses [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) to play the media content.</span></span> <span data-ttu-id="92d2b-191">Weitere Informationen finden Sie unter [Adaptives Streaming](adaptive-streaming.md).</span><span class="sxs-lookup"><span data-stu-id="92d2b-191">For more information, see [Adaptive Streaming](adaptive-streaming.md).</span></span> <span data-ttu-id="92d2b-192">Erstellen Sie für den Inhalt eine **AdaptiveMediaSource** durch den Aufruf von [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) oder [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync).</span><span class="sxs-lookup"><span data-stu-id="92d2b-192">Create an **AdaptiveMediaSource** for the content by calling [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) or [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync).</span></span> <span data-ttu-id="92d2b-193">Erstellen Sie zuerst ein [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource)-Objekt durch den Aufruf [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) und dann ein [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) aus der **MediaSource**.</span><span class="sxs-lookup"><span data-stu-id="92d2b-193">Create a  [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) object by calling [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) and then create a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) from the **MediaSource**.</span></span>

[!code-cs[EXTM3ULoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3ULoadContent)]

<span data-ttu-id="92d2b-194">Registrieren Sie die M3U-Metadaten-Ereignisse mithilfe des im vorherigen Schritterstellten **MediaPlaybackItem**-Objekts.</span><span class="sxs-lookup"><span data-stu-id="92d2b-194">Register for the M3U metadata events using the **MediaPlaybackItem** object created in the previous step.</span></span> <span data-ttu-id="92d2b-195">Dieses Beispiel verwendet die Hilfsmethode **RegisterMetadataHandlerForEXTM3UCues**, um die Ereignisse zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-195">This example uses a helper method, **RegisterMetadataHandlerForEXTM3UCues**, to register for the events.</span></span> <span data-ttu-id="92d2b-196">Mithilfe eines Lambda-Ausdrucks implementieren wir einen Handler für das [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged)-Ereignis, das auftritt, wenn das System die Änderung einer dem **MediaPlaybackItem** zugeordneten Metadatenspuren bemerkt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-196">A lambda expression is used to implement a handler for the [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged) event, which occurs when the system detects a change in the metadata tracks associated with a **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-197">Falls Metadatenspuren schon verfügbar sind, weil das Wiedergabeelement zu Beginn aufgelöst wurde, durchsuchen Sie außer dem **TimedMetadataTracksChanged**-Ereignishandler alle verfügbaren Metadatenspuren und rufen **RegisterMetadataHandlerForEXTM3UCues** auf.</span><span class="sxs-lookup"><span data-stu-id="92d2b-197">In some cases, the metadata tracks may be available when the playback item is initially resolved, so outside of the **TimedMetadataTracksChanged** handler, we also loop through the available metadata tracks and call **RegisterMetadataHandlerForEXTM3UCues**.</span></span>

[!code-cs[EXTM3UCueTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCueTracksChanged)]

<span data-ttu-id="92d2b-198">Nach der Registrierung der M3U-Metadaten-Ereignisse wird das **MediaItem** für die Wiedergabe einem [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) als [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement) zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-198">After registering for the M3U metadata events, the **MediaItem** is assigned to a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) for playback within a [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).</span></span>

[!code-cs[EXTM3UCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCuePlay)]

<span data-ttu-id="92d2b-199">Rufen Sie in der **RegisterMetadataHandlerForEXTM3UCues**-Hilfsmethode eine Instanz der [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Klasse ab, indem Sie es in der **TimedMetadataTracks**-Sammlung des **MediaPlaybackItem** indizieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-199">In the **RegisterMetadataHandlerForEXTM3UCues** helper method, get an instance of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) class by indexing into the **TimedMetadataTracks** collection of the **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-200">Prüfen Sie die Dispatchtyp-Eigenschaft der Metadatenspur; diese weist den Wert „EXTM3U“ auf, wenn die Spur M3U-Kommentare darstellt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-200">Check the DispatchType property of the metadata track, which will have a value of "EXTM3U" if the track represents M3U comments.</span></span> <span data-ttu-id="92d2b-201">Registrieren Sie die Ereignisse [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) und [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited).</span><span class="sxs-lookup"><span data-stu-id="92d2b-201">Register for the [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) event and the [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) event.</span></span> <span data-ttu-id="92d2b-202">Anschließend müssen Sie [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) in der **TimedMetadataTracks**-Sammlung des Wiedergabeelements aufrufen, um das System anzuweisen, für dieses Wiedergabeelement Metadaten-Marker-Ereignisse an die App zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-202">Then, you must call [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) on the playback item's **TimedMetadataTracks** collection, to instruct the system that the app wants to receive metadata cue events for this playback item.</span></span>

[!code-cs[RegisterMetadataHandlerForEXTM3UCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForEXTM3UCues)]

<span data-ttu-id="92d2b-203">Im Handler für das **CueEntered**-Ereignis übertragen Sie die in der **Cues**-Eigenschaft des [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) enthaltenen Datenmarker auf einen [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).</span><span class="sxs-lookup"><span data-stu-id="92d2b-203">In the handler for the **CueEntered** event, cast the data cue contained in the **Cue** property of the [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) to an [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).</span></span>  <span data-ttu-id="92d2b-204">Stellen Sie sicher, dass die Eigenschaften **DataCue** und [**Data**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Data) des Markers nicht „Null” lauten.</span><span class="sxs-lookup"><span data-stu-id="92d2b-204">Check to make sure the **DataCue** and the [**Data**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Data) property of the cue are not null.</span></span> <span data-ttu-id="92d2b-205">Erweiterte EWU-Kommentare werden als Zeichenfolgen bereitgestellt in der Form UTF-16, little endian, null-beendet.</span><span class="sxs-lookup"><span data-stu-id="92d2b-205">Extended EMU comments are provided in the form of UTF-16, little endian, null terminated strings.</span></span> <span data-ttu-id="92d2b-206">Erstellen Sie zum Lesen der Markerdaten einen neuen **DataReader** durch den Aufruf [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer).</span><span class="sxs-lookup"><span data-stu-id="92d2b-206">Create a new **DataReader** to read the cue data by calling [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer).</span></span> <span data-ttu-id="92d2b-207">Legen Sie die [**UnicodeEncoding**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.UnicodeEncoding)-Eigenschaft des Readers auf [**Utf16LE**](https://docs.microsoft.com/uwp/api/windows.storage.streams.unicodeencoding) fest, damit die Daten im richtigen Format gelesen werden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-207">Set the [**UnicodeEncoding**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.UnicodeEncoding) property of the reader to [**Utf16LE**](https://docs.microsoft.com/uwp/api/windows.storage.streams.unicodeencoding) to read the data in the correct format.</span></span> <span data-ttu-id="92d2b-208">Um die Daten zu lesen, müssen Sie [**ReadString**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.ReadString) aufrufen, dann die Hälfte des **Data**-Feldes ausfüllen und, da jedes Zeichen zwei Byte groß ist, eines abziehen, um das letzte Null-Zeichen zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-208">Call [**ReadString**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.ReadString) to read the data, specifying half of the length of the **Data** field, because each character is two bytes in size, and subtract one to remove the trailing null character.</span></span> <span data-ttu-id="92d2b-209">In diesem Beispiel wird der M3U-Kommentar einfach in die Debugausgabe geschrieben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-209">In this example, the M3U comment is simply written to the debug output.</span></span>

[!code-cs[EXTM3UCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCueEntered)]

## <a name="id3-tags"></a><span data-ttu-id="92d2b-210">ID3-Tags</span><span class="sxs-lookup"><span data-stu-id="92d2b-210">ID3 tags</span></span>
<span data-ttu-id="92d2b-211">Ab Windows10 Version 1703 können UWP-Apps Marker registrieren, die ID3-Tags im Inhalt von Http Live Streaming (HLS) zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="92d2b-211">Starting with Windows 10, version 1703, UWP apps can register for cues that correspond to ID3 tags within Http Live Streaming (HLS) content.</span></span> <span data-ttu-id="92d2b-212">Dieses Beispiel verwendet [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource), um Medieninhalte wiederzugeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-212">This example uses [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) to play the media content.</span></span> <span data-ttu-id="92d2b-213">Weitere Informationen finden Sie unter [Adaptives Streaming](adaptive-streaming.md).</span><span class="sxs-lookup"><span data-stu-id="92d2b-213">For more information, see [Adaptive Streaming](adaptive-streaming.md).</span></span> <span data-ttu-id="92d2b-214">Erstellen Sie für den Inhalt eine **AdaptiveMediaSource** durch den Aufruf von [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) oder [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync).</span><span class="sxs-lookup"><span data-stu-id="92d2b-214">Create an **AdaptiveMediaSource** for the content by calling [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) or [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync).</span></span> <span data-ttu-id="92d2b-215">Erstellen Sie zuerst ein [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource)-Objekt durch den Aufruf [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) und dann ein [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) aus der **MediaSource**.</span><span class="sxs-lookup"><span data-stu-id="92d2b-215">Create a  [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) object by calling [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) and then create a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) from the **MediaSource**.</span></span>

[!code-cs[EXTM3ULoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3ULoadContent)]

<span data-ttu-id="92d2b-216">Registrieren Sie die ID3-Tag-Ereignisse mithilfe des im vorherigen Schritterstellten **MediaPlaybackItem**-Objekts.</span><span class="sxs-lookup"><span data-stu-id="92d2b-216">Register for the ID3 tag events using the **MediaPlaybackItem** object created in the previous step.</span></span> <span data-ttu-id="92d2b-217">Dieses Beispiel verwendet die Hilfsmethode **RegisterMetadataHandlerForID3Cues**, um die Ereignisse zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-217">This example uses a helper method, **RegisterMetadataHandlerForID3Cues**, to register for the events.</span></span> <span data-ttu-id="92d2b-218">Mithilfe eines Lambda-Ausdrucks implementieren wir einen Handler für das [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged)-Ereignis, das auftritt, wenn das System die Änderung einer dem **MediaPlaybackItem** zugeordneten Metadatenspuren bemerkt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-218">A lambda expression is used to implement a handler for the [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged) event, which occurs when the system detects a change in the metadata tracks associated with a **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-219">Falls Metadatenspuren schon verfügbar sind, weil das Wiedergabeelement zu Beginn aufgelöst wurde, durchsuchen Sie außer dem **TimedMetadataTracksChanged**-Ereignishandler alle verfügbaren Metadatenspuren und rufen **RegisterMetadataHandlerForID3Cues** auf.</span><span class="sxs-lookup"><span data-stu-id="92d2b-219">In some cases, the metadata tracks may be available when the playback item is initially resolved, so outside of the **TimedMetadataTracksChanged** handler, we also loop through the available metadata tracks and call **RegisterMetadataHandlerForID3Cues**.</span></span>

[!code-cs[ID3LoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3LoadContent)]

<span data-ttu-id="92d2b-220">Nach der Registrierung der ID3-Metadaten-Ereignisse wird das **MediaItem** für die Wiedergabe einem [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) als [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement) zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-220">After registering for the ID3 metadata events, the **MediaItem** is assigned to a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) for playback within a [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).</span></span>

[!code-cs[ID3CuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3CuePlay)]


<span data-ttu-id="92d2b-221">Rufen Sie in der **RegisterMetadataHandlerForID3Cues**-Hilfsmethode eine Instanz der [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Klasse ab, indem Sie es in der **TimedMetadataTracks**-Sammlung des **MediaPlaybackItem** indizieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-221">In the **RegisterMetadataHandlerForID3Cues** helper method, get an instance of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) class by indexing into the **TimedMetadataTracks** collection of the **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-222">Prüfen Sie die Dispatchtyp-Eigenschaft der Metadatenspur; diese enthalten die GUID-Zeichenfolge „15260DFFFF49443320FF49443320000F”, wenn die Spur ID3-Tags darstellt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-222">Check the DispatchType property of the metadata track, which will have a value containing the GUID string "15260DFFFF49443320FF49443320000F" if the track represents ID3 tags.</span></span> <span data-ttu-id="92d2b-223">Registrieren Sie die Ereignisse [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) und [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited).</span><span class="sxs-lookup"><span data-stu-id="92d2b-223">Register for the [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) event and the [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) event.</span></span> <span data-ttu-id="92d2b-224">Anschließend müssen Sie [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) in der **TimedMetadataTracks**-Sammlung des Wiedergabeelements aufrufen, um das System anzuweisen, für dieses Wiedergabeelement Metadaten-Marker-Ereignisse an die App zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-224">Then, you must call [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) on the playback item's **TimedMetadataTracks** collection, to instruct the system that the app wants to receive metadata cue events for this playback item.</span></span>

[!code-cs[RegisterMetadataHandlerForID3Cues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForID3Cues)]

<span data-ttu-id="92d2b-225">Im Handler für das **CueEntered**-Ereignis übertragen Sie die in der **Cues**-Eigenschaft des [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) enthaltenen Datenmarker auf einen [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).</span><span class="sxs-lookup"><span data-stu-id="92d2b-225">In the handler for the **CueEntered** event, cast the data cue contained in the **Cue** property of the [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) to an [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).</span></span>  <span data-ttu-id="92d2b-226">Stellen Sie sicher, dass die Eigenschaften **DataCue** und [**Data**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Data) des Markers nicht „Null” lauten.</span><span class="sxs-lookup"><span data-stu-id="92d2b-226">Check to make sure the **DataCue** and the [**Data**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Data) property of the cue are not null.</span></span> <span data-ttu-id="92d2b-227">Erweiterte EWU-Kommentare werden im Transportstream als unformatierte Bytes bereitgestellt (siehe [http://id3.org/id3v2.4.0-structure](http://id3.org/id3v2.4.0-structure)).</span><span class="sxs-lookup"><span data-stu-id="92d2b-227">Extended EMU comments are provided in the form raw bytes in the transport stream (see [http://id3.org/id3v2.4.0-structure](http://id3.org/id3v2.4.0-structure)).</span></span> <span data-ttu-id="92d2b-228">Erstellen Sie zum Lesen der Markerdaten einen neuen **DataReader** durch den Aufruf [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer).</span><span class="sxs-lookup"><span data-stu-id="92d2b-228">Create a new **DataReader** to read the cue data by calling [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer).</span></span>  <span data-ttu-id="92d2b-229">In diesem Beispiel werden die Kopfzeilenwerte des ID3-Tags aus den Markerdaten gelesen und in die Debugausgabe geschrieben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-229">In this example, the header values from the ID3 tag are read from the cue data and written to the debug output.</span></span>

[!code-cs[ID3CueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3CueEntered)]

## <a name="fragmented-mp4-emsg-boxes"></a><span data-ttu-id="92d2b-230">Fragmentierte MP4-Emsg-Felder</span><span class="sxs-lookup"><span data-stu-id="92d2b-230">Fragmented mp4 emsg boxes</span></span>
<span data-ttu-id="92d2b-231">Ab Windows10 Version 1703 können UWP-Apps Marker registrieren, die Emsg-Feldern in fragmentierten MP4-Streams zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="92d2b-231">Starting with Windows 10, version 1703, UWP apps can register for cues that correspond to emsg boxes within fragmented mp4 streams.</span></span> <span data-ttu-id="92d2b-232">Diesen Metadatentyp können z. B. Inhaltsanbieter verwenden, um Clientanwendungen die Wiedergabe von Anzeigen in Live-Streaming-Inhalten zu signalisieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-232">An example usage of this type of metadata is for content providers to signal client applications to play an ad during live streaming content.</span></span> <span data-ttu-id="92d2b-233">Dieses Beispiel verwendet [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource), um Medieninhalte wiederzugeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-233">This example uses [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) to play the media content.</span></span> <span data-ttu-id="92d2b-234">Weitere Informationen finden Sie unter [Adaptives Streaming](adaptive-streaming.md).</span><span class="sxs-lookup"><span data-stu-id="92d2b-234">For more information, see [Adaptive Streaming](adaptive-streaming.md).</span></span> <span data-ttu-id="92d2b-235">Erstellen Sie für den Inhalt eine **AdaptiveMediaSource** durch den Aufruf von [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) oder [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync).</span><span class="sxs-lookup"><span data-stu-id="92d2b-235">Create an **AdaptiveMediaSource** for the content by calling [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) or [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync).</span></span> <span data-ttu-id="92d2b-236">Erstellen Sie zuerst ein [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource)-Objekt durch den Aufruf [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) und dann ein [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) aus der **MediaSource**.</span><span class="sxs-lookup"><span data-stu-id="92d2b-236">Create a  [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) object by calling [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) and then create a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) from the **MediaSource**.</span></span>

[!code-cs[EmsgLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgLoadContent)]

<span data-ttu-id="92d2b-237">Registrieren Sie die Emsg-Feld-Ereignisse mithilfe des im vorherigen Schritterstellten **MediaPlaybackItem**-Objekts.</span><span class="sxs-lookup"><span data-stu-id="92d2b-237">Register for the emsg box events using the **MediaPlaybackItem** object created in the previous step.</span></span> <span data-ttu-id="92d2b-238">Dieses Beispiel verwendet die Hilfsmethode **RegisterMetadataHandlerForEmsgCues**, um die Ereignisse zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-238">This example uses a helper method, **RegisterMetadataHandlerForEmsgCues**, to register for the events.</span></span> <span data-ttu-id="92d2b-239">Mithilfe eines Lambda-Ausdrucks implementieren wir einen Handler für das [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged)-Ereignis, das auftritt, wenn das System die Änderung einer dem **MediaPlaybackItem** zugeordneten Metadatenspuren bemerkt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-239">A lambda expression is used to implement a handler for the [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged) event, which occurs when the system detects a change in the metadata tracks associated with a **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-240">Falls Metadatenspuren schon verfügbar sind, weil das Wiedergabeelement zu Beginn aufgelöst wurde, durchsuchen Sie außer dem **TimedMetadataTracksChanged**-Ereignishandler alle verfügbaren Metadatenspuren und rufen **RegisterMetadataHandlerForEmsgCues** auf.</span><span class="sxs-lookup"><span data-stu-id="92d2b-240">In some cases, the metadata tracks may be available when the playback item is initially resolved, so outside of the **TimedMetadataTracksChanged** handler, we also loop through the available metadata tracks and call **RegisterMetadataHandlerForEmsgCues**.</span></span>

[!code-cs[ID3LoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3LoadContent)]

<span data-ttu-id="92d2b-241">Nach der Registrierung der Emsg-Feld-Ereignisse wird das **MediaItem** für die Wiedergabe einem [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) als [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement) zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-241">After registering for the emsg box metadata events, the **MediaItem** is assigned to a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) for playback within a [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).</span></span>

[!code-cs[EmsgCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgCuePlay)]


<span data-ttu-id="92d2b-242">Rufen Sie in der **RegisterMetadataHandlerForEmsgCues**-Hilfsmethode eine Instanz der [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack)-Klasse ab, indem Sie es in der **TimedMetadataTracks**-Sammlung des **MediaPlaybackItem** indizieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-242">In the **RegisterMetadataHandlerForEmsgCues** helper method, get an instance of the [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) class by indexing into the **TimedMetadataTracks** collection of the **MediaPlaybackItem**.</span></span> <span data-ttu-id="92d2b-243">Prüfen Sie die Dispatchtyp-Eigenschaft der Metadatenspur; diese enthält den Wert „emsg:mp4”, wenn die Spur Emsg-Felder darstellt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-243">Check the DispatchType property of the metadata track, which will have a value of "emsg:mp4" if the track represents emsg boxes.</span></span> <span data-ttu-id="92d2b-244">Registrieren Sie die Ereignisse [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) und [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited).</span><span class="sxs-lookup"><span data-stu-id="92d2b-244">Register for the [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) event and the [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) event.</span></span> <span data-ttu-id="92d2b-245">Anschließend müssen Sie [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) in der **TimedMetadataTracks**-Sammlung des Wiedergabeelements aufrufen, um das System anzuweisen, für dieses Wiedergabeelement Metadaten-Marker-Ereignisse an die App zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-245">Then, you must call [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) on the playback item's **TimedMetadataTracks** collection, to instruct the system that the app wants to receive metadata cue events for this playback item.</span></span>


[!code-cs[RegisterMetadataHandlerForEmsgCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForEmsgCues)]


<span data-ttu-id="92d2b-246">Im Handler für das **CueEntered**-Ereignis übertragen Sie die in der **Cues**-Eigenschaft des [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) enthaltenen Datenmarker auf einen [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).</span><span class="sxs-lookup"><span data-stu-id="92d2b-246">In the handler for the **CueEntered** event, cast the data cue contained in the **Cue** property of the [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) to an [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).</span></span>  <span data-ttu-id="92d2b-247">Stellen Sie sicher, dass das **DataCue**-Objekt nicht „Null“ lautet.</span><span class="sxs-lookup"><span data-stu-id="92d2b-247">Check to make sure the **DataCue** object is not null.</span></span> <span data-ttu-id="92d2b-248">Die Eigenschaften des Emsg-Feldes werden von der Medienpipeline in der [**Properties**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Properties)-Sammlung als benutzerdefinierte Eigenschaften des Datenmarker-Objekts bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-248">The properies of the emsg box are provided by the media pipeline as custom properties in the DataCue object's [**Properties**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Properties) collection.</span></span> <span data-ttu-id="92d2b-249">In diesem Beispiel wird versucht, mehrere verschiedene Eigenschaftswerte mithilfe der **[TryGetValue](https://docs.microsoft.com/uwp/api/windows.foundation.collections.propertyset.trygetvalue)**-Methode zu extrahieren.</span><span class="sxs-lookup"><span data-stu-id="92d2b-249">This example attempts to extract several different property values using the **[TryGetValue](https://docs.microsoft.com/uwp/api/windows.foundation.collections.propertyset.trygetvalue)** method.</span></span> <span data-ttu-id="92d2b-250">Wenn diese Methode „Null“ zurückgibt, ist die angeforderte Eigenschaft nicht im Emsg-Feld vorhanden; stattdessen wird ein Standardwert festgelegt.</span><span class="sxs-lookup"><span data-stu-id="92d2b-250">If this method returns null, it means the requested propery is not present in the emsg box, so a default value is set instead.</span></span>

<span data-ttu-id="92d2b-251">Der nächste Teil des Beispiels zeigt, wie die Wiedergabe einer Anzeige ausgelöst wird, weil die im vorherigen Schrittermittelte Eigenschaft *Scheme_id_uri* den Wert „urn: scte:scte35:2013:xml” aufweist (siehe [http://dashif.org/identifiers/event-schemes/](http://dashif.org/identifiers/event-schemes/)).</span><span class="sxs-lookup"><span data-stu-id="92d2b-251">The next part of the example illustrates the scenario where ad playback is triggered, which is the case when the *scheme_id_uri* property, obtained in the previous step, has a value of "urn:scte:scte35:2013:xml" (see [http://dashif.org/identifiers/event-schemes/](http://dashif.org/identifiers/event-schemes/)).</span></span> <span data-ttu-id="92d2b-252">Beachten Sie, dass der Standard empfiehlt, das Emsg mehrmals redundant zu senden; dieses Beispiel führt daher eine Liste bereits verarbeiteter Emsg-IDs, damit nur neue Nachrichten verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="92d2b-252">Note that the standard recommends sending this emsg multiple times for redundancy, so this example maintains a list of the emsg IDs that have already been processed and only processes new messages.</span></span> <span data-ttu-id="92d2b-253">Erstellen Sie vor dem Lesen der Markerdaten einen neuen **DataReader** durch den Aufruf [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer) und legen Sie durch die [**UnicodeEncoding**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.UnicodeEncoding)-Eigenschaft UTF-8 als Codierung fest.</span><span class="sxs-lookup"><span data-stu-id="92d2b-253">Create a new **DataReader** to read the cue data by calling [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer) and set the encoding to UTF-8 by setting the [**UnicodeEncoding**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.UnicodeEncoding) property, then read the data.</span></span> <span data-ttu-id="92d2b-254">In diesem Beispiel wird die Meldungsnutzlast in die Debugausgabe geschrieben.</span><span class="sxs-lookup"><span data-stu-id="92d2b-254">In this example, the message payload is written to the debug output.</span></span> <span data-ttu-id="92d2b-255">Echte Apps verwenden diese Nutzlastdaten, um die Wiedergabe von Anzeigen zu planen.</span><span class="sxs-lookup"><span data-stu-id="92d2b-255">A real app would use the payload data to schedule the playback of an ad.</span></span>

[!code-cs[EmsgCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgCueEntered)]


## <a name="related-topics"></a><span data-ttu-id="92d2b-256">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="92d2b-256">Related topics</span></span>

* [<span data-ttu-id="92d2b-257">Medienwiedergabe</span><span class="sxs-lookup"><span data-stu-id="92d2b-257">Media playback</span></span>](media-playback.md)
* [<span data-ttu-id="92d2b-258">Medienelemente, Wiedergabelisten und Titel</span><span class="sxs-lookup"><span data-stu-id="92d2b-258">Media items, playlists, and tracks</span></span>](media-playback-with-mediasource.md)


 




