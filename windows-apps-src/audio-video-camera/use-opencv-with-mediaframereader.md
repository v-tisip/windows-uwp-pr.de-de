---
author: drewbatgit
ms.assetid: ''
description: In diesem Artikel wird erläutert, wie Sie die Open Source Computer Vision-Bibliothek (OpenCV) mit der MediaFrameReader-Klasse verwenden.
title: Verwenden von OpenCV mit MediaFrameReader
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows10, UWP, openCV
ms.localizationpriority: medium
ms.openlocfilehash: 43545f2a8e1965124560479d399df79d247c5f05
ms.sourcegitcommit: 3727445c1d6374401b867c78e4ff8b07d92b7adc
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/29/2018
ms.locfileid: "2913037"
---
# <a name="use-the-open-source-computer-vision-library-opencv-with-mediaframereader"></a><span data-ttu-id="88ac4-104">Verwenden Sie die Open Source Computer Vision-Bibliothek (OpenCV) mit MediaFrameReader</span><span class="sxs-lookup"><span data-stu-id="88ac4-104">Use the Open Source Computer Vision Library (OpenCV) with MediaFrameReader</span></span>

<span data-ttu-id="88ac4-105">In diesem Artikel wird erläutert, wie Sie die Open Source Computer Vision-Bibliothek (OpenCV), eine systemeigene Code-Bibliothek, die eine Vielzahl von Algorithmen für die Bildverarbeitung bietet, mit der [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader)-Klasse verwenden, die Medien aus mehreren Quellen gleichzeitig lesen kann.</span><span class="sxs-lookup"><span data-stu-id="88ac4-105">This article shows you how to use the Open Source Computer Vision Library (OpenCV), a native code library that provides a wide variety of image processing algorithms, with the [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader) class that can read media frames from multiple sources simulataneously.</span></span> <span data-ttu-id="88ac4-106">Der Beispielcode in diesem Artikel führt Sie durch die Erstellung einer einfachen App, die Frames von einem Farbsensor erhält, jede Frame mithilfe der OpenCV-Bibliothek verwischt und dann das verarbeitete Bild in einem XAML-**Image** Steuerelement anzeigt.</span><span class="sxs-lookup"><span data-stu-id="88ac4-106">The example code in this article walks you through creating a simple app that obtains frames from a color sensor, blurs each frame using the OpenCV library, and then displays the processed image in a XAML **Image** control.</span></span> 

>[!NOTE]
><span data-ttu-id="88ac4-107">OpenCV.Win.Core und OpenCV.Win. ImgProc werden nicht regelmäßig aktualisiert, werden jedoch weiterhin für das Erstellen von OpenCVHelper empfohlen, wie auf dieser Seite beschrieben.</span><span class="sxs-lookup"><span data-stu-id="88ac4-107">OpenCV.Win.Core and OpenCV.Win.ImgProc are not regularly updated, but are still recommended for creating an OpenCVHelper as described on this page.</span></span>

<span data-ttu-id="88ac4-108">Dieser Artikel baut auf dem Inhalt von zwei anderen Artikeln auf:</span><span class="sxs-lookup"><span data-stu-id="88ac4-108">This article builds on the content of two other articles:</span></span>

* <span data-ttu-id="88ac4-109">[Verarbeiten von Medienframes mit "MediaFrameReader"](process-media-frames-with-mediaframereader.md) – dieser Artikel enthält ausführliche Informationen zur Verwendung von **MediaFrameReader** zum Abrufen von Frames aus einer oder mehreren Medienframequellen und beschreibt ausführlich die meisten Beispielcodes in diesem Artikel.</span><span class="sxs-lookup"><span data-stu-id="88ac4-109">[Process media frames with MediaFrameReader](process-media-frames-with-mediaframereader.md) - This article provides detailed information on using **MediaFrameReader** to obtain frames from one or more media frame sources and describes, in detail, most of the sample code in this article.</span></span> <span data-ttu-id="88ac4-110">Vor allem der Artikel **Verarbeiten von Medienframes mit „MediaFrameReader“** enthält den Code für eine Hilfsklasse **FrameRenderer**, die die Darstellung von Medienframes in einem XAML-**Bild**element behandelt.</span><span class="sxs-lookup"><span data-stu-id="88ac4-110">In particular, **Process media frames with MediaFrameReader** provides the code listing for a helper class, **FrameRenderer**, which handles the presentation of media frames in a XAML **Image** element.</span></span> <span data-ttu-id="88ac4-111">Der Beispielcode in diesem Artikel verwendet ebenfalls diese Hilfsklasse.</span><span class="sxs-lookup"><span data-stu-id="88ac4-111">The sample code in this article uses this helper class as well.</span></span>

* <span data-ttu-id="88ac4-112">[Verarbeiten von Softwarebitmaps mit OpenCV](process-software-bitmaps-with-opencv.md) – dieser Artikel führt Sie durch die Erstellung einer mit systemeigenem Code erstellten Komponente für Windows-Runtime, **OpenCVBridge**. Dies hilft beim Konvertieren zwischen einem **SoftwareBitmap**-Objekt, das von **MediaFrameReader** verwendet wird und dem **Mat**-Typ, der von der OpenCV-Bibliothek verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="88ac4-112">[Process software bitmaps with OpenCV](process-software-bitmaps-with-opencv.md) - This article walks you through creating a native code Windows Runtime Component, **OpenCVBridge**, which helps to convert between the **SoftwareBitmap** object, used by the **MediaFrameReader**,  and the **Mat** type used by the OpenCV library.</span></span> <span data-ttu-id="88ac4-113">Im Beispielcode in diesem Artikel wird vorausgesetzt, dass Sie die Schritte zum Hinzufügen der **OpenCVBridge**-Komponente zu Ihrer UWP-App-Lösung befolgt haben.</span><span class="sxs-lookup"><span data-stu-id="88ac4-113">The sample code in this article assumes you have followed the steps to add the **OpenCVBridge** component to your UWP app solution.</span></span>

<span data-ttu-id="88ac4-114">Wenn Sie zusätzlich zu diesem Artikel ein vollständiges, funtionsfähiges End-to-End-Beispiel des in diesem Artikel beschriebenen Szenarios anzeigen und herunterladen möchten, finden Sie dies unter [Kamera-Frames + OpenCV – Beispiel](https://go.microsoft.com/fwlink/?linkid=854003) im GitHub-Repository für Beispiele für die Universelle Windows-Plattform.</span><span class="sxs-lookup"><span data-stu-id="88ac4-114">In addition to these articles, to view and download a full, end-to-end working sample of the scenario described in this article, see the [Camera Frames + OpenCV Sample](https://go.microsoft.com/fwlink/?linkid=854003) in the Windows Universal Samples GitHub repo.</span></span>

<span data-ttu-id="88ac4-115">Zunächst schnell entwickeln können Sie die OpenCV-Bibliothek in einer UWP-app-Projekt mithilfe von NuGet-Pakete enthalten diese Pakete möglicherweise nicht den Prozess der app-Certficication übergeben, wenn Sie Ihre app an den Store übermitteln, daher wird empfohlen, dass Sie die OpenCV herunterladen Bibliothek Quellcode und die Binärdateien vor dem Übermitteln Ihrer app erstellen.</span><span class="sxs-lookup"><span data-stu-id="88ac4-115">To get started developing quickly, you can include the OpenCV library in a UWP app project by using NuGet packages, but these packages may not pass the app certficication process when you submit your app to the Store, so it is recommended that you download the OpenCV library source code and build the binaries yourself before submitting your app.</span></span> <span data-ttu-id="88ac4-116">Informationen zum Entwickeln mit OpenCV finden Sie unter [http://opencv.org](http://opencv.org)</span><span class="sxs-lookup"><span data-stu-id="88ac4-116">Information developing with OpenCV can be found at [http://opencv.org](http://opencv.org)</span></span>


## <a name="implement-the-opencvhelper-native-windows-runtime-component"></a><span data-ttu-id="88ac4-117">Implementieren der systemeigenem OpenCVHelper-Komponente für Windows-Runtime</span><span class="sxs-lookup"><span data-stu-id="88ac4-117">Implement the OpenCVHelper native Windows Runtime Component</span></span>
<span data-ttu-id="88ac4-118">Führen Sie die Schritte unter [Verarbeiten von Softwarebitmaps mit OpenCV](process-software-bitmaps-with-opencv.md) durch, um die OpenCV Helferkomponente für Windows-Runtime zu erstellen und der UWP-App-Lösung einen Verweis auf das Komponentenprojekt hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="88ac4-118">Follow the steps in [Process software bitmaps with OpenCV](process-software-bitmaps-with-opencv.md) to create the OpenCV helper Windows Runtime Component and add a reference to the component project to your UWP app solution.</span></span>

## <a name="find-available-frame-source-groups"></a><span data-ttu-id="88ac4-119">Suchen nach verfügbaren Framequellgruppen</span><span class="sxs-lookup"><span data-stu-id="88ac4-119">Find available frame source groups</span></span>
<span data-ttu-id="88ac4-120">Zunächst müssen Sie eine Framequellgruppe von Medien finden, aus der die Medienframes abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="88ac4-120">First, you need to find a media frame source group from which media frames will be obtained.</span></span> <span data-ttu-id="88ac4-121">Erhalten Sie die Liste der verfügbaren Gruppen auf dem aktuellen Gerät durch Aufrufen von **[MediaFrameSourceGroup.FindAllAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourcegroup.FindAllAsync)**.</span><span class="sxs-lookup"><span data-stu-id="88ac4-121">Get the list of available source groups on the current device by calling **[MediaFrameSourceGroup.FindAllAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourcegroup.FindAllAsync)**.</span></span> <span data-ttu-id="88ac4-122">Wählen Sie anschließend die Quellgruppen aus, die die für Ihr App-Szenario erforderlichen Sensortypen enthalten.</span><span class="sxs-lookup"><span data-stu-id="88ac4-122">Then select the source groups that provide the sensor types required for your app scenario.</span></span> <span data-ttu-id="88ac4-123">In diesem Beispiel benötigen wir lediglich eine Quellgruppe, die Frames von einer RGB-Kamera bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="88ac4-123">For this example, we simply need a source group that provides frames from an RGB camera.</span></span>

[!code-cs[OpenCVFrameSourceGroups](./code/Frames_Win10/Frames_Win10/MainPage.OpenCV.xaml.cs#SnippetOpenCVFrameSourceGroups)]

## <a name="initialize-the-mediacapture-object"></a><span data-ttu-id="88ac4-124">Initialisieren des MediaCapture-Objekts</span><span class="sxs-lookup"><span data-stu-id="88ac4-124">Initialize the MediaCapture object</span></span>
<span data-ttu-id="88ac4-125">Initialisieren Sie anschließend das **MediaCapture**-Objekt durch Festlegen der Eigenschaften von **[SourceGroup](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacaptureinitializationsettings.SourceGroup)** der **MediaCaptureInitializationSettings**, um die im vorherigen Schritt ausgewählte Framequellgruppe zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="88ac4-125">Next, you need to initialize the **MediaCapture** object to use the frame source group selected in the previous step by setting the **[SourceGroup](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacaptureinitializationsettings.SourceGroup)** property of the **MediaCaptureInitializationSettings**.</span></span>

> [!NOTE] 
> <span data-ttu-id="88ac4-126">Die Technik, die von der OpenCV-Helferkomponente verwendet wird und die in [Verarbeiten von Softwarebitmaps mit OpenCV](process-software-bitmaps-with-opencv.md) ausführlich beschrieben ist, erfordert, dass sich die Bilddaten im CPU-Speicher und nicht im GPU-Speicher befinden.</span><span class="sxs-lookup"><span data-stu-id="88ac4-126">The technique used by the OpenCVHelper component, described in detail in [Process software bitmaps with OpenCV](process-software-bitmaps-with-opencv.md), requires that the image data resides in CPU memory, not GPU memory.</span></span> <span data-ttu-id="88ac4-127">Sie sollten daher **MemoryPreference.CPU** für die **[MemoryPreference](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacaptureinitializationsettings.MemoryPreference)** im Feld der **MediaCaptureInitializationSettings** angeben.</span><span class="sxs-lookup"><span data-stu-id="88ac4-127">So, you should specify **MemoryPreference.CPU** for the **[MemoryPreference](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacaptureinitializationsettings.MemoryPreference)** field of the **MediaCaptureInitializationSettings**.</span></span>

<span data-ttu-id="88ac4-128">Nachdem das **MediaCapture**-Objet initialisiert wurde, rufen Sie einen Verweis auf die RGB-Framequelle durch den Zugriff auf die **[MediaCapture.FrameSources](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.FrameSources)**-Eigenschaft auf.</span><span class="sxs-lookup"><span data-stu-id="88ac4-128">After the **MediaCapture** objet has been initialized, get a reference to the RGB frame source by accessing the **[MediaCapture.FrameSources](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.FrameSources)** property.</span></span>

[!code-cs[OpenCVInitMediaCapture](./code/Frames_Win10/Frames_Win10/MainPage.OpenCV.xaml.cs#SnippetOpenCVInitMediaCapture)]

## <a name="initialize-the-mediaframereader"></a><span data-ttu-id="88ac4-129">Initialisieren des MediaFrameReader</span><span class="sxs-lookup"><span data-stu-id="88ac4-129">Initialize the MediaFrameReader</span></span>
<span data-ttu-id="88ac4-130">Als Nächstes erstellen Sie einen [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader) für die RGB-Framequelle, die in den vorherigen Schritten abgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="88ac4-130">Next, create a [**MediaFrameReader**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.Frames.MediaFrameReader) for the RGB frame source retrieved in the previous step.</span></span> <span data-ttu-id="88ac4-131">Um eine gute Framerate zu gewährleisten, sollten Sie Frames verarbeiten, die eine niedrigere Auflösung als die Auflösung des Sensors haben.</span><span class="sxs-lookup"><span data-stu-id="88ac4-131">In order to maintain a good frame rate, you may want to process frames that have a lower resolution than the resolution of the sensor.</span></span> <span data-ttu-id="88ac4-132">Dieses Beispiel bietet das optionale **[BitmapSize](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapsize)**-Argument für die **[MediaCapture.CreateFrameReaderAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.createframereaderasync)**-Methode, um anzufordern, dass die vom Frame-Reader bereitgestellten Frames auf 640 x 480 Pixel geändert werden.</span><span class="sxs-lookup"><span data-stu-id="88ac4-132">This example provides the optional **[BitmapSize](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapsize)** argument to the **[MediaCapture.CreateFrameReaderAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.createframereaderasync)** method to request that frames provided by the frame reader be resized to 640 x 480 pixels.</span></span>

<span data-ttu-id="88ac4-133">Nach dem Erstellen des Frame-Readers, registrieren Sie einen Handler für das **[FrameArrived](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader.FrameArrived)**-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="88ac4-133">After creating the frame reader, register a handler for the **[FrameArrived](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader.FrameArrived)** event.</span></span> <span data-ttu-id="88ac4-134">Erstellen Sie anschließend ein neues **[SoftwareBitmapSource](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource)**-Objekt, das die **FrameRenderer**-Hilfsklasse verwendet, um das verarbeitete Bild darzustellen.</span><span class="sxs-lookup"><span data-stu-id="88ac4-134">Then create a new **[SoftwareBitmapSource](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource)** object, which the **FrameRenderer** helper class will use to present the processed image.</span></span> <span data-ttu-id="88ac4-135">Rufen Sie dann den Konstruktor für den **FrameRenderer** auf.</span><span class="sxs-lookup"><span data-stu-id="88ac4-135">Then call the constructor for the **FrameRenderer**.</span></span> <span data-ttu-id="88ac4-136">Initialisieren Sie die Instanzen der **OpenCVHelper**-Klasse, die in der OpenCVBridge Komponente für Windows-Runtime definiert ist.</span><span class="sxs-lookup"><span data-stu-id="88ac4-136">Initialize the instance of the **OpenCVHelper** class defined in the OpenCVBridge Windows Runtime Component.</span></span> <span data-ttu-id="88ac4-137">Diese Hilfsklasse wird im **FrameArrived**-Ereignishandler verwendet, um jeden Frame zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="88ac4-137">This helper class is used in the **FrameArrived** handler to process each frame.</span></span> <span data-ttu-id="88ac4-138">Starten Sie anschließend die den Framereader durch Aufrufen von **[StartAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader.StartAsync)**.</span><span class="sxs-lookup"><span data-stu-id="88ac4-138">Finally, start the frame reader by calling **[StartAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader.StartAsync)**.</span></span>

[!code-cs[OpenCVFrameReader](./code/Frames_Win10/Frames_Win10/MainPage.OpenCV.xaml.cs#SnippetOpenCVFrameReader)]


## <a name="handle-the-framearrived-event"></a><span data-ttu-id="88ac4-139">Behandeln des „FrameArrived“-Ereignisses</span><span class="sxs-lookup"><span data-stu-id="88ac4-139">Handle the FrameArrived event</span></span>
<span data-ttu-id="88ac4-140">Das **FrameArrived**-Ereignis wird ausgelöst, wenn ein neuer Frame von FrameReader verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="88ac4-140">The **FrameArrived** event is raised whenever a new frame is available from the frame reader.</span></span> <span data-ttu-id="88ac4-141">Rufen Sie **[TryAcquireLatestFrame](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader.TryAcquireLatestFrame)** auf, um das Frame zu erhalten, wenn es vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="88ac4-141">Call **[TryAcquireLatestFrame](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader.TryAcquireLatestFrame)** to get the frame, if it exists.</span></span> <span data-ttu-id="88ac4-142">Rufen Sie **SoftwareBitmap** aus **[MediaFrameReference](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereference)** auf.</span><span class="sxs-lookup"><span data-stu-id="88ac4-142">Get the **SoftwareBitmap** from the **[MediaFrameReference](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereference)**.</span></span> <span data-ttu-id="88ac4-143">Beachten Sie, dass die **CVHelper**-Klasse, die in diesem Beispiel verwendet wird, Bilder im BRGA8-Format mit vormultipliziertem Alpha erfordert.</span><span class="sxs-lookup"><span data-stu-id="88ac4-143">Note that the **CVHelper** class used in this example requires images to use the BRGA8 pixel format with premultiplied alpha.</span></span> <span data-ttu-id="88ac4-144">Wenn das in das Ereignis übergebene Frame ein anderes Format hat, konvertieren Sie die **SoftwareBitmap** in das richtige Format.</span><span class="sxs-lookup"><span data-stu-id="88ac4-144">If the frame passed into the event has a different format, convert the **SoftwareBitmap** to the correct format.</span></span> <span data-ttu-id="88ac4-145">Erstellen Sie als Nächstes ein **SoftwareBitmap**, um als Ziel für den Weichzeichnervorgang zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="88ac4-145">Next, create a **SoftwareBitmap** to be used as the target of the blur operation.</span></span> <span data-ttu-id="88ac4-146">Die Quell-Bildeigenschaften werden als Argumente für den Konstruktor verwendet, um eine Bitmap mit übereinstimmendem Format erstellen.</span><span class="sxs-lookup"><span data-stu-id="88ac4-146">The source image properties are used as arguments to the constructor to create a bitmap with matching format.</span></span> <span data-ttu-id="88ac4-147">Rufen Sie die **Weichzeichner**-Methode der Hilfsklasse auf, um den Frame zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="88ac4-147">Call the helper class **Blur** method to process the frame.</span></span> <span data-ttu-id="88ac4-148">Übergeben Sie abschließend das Bild des Weichzeichnervorgangs in **PresentSoftwareBitmap**, die Methode der **FrameRenderer**-Hilfsklasse, die das Bild im XAML-**Bild**-Steuerelement anzeigt, mit dem es initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="88ac4-148">Finally, pass the output image of the blur operation into **PresentSoftwareBitmap**, the method of the **FrameRenderer** helper class that displays the image in the XAML **Image** control with which it was initialized.</span></span>

[!code-cs[OpenCVFrameArrived](./code/Frames_Win10/Frames_Win10/MainPage.OpenCV.xaml.cs#SnippetOpenCVFrameArrived)]

## <a name="related-topics"></a><span data-ttu-id="88ac4-149">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="88ac4-149">Related topics</span></span>

* [<span data-ttu-id="88ac4-150">Kamera</span><span class="sxs-lookup"><span data-stu-id="88ac4-150">Camera</span></span>](camera.md)
* [<span data-ttu-id="88ac4-151">Allgemeine Foto-, Video- und Audioaufnahme mit MediaCapture</span><span class="sxs-lookup"><span data-stu-id="88ac4-151">Basic photo, video, and audio capture with MediaCapture</span></span>](basic-photo-video-and-audio-capture-with-MediaCapture.md)
* [<span data-ttu-id="88ac4-152">Verarbeiten von Medienframes mit „MediaFrameReader“</span><span class="sxs-lookup"><span data-stu-id="88ac4-152">Process media frames with MediaFrameReader</span></span>](process-media-frames-with-mediaframereader.md)
* [<span data-ttu-id="88ac4-153">Prozess-Sotftwarebitmaps mit OpenCV</span><span class="sxs-lookup"><span data-stu-id="88ac4-153">Process software bitmaps with OpenCV</span></span>](process-software-bitmaps-with-opencv.md)
* [<span data-ttu-id="88ac4-154">Beispiel für Kameraframes</span><span class="sxs-lookup"><span data-stu-id="88ac4-154">Camera frames sample</span></span>](http://go.microsoft.com/fwlink/?LinkId=823230)
* [<span data-ttu-id="88ac4-155">Kamera-Frames + OpenCV – Beispiel</span><span class="sxs-lookup"><span data-stu-id="88ac4-155">Camera Frames + OpenCV Sample</span></span>](https://go.microsoft.com/fwlink/?linkid=854003)
 

 




