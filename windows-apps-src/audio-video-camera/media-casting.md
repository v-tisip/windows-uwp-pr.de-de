---
author: drewbatgit
ms.assetid: 40B97E0C-EB1B-40C2-A022-1AB95DFB085E
description: In diesem Artikel wird beschrieben, wie Sie Medien von einer universellen Windows-App für Remotegeräte umwandeln.
title: Medienumwandlung
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: da0bb4d25166dd62372d5902ff89221d20189c22
ms.sourcegitcommit: 753e0a7160a88830d9908b446ef0907cc71c64e7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/30/2018
ms.locfileid: "5760504"
---
# <a name="media-casting"></a><span data-ttu-id="03b2d-104">Medienumwandlung</span><span class="sxs-lookup"><span data-stu-id="03b2d-104">Media casting</span></span>



<span data-ttu-id="03b2d-105">In diesem Artikel wird beschrieben, wie Sie Medien von einer universellen Windows-App für Remotegeräte umwandeln.</span><span class="sxs-lookup"><span data-stu-id="03b2d-105">This article shows you how to cast media to remote devices from a Universal Windows app.</span></span>

## <a name="built-in-media-casting-with-mediaplayerelement"></a><span data-ttu-id="03b2d-106">Integrierte Medienumwandlung mit MediaPlayerElement</span><span class="sxs-lookup"><span data-stu-id="03b2d-106">Built-in media casting with MediaPlayerElement</span></span>

<span data-ttu-id="03b2d-107">Die einfachste Methode zum Umwandeln von Medien aus einer universellen Windows-App ist die Verwendung der integrierten Umwandlungsfunktion des [**MediaPlayerElement**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaPlayerElement)-Steuerelements.</span><span class="sxs-lookup"><span data-stu-id="03b2d-107">The simplest way to cast media from a Universal Windows app is to use the built-in casting capability of the [**MediaPlayerElement**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaPlayerElement) control.</span></span>

<span data-ttu-id="03b2d-108">Um dem Benutzer das Öffnen einer wiederzugebenden Videodatei im **MediaPlayerElement**-Steuerelement zu ermöglichen, fügen Sie Ihrem Projekt die folgenden Namespaces hinzu.</span><span class="sxs-lookup"><span data-stu-id="03b2d-108">To allow the user to open a video file to be played in the **MediaPlayerElement** control, add the following namespaces to your project.</span></span>

[!code-cs[BuiltInCastingUsing](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetBuiltInCastingUsing)]

<span data-ttu-id="03b2d-109">Fügen Sie in der XAML-Datei der App ein **MediaPlayerElement** hinzu, und legen Sie [**AreTransportControlsEnabled**](https://msdn.microsoft.com/library/windows/apps/dn298977) auf „true“ fest.</span><span class="sxs-lookup"><span data-stu-id="03b2d-109">In your app's XAML file, add a **MediaPlayerElement** and set [**AreTransportControlsEnabled**](https://msdn.microsoft.com/library/windows/apps/dn298977) to true.</span></span>

[!code-xml[MediaElement](./code/MediaCasting_RS1/cs/MainPage.xaml#SnippetMediaElement)]

<span data-ttu-id="03b2d-110">Fügen Sie eine Schaltfläche hinzu, über die der Benutzer die Auswahl einer Datei initiieren kann.</span><span class="sxs-lookup"><span data-stu-id="03b2d-110">Add a button to let the user initiate picking a file.</span></span>

[!code-xml[OpenButton](./code/MediaCasting_RS1/cs/MainPage.xaml#SnippetOpenButton)]

<span data-ttu-id="03b2d-111">Erstellen Sie im [**Click**](https://msdn.microsoft.com/library/windows/apps/br227737)-Ereignishandler für die Schaltfläche eine neue Instanz des [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847)-Objekts, fügen Sie der [**FileTypeFilter**](https://msdn.microsoft.com/library/windows/apps/br207850)-Sammlung Videodateitypen hinzu, und legen die Ausgangsposition auf die Videobibliothek des Benutzers fest.</span><span class="sxs-lookup"><span data-stu-id="03b2d-111">In the [**Click**](https://msdn.microsoft.com/library/windows/apps/br227737) event handler for the button, create a new instance of the [**FileOpenPicker**](https://msdn.microsoft.com/library/windows/apps/br207847), add video file types to the [**FileTypeFilter**](https://msdn.microsoft.com/library/windows/apps/br207850) collection, and set the starting location to the user's videos library.</span></span>

<span data-ttu-id="03b2d-112">Rufen Sie [**PickSingleFileAsync**](https://msdn.microsoft.com/library/windows/apps/jj635275) auf, um das Dialogfeld für die Dateiauswahl zu starten.</span><span class="sxs-lookup"><span data-stu-id="03b2d-112">Call [**PickSingleFileAsync**](https://msdn.microsoft.com/library/windows/apps/jj635275) to launch the file picker dialog.</span></span> <span data-ttu-id="03b2d-113">Diese Methode gibt ein [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171)-Objekt zurück, das die Videodatei darstellt.</span><span class="sxs-lookup"><span data-stu-id="03b2d-113">When this method returns, the result is a [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/br227171) object representing the video file.</span></span> <span data-ttu-id="03b2d-114">Stellen Sie sicher, dass die Datei nicht NULL ist; dies ist der Fall, wenn der Benutzer den Auswahlvorgang abbricht.</span><span class="sxs-lookup"><span data-stu-id="03b2d-114">Check to make sure the file isn't null, which it will be if the user cancels the picking operation.</span></span> <span data-ttu-id="03b2d-115">Rufen Sie die [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227221.aspx)-Methode der Datei auf, um einen [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241731) für die Datei abzurufen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-115">Call the file's [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/br227221.aspx) method to get an [**IRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/br241731) for the file.</span></span> <span data-ttu-id="03b2d-116">Abschließend erstellen Sie ein neues **MediaSource**-Objekt aus der ausgewählten Datei durch Aufrufen von [**CreateFromStorageFile**](https://msdn.microsoft.com/library/windows/apps/dn930909) und weisen es der [**Source**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaPlayerElement.Source)-Eigenschaft des **MediaPlayerElement**-Objekts zu, um die Videodatei zur Videoquelle für das Steuerelement zu machen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-116">Finally, create a new **MediaSource** object from the selected file by calling [**CreateFromStorageFile**](https://msdn.microsoft.com/library/windows/apps/dn930909) and assign it to the **MediaPlayerElement** object's [**Source**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaPlayerElement.Source) property to make the video file the video source for the control.</span></span>

[!code-cs[OpenButtonClick](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetOpenButtonClick)]

<span data-ttu-id="03b2d-117">Nachdem das Video in das **MediaPlayerElement** geladen wurde, kann der Benutzer einfach die Umwandlungsschaltfläche in den Transportsteuerelementen wählen, um ein integriertes Dialogfeld zu öffnen, in dem er ein Gerät auswählen kann, für das die geladenen Medien umgewandelt werden.</span><span class="sxs-lookup"><span data-stu-id="03b2d-117">Once the video is loaded in the **MediaPlayerElement**, the user can simply press the casting button on the transport controls to launch a built-in dialog that allows them to choose a device to which the loaded media will be cast.</span></span>

![MediaElement-Umwandlungsschaltfläche](images/media-element-casting-button.png)

> [!NOTE] 
> <span data-ttu-id="03b2d-119">Ab Windows10, Version1607, wird die Verwendung der **MediaPlayer**-Klasse zum Wiedergeben von Medienelementen empfohlen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-119">Starting with Windows 10, version 1607, it is recommended that you use the **MediaPlayer** class to play media items.</span></span> <span data-ttu-id="03b2d-120">**MediaPlayerElement** ist ein einfaches XAML-Steuerelement, das zum Rendern des Inhalts eines **MediaPlayer**-Objekts auf einer XAML-Seite verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="03b2d-120">The **MediaPlayerElement** is a lightweight XAML control that is used to render the content of a **MediaPlayer** in a XAML page.</span></span> <span data-ttu-id="03b2d-121">Das **MediaElement**-Steuerelement wird aus Gründen der Abwärtskompatibilität weiterhin unterstützt.</span><span class="sxs-lookup"><span data-stu-id="03b2d-121">The **MediaElement** control continues to be supported for backwards compatibility.</span></span> <span data-ttu-id="03b2d-122">Weitere Informationen zur Verwendung von **MediaPlayer** und **MediaPlayerElement** zum Wiedergeben von Medieninhalten finden Sie unter [Wiedergeben von Audio- und Videoinhalten mit „MediaPlayer“](play-audio-and-video-with-mediaplayer.md).</span><span class="sxs-lookup"><span data-stu-id="03b2d-122">For more information on using **MediaPlayer** and **MediaPlayerElement** to play media content, see [Play audio and video with MediaPlayer](play-audio-and-video-with-mediaplayer.md).</span></span> <span data-ttu-id="03b2d-123">Informationen zur Verwendung von **MediaSource** und dazugehörigen APIs für die Arbeit mit Medieninhalten finden Sie unter [Medienelemente, Wiedergabelisten und Titel](media-playback-with-mediasource.md).</span><span class="sxs-lookup"><span data-stu-id="03b2d-123">For information on using **MediaSource** and related APIs to work with media content, see [Media items, playlists, and tracks](media-playback-with-mediasource.md).</span></span>

## <a name="media-casting-with-the-castingdevicepicker"></a><span data-ttu-id="03b2d-124">Medienumwandlung mit CastingDevicePicker</span><span class="sxs-lookup"><span data-stu-id="03b2d-124">Media casting with the CastingDevicePicker</span></span>

<span data-ttu-id="03b2d-125">Eine zweite Methode zum Umwandeln von Medien für ein Gerät ist die Verwendung der [**CastingDevicePicker**](https://msdn.microsoft.com/library/windows/apps/dn972525)-Klasse.</span><span class="sxs-lookup"><span data-stu-id="03b2d-125">A second way to cast media to a device is to use the [**CastingDevicePicker**](https://msdn.microsoft.com/library/windows/apps/dn972525).</span></span> <span data-ttu-id="03b2d-126">Zum Verwenden dieser Klasse schließen Sie den [**Windows.Media.Casting**](https://msdn.microsoft.com/library/windows/apps/dn972568)-Namespace in Ihr Projekt ein.</span><span class="sxs-lookup"><span data-stu-id="03b2d-126">To use this class, include the [**Windows.Media.Casting**](https://msdn.microsoft.com/library/windows/apps/dn972568) namespace in your project.</span></span>

[!code-cs[CastingNamespace](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetCastingNamespace)]

<span data-ttu-id="03b2d-127">Deklarieren Sie eine Membervariable für das **CastingDevicePicker**-Objekt.</span><span class="sxs-lookup"><span data-stu-id="03b2d-127">Declare a member variable for the **CastingDevicePicker** object.</span></span>

[!code-cs[DeclareCastingPicker](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetDeclareCastingPicker)]

<span data-ttu-id="03b2d-128">Wenn die Seite initialisiert wird, erstellen Sie eine neue Instanz der Umwandlungsauswahl, und legen Sie die [**Filter**](https://msdn.microsoft.com/library/windows/apps/dn972540)-Eigenschaft auf [**SupportsVideo**](https://msdn.microsoft.com/library/windows/apps/dn972526) fest, um anzugeben, dass die von der Auswahl aufgeführten Umwandlungsgeräte Video unterstützen müssen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-128">When you page is initialized, create a new instance of the casting picker and set the [**Filter**](https://msdn.microsoft.com/library/windows/apps/dn972540) to [**SupportsVideo**](https://msdn.microsoft.com/library/windows/apps/dn972526) property to indicate that the casting devices listed by the picker should support video.</span></span> <span data-ttu-id="03b2d-129">Registrieren Sie einen Handler für das [**CastingDeviceSelected**](https://msdn.microsoft.com/library/windows/apps/dn972539)-Ereignis, das ausgelöst wird, wenn der Benutzer ein Gerät für die Umwandlung auswählt.</span><span class="sxs-lookup"><span data-stu-id="03b2d-129">Register a handler for the [**CastingDeviceSelected**](https://msdn.microsoft.com/library/windows/apps/dn972539) event, which is raised when the user picks a device for casting.</span></span>

[!code-cs[InitCastingPicker](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetInitCastingPicker)]

<span data-ttu-id="03b2d-130">Fügen Sie in der XAML-Datei eine Schaltfläche hinzu, über die der Benutzer die Auswahl starten kann.</span><span class="sxs-lookup"><span data-stu-id="03b2d-130">In your XAML file, add a button to allow the user to launch the picker.</span></span>

[!code-xml[CastPickerButton](./code/MediaCasting_RS1/cs/MainPage.xaml#SnippetCastPickerButton)]

<span data-ttu-id="03b2d-131">Rufen Sie im **Click**-Ereignishandler für die Schaltfläche [**TransformToVisual**](https://msdn.microsoft.com/library/windows/apps/br208986) auf, um die Transformation eines UI-Elements relativ zu einem anderen Element abzurufen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-131">In the **Click** event handler for the button, call [**TransformToVisual**](https://msdn.microsoft.com/library/windows/apps/br208986) to get the transform of a UI element relative to another element.</span></span> <span data-ttu-id="03b2d-132">In diesem Beispiel ist die Transformation die Position der Umwandlungsauswahl-Schaltfläche relativ zum visuellen Stamm des Anwendungsfensters.</span><span class="sxs-lookup"><span data-stu-id="03b2d-132">In this example, the transform is the position of the cast picker button relative to the visual root of the application window.</span></span> <span data-ttu-id="03b2d-133">Rufen Sie die [**Show**](https://msdn.microsoft.com/library/windows/apps/dn972542)-Methode des [**CastingDevicePicker**](https://msdn.microsoft.com/library/windows/apps/dn972525)-Objekts auf, um das Dialogfeld der Umwandlungsauswahl zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-133">Call the [**Show**](https://msdn.microsoft.com/library/windows/apps/dn972542) method of the [**CastingDevicePicker**](https://msdn.microsoft.com/library/windows/apps/dn972525) object to launch the casting picker dialog.</span></span> <span data-ttu-id="03b2d-134">Geben Sie die Position und die Abmessungen der Umwandlungsauswahl-Schaltfläche an, sodass das Dialogfeld als Flyout der vom Benutzer gewählten Schaltfläche angezeigt werden kann.</span><span class="sxs-lookup"><span data-stu-id="03b2d-134">Specify the location and dimensions of the cast picker button so that the system can make the dialog fly out from the button that the user pressed.</span></span>

[!code-cs[CastPickerButtonClick](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetCastPickerButtonClick)]

<span data-ttu-id="03b2d-135">Rufen Sie im **CastingDeviceSelected**-Ereignishandler die [**CreateCastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972547)-Methode der [**SelectedCastingDevice**](https://msdn.microsoft.com/library/windows/apps/dn972546)-Eigenschaft der Ereignisargumente auf, die das vom Benutzer ausgewählte Umwandlungsgerät darstellt.</span><span class="sxs-lookup"><span data-stu-id="03b2d-135">In the **CastingDeviceSelected** event handler, call the [**CreateCastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972547) method of the [**SelectedCastingDevice**](https://msdn.microsoft.com/library/windows/apps/dn972546) property of the event args, which represents the casting device selected by the user.</span></span> <span data-ttu-id="03b2d-136">Registrieren Sie Handler für die Ereignisse [**ErrorOccurred**](https://msdn.microsoft.com/library/windows/apps/dn972519) und [**StateChanged**](https://msdn.microsoft.com/library/windows/apps/dn972523).</span><span class="sxs-lookup"><span data-stu-id="03b2d-136">Register handlers for the [**ErrorOccurred**](https://msdn.microsoft.com/library/windows/apps/dn972519) and [**StateChanged**](https://msdn.microsoft.com/library/windows/apps/dn972523) events.</span></span> <span data-ttu-id="03b2d-137">Rufen Sie abschließend [**RequestStartCastingAsync**](https://msdn.microsoft.com/library/windows/apps/dn972520) auf, um die Umwandlung zu starten, indem das Ergebnis für die [**GetAsCastingSource**](https://msdn.microsoft.com/library/windows/apps/dn920012)-Methode des **MediaPlayer**-Objekts des **MediaPlayerElement**-Steuerelements übergeben wird, um anzugeben, dass die Medien, die umgewandelt werden sollen, der Inhalt des **MediaPlayer** sind, der dem **MediaPlayerElement** zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="03b2d-137">Finally, call [**RequestStartCastingAsync**](https://msdn.microsoft.com/library/windows/apps/dn972520) to begin casting, passing in the result to the **MediaPlayerElement** control's **MediaPlayer** object's [**GetAsCastingSource**](https://msdn.microsoft.com/library/windows/apps/dn920012) method to specify that the media to be cast is the content of the **MediaPlayer** associated with the **MediaPlayerElement**.</span></span>

> [!NOTE] 
> <span data-ttu-id="03b2d-138">Die Umwandlungsverbindung muss im UI-Thread initiiert werden.</span><span class="sxs-lookup"><span data-stu-id="03b2d-138">The casting connection must be initiated on the UI thread.</span></span> <span data-ttu-id="03b2d-139">Da **CastingDeviceSelected** nicht für den UI-Thread aufgerufen wird, müssen Sie diese Aufrufe innerhalb eines Aufrufs von [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) platzieren, sodass diese für den UI-Thread aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="03b2d-139">Since the **CastingDeviceSelected** is not called on the UI thread, you must place these calls inside a call to [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) which causes them to be called on the UI thread.</span></span>

[!code-cs[CastingDeviceSelected](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetCastingDeviceSelected)]

<span data-ttu-id="03b2d-140">Aktualisieren Sie die Benutzeroberfläche in den Ereignishandlern **ErrorOccurred** und **StateChanged**, um den Benutzer über den aktuellen Status der Umwandlung zu informieren.</span><span class="sxs-lookup"><span data-stu-id="03b2d-140">In the **ErrorOccurred** and **StateChanged** event handlers, you should update your UI to inform the user of the current casting status.</span></span> <span data-ttu-id="03b2d-141">Diese Ereignisse werden im folgenden Abschnitt zum Erstellen einer benutzerdefinierten Umwandlungsgeräteauswahl ausführlich erläutert.</span><span class="sxs-lookup"><span data-stu-id="03b2d-141">These events are discussed in detail in the following section on creating a custom casting device picker.</span></span>

[!code-cs[EmptyStateHandlers](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetEmptyStateHandlers)]

## <a name="media-casting-with-a-custom-device-picker"></a><span data-ttu-id="03b2d-142">Medienumwandlung mit einer benutzerdefinierten Geräteauswahl</span><span class="sxs-lookup"><span data-stu-id="03b2d-142">Media casting with a custom device picker</span></span>

<span data-ttu-id="03b2d-143">Im folgenden Abschnitt wird beschrieben, wie Sie ein eigenes Benutzeroberflächenelement zur Umwandlungsgeräteauswahl erstellen, indem Sie die Umwandlungsgeräte aufzählen und die Verbindung im Code initiieren.</span><span class="sxs-lookup"><span data-stu-id="03b2d-143">The following section describes how to create your own casting device picker UI by enumerating the casting devices and initiating the connection from your code.</span></span>

<span data-ttu-id="03b2d-144">Um die verfügbaren Umwandlungsgeräte aufzuzählen, schließen Sie den [**Windows.Devices.Enumeration**](https://msdn.microsoft.com/library/windows/apps/br225459)-Namespace in Ihr Projekt ein.</span><span class="sxs-lookup"><span data-stu-id="03b2d-144">To enumerate the available casting devices, include the [**Windows.Devices.Enumeration**](https://msdn.microsoft.com/library/windows/apps/br225459) namespace in your project.</span></span>

[!code-cs[EnumerationNamespace](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetEnumerationNamespace)]

<span data-ttu-id="03b2d-145">Fügen Sie der XAML-Seite die folgenden Steuerelemente hinzu, um die einfache Benutzeroberfläche für dieses Beispiel zu implementieren:</span><span class="sxs-lookup"><span data-stu-id="03b2d-145">Add the following controls to your XAML page to implement the rudimentary UI for this example:</span></span>

-   <span data-ttu-id="03b2d-146">Eine Schaltfläche zum Starten des Geräteüberwachungselements, das nach verfügbaren Umwandlungsgeräten sucht.</span><span class="sxs-lookup"><span data-stu-id="03b2d-146">A button to start the device watcher that looks for available casting devices.</span></span>
-   <span data-ttu-id="03b2d-147">Ein [**ProgressRing**](https://msdn.microsoft.com/library/windows/apps/br227538)-Steuerelement, das den Benutzer über die laufende Umwandlungsenumeration informiert.</span><span class="sxs-lookup"><span data-stu-id="03b2d-147">A [**ProgressRing**](https://msdn.microsoft.com/library/windows/apps/br227538) control to provide feedback to the user that casting enumeration is ongoing.</span></span>
-   <span data-ttu-id="03b2d-148">Ein [**ListBox**](https://msdn.microsoft.com/library/windows/apps/br242868) zum Auflisten der erkannten Umwandlungsgeräte.</span><span class="sxs-lookup"><span data-stu-id="03b2d-148">A [**ListBox**](https://msdn.microsoft.com/library/windows/apps/br242868) to list the discovered casting devices.</span></span> <span data-ttu-id="03b2d-149">Definieren Sie eine [**ItemTemplate**](https://msdn.microsoft.com/library/windows/apps/br242830) für das Steuerelement, sodass die Umwandlungsgeräteobjekte direkt dem Steuerelement zugewiesen werden können und die [**FriendlyName**](https://msdn.microsoft.com/library/windows/apps/dn972549)-Eigenschaft trotzdem weiterhin angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="03b2d-149">Define an [**ItemTemplate**](https://msdn.microsoft.com/library/windows/apps/br242830) for the control so that we can assign the casting device objects directly to the control and still display the [**FriendlyName**](https://msdn.microsoft.com/library/windows/apps/dn972549) property.</span></span>
-   <span data-ttu-id="03b2d-150">Eine Schaltfläche, über die der Benutzer das Umwandlungsgerät trennen kann.</span><span class="sxs-lookup"><span data-stu-id="03b2d-150">A button to allow the user to disconnect the casting device.</span></span>

[!code-xml[CustomPickerXAML](./code/MediaCasting_RS1/cs/MainPage.xaml#SnippetCustomPickerXAML)]

<span data-ttu-id="03b2d-151">Deklarieren Sie im CodeBehind Membervariablen für [**DeviceWatcher**](https://msdn.microsoft.com/library/windows/apps/br225446) und [**CastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972510).</span><span class="sxs-lookup"><span data-stu-id="03b2d-151">In your code behind, declare member variables for the [**DeviceWatcher**](https://msdn.microsoft.com/library/windows/apps/br225446) and the [**CastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972510).</span></span>

[!code-cs[DeclareDeviceWatcher](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetDeclareDeviceWatcher)]

<span data-ttu-id="03b2d-152">Aktualisieren Sie im **Click**-Handler für die *startWatcherButton* zuerst die Benutzeroberfläche, indem Sie die Schaltfläche deaktivieren und das Statussignal aktivieren, während die Geräteenumeration ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="03b2d-152">In the **Click** handler for the *startWatcherButton*, first update the UI by disabling the button and making the progress ring active while device enumeration is ongoing.</span></span> <span data-ttu-id="03b2d-153">Löschen Sie den Inhalt des Listenfelds mit Umwandlungsgeräten.</span><span class="sxs-lookup"><span data-stu-id="03b2d-153">Clear the list box of casting devices.</span></span>

<span data-ttu-id="03b2d-154">Erstellen Sie als Nächstes ein Geräteüberwachungselement durch Aufruf von [**DeviceInformation.CreateWatcher**](https://msdn.microsoft.com/library/windows/apps/br225427).</span><span class="sxs-lookup"><span data-stu-id="03b2d-154">Next, create a device watcher by calling [**DeviceInformation.CreateWatcher**](https://msdn.microsoft.com/library/windows/apps/br225427).</span></span> <span data-ttu-id="03b2d-155">Diese Methode kann verwendet werden, um viele verschiedene Arten von Geräten zu überwachen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-155">This method can be used to watch for many different types of devices.</span></span> <span data-ttu-id="03b2d-156">Geben Sie mithilfe der von [**CastingDevice.GetDeviceSelector**](https://msdn.microsoft.com/library/windows/apps/dn972551) zurückgegebenen Geräteauswahlzeichenfolge an, dass Sie Geräte überwachen möchten, die die Videoumwandlung unterstützen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-156">Specify that you want to watch for devices that support video casting by using the device selector string returned by [**CastingDevice.GetDeviceSelector**](https://msdn.microsoft.com/library/windows/apps/dn972551).</span></span>

<span data-ttu-id="03b2d-157">Registrieren Sie abschließend Ereignishandler für die Ereignisse [**Added**](https://msdn.microsoft.com/library/windows/apps/br225450), [**Removed**](https://msdn.microsoft.com/library/windows/apps/br225453), [**EnumerationCompleted**](https://msdn.microsoft.com/library/windows/apps/br225451) und [**Stopped**](https://msdn.microsoft.com/library/windows/apps/br225457).</span><span class="sxs-lookup"><span data-stu-id="03b2d-157">Finally, register event handlers for the [**Added**](https://msdn.microsoft.com/library/windows/apps/br225450), [**Removed**](https://msdn.microsoft.com/library/windows/apps/br225453), [**EnumerationCompleted**](https://msdn.microsoft.com/library/windows/apps/br225451), and [**Stopped**](https://msdn.microsoft.com/library/windows/apps/br225457) events.</span></span>

[!code-cs[StartWatcherButtonClick](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetStartWatcherButtonClick)]

<span data-ttu-id="03b2d-158">Das **Added**-Ereignis wird ausgelöst, wenn ein neues Gerät vom Überwachungselement erkannt wird.</span><span class="sxs-lookup"><span data-stu-id="03b2d-158">The **Added** event is raised when a new device is discovered by the watcher.</span></span> <span data-ttu-id="03b2d-159">Erstellen Sie im Handler für dieses Ereignis ein neues [**CastingDevice**](https://msdn.microsoft.com/library/windows/apps/dn972524)-Objekt, indem Sie [**CastingDevice.FromIdAsync**](https://msdn.microsoft.com/library/windows/apps/dn972550) aufrufen und die ID des erkannten Umwandlungsgeräts übergeben, die in dem an den Handler übergebenen **DeviceInformation**-Objekt enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="03b2d-159">In the handler for this event, create a new [**CastingDevice**](https://msdn.microsoft.com/library/windows/apps/dn972524) object by calling [**CastingDevice.FromIdAsync**](https://msdn.microsoft.com/library/windows/apps/dn972550) and passing in the ID of the discovered casting device, which is contained in the **DeviceInformation** object passed into the handler.</span></span>

<span data-ttu-id="03b2d-160">Fügen Sie das **CastingDevice** zum **ListBox** für Umwandlungsgeräte hinzu, damit der Benutzer es auswählen kann.</span><span class="sxs-lookup"><span data-stu-id="03b2d-160">Add the **CastingDevice** to the casting device **ListBox** so that the user can select it.</span></span> <span data-ttu-id="03b2d-161">Aufgrund der in XAML definierten [**ItemTemplate**](https://msdn.microsoft.com/library/windows/apps/br242830) wird die [**FriendlyName**](https://msdn.microsoft.com/library/windows/apps/dn972549)-Eigenschaft als Elementtext im Listenfeld verwendet.</span><span class="sxs-lookup"><span data-stu-id="03b2d-161">Because of the [**ItemTemplate**](https://msdn.microsoft.com/library/windows/apps/br242830) defined in the XAML, the [**FriendlyName**](https://msdn.microsoft.com/library/windows/apps/dn972549) property will be used as the item text for in the list box.</span></span> <span data-ttu-id="03b2d-162">Da dieser Ereignishandler nicht für den UI-Thread aufgerufen wird, müssen Sie die Benutzeroberfläche innerhalb eines Aufrufs von [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="03b2d-162">Because this event handler is not called on the UI thread, you must update the UI from within a call to [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317).</span></span>

[!code-cs[WatcherAdded](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetWatcherAdded)]

<span data-ttu-id="03b2d-163">Das **Removed**-Ereignis wird ausgelöst, wenn das Überwachungselement erkennt, dass ein Umwandlungsgerät nicht mehr vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="03b2d-163">The **Removed** event is raised when the watcher detects that a casting device is no longer present.</span></span> <span data-ttu-id="03b2d-164">Vergleichen Sie die ID-Eigenschaft des **Added**-Objekts, die an den Handler übergeben wird, mit der ID jedes **Added**-Objekts in der [**Items**](https://msdn.microsoft.com/library/windows/apps/br242823)-Sammlung des Listenfelds.</span><span class="sxs-lookup"><span data-stu-id="03b2d-164">Compare the ID property of the **Added** object passed into the handler to the ID of each **Added** in the list box's [**Items**](https://msdn.microsoft.com/library/windows/apps/br242823) collection.</span></span> <span data-ttu-id="03b2d-165">Wenn die ID übereinstimmt, entfernen Sie das Objekt aus der Sammlung.</span><span class="sxs-lookup"><span data-stu-id="03b2d-165">If the ID matches, remove that object from the collection.</span></span> <span data-ttu-id="03b2d-166">Zur Erinnerung: Da die Benutzeroberfläche aktualisiert wird, muss dieser Aufruf innerhalb eines **RunAsync**-Aufrufs erfolgen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-166">Again, because the UI is being updated, this call must be made from within a **RunAsync** call.</span></span>

[!code-cs[WatcherRemoved](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetWatcherRemoved)]

<span data-ttu-id="03b2d-167">Das **EnumerationCompleted**-Ereignis wird ausgelöst, wenn das Überwachungselement die Erkennung von Geräten abgeschlossen hat.</span><span class="sxs-lookup"><span data-stu-id="03b2d-167">The **EnumerationCompleted** event is raised when the watcher has finished detecting devices.</span></span> <span data-ttu-id="03b2d-168">Aktualisieren Sie im Handler für dieses Ereignis die Benutzeroberfläche, um den Benutzer darüber zu informieren, dass die Enumeration abgeschlossen ist, und beenden Sie das Geräteüberwachungselement durch Aufruf von [**Stop**](https://msdn.microsoft.com/library/windows/apps/br225456).</span><span class="sxs-lookup"><span data-stu-id="03b2d-168">In the handler for this event, update the UI to let the user know that device enumeration has completed and stop the device watcher by calling [**Stop**](https://msdn.microsoft.com/library/windows/apps/br225456).</span></span>

[!code-cs[WatcherEnumerationCompleted](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetWatcherEnumerationCompleted)]

<span data-ttu-id="03b2d-169">Das Stopped-Ereignis wird ausgelöst, wenn das Beenden des Geräteüberwachungselements abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="03b2d-169">The Stopped event is raised when the device watcher has finished stopping.</span></span> <span data-ttu-id="03b2d-170">Beenden Sie im Handler für dieses Ereignis das [**ProgressRing**](https://msdn.microsoft.com/library/windows/apps/br227538)-Steuerelement, und aktivieren Sie die *startWatcherButton* wieder, damit der Benutzer den Vorgang der Geräteenumeration neu starten kann.</span><span class="sxs-lookup"><span data-stu-id="03b2d-170">In the handler for this event, stop the [**ProgressRing**](https://msdn.microsoft.com/library/windows/apps/br227538) control and reenable the *startWatcherButton* so that the user can restart the device enumeration process.</span></span>

[!code-cs[WatcherStopped](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetWatcherStopped)]

<span data-ttu-id="03b2d-171">Wenn der Benutzer eines der Umwandlungsgeräte im Listenfeld auswählt, wird das [**SelectionChanged**](https://msdn.microsoft.com/library/windows/apps/br209776)-Ereignis ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="03b2d-171">When the user selects one of the casting devices from the list box, the [**SelectionChanged**](https://msdn.microsoft.com/library/windows/apps/br209776) event is raised.</span></span> <span data-ttu-id="03b2d-172">Innerhalb dieses Handlers werden die Umwandlungsverbindung erstellt und die Umwandlung gestartet.</span><span class="sxs-lookup"><span data-stu-id="03b2d-172">It is within this handler that the casting connection will be created and casting will be started.</span></span>

<span data-ttu-id="03b2d-173">Stellen Sie zunächst sicher, dass das Geräteüberwachungselement beendet wurde, sodass kein Konflikt zwischen Geräteenumeration und Medienumwandlung auftritt.</span><span class="sxs-lookup"><span data-stu-id="03b2d-173">First, make sure the device watcher is stopped so that device enumeration doesn't interfere with media casting.</span></span> <span data-ttu-id="03b2d-174">Erstellen Sie eine Umwandlungsverbindung, indem Sie [**CreateCastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972547) für das vom Benutzer ausgewählte **CastingDevice**-Objekt aufrufen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-174">Create a casting connection by calling [**CreateCastingConnection**](https://msdn.microsoft.com/library/windows/apps/dn972547) on the **CastingDevice** object selected by the user.</span></span> <span data-ttu-id="03b2d-175">Fügen Sie Ereignishandler für die Ereignisse [**StateChanged**](https://msdn.microsoft.com/library/windows/apps/dn972523) und [**ErrorOccurred**](https://msdn.microsoft.com/library/windows/apps/dn972519) hinzu.</span><span class="sxs-lookup"><span data-stu-id="03b2d-175">Add event handlers for the [**StateChanged**](https://msdn.microsoft.com/library/windows/apps/dn972523) and [**ErrorOccurred**](https://msdn.microsoft.com/library/windows/apps/dn972519) events.</span></span>

<span data-ttu-id="03b2d-176">Starten Sie die Medienumwandlung durch Aufrufen von [**RequestStartCastingAsync**](https://msdn.microsoft.com/library/windows/apps/dn972520), und übergeben Sie dabei die Umwandlungsquelle, die durch den Aufruf der **MediaPlayer**-Methode [**GetAsCastingSource**](https://msdn.microsoft.com/library/windows/apps/dn920012) zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="03b2d-176">Start media casting by calling [**RequestStartCastingAsync**](https://msdn.microsoft.com/library/windows/apps/dn972520), passing in the casting source returned by calling the **MediaPlayer** method [**GetAsCastingSource**](https://msdn.microsoft.com/library/windows/apps/dn920012).</span></span> <span data-ttu-id="03b2d-177">Machen Sie zum Schluss die Schaltfläche zum Trennen sichtbar, damit der Benutzer die Medienumwandlung beenden kann.</span><span class="sxs-lookup"><span data-stu-id="03b2d-177">Finally, make the disconnect button visible to allow the user to stop media casting.</span></span>

[!code-cs[SelectionChanged](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetSelectionChanged)]

<span data-ttu-id="03b2d-178">Im Ereignishandler für geänderten Zustand hängt die ausgeführte Aktion vom neuen Zustand der Umwandlungsverbindung ab:</span><span class="sxs-lookup"><span data-stu-id="03b2d-178">In the state changed handler, the action you take depends on the new state of the casting connection:</span></span>

-   <span data-ttu-id="03b2d-179">Beim Zustand **Connected** oder **Rendering** stellen Sie sicher, dass das **ProgressRing**-Steuerelement inaktiv ist und die Schaltfläche zum Trennen angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="03b2d-179">If the state is **Connected** or **Rendering**, make sure the **ProgressRing** control is inactive and the disconnect button is visible.</span></span>
-   <span data-ttu-id="03b2d-180">Beim Zustand **Disconnected** heben Sie die Auswahl des aktuellen Umwandlungsgerät im Listenfeld auf, deaktivieren Sie das **ProgressRing**-Steuerelement, und blenden Sie die Schaltfläche zum Trennen aus.</span><span class="sxs-lookup"><span data-stu-id="03b2d-180">If the state is **Disconnected**, unselect the current casting device in the list box, make the **ProgressRing** control inactive, and hide the disconnect button.</span></span>
-   <span data-ttu-id="03b2d-181">Beim Zustand **Connecting** aktivieren Sie das **ProgressRing**-Steuerelement, und blenden Sie die Schaltfläche zum Trennen aus.</span><span class="sxs-lookup"><span data-stu-id="03b2d-181">If the state is **Connecting**, make the **ProgressRing** control active and hide the disconnect button.</span></span>
-   <span data-ttu-id="03b2d-182">Beim Zustand **Disconnecting** aktivieren Sie das **ProgressRing**-Steuerelement, und blenden Sie die Schaltfläche zum Trennen aus.</span><span class="sxs-lookup"><span data-stu-id="03b2d-182">If the state is **Disconnecting**, make the **ProgressRing** control active and hide the disconnect button.</span></span>

[!code-cs[StateChanged](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetStateChanged)]

<span data-ttu-id="03b2d-183">Aktualisieren Sie im Handler für das **ErrorOccurred**-Ereignis die Benutzeroberfläche, um den Benutzer darüber zu informieren, dass ein Umwandlungsfehler aufgetreten ist, und heben Sie die Auswahl des aktuellen **CastingDevice**-Objekts im Listenfeld auf.</span><span class="sxs-lookup"><span data-stu-id="03b2d-183">In the handler for the **ErrorOccurred** event, update your UI to let the user know that a casting error occurred and unselect the current **CastingDevice** object in the list box.</span></span>

[!code-cs[ErrorOccurred](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetErrorOccurred)]

<span data-ttu-id="03b2d-184">Implementieren Sie zum Schluss den Handler für die Schaltfläche zum Trennen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-184">Finally, implement the handler for the disconnect button.</span></span> <span data-ttu-id="03b2d-185">Beenden Sie die Medienumwandlung, und trennen Sie die Verbindung mit dem Umwandlungsgerät, indem Sie die [**DisconnectAsync**](https://msdn.microsoft.com/library/windows/apps/dn972518)-Methode des **CastingConnection**-Objekts aufrufen.</span><span class="sxs-lookup"><span data-stu-id="03b2d-185">Stop media casting and disconnect from the casting device by calling the **CastingConnection** object's [**DisconnectAsync**](https://msdn.microsoft.com/library/windows/apps/dn972518) method.</span></span> <span data-ttu-id="03b2d-186">Dieser Aufruf muss durch Aufrufen von [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) an den UI-Thread weitergeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="03b2d-186">This call must be dispatched to the UI thread by calling [**CoreDispatcher.RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317).</span></span>

[!code-cs[DisconnectButton](./code/MediaCasting_RS1/cs/MainPage.xaml.cs#SnippetDisconnectButton)]

 

 




