---
ms.assetid: ''
description: Enthält Informationen zum Aufzeichnen von Audio-, Video- und Metadaten aus Spielen in einer UWP-App.
title: Aufzeichnen von Screenshots sowie von Audio-, Video- und Metadaten eines Spiels
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, spiel, aufzeichnen, audio, video, metadaten
ms.localizationpriority: medium
ms.openlocfilehash: c4d4d764395d7f383e9cefcb9d8b1121db098780
ms.sourcegitcommit: d2517e522cacc5240f7dffd5bc1eaa278e3f7768
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/30/2018
ms.locfileid: "8348759"
---
# <a name="capture-game-audio-video-screenshots-and-metadata"></a><span data-ttu-id="991e6-104">Aufzeichnen von Screenshots sowie von Audio-, Video- und Metadaten eines Spiels</span><span class="sxs-lookup"><span data-stu-id="991e6-104">Capture game audio, video, screenshots, and metadata</span></span>
<span data-ttu-id="991e6-105">In diesem Artikel wird beschrieben, wie Audio- und Videosequenzen sowie Screenshots aufgezeichnet und Metadaten von Spielen übermittelt werden, die das System in aufgezeichnete und übertragene Videostreams einbettet. So kann Ihre App dynamische Erfahrungen erstellen, die mit Spielereignissen synchronisiert sind.</span><span class="sxs-lookup"><span data-stu-id="991e6-105">This article describes how to capture game video, audio, and screenshots, and how to submit metadata that the system will embed in captured and broadcast media, allowing your app and others to create dynamic experiences that are synchronized to gameplay events.</span></span> 

<span data-ttu-id="991e6-106">Es gibt zwei Möglichkeiten, den Spielverlauf in einer UWP-App zu erfassen.</span><span class="sxs-lookup"><span data-stu-id="991e6-106">There are two different ways that gameplay can be captured in a UWP app.</span></span> <span data-ttu-id="991e6-107">Der Benutzer kann die Aufzeichnung mithilfe der integrierten Systembenutzeroberfläche initiieren.</span><span class="sxs-lookup"><span data-stu-id="991e6-107">The user can initiate capture using the built-in system UI.</span></span> <span data-ttu-id="991e6-108">Medien, die auf diese Weise erfasst werden, werden in das Microsoft-Ökosystem für Spiele aufgenommen, können über Erstanbietererfahrungen wie die XBox App angezeigt und weitergegeben werden und stehen Ihrer App oder Nutzern nicht direkt zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="991e6-108">Media that is captured using this technique is ingested into the Microsoft gaming ecosystem, can be viewed and shared through first-party experiences such as the XBox app, and is not directly availble to your app or to users.</span></span> <span data-ttu-id="991e6-109">In den ersten Abschnitten dieses Artikels erfahren Sie, wie Sie die vom System implementierte Erfassung mit der App aktivieren und deaktivieren, und wie Sie Benachrichtigungen erhalten, wenn die App eine Aufzeichnung startet oder beendet.</span><span class="sxs-lookup"><span data-stu-id="991e6-109">The first sections of this article will show you how to enable and disable system-implemented app capture and how to receive notifications when app capture starts or stops.</span></span>

<span data-ttu-id="991e6-110">Die andere Möglichkeit zum Aufzeichnen von Medien ist die Verwendung der APIs aus dem **[Windows.Media.AppRecording](https://docs.microsoft.com/uwp/api/windows.media.apprecording)** Namespace.</span><span class="sxs-lookup"><span data-stu-id="991e6-110">The other way to capture media is to use the APIs of the **[Windows.Media.AppRecording](https://docs.microsoft.com/uwp/api/windows.media.apprecording)** namespace.</span></span> <span data-ttu-id="991e6-111">Wenn das Aufzeichnen auf dem Gerät aktiviert ist, kann die App mit der Erfassung des Spielverlaufs beginnen. Sobald Sie die Aufzeichnung nach einiger Zeit stoppen, wird das Medium in eine Datei geschrieben.</span><span class="sxs-lookup"><span data-stu-id="991e6-111">If capturing is enabled on the device, your app can start capturing gameplay and then, after some time has passed, you can stop the capture, at which point the media is written to a file.</span></span> <span data-ttu-id="991e6-112">Wenn der Benutzer die rückwirkende Aufzeichnung aktiviert hat, können Sie auch bereits stattgefundene Spielszenen aufzeichnen, indem Sie eine Startzeit in der Vergangenheit und eine Aufzeichnungsdauer angeben.</span><span class="sxs-lookup"><span data-stu-id="991e6-112">If the user has enabled historical capture, then you can also record gameplay that has already occured by specifying a start time in the past and a duration to record.</span></span> <span data-ttu-id="991e6-113">Beide Techniken generieren eine Videodatei, auf die Ihre App zugreifen kann, und je nachdem, wo Sie die Dateien speichern, auch der Benutzer.</span><span class="sxs-lookup"><span data-stu-id="991e6-113">Both of these techniques produce an video file that can be accessed by your app, and depending on where you choose to save the files, by the user.</span></span> <span data-ttu-id="991e6-114">In den mittleren Abschnitten dieses Artikels wird die Implementierung dieser Szenarien erläutert.</span><span class="sxs-lookup"><span data-stu-id="991e6-114">The middle sections of this article walk you through the implemenation of these scenarios.</span></span>

<span data-ttu-id="991e6-115">Der Namespace **[Windows.Media.Capture](https://docs.microsoft.com/uwp/api/windows.media.capture)** enthält APIs für das Erstellen von Metadaten, die das aufgezeichnete oder übertragene Spiel beschreiben.</span><span class="sxs-lookup"><span data-stu-id="991e6-115">The **[Windows.Media.Capture](https://docs.microsoft.com/uwp/api/windows.media.capture)** namespace provides APIs for creating metadata that describes the gameplay being captured or broadcast.</span></span> <span data-ttu-id="991e6-116">Dabei kann es sich um Text oder numerische Werte handeln, wobei ein Textlabel jedes Datenelement kennzeichnet.</span><span class="sxs-lookup"><span data-stu-id="991e6-116">This can include text or numeric values, with a text label identifying each data item.</span></span> <span data-ttu-id="991e6-117">Metadaten können ein „Ereignis” beschreiben, das zu einem bestimmten Zeitpunkt auftritt, beispielsweise dann, wenn der Benutzer eine Runde in einem Rennspiel beendet, oder einen „Zustand”, der sich über einen bestimmten Zeitraum erstreckt, wie etwa die Landkarte, in der momentan gespielt wird.</span><span class="sxs-lookup"><span data-stu-id="991e6-117">Metadata can represent an "event" which occurs at a single moment, such as when the user finishes a lap in a racing game, or it can represent a "state" that persists over a span of time, such as the current game map the user is playing in.</span></span> <span data-ttu-id="991e6-118">Die Metadaten werden in einen Zwischenspeicher geschrieben, der vom System für Ihre App zugewiesen und verwaltet wird.</span><span class="sxs-lookup"><span data-stu-id="991e6-118">The metadata is written to a cache that is allocated and managed for your app by the system.</span></span> <span data-ttu-id="991e6-119">Die Metadaten werden in Übertragungsstreams und erfasste Videodateien eingebettet, einschließlich der systemeigenen oder benutzerdefinierten Erfassungstechniken für die App.</span><span class="sxs-lookup"><span data-stu-id="991e6-119">The metadata is embedded into broadcast streams and captured video files, including both the built-in system capture or custom app capture techniques.</span></span> <span data-ttu-id="991e6-120">In den letzten Abschnitten dieses Artikels wird das Schreiben von Spielmetadaten behandelt.</span><span class="sxs-lookup"><span data-stu-id="991e6-120">The final sections of this article show you how to write gameplay metadata.</span></span>

> [!NOTE] 
> <span data-ttu-id="991e6-121">Da die Mediendateien mit eingebetteten Metadaten möglicherweise ohne Kontrolle des Benutzers im Netzwerk freigegeben werden, sollten Sie keine personenbezogenen oder andere potenziell vertrauliche Daten in die Metadaten einschließen.</span><span class="sxs-lookup"><span data-stu-id="991e6-121">Because the gameplay metadata can be embedded in media files that can potentially be shared over the network, out of the user's control, you should not include personally identifiable information or other potentially sensitive data in the metadata.</span></span>


## <a name="enable-and-disable-system-app-capture"></a><span data-ttu-id="991e6-122">Aktivieren und deaktivieren der systemeigenen App-Erfassung</span><span class="sxs-lookup"><span data-stu-id="991e6-122">Enable and disable system app capture</span></span>
<span data-ttu-id="991e6-123">Systemeigene App-Aufzeichnungen werden durch den Benutzer mithilfe der integrierten Systembenutzeroberfläche initiiert.</span><span class="sxs-lookup"><span data-stu-id="991e6-123">System app capture is initiated by the user with the built-in system UI.</span></span> <span data-ttu-id="991e6-124">Die Dateien werden in das Windows-Spieleökosystem aufgenommen und stehen Ihrer App oder dem Benutzer nicht zur Verfügung, wohl aber internen Erfahrungen wie der XBox App.</span><span class="sxs-lookup"><span data-stu-id="991e6-124">The files are ingested by the Windows gaming ecosystem and is not available to your app or the user, except for through first party experiences like the XBox app.</span></span> <span data-ttu-id="991e6-125">Ihre App kann die systeminitiierte App-Erfassung deaktivieren und aktivieren, sodass Sie verhindern können, dass der Nutzer bestimmte Inhalte oder den Spielverlauf aufzeichnet.</span><span class="sxs-lookup"><span data-stu-id="991e6-125">Your app can disable and enable system-initiated app capture, allowing you to prevent the user from capturing certain content or gameplay.</span></span> 

<span data-ttu-id="991e6-126">Zum Aktivieren oder Deaktivieren der systemeigenen App-Aufzeichnung rufen Sie einfach die statische Methode **[AppCapture.SetAllowedAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.setallowedasync)** auf und übergeben **false**, um die Aufnahme zu deaktivieren, oder **true**, um sie zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="991e6-126">To enable or disable system app capture, simply call the static method **[AppCapture.SetAllowedAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.setallowedasync)** and passing **false** to disable capture or **true** to enable capture.</span></span>

[!code-cpp[SetAppCaptureAllowed](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetSetAppCaptureAllowed)]


## <a name="receive-notifications-when-system-app-capture-starts-and-stops"></a><span data-ttu-id="991e6-127">Empfangen von Benachrichtigungen, wenn die systemeigene App-Aufzeichnung beginnt oder endet</span><span class="sxs-lookup"><span data-stu-id="991e6-127">Receive notifications when system app capture starts and stops</span></span>
<span data-ttu-id="991e6-128">Um eine Benachrichtigung erhalten, wenn die systemeigene App-Aufzeichnung beginnt oder endet, rufen Sie zunächst eine Instanz der Klasse **[AppCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture)** ab, indem Sie die Factorymethode **[GetForCurrentView](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.GetForCurrentView)** aufrufen.</span><span class="sxs-lookup"><span data-stu-id="991e6-128">To receive a notification when system app capture begins or ends, first get an instance of the **[AppCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture)** class by calling the factory method **[GetForCurrentView](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.GetForCurrentView)**.</span></span> <span data-ttu-id="991e6-129">Dann registrieren Sie einen Handler für das Ereignis **[CapturingChanged](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.CapturingChanged)**.</span><span class="sxs-lookup"><span data-stu-id="991e6-129">Next, register a handler for the **[CapturingChanged](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.CapturingChanged)** event.</span></span>

[!code-cpp[RegisterCapturingChanged](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetRegisterCapturingChanged)]

<span data-ttu-id="991e6-130">Im Handler für das Ereignis **CapturingChanged** können Sie die Eigenschaften **[IsCapturingAudio](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.IsCapturingAudio)** und **[IsCapturingVideo](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.IsCapturingVideo)** überprüfen, um festzustellen, ob Audio- oder Videodaten erfasst werden.</span><span class="sxs-lookup"><span data-stu-id="991e6-130">In the handler for the **CapturingChanged** event, you can check the **[IsCapturingAudio](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.IsCapturingAudio)** and the **[IsCapturingVideo](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.IsCapturingVideo)** properties to determine if audio or video are being captured respectively.</span></span> <span data-ttu-id="991e6-131">Sie können den aktuellen Status der Aufzeichnung in der Benutzeroberfläche Ihrer App anzeigen.</span><span class="sxs-lookup"><span data-stu-id="991e6-131">You may want to update your app's UI to indicate the current capturing status.</span></span>

[!code-cpp[OnCapturingChanged](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetOnCapturingChanged)]

## <a name="add-the-windows-desktop-extensions-for-the-uwp-to-your-app"></a><span data-ttu-id="991e6-132">Hinzufügen der „Windows Desktop Extensions for the UWP” zu Ihrer App</span><span class="sxs-lookup"><span data-stu-id="991e6-132">Add the Windows Desktop Extensions for the UWP to your app</span></span>
<span data-ttu-id="991e6-133">Die APIs im Namespace **[Windows.Media.AppRecording](https://docs.microsoft.com/uwp/api/windows.media.apprecording)** für das Aufzeichnen von Audio- und Videodaten sowie von Screenshots direkt aus Ihrer App sind nicht im Universal API-Vertrag enthalten.</span><span class="sxs-lookup"><span data-stu-id="991e6-133">The APIs for recording audio and video and for capturing screenshots directly from your app, found in the **[Windows.Media.AppRecording](https://docs.microsoft.com/uwp/api/windows.media.apprecording)** namespace, are not included in the Universal API contract.</span></span> <span data-ttu-id="991e6-134">Für den Zugriff auf die APIs müssen Sie Ihrer App mit den folgenden Schritten einen Verweis auf die „Windows Desktop Extensions for the UWP” hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="991e6-134">To access the APIs, you must add a reference to the Windows Desktop Extensions for the UWP to your app with the following steps.</span></span>

1. <span data-ttu-id="991e6-135">Erweitern Sie im **Projektmappen-Explorer** Ihr UWP-Projekt, klicken Sie mit der rechten Maustaste auf **Verweise**, und wählen Sie **Verweis hinzufügen** aus.</span><span class="sxs-lookup"><span data-stu-id="991e6-135">In Visual Studio, in **Solution Explorer**, expand your UWP project and right-click **References** and then select **Add Reference...**.</span></span> 
2. <span data-ttu-id="991e6-136">Erweitern Sie den Knoten **Universal Windows**, und wählen Sie **Erweiterungen** aus.</span><span class="sxs-lookup"><span data-stu-id="991e6-136">Expand the **Universal Windows** node and select **Extensions**.</span></span>
3. <span data-ttu-id="991e6-137">In der Liste der Erweiterungen aktivieren Sie das Kontrollkästchen neben dem Eintrag **Windows Desktop Extensions for the UWP**, der dem Zielbuild für Ihr Projekt entspricht.</span><span class="sxs-lookup"><span data-stu-id="991e6-137">In the list of extensions check the checkbox next to the **Windows Desktop Extensions for the UWP** entry that matches the target build for your project.</span></span> <span data-ttu-id="991e6-138">Die Übertragungsfeatures der App sind ab der Version 1709 verfügbar.</span><span class="sxs-lookup"><span data-stu-id="991e6-138">For the app broadcast features, the version must be 1709 or greater.</span></span>
4. <span data-ttu-id="991e6-139">Klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="991e6-139">Click **OK**.</span></span>

## <a name="get-an-instance-of-apprecordingmanager"></a><span data-ttu-id="991e6-140">Abrufen einer AppRecordingManager-Instanz</span><span class="sxs-lookup"><span data-stu-id="991e6-140">Get an instance of AppRecordingManager</span></span>
<span data-ttu-id="991e6-141">Die Klasse **[AppRecordingManager](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager)** ist die zentrale API zum Verwalten von App-Aufzeichnungen.</span><span class="sxs-lookup"><span data-stu-id="991e6-141">The **[AppRecordingManager](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager)** class is the central API you will use to manage app recording.</span></span> <span data-ttu-id="991e6-142">Sie können eine Instanz dieser Klasse durch einen Aufruf der Factorymethode **[GetDefault](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetDefault)** abrufen.</span><span class="sxs-lookup"><span data-stu-id="991e6-142">Get an instance of this class by calling the factory method **[GetDefault](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetDefault)**.</span></span> <span data-ttu-id="991e6-143">Vor der Verwendung von APIs aus dem Namespace **Windows.Media.AppRecording** sollten Sie deren Vorhandensein auf dem aktuellen Gerät überprüfen.</span><span class="sxs-lookup"><span data-stu-id="991e6-143">Before using any of the APIs in the **Windows.Media.AppRecording** namespace, you should check for their presence on the current device.</span></span> <span data-ttu-id="991e6-144">Die APIs sind nur auf Geräten verfügbar, auf denen Version 1709 (oder höher) von Windows10 ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="991e6-144">The APIs are not available on devices running an OS version earlier than Windows 10, version 1709.</span></span> <span data-ttu-id="991e6-145">Statt die Version des Betriebssystems zu überprüfen, können Sie die Methode **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation.isapicontractpresent)** verwenden, um festzustellen, ob Version 1.0 von *Windows.Media.AppBroadcasting.AppRecordingContract* vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="991e6-145">Rather than check for a specific OS version, use the **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation.isapicontractpresent)** method to query for the *Windows.Media.AppBroadcasting.AppRecordingContract* version 1.0.</span></span> <span data-ttu-id="991e6-146">Wenn dieser Vertrag vorhanden ist, sind die Aufnahme-APIs auf dem Gerät verfügbar.</span><span class="sxs-lookup"><span data-stu-id="991e6-146">If this contract is present, then the recording APIs are available on the device.</span></span> <span data-ttu-id="991e6-147">Der Beispielcode in diesem Artikel sucht zunächst nach den APIs und prüft dann, ob **AppRecordingManager** Null ist, bevor weitere Operationen ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="991e6-147">The example code in this article checks for the APIs once and then checks if the **AppRecordingManager** is null before subsequent operations.</span></span>

[!code-cpp[GetAppRecordingManager](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetGetAppRecordingManager)]

## <a name="determine-if-your-app-can-currently-record"></a><span data-ttu-id="991e6-148">Ermitteln, ob die App momentan aufzeichnen kann</span><span class="sxs-lookup"><span data-stu-id="991e6-148">Determine if your app can currently record</span></span>
<span data-ttu-id="991e6-149">Es gibt verschiedene Gründe dafür, dass Ihre App momentan möglicherweise keine Audio- oder Videoaufzeichnungen erstellen kann. Beispielsweise könnte das aktuelle Gerät nicht den Hardwareanforderungen für Aufnahmen entsprechen oder eine andere App gerade Daten übertragen.</span><span class="sxs-lookup"><span data-stu-id="991e6-149">There are several reasons that your app may not currently be able to capture audio or video, including if the current device doesn't meet the hardware requirements for recording or if another app is currently broadcasting.</span></span> <span data-ttu-id="991e6-150">Vor dem Initiieren einer Aufzeichnung können Sie überprüfen, ob Ihre App momentan aufzeichnen kann.</span><span class="sxs-lookup"><span data-stu-id="991e6-150">Before initiating a recording, you can check to see if your app is currently able to record.</span></span> <span data-ttu-id="991e6-151">Rufen Sie die Methode **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetStatus)** des Objekts **AppRecordingManager** auf, und überprüfen Sie dann die Eigenschaft **[CanRecord](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.CanRecord)** des zurückgegebenen Objekts **[AppRecordingStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus)**.</span><span class="sxs-lookup"><span data-stu-id="991e6-151">Call the **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetStatus)** method of the **AppRecordingManager** object and then check the **[CanRecord](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.CanRecord)** property of the returned **[AppRecordingStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus)** object.</span></span> <span data-ttu-id="991e6-152">Wenn **CanRecord** **"false"** gibt, was bedeutet, dass die app momentan aufzeichnen kann nicht, können Sie die **[Details](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.Details)** -Eigenschaft, um die Ursache festzustellen überprüfen.</span><span class="sxs-lookup"><span data-stu-id="991e6-152">If **CanRecord** returns **false**, meaning that your app can't currently record, you can check the **[Details](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.Details)** property to determine the reason.</span></span> <span data-ttu-id="991e6-153">Je nach Ursache sollten Sie dem Benutzer den Status oder Anweisungen zum Aktivieren der App-Aufzeichnung anzeigen.</span><span class="sxs-lookup"><span data-stu-id="991e6-153">Depending on the reason, you may want to display the status to the user or show instructions for enabling app recording.</span></span>



[!code-cpp[CanRecord](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCanRecord)]

## <a name="manually-start-and-stop-recording-your-app-to-a-file"></a><span data-ttu-id="991e6-154">Manuelles Starten und Beenden einer App-Aufzeichnung, die in einer Datei gespeichert wird</span><span class="sxs-lookup"><span data-stu-id="991e6-154">Manually start and stop recording your app to a file</span></span>

<span data-ttu-id="991e6-155">Nachdem Sie sicher sind, dass Ihre App aufzeichnen kann, können Sie eine neue Aufzeichnung starten, indem Sie die Methode **[StartRecordingToFileAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.startrecordingtofileasync)** des Objekts **AppRecordingManager** aufrufen.</span><span class="sxs-lookup"><span data-stu-id="991e6-155">After verifying that your app is able to record, you can start a new recording by calling the **[StartRecordingToFileAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.startrecordingtofileasync)** method of the **AppRecordingManager** object.</span></span>

<span data-ttu-id="991e6-156">Im folgenden Beispiel wird der erste **then**-Block ausgeführt, wenn im asynchronen Task ein Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="991e6-156">In the following example, the first **then** block executes when the asynchronous task fails.</span></span> <span data-ttu-id="991e6-157">Der zweite **then**-Block versucht, auf das Taskergebnis zuzugreifen und, wenn das Ergebnis Null ist, ist der Task beendet.</span><span class="sxs-lookup"><span data-stu-id="991e6-157">The second **then** block attempts to access the result of the task and, if the result is null, then the task has completed.</span></span> <span data-ttu-id="991e6-158">In beiden Fällen wird die Hilfsmethode **OnRecordingComplete** (unten dargestellt) aufgerufen, um das Ergebnis zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="991e6-158">In both cases, the **OnRecordingComplete** helper method, shown below, is called to handle the result.</span></span> 

[!code-cpp[StartRecordToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetStartRecordToFile)]

<span data-ttu-id="991e6-159">Überprüfen Sie nach Abschluss des Aufzeichnungsvorgangs die Eigenschaft **[Succeeded](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Succeeded)** des zurückgegebenen Objekts **[AppRecordingResult](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult)**, um zu ermitteln, ob der Aufzeichnungsvorgang erfolgreich verlaufen ist.</span><span class="sxs-lookup"><span data-stu-id="991e6-159">When the recording operation completes, check the **[Succeeded](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Succeeded)** property of the returned **[AppRecordingResult](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult)** object to determine if the record operation was successful.</span></span> <span data-ttu-id="991e6-160">Wenn das der Fall ist, können Sie anhand der Eigenschaft **[IsFileTruncated](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.IsFileTruncated)** überprüfen, ob das System aus Speicherplatzmangel gezwungen war, die erfasste Datei zu kürzen.</span><span class="sxs-lookup"><span data-stu-id="991e6-160">If so, you can check the **[IsFileTruncated](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.IsFileTruncated)** property to determine if, for storage reasons, the system was forced to truncate the captured file.</span></span> <span data-ttu-id="991e6-161">Überprüfen Sie anhand der Eigenschaft **[Duration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Duration)** die tatsächliche Dauer der gespeicherten Datei. Dieser Wert wird kleiner sein als die Dauer der Aufzeichnung, wenn die Datei nicht vollständig gespeichert wurde.</span><span class="sxs-lookup"><span data-stu-id="991e6-161">You can check the **[Duration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Duration)** property to discover the actual duration of the recorded file which, if the file is truncated, may be shorter than the duration of the recording operation.</span></span>

[!code-cpp[OnRecordingComplete](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetOnRecordingComplete)]

<span data-ttu-id="991e6-162">Die folgenden Beispiele zeigen grundlegenden Code zum Starten und Stoppen der im vorherigen Beispiel gezeigten Aufzeichnungsoperation.</span><span class="sxs-lookup"><span data-stu-id="991e6-162">The following examples show some basic code for starting and stopping the recording operation shown in the previous example.</span></span>

[!code-cpp[CallStartRecordToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCallStartRecordToFile)]

[!code-cpp[FinishRecordToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetFinishRecordToFile)]

## <a name="record-a-historical-time-span-to-a-file"></a><span data-ttu-id="991e6-163">Speichern einer vergangenen Zeitspanne in einer Datei</span><span class="sxs-lookup"><span data-stu-id="991e6-163">Record a historical time span to a file</span></span>
<span data-ttu-id="991e6-164">Wenn der Benutzer die rückwirkende Aufzeichnung für Ihre App in den Systemeinstellungen aktiviert hat, können Sie eine Zeitspanne eines Spiels aufzeichnen, die zuvor abgespielt wurde.</span><span class="sxs-lookup"><span data-stu-id="991e6-164">If the user has enabled historical recording for your app in the system settings, you can record a time span of gameplay that has previously transpired.</span></span> <span data-ttu-id="991e6-165">In einem früheren Beispiel dieses Artikels wurde gezeigt, wie Sie feststellen können, ob Ihre App momentan aufnehmen kann.</span><span class="sxs-lookup"><span data-stu-id="991e6-165">A previous example in this article showed how to confirm that your app can currently record gameplay.</span></span> <span data-ttu-id="991e6-166">Mit einer weiteren Überprüfung ermitteln Sie, ob die rückwirkende Aufzeichnung des Spielverlaufs aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="991e6-166">There is an additional check to determine if historical capture is enabled.</span></span> <span data-ttu-id="991e6-167">Rufen Sie wieder **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetStatus)** auf, und überprüfen Sie die Eigenschaft **[CanRecordTimeSpan](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.CanRecordTimeSpan)** des zurückgegebenen Objekts **AppRecordingStatus**.</span><span class="sxs-lookup"><span data-stu-id="991e6-167">Once again, call **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetStatus)** and check the **[CanRecordTimeSpan](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.CanRecordTimeSpan)** property of the returned **AppRecordingStatus** object.</span></span> <span data-ttu-id="991e6-168">In diesem Beispiel wird ebenfalls die Eigenschaft **[HistoricalBufferDuration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.HistoricalBufferDuration)** von **AppRecordingStatus** zurückgegeben und dazu verwendet, eine gültige Startzeit für die Aufzeichnung zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="991e6-168">This example also returns the **[HistoricalBufferDuration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.HistoricalBufferDuration)** property of the **AppRecordingStatus** which will be used to determine a valid start time for the recording operation.</span></span>

[!code-cpp[CanRecordTimeSpan](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCanRecordTimeSpan)]

<span data-ttu-id="991e6-169">Um eine vergangene Zeitspanne aufzuzeichnen, müssen Sie eine Startzeit für die Aufzeichnung und eine Dauer angeben.</span><span class="sxs-lookup"><span data-stu-id="991e6-169">To capture a historical timespan, you must specify a start time for the recording and a duration.</span></span> <span data-ttu-id="991e6-170">Die Startzeit wird als **[DateTime](https://docs.microsoft.com/uwp/api/windows.foundation.datetime)**-Struktur bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="991e6-170">The start time is provided as a **[DateTime](https://docs.microsoft.com/uwp/api/windows.foundation.datetime)** struct.</span></span> <span data-ttu-id="991e6-171">Die Startzeit muss vor der aktuellen Zeit und innerhalb der Länge des Puffers für zurückliegende Aufzeichnungen liegen.</span><span class="sxs-lookup"><span data-stu-id="991e6-171">The start time must be a time before the current time, within the length of the historical recording buffer.</span></span> <span data-ttu-id="991e6-172">In diesem Beispiel wird die Pufferlänge als Teil der Prüfung abgerufen, um festzustellen, ob die rückwirkende Aufzeichnung aktiviert ist, was im vorherigen Codebeispiel gezeigt wurde.</span><span class="sxs-lookup"><span data-stu-id="991e6-172">For this example, the buffer length is retrieved as part of the check to see if historical recording is enabled, which is shown in the previous code example.</span></span> <span data-ttu-id="991e6-173">Die Dauer der rückwirkenden Aufzeichnung wird als **[TimeSpan](https://docs.microsoft.com/uwp/api/windows.foundation.timespan)**-Struktur bereitgestellt und sollte gleich oder kleiner sein als die Dauer des Puffers für zurückliegende Aufzeichnungen.</span><span class="sxs-lookup"><span data-stu-id="991e6-173">The duration of the historical recording is provided as  **[TimeSpan](https://docs.microsoft.com/uwp/api/windows.foundation.timespan)** struct, which should also be equal to or smaller than the duration of the historical buffer.</span></span> <span data-ttu-id="991e6-174">Nachdem Sie die gewünschte Startzeit und Dauer festgelegt haben, rufen Sie **[RecordTimeSpanToFileAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.recordtimespantofileasync)** auf, um die Aufzeichnung zu starten.</span><span class="sxs-lookup"><span data-stu-id="991e6-174">Once you have determined your desired start time and duration, call **[RecordTimeSpanToFileAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.recordtimespantofileasync)** to start the recording operation.</span></span>

<span data-ttu-id="991e6-175">Wie beim Aufzeichnen mit manuellem Start und Stopp können Sie nach Abschluss der rückwirkenden Aufzeichnung die Eigenschaft **[Succeeded](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Succeeded)** des zurückgegebenen Objekts **[AppRecordingResult](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult)** überprüfen, um festzustellen, ob der Aufzeichnungsvorgang erfolgreich war, und anhand der Eigenschaften **[IsFileTruncated](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.IsFileTruncated)** und **[Duration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Duration)** können Sie die tatsächliche Dauer der aufgezeichneten Datei ermitteln. Dieser Wert wird kleiner sein als das angeforderte Zeitfenster, wenn die Datei abgeschnitten wurde.</span><span class="sxs-lookup"><span data-stu-id="991e6-175">Like recording with manual start and stop, when a historical recording completes, you can check the **[Succeeded](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Succeeded)** property of the returned **[AppRecordingResult](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult)** object to determine if the record operation was successful, and you can check the **[IsFileTruncated](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.IsFileTruncated)** and **[Duration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Duration)** property to discover the actual duration of the recorded file which, if the file is truncated, may be shorter than the duration of the requested time window.</span></span>

[!code-cpp[RecordTimeSpanToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetRecordTimeSpanToFile)]

<span data-ttu-id="991e6-176">Das folgende Beispiel zeigt grundlegenden Code zum Initiieren der rückwirkenden Aufzeichnung aus dem vorherigen Beispiel.</span><span class="sxs-lookup"><span data-stu-id="991e6-176">The following example shows some basic code for initiating the historical record operation shown in the previous example.</span></span>

[!code-cpp[CallRecordTimeSpanToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCallRecordTimeSpanToFile)]

## <a name="save-screenshot-images-to-files"></a><span data-ttu-id="991e6-177">Speichern von Screenshots in Dateien</span><span class="sxs-lookup"><span data-stu-id="991e6-177">Save screenshot images to files</span></span>
<span data-ttu-id="991e6-178">Ihre App kann eine Erfassung des Bildschirminhalts initiieren, die den aktuellen Inhalt des App-Fensters in einer Bilddatei oder in mehreren, unterschiedlich codierten Bilddateien speichert.</span><span class="sxs-lookup"><span data-stu-id="991e6-178">Your app can initiate a screenshot capture that will save the current contents of the app's window to one image file or to multiple image files with different image encodings.</span></span> <span data-ttu-id="991e6-179">Um die gewünschten Bildcodierungen anzugeben, erstellen Sie eine Liste von Zeichenfolgen, die jeweils einen Bildtyp darstellen.</span><span class="sxs-lookup"><span data-stu-id="991e6-179">To specify the image encodings you would like to use, create a list of strings where each represents an image type.</span></span> <span data-ttu-id="991e6-180">Die Eigenschaften von **[ImageEncodingSubtypes](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingsubtypes)** stellen die korrekte Zeichenfolge für jeden unterstützten Bildtyp bereit, beispielsweise **MediaEncodingSubtypes.Png** oder **MediaEncodingSubtypes.JpegXr**.</span><span class="sxs-lookup"><span data-stu-id="991e6-180">The properties of the **[ImageEncodingSubtypes](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingsubtypes)** provide the correct string for each supported image type, such as **MediaEncodingSubtypes.Png** or **MediaEncodingSubtypes.JpegXr**.</span></span>

<span data-ttu-id="991e6-181">Initiieren Sie die Aufnahme eines Screenshots durch Aufrufen der Methode **[SaveScreenshotToFilesAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.savescreenshottofilesasync)** des Objekts **AppRecordingManager**.</span><span class="sxs-lookup"><span data-stu-id="991e6-181">Initiate screen capture by calling the **[SaveScreenshotToFilesAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.savescreenshottofilesasync)** method of the **AppRecordingManager** object.</span></span> <span data-ttu-id="991e6-182">Der erste Parameter für diese Methode ist ein **StorageFolder**, in dem die Bilddateien gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="991e6-182">The first parameter to this method is a **StorageFolder** where the image files will be saved.</span></span> <span data-ttu-id="991e6-183">Der zweite Parameter ist ein Dateinamenpräfix, an den das System die Erweiterung für den jeweiligen Bildtyp anfügt, beispielsweise PNG.</span><span class="sxs-lookup"><span data-stu-id="991e6-183">The second parameter is a filename prefix to which the system will append the extension for each image type saved, such as ".png".</span></span>

<span data-ttu-id="991e6-184">Der dritte Parameter für **SaveScreenshotToFilesAsync** ist erforderlich, damit das System in der Lage ist, die richtige Farbraumkonvertierung vorzunehmen, wenn das aufzuzeichnende Fenster HDR-Inhalt anzeigt.</span><span class="sxs-lookup"><span data-stu-id="991e6-184">The third parameter to **SaveScreenshotToFilesAsync** is necessary for the system to be able to do the proper colorspace conversion if the current window to be captured is displaying HDR content.</span></span> <span data-ttu-id="991e6-185">Wenn HDR-Inhalt vorhanden ist, sollte dieser Parameter auf **AppRecordingSaveScreenshotOption.HdrContentVisible** festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="991e6-185">If HDR content is present, this parameter should be set to **AppRecordingSaveScreenshotOption.HdrContentVisible**.</span></span> <span data-ttu-id="991e6-186">Verwenden Sie andernfalls **AppRecordingSaveScreenshotOption.None**.</span><span class="sxs-lookup"><span data-stu-id="991e6-186">Otherwise, use **AppRecordingSaveScreenshotOption.None**.</span></span> <span data-ttu-id="991e6-187">Der letzte Parameter der Methode ist die Liste der Bildformate, für die Bildschirm erfasst werden soll.</span><span class="sxs-lookup"><span data-stu-id="991e6-187">The final parameter to the method is the list of image formats to which the screen should be captured.</span></span>

<span data-ttu-id="991e6-188">Wenn der asynchrone Aufruf von **SaveScreenshotToFilesAsync** abgeschlossen ist, wird ein **[AppRecordingSavedScreenshotInfo](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingsavedscreenshotinfo)**-Objekt zurückgegeben, dass neben dem Wert **StorageFile** auch den zugehörigen Wert **MediaEncodingSubtypes** bereitstellt, der den Bildtyp für jedes gespeicherte Bild angibt.</span><span class="sxs-lookup"><span data-stu-id="991e6-188">When the asynchronous call to **SaveScreenshotToFilesAsync** completes, it returns a **[AppRecordingSavedScreenshotInfo](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingsavedscreenshotinfo)** object that provides the **StorageFile** and associated **MediaEncodingSubtypes** value indicating the image type for each saved image.</span></span>

[!code-cpp[SaveScreenShotToFiles](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetSaveScreenShotToFiles)]

<span data-ttu-id="991e6-189">Das folgende Beispiel zeigt grundlegenden Code zum Initiieren der Screenshotoperation aus dem vorherigen Beispiel.</span><span class="sxs-lookup"><span data-stu-id="991e6-189">The following example shows some basic code for initiating the screenshot operation shown in the previous example.</span></span>

[!code-cpp[CallSaveScreenShotToFiles](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCallSaveScreenShotToFiles)]

## <a name="add-game-metadata-for-system-and-app-initiated-capture"></a><span data-ttu-id="991e6-190">Hinzufügen von Metadaten für systemeigene und App-initiierte Aufzeichnungen</span><span class="sxs-lookup"><span data-stu-id="991e6-190">Add game metadata for system and app-initiated capture</span></span>
<span data-ttu-id="991e6-191">In den folgenden Abschnitten dieses Artikels wird beschrieben, wie Metadaten bereitgestellt werden, die das System in den MP4-Datenstrom des aufgenommenen oder zu übertragenen Spielverlaufs einbettet.</span><span class="sxs-lookup"><span data-stu-id="991e6-191">The following sections of this article describe how to provide metadata that the system will embed into the MP4 stream of captured or broadcast gameplay.</span></span> <span data-ttu-id="991e6-192">Metadaten können in Medien eingebettet werden, die mithilfe der integrierten Systembenutzeroberfläche aufgezeichnet werden, und in Medien, die von der App mithilfe von **AppRecordingManager** aufgezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="991e6-192">Metadata can be embedded in media that is captured using the built-in system UI and media that is captured by the app with **AppRecordingManager**.</span></span> <span data-ttu-id="991e6-193">Diese Metadaten können von Ihrer App und anderen Apps während der Medienwiedergabe extrahiert werden, um kontextabhängige Erlebnisse bereitzustellen, die mit dem erfassten oder übertragenen Spielverlauf synchronisiert sind.</span><span class="sxs-lookup"><span data-stu-id="991e6-193">This metadata can be extracted by your app and other apps during media playback in order to provide contextually-aware experiences that are synchronized with the captured or broadcast gameplay.</span></span>

### <a name="get-an-instance-of-appcapturemetadatawriter"></a><span data-ttu-id="991e6-194">Abrufen einer Instanz von AppCaptureMetadataWriter</span><span class="sxs-lookup"><span data-stu-id="991e6-194">Get an instance of AppCaptureMetadataWriter</span></span>
<span data-ttu-id="991e6-195">Die primäre Klasse zur Verwaltung von Metadaten einer App-Aufnahme ist **[AppCaptureMetadataWriter](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter)**.</span><span class="sxs-lookup"><span data-stu-id="991e6-195">The primary class for managing app capture metadata is **[AppCaptureMetadataWriter](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter)**.</span></span> <span data-ttu-id="991e6-196">Verwenden Sie vor dem Initialisieren einer Instanz dieser Klasse die Methode **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation.isapicontractpresent)**, um zu prüfen, ob Version 1.0 des Vertrags *Windows.Media.Capture.AppCaptureMetadataContract* vorhanden ist. Wenn das der Fall ist, steht die API auf dem aktuellen Gerät zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="991e6-196">Before initializing an instance of this class, use the **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation.isapicontractpresent)** method to query for the *Windows.Media.Capture.AppCaptureMetadataContract* version 1.0 to verify that the API is available on the current device.</span></span>

[!code-cpp[GetMetadataWriter](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetGetMetadataWriter)]

### <a name="write-metadata-to-the-system-cache-for-your-app"></a><span data-ttu-id="991e6-197">Schreiben von Metadaten in den Zwischenspeicher für Ihre App</span><span class="sxs-lookup"><span data-stu-id="991e6-197">Write metadata to the system cache for your app</span></span>
<span data-ttu-id="991e6-198">Ein Metadatenelement enthält ein Bezeichnung in Form einer Zeichenfolge, die das Metadatenelement identifiziert, einen zugeordneten Wert, der eine Zeichenfolge, eine ganze Zahl oder ein Double-Wert sein kann, und einen Wert aus der Enumeration **[AppCaptureMetadataPriority](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)**, der die relative Priorität des Datenelements angibt</span><span class="sxs-lookup"><span data-stu-id="991e6-198">Each metadata item has a string label, identifying the metadata item, an associated data value which can be a string, an integer, or a double value, and a value from the **[AppCaptureMetadataPriority](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** enumeration indicating the relative priority of the data item.</span></span> <span data-ttu-id="991e6-199">Ein Metadatenelement stellt entweder ein „Ereignis” dar, das zu einem bestimmten Zeitpunkt eintritt, oder einen „Status”, der einen Wert während eines Zeitfensters beibehält.</span><span class="sxs-lookup"><span data-stu-id="991e6-199">A metadata item can either be considered an "event", which occurs at a single point in time, or a "state" which maintains a value over a time window.</span></span> <span data-ttu-id="991e6-200">Metadaten werden in einen Zwischenspeicher geschrieben, der vom System für Ihre App zugewiesen und verwaltet wird.</span><span class="sxs-lookup"><span data-stu-id="991e6-200">Metadata is written to a memory cache that is allocated and managed for your app by the system.</span></span> <span data-ttu-id="991e6-201">Das System erzwingt eine Größenbeschränkung für den Metadaten-Zwischenspeicher und löscht, sobald das Limit erreicht ist, die Daten basierend auf der Priorität, mit der jedes Metadatenelement geschrieben wurde.</span><span class="sxs-lookup"><span data-stu-id="991e6-201">The system enforces a size limit on the metadata memory cache and, when the limit is reached, will purge data based on the priority with which each metadata item was written.</span></span> <span data-ttu-id="991e6-202">Im nächsten Abschnitt dieses Artikels wird die Verwaltung der Speicherzuordnung für die Metadaten einer App beschrieben.</span><span class="sxs-lookup"><span data-stu-id="991e6-202">The next section of this article shows how to manage your app's metadata memory allocation.</span></span>

<span data-ttu-id="991e6-203">Eine typische App könnte einige Metadaten zu Beginn der Erfassungssitzung schreiben, um einen Kontext für die nachfolgenden Daten bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="991e6-203">A typical app may choose to write some metadata at the beginning of the capture session to provide some context for the subsequent data.</span></span> <span data-ttu-id="991e6-204">Für dieses Szenario wird empfohlen, dass Sie unmittelbare „Ereignis”-Daten verwenden.</span><span class="sxs-lookup"><span data-stu-id="991e6-204">For this scenario it is recommended that you use instantaneous "event" data.</span></span> <span data-ttu-id="991e6-205">Dieses Beispiel ruft **[AddStringEvent](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.addstringevent)**, **[AddDoubleEvent](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.adddoubleevent)** und **[AddInt32Event](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.addint32event)** auf, um unmittelbare Werte für jeden Datentyp festzulegen.</span><span class="sxs-lookup"><span data-stu-id="991e6-205">This example calls **[AddStringEvent](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.addstringevent)**, **[AddDoubleEvent](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.adddoubleevent)**, and **[AddInt32Event](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.addint32event)** to set instantaneous values for each data type.</span></span>

[!code-cpp[StartSession](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetStartSession)]

<span data-ttu-id="991e6-206">Ein häufiges Szenario für die Verwendung von „Status”-Daten, die über einen bestimmten Zeitraum erhalten bleiben, ist die Nachverfolgung einer Landkarte, auf der sich der Spieler gerade befindet.</span><span class="sxs-lookup"><span data-stu-id="991e6-206">A common scenario for using "state" data that persists over time is to track the game map that the player is currently within.</span></span> <span data-ttu-id="991e6-207">Dieses Beispiel ruft **[StartStringState](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.startstringstate)** auf, um den Statuswert festlegen.</span><span class="sxs-lookup"><span data-stu-id="991e6-207">This example calls **[StartStringState](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.startstringstate)** to set the state value.</span></span> 

[!code-cpp[StartMap](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetStartMap)]

<span data-ttu-id="991e6-208">Rufen Sie **[StopState](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.stopstate)** auf, um aufzuzeichnen, dass ein bestimmter Status beendet wurde.</span><span class="sxs-lookup"><span data-stu-id="991e6-208">Call **[StopState](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.stopstate)** to record that a particular state has ended.</span></span>

[!code-cpp[EndMap](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetEndMap)]

<span data-ttu-id="991e6-209">Sie können einen Zustand überschreiben, indem Sie einen neuen Wert für eine vorhandene Zustandsbezeichnung festlegen.</span><span class="sxs-lookup"><span data-stu-id="991e6-209">You can overwrite a state by setting a new value with an existing state label.</span></span>

[!code-cpp[LevelUp](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetLevelUp)]

<span data-ttu-id="991e6-210">Durch Aufrufen von **[StopAllStates](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.StopAllStates)** beenden Sie alle Zustände, die momentan geöffnet sind.</span><span class="sxs-lookup"><span data-stu-id="991e6-210">You can end all currently open states by calling **[StopAllStates](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.StopAllStates)**.</span></span>

[!code-cpp[RaceComplete](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetRaceComplete)]

### <a name="manage-metadata-cache-storage-limit"></a><span data-ttu-id="991e6-211">Verwalten des Limits für den Metadaten-Zwischenspeicher</span><span class="sxs-lookup"><span data-stu-id="991e6-211">Manage metadata cache storage limit</span></span>
<span data-ttu-id="991e6-212">Die Metadaten, die Sie mit **AppCaptureMetadataWriter** schreiben, werden vom System zwischengespeichert, bis sie in den zugehörigen Datenstrom geschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="991e6-212">The metadata that you write with **AppCaptureMetadataWriter** is cached by the system until it is written to the associated media stream.</span></span> <span data-ttu-id="991e6-213">Das System definiert ein Limit für die Größe des Metadaten-Zwischenspeichers jeder App.</span><span class="sxs-lookup"><span data-stu-id="991e6-213">The system defines a size limit for each app's metadata cache.</span></span> <span data-ttu-id="991e6-214">Sobald diese Limit erreicht ist, beginnt das System mit dem Löschen von zwischengespeicherten Metadaten.</span><span class="sxs-lookup"><span data-stu-id="991e6-214">Once the cache size limit has been reached, the system will begin purging cached metadata.</span></span> <span data-ttu-id="991e6-215">Das System löscht Metadaten, die vor dem Löschen von Metadaten mit der Priorität **[AppCaptureMetadataPriority.Important](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** mit **[AppCaptureMetadataPriority.Informational](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** Prioritätswert geschrieben wurde.</span><span class="sxs-lookup"><span data-stu-id="991e6-215">The system will delete metadata that was written with **[AppCaptureMetadataPriority.Informational](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** priority value before deleting metadata with the **[AppCaptureMetadataPriority.Important](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** priority.</span></span>

<span data-ttu-id="991e6-216">Zu jedem Zeitpunkt können Sie durch Aufruf von **[RemainingStorageBytesAvailable](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.RemainingStorageBytesAvailable)** die Anzahl der verfügbaren Bytes Metadaten-Zwischenspeicher der App ermitteln.</span><span class="sxs-lookup"><span data-stu-id="991e6-216">At any point, you can check to see the number of bytes available in your app's metadata cache by calling **[RemainingStorageBytesAvailable](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.RemainingStorageBytesAvailable)**.</span></span> <span data-ttu-id="991e6-217">Sie können auch selbst einen Schwellenwert für die App festlegen, um nach dessen Erreichen die Menge der Metadaten zu reduzieren, die Sie in den Zwischenspeicher schreiben.</span><span class="sxs-lookup"><span data-stu-id="991e6-217">You can choose to set your own app-defined threshold after which you can choose to reduce the amount of metadata that you write to the cache.</span></span> <span data-ttu-id="991e6-218">Das folgende Beispiel zeigt eine einfache Implementierung dieses Musters.</span><span class="sxs-lookup"><span data-stu-id="991e6-218">The following example shows a simple implementation of this pattern.</span></span>

[!code-cpp[CheckMetadataStorage](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCheckMetadataStorage)]

[!code-cpp[ComboExecuted](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetComboExecuted)]

### <a name="receive-notifications-when-the-system-purges-metadata"></a><span data-ttu-id="991e6-219">Empfangen von Benachrichtigungen, wenn das System Metadaten löscht</span><span class="sxs-lookup"><span data-stu-id="991e6-219">Receive notifications when the system purges metadata</span></span>
<span data-ttu-id="991e6-220">Sie können eine Benachrichtigung erhalten, wenn das System beginnt mit dem Löschen von Metadaten für Ihre app registrieren Sie einen Handler für das Ereignis **[MetadataPurged](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.MetadataPurged)** registrieren.</span><span class="sxs-lookup"><span data-stu-id="991e6-220">You can register to receive a notification when the system begins purging metadata for your app by registering a handler for the **[MetadataPurged](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.MetadataPurged)** event.</span></span>

[!code-cpp[RegisterMetadataPurged](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetRegisterMetadataPurged)]

<span data-ttu-id="991e6-221">Im Handler für das Ereignis **MetadataPurged** können Sie Platz im Metadaten-Zwischenspeicher schaffen, indem Sie Zustände mit niedriger Priorität beenden, Sie können eine App-bezogene Logik implementieren, um die Menge der Metadaten zu reduzieren, die Sie in den Zwischenspeicher schreiben, oder Sie können nichts tun und das System weiterhin den Zwischenspeicher leeren lassen, basierend auf der Priorität, mit der die Metadaten geschrieben wurden.</span><span class="sxs-lookup"><span data-stu-id="991e6-221">In the handler for the **MetadataPurged** event, you can clear up some room in the metadata cache by ending lower-priority states, you can implement app-defined logic for reducing the amount of metadata you write to the cache, or you can do nothing and let the system continue to purge the cache based on the priority with which it was written.</span></span>

[!code-cpp[OnMetadataPurged](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetOnMetadataPurged)]

## <a name="related-topics"></a><span data-ttu-id="991e6-222">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="991e6-222">Related topics</span></span>

* [<span data-ttu-id="991e6-223">Gaming</span><span class="sxs-lookup"><span data-stu-id="991e6-223">Gaming</span></span>](index.md)
 

 




