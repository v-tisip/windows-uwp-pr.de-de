---
author: mtoepke
title: Asynchrone Programmierung (DirectX und C++)
description: In diesem Thema werden verschiedene Aspekte behandelt, die Sie beim Verwenden der asynchronen Programmierung und des Threadings mit DirectX berücksichtigen sollten.
ms.assetid: 17613cd3-1d9d-8d2f-1b8d-9f8d31faaa6b
ms.author: mtoepke
ms.date: 02/08/2017
ms.topic: article
keywords: Windows10, UWP, Spiele, asynchrone Programmierung, DirectX
ms.localizationpriority: medium
ms.openlocfilehash: 9f395136ff7f331f58b9c8e0ac1ee9efea296c02
ms.sourcegitcommit: e38b334edb82bf2b1474ba686990f4299b8f59c7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/15/2018
ms.locfileid: "6848509"
---
# <a name="asynchronous-programming-directx-and-c"></a><span data-ttu-id="11a3f-104">Asynchrone Programmierung (DirectX und C++)</span><span class="sxs-lookup"><span data-stu-id="11a3f-104">Asynchronous programming (DirectX and C++)</span></span>



<span data-ttu-id="11a3f-105">Dieses Thema behandelt verschiedene Aspekte, die Sie beim Verwenden der asynchronen Programmierung und des Threadings mit DirectX berücksichtigen sollten.</span><span class="sxs-lookup"><span data-stu-id="11a3f-105">This topic covers various points to consider when you are using asynchronous programming and threading with DirectX.</span></span>

## <a name="async-programming-and-directx"></a><span data-ttu-id="11a3f-106">Asynchrone Programmierung und DirectX</span><span class="sxs-lookup"><span data-stu-id="11a3f-106">Async programming and DirectX</span></span>


<span data-ttu-id="11a3f-107">Wenn Sie gerade erste Erfahrungen mit DirectX sammeln oder wenn Sie sogar bereits mit DirectX vertraut sind, sollten Sie Ihre gesamte Grafikverarbeitungspipeline in einen Thread einfügen.</span><span class="sxs-lookup"><span data-stu-id="11a3f-107">If you're just learning about DirectX, or even if you're experienced with it, consider putting all your graphics processing pipeline on one thread.</span></span> <span data-ttu-id="11a3f-108">In jeder beliebigen Szene eines Spiels gibt es allgemeine Ressourcen wie Bitmaps, Shader und andere Objekte, die einen exklusiven Zugriff erfordern.</span><span class="sxs-lookup"><span data-stu-id="11a3f-108">In any given scene in a game, there are common resources such as bitmaps, shaders, and other assets that require exclusive access.</span></span> <span data-ttu-id="11a3f-109">Genau für diese Ressourcen müssen Sie den Zugriff über parallele Threads hinweg synchronisieren.</span><span class="sxs-lookup"><span data-stu-id="11a3f-109">These same resources require that you synchronize any access to these resources across the parallel threads.</span></span> <span data-ttu-id="11a3f-110">Es ist schwierig, das Rendering über mehrere Threads zu parallelisieren.</span><span class="sxs-lookup"><span data-stu-id="11a3f-110">Rendering is a difficult process to parallelize across multiple threads.</span></span>

<span data-ttu-id="11a3f-111">Wenn Ihr Spiel ausreichend komplex ist oder Sie die Leistung verbessern möchten, können Sie mithilfe der asynchronen Programmierung einige der Komponenten parallelisieren, die nicht für Ihre Renderingpipeline spezifisch sind.</span><span class="sxs-lookup"><span data-stu-id="11a3f-111">However, if your game is sufficiently complex, or if you are looking to get improved performance, you can use asynchronous programming to parallelize some of the components that are not specific to your rendering pipeline.</span></span> <span data-ttu-id="11a3f-112">Moderne Hardware ist mit Hyperthreading-CPUs mit mehreren Kernen ausgestattet, und Ihre App sollte sich diese Leistungsmerkmale zu Nutze machen!</span><span class="sxs-lookup"><span data-stu-id="11a3f-112">Modern hardware features multiple core and hyperthreaded CPUs, and your app should take advantage of this!</span></span> <span data-ttu-id="11a3f-113">Sie können dies sicherstellen, indem Sie eine asynchrone Programmierung für einige der Komponenten Ihres Spiels verwenden, die keinen direkten Zugriff auf den Direct3D-Gerätekontext benötigen. Hierzu gehören:</span><span class="sxs-lookup"><span data-stu-id="11a3f-113">You can ensure this by using asynchronous programming for some of the components of your game that don't need direct access to the Direct3D device context, such as:</span></span>

-   <span data-ttu-id="11a3f-114">Datei-E/A</span><span class="sxs-lookup"><span data-stu-id="11a3f-114">file I/O</span></span>
-   <span data-ttu-id="11a3f-115">Physische Effekte</span><span class="sxs-lookup"><span data-stu-id="11a3f-115">physics</span></span>
-   <span data-ttu-id="11a3f-116">Künstliche Intelligenz (KI)</span><span class="sxs-lookup"><span data-stu-id="11a3f-116">AI</span></span>
-   <span data-ttu-id="11a3f-117">Netzwerk</span><span class="sxs-lookup"><span data-stu-id="11a3f-117">networking</span></span>
-   <span data-ttu-id="11a3f-118">Audio</span><span class="sxs-lookup"><span data-stu-id="11a3f-118">audio</span></span>
-   <span data-ttu-id="11a3f-119">Steuerelemente</span><span class="sxs-lookup"><span data-stu-id="11a3f-119">controls</span></span>
-   <span data-ttu-id="11a3f-120">XAML-basierte UI-Komponenten</span><span class="sxs-lookup"><span data-stu-id="11a3f-120">XAML-based UI components</span></span>

<span data-ttu-id="11a3f-121">Ihre App kann diese Komponenten in mehreren gleichzeitigen Threads verwalten.</span><span class="sxs-lookup"><span data-stu-id="11a3f-121">Your app can handle these components on multiple concurrent threads.</span></span> <span data-ttu-id="11a3f-122">Das asynchrone Laden wirkt sich positiv auf die Datei-E/A aus, insbesondere auf das Laden von Objekten, da Ihr Spiel oder Ihre App sich in einem interaktiven Zustand befinden kann, während mehrere (oder mehrere Hundert) Megabytes von Objekten geladen oder gestreamt werden.</span><span class="sxs-lookup"><span data-stu-id="11a3f-122">File I/O, especially asset loading, benefits greatly from asynchronous loading, because your game or app can be in an interactive state while several (or several hundred) megabytes of assets are being loaded or streamed.</span></span> <span data-ttu-id="11a3f-123">Es ist am einfachsten, diese Threads mit der [Parallel Patterns Library (PPL)](https://msdn.microsoft.com/library/dd492418.aspx) und dem **task**-Muster zu erstellen und zu verwalten, die in dem in der Datei „PPLTasks.h“ definierten **concurrency**-Namespace enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="11a3f-123">The easiest way to create and manage these threads is by using the [Parallel Patterns Library](https://msdn.microsoft.com/library/dd492418.aspx) and the **task** pattern, as contained in the **concurrency** namespace defined in PPLTasks.h.</span></span> <span data-ttu-id="11a3f-124">Wenn Sie die [Parallel Patterns Library](https://msdn.microsoft.com/library/dd492418.aspx) verwenden, können Sie direkt von den Hyperthreading-CPUs mit mehreren Kernen profitieren und verschiedene Verbesserungen erzielen, z. B. durch verkürzte Ladezeiten oder weniger Störungen und Verzögerungen bei umfassenden CPU-Berechnungen oder Netzwerkverarbeitung.</span><span class="sxs-lookup"><span data-stu-id="11a3f-124">Using the [Parallel Patterns Library](https://msdn.microsoft.com/library/dd492418.aspx) takes direct advantage of multiple core and hyperthreaded CPUs, and can improve everything from perceived load times to the hitches and lags that come with intensive CPU calculations or network processing.</span></span>

> <span data-ttu-id="11a3f-125">**Hinweis:**  In eine universelle Windows-Plattform (UWP)-app, die Benutzeroberfläche, die vollständig in einem Singlethread-Apartment (STA) ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="11a3f-125">**Note** In a Universal Windows Platform (UWP) app, the user interface runs entirely in a single-threaded apartment (STA).</span></span> <span data-ttu-id="11a3f-126">Wenn Sie eine UI für Ihr DirectX-Spiel mit [XAML-Interoperabilität](directx-and-xaml-interop.md) erstellen, können Sie nur mithilfe von STA auf die Steuerelemente zugreifen.</span><span class="sxs-lookup"><span data-stu-id="11a3f-126">If you are creating a UI for your DirectX game using [XAML interop](directx-and-xaml-interop.md), you can only access the controls by using the STA.</span></span>

 

## <a name="multithreading-with-direct3d-devices"></a><span data-ttu-id="11a3f-127">Multithreading mit Direct3D-Geräten</span><span class="sxs-lookup"><span data-stu-id="11a3f-127">Multithreading with Direct3D devices</span></span>


<span data-ttu-id="11a3f-128">Multithreading für Gerätekontexte ist nur für Grafikgeräte verfügbar, die eine Direct3D-Featureebene von 11\_0 oder höher unterstützen.</span><span class="sxs-lookup"><span data-stu-id="11a3f-128">Multithreading for device contexts is only available on graphics devices that support a Direct3D feature level of 11\_0 or higher.</span></span> <span data-ttu-id="11a3f-129">Sie können jedoch die Nutzung des leistungsfähigen Grafikprozessors (GPU) auf vielen Plattformen maximieren, z. B. auf speziellen Gaming-Plattformen.</span><span class="sxs-lookup"><span data-stu-id="11a3f-129">However, you might want to maximize the use of the powerful GPU in many platforms, such as dedicated gaming platforms.</span></span> <span data-ttu-id="11a3f-130">Im einfachsten Fall möchten Sie vielleicht das Rendering einer HUD-Überlagerung (Heads-up-Display) vom Rendern der 3D-Szene trennen, sodass beide Komponenten separate parallele Pipelines verwenden.</span><span class="sxs-lookup"><span data-stu-id="11a3f-130">In the simplest case, you might want to separate the rendering of a heads-up display (HUD) overlay from the 3D scene rendering and projection and have both components use separate parallel pipelines.</span></span> <span data-ttu-id="11a3f-131">Beide Threads müssen jedoch dasselbe Singlethread-[**ID3D11DeviceContext**](https://msdn.microsoft.com/library/windows/desktop/ff476385)-Element verwenden, um Ressourcenobjekte (Texturen, Gitter, Shader und andere Objekte) zu erstellen und zu verwalten. Dies erfordert, dass Sie für einen sicheren Zugriff eine Art von Synchronisierungsmechanismus implementieren (z. B. wichtige Abschnitte).</span><span class="sxs-lookup"><span data-stu-id="11a3f-131">Both threads must use the same [**ID3D11DeviceContext**](https://msdn.microsoft.com/library/windows/desktop/ff476385) to create and manage the resource objects (the textures, meshes, shaders, and other assets), though, which is single-threaded, and which requires that you implement some sort of synchronization mechanism (such as critical sections) to access it safely.</span></span> <span data-ttu-id="11a3f-132">Sie können zwar separate Befehlslisten für den Gerätekontext in verschiedenen Threads (für verzögertes Rendering) erstellen, diese Befehlslisten aber nicht gleichzeitig in derselben **ID3D11DeviceContext**-Instanz wiedergeben.</span><span class="sxs-lookup"><span data-stu-id="11a3f-132">And, while you can create separate command lists for the device context on different threads (for deferred rendering), you cannot play those command lists back simultaneously on the same **ID3D11DeviceContext** instance.</span></span>

<span data-ttu-id="11a3f-133">Jetzt kann Ihre App zum Erstellen von Ressourcenobjekten auch das [**ID3D11Device**](https://msdn.microsoft.com/library/windows/desktop/ff476379)-Element verwenden, das problemlos für Multithreading eingesetzt werden kann.</span><span class="sxs-lookup"><span data-stu-id="11a3f-133">Now, your app can also use [**ID3D11Device**](https://msdn.microsoft.com/library/windows/desktop/ff476379), which is safe for multithreading, to create resource objects.</span></span> <span data-ttu-id="11a3f-134">Warum also nicht immer **ID3D11Device** anstatt [**ID3D11DeviceContext**](https://msdn.microsoft.com/library/windows/desktop/ff476385) verwenden?</span><span class="sxs-lookup"><span data-stu-id="11a3f-134">So, why not always use **ID3D11Device** instead of [**ID3D11DeviceContext**](https://msdn.microsoft.com/library/windows/desktop/ff476385)?</span></span> <span data-ttu-id="11a3f-135">Nun, derzeit steht nicht für alle Grafikoberflächen eine Treiberunterstützung für Multithreading zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="11a3f-135">Well, currently, driver support for multithreading might not be available for some graphics interfaces.</span></span> <span data-ttu-id="11a3f-136">Sie können das Gerät abfragen und herausfinden, ob es Multithreading unterstützt. Wenn Sie aber die größtmögliche Zielgruppe erreichen möchten, sollten Sie das Singlethread-**ID3D11DeviceContext**-Element zur Verwaltung von Ressourcenobjekten verwenden.</span><span class="sxs-lookup"><span data-stu-id="11a3f-136">You can query the device and find out if it does support multithreading, but if you are looking to reach the broadest audience, you might stick with single-threaded **ID3D11DeviceContext** for resource object management.</span></span> <span data-ttu-id="11a3f-137">Wenn allerdings der Grafikgerätetreiber Multithreading oder Befehlslisten nicht unterstützt, versucht Direct3D 11, den synchronisierten Zugriff auf den Gerätekontext intern zu behandeln. Und wenn keine Befehlslisten unterstützt werden, wird eine Softwareimplementierung bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="11a3f-137">That said, when the graphics device driver doesn't support multithreading or command lists, Direct3D 11 attempts to handle synchronized access to the device context internally; and if command lists are not supported, it provides a software implementation.</span></span> <span data-ttu-id="11a3f-138">So können Sie Multithreadcode schreiben, der auf Plattformen mit Grafikoberflächen ausgeführt wird, die keine Treiberunterstützung für den Zugriff auf Multithread-Gerätekontexte bieten.</span><span class="sxs-lookup"><span data-stu-id="11a3f-138">As a result, you can write multithreaded code that will run on platforms with graphics interfaces that lack driver support for multithreaded device context access.</span></span>

<span data-ttu-id="11a3f-139">Wenn Ihre App separate Threads für die Verarbeitung von Befehlslisten und zum Anzeigen von Frames unterstützt, möchten Sie wahrscheinlich, dass der Grafikprozessor (GPU) aktiv bleibt. Er soll die Befehlslisten verarbeiten und gleichzeitig Frames zeitnah ohne Störungen oder Verzögerungen anzeigen.</span><span class="sxs-lookup"><span data-stu-id="11a3f-139">If your app supports separate threads for processing command lists and for displaying frames, you probably want to keep the GPU active, processing the command lists while displaying frames in a timely fashion without perceptible stutter or lag.</span></span> <span data-ttu-id="11a3f-140">In diesem Fall können Sie ein separates [**ID3D11DeviceContext**](https://msdn.microsoft.com/library/windows/desktop/ff476385)-Element für jeden Thread verwenden und Ressourcen (wie Texturen) freigeben, indem Sie diese mit dem D3D11\_RESOURCE\_MISC\_SHARED-Kennzeichen erstellen.</span><span class="sxs-lookup"><span data-stu-id="11a3f-140">In this case, you could use a separate [**ID3D11DeviceContext**](https://msdn.microsoft.com/library/windows/desktop/ff476385) for each thread, and to share resources (like textures) by creating them with the D3D11\_RESOURCE\_MISC\_SHARED flag.</span></span> <span data-ttu-id="11a3f-141">In diesem Szenario muss [**ID3D11DeviceContext::Flush**](https://msdn.microsoft.com/library/windows/desktop/ff476425) für den Verarbeitungsthread aufgerufen werden, um die Ausführung der Befehlsliste abzuschließen, bevor die Ergebnisse der Ressourcenobjektverarbeitung im Anzeigethread angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="11a3f-141">In this scenario, [**ID3D11DeviceContext::Flush**](https://msdn.microsoft.com/library/windows/desktop/ff476425) must be called on the processing thread to complete the execution of the command list prior to displaying the results of processing the resource object in the display thread.</span></span>

## <a name="deferred-rendering"></a><span data-ttu-id="11a3f-142">Verzögertes Rendering</span><span class="sxs-lookup"><span data-stu-id="11a3f-142">Deferred rendering</span></span>


<span data-ttu-id="11a3f-143">Beim verzögerten Rendering werden Grafikbefehle in einer Befehlsliste aufgezeichnet, damit sie zu einem anderen Zeitpunkt ausgeführt werden können. Hierbei wird das Rendering in einem Thread ausgeführt, während die Aufzeichnung der Befehle zum Rendern in zusätzlichen Threads erfolgt.</span><span class="sxs-lookup"><span data-stu-id="11a3f-143">Deferred rendering records graphics commands in a command list so that they can be played back at some other time, and is designed to support rendering on one thread while recording commands for rendering on additional threads.</span></span> <span data-ttu-id="11a3f-144">Nachdem diese Befehle abgeschlossen wurden, können sie in dem Thread ausgeführt werden, der das endgültige Anzeigeobjekt (Framepuffer, Textur oder andere Grafikausgabe) generiert.</span><span class="sxs-lookup"><span data-stu-id="11a3f-144">After these commands are completed, they can be executed on the thread that generates the final display object (frame buffer, texture, or other graphics output).</span></span>

<span data-ttu-id="11a3f-145">Erstellen Sie mit [**ID3D11Device::CreateDeferredContext**](https://msdn.microsoft.com/library/windows/desktop/ff476505) einen Kontext für verzögertes Rendering (anstatt mit [**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) oder [**D3D11CreateDeviceAndSwapChain**](https://msdn.microsoft.com/library/windows/desktop/ff476083), die einen Kontext für das sofortige Rendering erstellen).</span><span class="sxs-lookup"><span data-stu-id="11a3f-145">Create a deferred context using [**ID3D11Device::CreateDeferredContext**](https://msdn.microsoft.com/library/windows/desktop/ff476505) (instead of [**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) or [**D3D11CreateDeviceAndSwapChain**](https://msdn.microsoft.com/library/windows/desktop/ff476083), which create an immediate context).</span></span> <span data-ttu-id="11a3f-146">Weitere Informationen finden Sie im Thema zum [Sofortigen und verzögerten Rendering](https://msdn.microsoft.com/library/windows/desktop/ff476892).</span><span class="sxs-lookup"><span data-stu-id="11a3f-146">For more info, see [Immediate and Deferred Rendering](https://msdn.microsoft.com/library/windows/desktop/ff476892).</span></span>

## <a name="related-topics"></a><span data-ttu-id="11a3f-147">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="11a3f-147">Related topics</span></span>


* [<span data-ttu-id="11a3f-148">Einführung in das Multithreading in Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="11a3f-148">Introduction to Multithreading in Direct3D 11</span></span>](https://msdn.microsoft.com/library/windows/desktop/ff476891)

 

 




