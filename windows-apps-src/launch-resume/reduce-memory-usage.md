---
author: TylerMSFT
ms.assetid: 3a3ea86e-fa47-46ee-9e2e-f59644c0d1db
description: Dieser Artikel beschreibt, wie Sie Arbeitsspeicher reduzieren, wenn Ihre App in den Hintergrund verschoben wird.
title: Reduzieren der Speicherverwendung bei Verschieben der App in den Hintergrundzustand
ms.author: twhitney
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: 983eb3e69e170054fcc7bc87a5f2035cd0541753
ms.sourcegitcommit: 0ab8f6fac53a6811f977ddc24de039c46c9db0ad
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 03/15/2018
ms.locfileid: "1655492"
---
# <a name="free-memory-when-your-app-moves-to-the-background"></a><span data-ttu-id="33508-104">Geben Sie Speicher frei, wenn Ihre App in den Hintergrund verschoben wird</span><span class="sxs-lookup"><span data-stu-id="33508-104">Free memory when your app moves to the background</span></span>

<span data-ttu-id="33508-105">Dieser Artikel beschreibt, wie Sie die Größe des Speichers reduzieren, den Ihre App verwendet, wenn sie in den Hintergrundzustand verschoben wird, so dass sie nicht angehalten und möglicherweise sogar beendet wird.</span><span class="sxs-lookup"><span data-stu-id="33508-105">This article shows you how to reduce the amount of memory that your app uses when it moves to the background state so that it won't be suspended and possibly terminated.</span></span>

## <a name="new-background-events"></a><span data-ttu-id="33508-106">Neue Hintergrund-Ereignisse</span><span class="sxs-lookup"><span data-stu-id="33508-106">New background events</span></span>

<span data-ttu-id="33508-107">Windows 10, Version 1607, führt zwei neue App-Lebenszyklusereignisse, [ **EnteredBackground** ](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.EnteredBackground) und [ **LeavingBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.LeavingBackground), ein.</span><span class="sxs-lookup"><span data-stu-id="33508-107">Windows 10, version 1607, introduces two new application lifecycle events, [**EnteredBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.EnteredBackground) and [**LeavingBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.LeavingBackground).</span></span> <span data-ttu-id="33508-108">Diese Ereignisse ermöglichen Ihrer App zu wissen, wann sie in den Hintergrund verschoben wird bzw. diesen verlässt.</span><span class="sxs-lookup"><span data-stu-id="33508-108">These events let your app know when it is entering and leaving the background.</span></span>

<span data-ttu-id="33508-109">Wenn Ihre App in den Hintergrund verschoben wird, können sich die vom System erzwungen Speicherbeschränkungen ändern.</span><span class="sxs-lookup"><span data-stu-id="33508-109">When your app moves into the background, the memory constraints enforced by the system may change.</span></span> <span data-ttu-id="33508-110">Verwenden Sie diese Ereignisse, um den aktuellen Speicherverbrauch zu prüfen und Ressourcen freizugeben, um unterhalb des Grenzwerts zu bleiben, so dass Ihre App nicht angehalten und möglicherweise beendet wird, während sie sich im Hintergrund befindet.</span><span class="sxs-lookup"><span data-stu-id="33508-110">Use these events to check your current memory consumption and free resources in order to stay below the limit so that your app won't be suspended and possibly terminated while it is in the background.</span></span>

### <a name="events-for-controlling-your-apps-memory-usage"></a><span data-ttu-id="33508-111">Ereignisse zur Steuerung der Speichernutzung Ihrer App</span><span class="sxs-lookup"><span data-stu-id="33508-111">Events for controlling your app's memory usage</span></span>

<span data-ttu-id="33508-112">[MemoryManager.AppMemoryUsageLimitChanging](https://msdn.microsoft.com/library/windows/apps/windows.system.memorymanager.appmemoryusagelimitchanging.aspx) wird ausgeführt, kurz bevor die Obergrenze des Speichers, den die App nutzen kann, erreicht ist.</span><span class="sxs-lookup"><span data-stu-id="33508-112">[MemoryManager.AppMemoryUsageLimitChanging](https://msdn.microsoft.com/library/windows/apps/windows.system.memorymanager.appmemoryusagelimitchanging.aspx) is raised just before the limit of total memory the app can use is changed.</span></span> <span data-ttu-id="33508-113">Zum Beispiel: Wenn die App in den Hintergrund verschoben wird und sich die Speichergrenze von 1024 MB zu 128 MB auf der Xbox ändert.</span><span class="sxs-lookup"><span data-stu-id="33508-113">For example, when the app moves into the background and on the Xbox the memory limit changes from 1024MB to 128MB.</span></span>  
<span data-ttu-id="33508-114">Dies ist das wichtigste Ereignis, um zu verhindern, dass die Plattform die App anhält oder beendet.</span><span class="sxs-lookup"><span data-stu-id="33508-114">This is the most important event to handle to keep the platform from suspending or terminating the app.</span></span>

<span data-ttu-id="33508-115">[MemoryManager.AppMemoryUsageIncreased](https://msdn.microsoft.com/library/windows/apps/windows.system.memorymanager.appmemoryusageincreased.aspx) wird ausgeführt, wenn der Speicherverbrauch der App auf einen höheren Wert in der [AppMemoryUsageLevel](https://msdn.microsoft.com/library/windows/apps/windows.system.appmemoryusagelevel.aspx)-Enumeration gestiegen ist.</span><span class="sxs-lookup"><span data-stu-id="33508-115">[MemoryManager.AppMemoryUsageIncreased](https://msdn.microsoft.com/library/windows/apps/windows.system.memorymanager.appmemoryusageincreased.aspx) is raised when the app's memory consumption has increased to a higher value in the [AppMemoryUsageLevel](https://msdn.microsoft.com/library/windows/apps/windows.system.appmemoryusagelevel.aspx) enumeration.</span></span> <span data-ttu-id="33508-116">Z. B. von **Low** auf **Medium**.</span><span class="sxs-lookup"><span data-stu-id="33508-116">For example, from **Low** to **Medium**.</span></span> <span data-ttu-id="33508-117">Die Verwendung dieses Ereignisses ist optional, wird jedoch empfohlen, da die Anwendung immer noch dafür verantwortlich ist, unter dem Grenzwert zu bleiben.</span><span class="sxs-lookup"><span data-stu-id="33508-117">Handling this event is optional but recommended because the application is still responsible for staying under the limit.</span></span>

<span data-ttu-id="33508-118">[MemoryManager.AppMemoryUsageDecreased](https://msdn.microsoft.com/library/windows/apps/windows.system.memorymanager.appmemoryusagedecreased.aspx) wird ausgeführt, wenn der Speicherverbrauch der App auf einen niedrigeren Wert in der **AppMemoryUsageLevel**-Enumeration gesunken ist.</span><span class="sxs-lookup"><span data-stu-id="33508-118">[MemoryManager.AppMemoryUsageDecreased](https://msdn.microsoft.com/library/windows/apps/windows.system.memorymanager.appmemoryusagedecreased.aspx) is raised when the app's memory consumption has decreased to a lower value in the **AppMemoryUsageLevel** enumeration.</span></span> <span data-ttu-id="33508-119">Z. B. von **High** auf **Low**.</span><span class="sxs-lookup"><span data-stu-id="33508-119">For example, from **High** to **Low**.</span></span> <span data-ttu-id="33508-120">Die Verwendung dieses Ereignisses ist optional, es zeigt jedoch an, dass die Anwendung bei Bedarf weiteren Speicher zuweisen könnte.</span><span class="sxs-lookup"><span data-stu-id="33508-120">Handling this event is optional but indicates the application may be able to allocate additional memory if needed.</span></span>

## <a name="handle-the-transition-between-foreground-and-background"></a><span data-ttu-id="33508-121">Verarbeiten des Übergangs zwischen Vordergrund und Hintergrund</span><span class="sxs-lookup"><span data-stu-id="33508-121">Handle the transition between foreground and background</span></span>

<span data-ttu-id="33508-122">Wenn Ihre App vom Vordergrund in den Hintergrund wechselt, wird das [**EnteredBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.EnteredBackground)-Ereignis ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="33508-122">When your app moves from the foreground to the background, the [**EnteredBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.EnteredBackground) event is raised.</span></span> <span data-ttu-id="33508-123">Wechselt die App dann wieder in den Vordergrund, wird das [**LeavingBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.LeavingBackground)-Ereignis ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="33508-123">When your app returns to the foreground, the [**LeavingBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.LeavingBackground) event is raised.</span></span> <span data-ttu-id="33508-124">Sie können Handler für diese Ereignisse registrieren, wenn Ihre App erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="33508-124">You can register handlers for these events when your app is created.</span></span> <span data-ttu-id="33508-125">In der Standardprojektvorlage geschieht dies im **App**-Klassenkonstruktor in „App.xaml.cs“.</span><span class="sxs-lookup"><span data-stu-id="33508-125">In the default project template, this is done in the **App** class constructor in App.xaml.cs.</span></span>

<span data-ttu-id="33508-126">Da die Ausführung im Hintergrund die Speicherressourcen belastet, die die App behalten kann, sollten Sie die App auch für das [**AppMemoryUsageIncreased**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageIncreased)-Ereignis und das [**AppMemoryUsageLimitChanging**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageLimitChanging)-Ereignis registrieren. Anhand dieser Ereignisse werden die aktuelle Speicherauslastung der App und der aktuelle Grenzwert überprüft.</span><span class="sxs-lookup"><span data-stu-id="33508-126">Because running in the background will reduce the memory resources your app is allowed to retain, you should also register for the [**AppMemoryUsageIncreased**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageIncreased) and [**AppMemoryUsageLimitChanging**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageLimitChanging) events which you can use to check your app's current memory usage and the current limit.</span></span> <span data-ttu-id="33508-127">Die Handler für diese Ereignisse werden in den folgenden Beispielen erläutert.</span><span class="sxs-lookup"><span data-stu-id="33508-127">The handlers for these events are shown in the following examples.</span></span> <span data-ttu-id="33508-128">Weitere Informationen zum Anwendungslebenszyklus für UWP-Apps finden Sie unter [App-Lebenszyklus](..//launch-resume/app-lifecycle.md).</span><span class="sxs-lookup"><span data-stu-id="33508-128">For more information on the application lifecycle for UWP apps, see [App lifecycle](..//launch-resume/app-lifecycle.md).</span></span>

[!code-cs[RegisterEvents](./code/ReduceMemory/cs/App.xaml.cs#SnippetRegisterEvents)]

<span data-ttu-id="33508-129">Wenn das [**EnteredBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.EnteredBackground)-Ereignis ausgelöst wird, legen Sie die Nachverfolgungsvariable fest, um anzugeben, dass die App momentan im Hintergrund ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="33508-129">When the [**EnteredBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.EnteredBackground) event is raised, set the tracking variable to indicate that you are currently running in the background.</span></span> <span data-ttu-id="33508-130">Dies ist nützlich, wenn Sie Code für die Reduzierung der Speichernutzung schreiben.</span><span class="sxs-lookup"><span data-stu-id="33508-130">This will be useful when you write the code for reducing memory usage.</span></span>

[!code-cs[EnteredBackground](./code/ReduceMemory/cs/App.xaml.cs#SnippetEnteredBackground)]

<span data-ttu-id="33508-131">Wenn Ihre App in den Hintergrund wechselt, reduziert das System das Arbeitsspeicherlimit der App, um sicherzustellen, dass die aktuelle Vordergrund-App über genügend Ressourcen verfügt, um ein zufriedenstellendes Reaktionsverhalten der App zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="33508-131">When your app transitions to the background, the system reduces the memory limit for the app to ensure that the current foreground app has sufficient resources to provide a responsive user experience</span></span>

<span data-ttu-id="33508-132">Durch den [**AppMemoryUsageLimitChanging**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageLimitChanging)-Ereignishandler wird der App mitgeteilt, dass der ihr zugewiesene Arbeitsspeicher verringert wurde. Außerdem wird der neue Grenzwert dem Handler in den übergebenen Ereignisargumenten mitgeteilt.</span><span class="sxs-lookup"><span data-stu-id="33508-132">The [**AppMemoryUsageLimitChanging**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageLimitChanging) event handler lets your app know that its allotted memory has been reduced and provides the new limit in the event arguments passed into the handler.</span></span> <span data-ttu-id="33508-133">Vergleichen Sie die [**MemoryManager.AppMemoryUsage**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsage)-Eigenschaft, die den aktuell von der App genutzten Arbeitsspeicher angibt, mit der [**NewLimit**](https://msdn.microsoft.com/library/windows/apps/Windows.System.AppMemoryUsageLimitChangingEventArgs.NewLimit)-Eigenschaft der Ereignisargumente, die den neuen Grenzwert angibt.</span><span class="sxs-lookup"><span data-stu-id="33508-133">Compare the [**MemoryManager.AppMemoryUsage**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsage) property, which provides your app's current usage, to the [**NewLimit**](https://msdn.microsoft.com/library/windows/apps/Windows.System.AppMemoryUsageLimitChangingEventArgs.NewLimit) property of the event arguments, which specifies the new limit.</span></span> <span data-ttu-id="33508-134">Wenn die Speicherauslastung den Grenzwert überschreitet, müssen Sie die Speicherauslastung verringern.</span><span class="sxs-lookup"><span data-stu-id="33508-134">If your memory usage exceeds the limit, you need to reduce your memory usage.</span></span>

<span data-ttu-id="33508-135">In diesem Beispiel verwenden Sie zu diesem Zweck die Hilfsmethode **ReduceMemoryUsage**, die später in diesem Artikel beschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="33508-135">In this example, this is done in the helper method **ReduceMemoryUsage**, which is defined later in this article.</span></span>

[!code-cs[MemoryUsageLimitChanging](./code/ReduceMemory/cs/App.xaml.cs#SnippetMemoryUsageLimitChanging)]

> [!NOTE]
> <span data-ttu-id="33508-136">Einige Gerätekonfigurationen lassen es zu, dass eine Anwendung den neuen Grenzwert für die Speicherauslastung überschreit, bis die Systemressourcen knapp werden. Dies gilt jedoch nicht für alle Gerätekonfigurationen.</span><span class="sxs-lookup"><span data-stu-id="33508-136">Some device configurations will allow an application to continue running over the new memory limit until the system experiences resource pressure, and some will not.</span></span> <span data-ttu-id="33508-137">Insbesondere auf der Xbox werden Apps angehalten oder beendet, wenn sie ihre Speicherauslastung nicht innerhalb von 2 Sekunden an die neuen Grenzwerte anpassen.</span><span class="sxs-lookup"><span data-stu-id="33508-137">On Xbox, in particular, apps will be suspended or terminated if they do not reduce memory to under the new limits within 2 seconds.</span></span> <span data-ttu-id="33508-138">Die beste Erfahrung auf möglichst vielen Geräten erzielen Sie mit diesem Ereignis, durch das die Ressourcenverwendung innerhalb von zwei Sekunden nach Auslösen des Ereignisses unter den Grenzwert gesenkt wird.</span><span class="sxs-lookup"><span data-stu-id="33508-138">This means that you can deliver the best experience across the broadest range of devices by using this event to reduce resource usage below the limit within 2 seconds of the event being raised.</span></span>

<span data-ttu-id="33508-139">Es ist möglich, dass zwar der Speicherbedarf Ihrer App aktuell unter dem Speicherlimit für Hintergrund-Apps liegt, wenn sie in den Hintergrund verschoben wird, sie jedoch ihre Speichernutzung mit der Zeit erhöht und sich auf den Grenzwert zubewegt.</span><span class="sxs-lookup"><span data-stu-id="33508-139">It is possible that although your app's memory usage is currently under the memory limit for background apps when it first transitions to the background, it may increase its memory consumption over time and begin to approach the limit.</span></span> <span data-ttu-id="33508-140">Mit dem Handler [**AppMemoryUsageIncreased**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageIncreased) können Sie die aktuelle Auslastung überprüfen und bei einem Anstieg bei Bedarf Arbeitsspeicher freigeben.</span><span class="sxs-lookup"><span data-stu-id="33508-140">The handler the [**AppMemoryUsageIncreased**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageIncreased) provides an opportunity to check your current usage when it increases and, if necessary, free memory.</span></span>

<span data-ttu-id="33508-141">Überprüfen Sie, ob [**AppMemoryUsageLevel**](https://msdn.microsoft.com/library/windows/apps/Windows.System.AppMemoryUsageLevel) den Wert **High** oder **OverLimit** aufweist, und reduzieren Sie ggf. die Speicherauslastung.</span><span class="sxs-lookup"><span data-stu-id="33508-141">Check to see if the [**AppMemoryUsageLevel**](https://msdn.microsoft.com/library/windows/apps/Windows.System.AppMemoryUsageLevel) is **High** or **OverLimit**, and if so, reduce your memory usage.</span></span> <span data-ttu-id="33508-142">Der Prozess in diesem Beispiel wird von der Hilfsmethode **ReduceMemoryUsage** verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="33508-142">In this example this is handled by the helper method, **ReduceMemoryUsage**.</span></span> <span data-ttu-id="33508-143">Sie können auch das [**AppMemoryUsageDecreased**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageDecreased)-Ereignis abonnieren und überprüfen, ob sich die App unter dem Grenzwert befindet. Wenn dies der Fall ist, können Sie zusätzliche Ressourcen zuweisen.</span><span class="sxs-lookup"><span data-stu-id="33508-143">You can also subscribe to the [**AppMemoryUsageDecreased**](https://msdn.microsoft.com/library/windows/apps/Windows.System.MemoryManager.AppMemoryUsageDecreased) event, check to see if your app is under the limit, and if so then you know you can allocate additional resources.</span></span>

[!code-cs[MemoryUsageIncreased](./code/ReduceMemory/cs/App.xaml.cs#SnippetMemoryUsageIncreased)]

<span data-ttu-id="33508-144">Sie können die Hilfsmethode **ReduceMemoryUsage** implementieren, um Arbeitsspeicher freizugeben, wenn die App den Auslastungsgrenzwert für Hintergrund-Apps überschreitet.</span><span class="sxs-lookup"><span data-stu-id="33508-144">**ReduceMemoryUsage** is a helper method that you can implement to release memory when your app is over the usage limit while running in the background.</span></span> <span data-ttu-id="33508-145">Die Vorgehensweise bei der Freigabe von Arbeitsspeicher hängt von den Spezifikationen Ihrer App ab. Eine empfohlene Methode besteht darin, die Benutzeroberfläche und andere mit der App-Ansicht zusammenhängende Ressourcen freizugeben.</span><span class="sxs-lookup"><span data-stu-id="33508-145">How you release memory depends on the specifics of your app, but one recommended way to free up memory is to dispose of your UI and the other resources associated with your app view.</span></span> <span data-ttu-id="33508-146">Dazu stellen Sie sicher, dass Sie die App im Hintergrund ausführen; setzen Sie dann die [ **Content** ](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Window.Content)-Eigenschaft des App-Fensters auf `null`, heben Sie die Registrierung der UI-Ereignishandler auf und entfernen Sie alle anderen Verweise, die Sie möglicherweise auf der Seite haben.</span><span class="sxs-lookup"><span data-stu-id="33508-146">To do so, ensure that you are running in the background state then set the [**Content**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Window.Content) property of your app's window to `null` and unregister your UI event handlers and remove any other references you may have to the page.</span></span> <span data-ttu-id="33508-147">Wenn Sie die Registrierung Ihrer UI-Ereignishandler nicht aufheben und andere Referenzen auf der Seite nicht löschen, kann die Seitenressource nicht freigegeben werden.</span><span class="sxs-lookup"><span data-stu-id="33508-147">Failing to unregister your UI event handlers and clearing any other references you may have to the page will prevent the page resources from being released.</span></span> <span data-ttu-id="33508-148">Rufen Sie dann **GC.Collect** auf, um den freigegebenen Speicherplatz sofort freizugeben.</span><span class="sxs-lookup"><span data-stu-id="33508-148">Then call **GC.Collect** to reclaim the freed up memory immediately.</span></span> <span data-ttu-id="33508-149">In der Regel ist es nicht erforderlich, eine Garbage Collection zu erzwingen, da das System dies erledigt.</span><span class="sxs-lookup"><span data-stu-id="33508-149">Typically you don't force garbage collection because the system will take care of it for you.</span></span> <span data-ttu-id="33508-150">In diesem speziellen Fall reduzieren wir die Menge an Arbeitsspeicher, die dieser Anwendung zugewiesen wird, wenn sie in den Hintergrund verschoben wird. So wird die Wahrscheinlichkeit verringert, dass das System bestimmt, dass die App beendet werden muss, um Arbeitsspeicher freizugeben.</span><span class="sxs-lookup"><span data-stu-id="33508-150">In this specific case, we are reducing the amount of memory charged to this application as it goes into the background to reduce the likelihood that the system will determine that it should terminate the app to reclaim memory.</span></span>

[!code-cs[UnloadViewContent](./code/ReduceMemory/cs/App.xaml.cs#SnippetUnloadViewContent)]

<span data-ttu-id="33508-151">Wenn der Fensterinhalt gesammelt wird, leitet jeder Frame seinen Trennungsprozess ein.</span><span class="sxs-lookup"><span data-stu-id="33508-151">When the window content is collected, each Frame begins its disconnection process.</span></span> <span data-ttu-id="33508-152">Wenn sich unterhalb des Fensterinhalts im visuellen Objektbaum Seiten befinden, lösen diese ihr „Unload“-Ereignis aus.</span><span class="sxs-lookup"><span data-stu-id="33508-152">If there are Pages in the visual object tree under the window content, these will begin firing their Unloaded event.</span></span> <span data-ttu-id="33508-153">Seiten können erst vollständig aus dem Arbeitsspeicher gelöscht werden, wenn alle Seitenverweise entfernt wurden.</span><span class="sxs-lookup"><span data-stu-id="33508-153">Pages cannot be completely cleared from memory unless all references to them are removed.</span></span> <span data-ttu-id="33508-154">Führen Sie im Unloaded-Rückruf die folgenden Schritte aus, um sicherzustellen, dass der Arbeitsspeicher schnell freigegeben wird:</span><span class="sxs-lookup"><span data-stu-id="33508-154">In the Unloaded callback, do the following to ensure that memory is quickly freed:</span></span>
* <span data-ttu-id="33508-155">Löschen Sie große Datenstrukturen auf der Seite, und legen Sie deren Wert auf  `null` fest.</span><span class="sxs-lookup"><span data-stu-id="33508-155">Clear and set any large data structures in your Page to `null`.</span></span>
* <span data-ttu-id="33508-156">Heben Sie die Registrierung aller Ereignishandler, die über Rückrufmethoden verfügen, innerhalb der Seite auf.</span><span class="sxs-lookup"><span data-stu-id="33508-156">Unregister all event handlers that have callback methods within the Page.</span></span> <span data-ttu-id="33508-157">Registrieren Sie diese Rückrufe beim Aufrufen des Loaded-Ereignishandlers für die Seite.</span><span class="sxs-lookup"><span data-stu-id="33508-157">Make sure to register those callbacks during the Loaded event handler for the Page.</span></span> <span data-ttu-id="33508-158">Das Loaded-Ereignis wird ausgelöst, nachdem die Benutzeroberfläche wiederhergestellt und die Seite der visuellen Objektstruktur hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="33508-158">The Loaded event is raised when the UI has been reconstituted and the Page has been added to the visual object tree.</span></span>
* <span data-ttu-id="33508-159">Rufen Sie `GC.Collect` am Ende des Unloaded-Rückrufs auf, um schnell eine Garbage Collection für große Datenstrukturen durchzuführen, die Sie gerade auf `null` festgelegt haben.</span><span class="sxs-lookup"><span data-stu-id="33508-159">Call `GC.Collect` at the end of the Unloaded callback to quickly garbage collect any of the large data structures you have just set to `null`.</span></span> <span data-ttu-id="33508-160">Normalerweise ist es wie gesagt nicht erforderlich, eine Garbage Collection zu erzwingen, da das System dies erledigt.</span><span class="sxs-lookup"><span data-stu-id="33508-160">Again, typically you don't force garbage collection because the system will take care of it for you.</span></span> <span data-ttu-id="33508-161">In diesem speziellen Fall reduzieren wir die Menge an Arbeitsspeicher, die dieser Anwendung zugewiesen wird, wenn sie in den Hintergrund verschoben wird. So wird die Wahrscheinlichkeit verringert, dass das System bestimmt, dass die App beendet werden muss, um Arbeitsspeicher freizugeben.</span><span class="sxs-lookup"><span data-stu-id="33508-161">In this specific case, we are reducing the amount of memory charged to this application as it goes into the background to reduce the likelihood that the system will determine that it should terminate the app to reclaim memory.</span></span>

[!code-cs[MainPageUnloaded](./code/ReduceMemory/cs/App.xaml.cs#SnippetMainPageUnloaded)]

<span data-ttu-id="33508-162">Im [**LeavingBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.LeavingBackground)-Ereignishandler sollten Sie die Nachverfolgungsvariable (`isInBackgroundMode`) festlegen, um anzugeben, dass die App nicht mehr im Hintergrund ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="33508-162">In the [**LeavingBackground**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Core.CoreApplication.LeavingBackground) event handler, set the tracking variable (`isInBackgroundMode`) to indicate that your app is no longer running in the background.</span></span> <span data-ttu-id="33508-163">Überprüfen Sie als Nächstes, ob der [**Content**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Window.Content) für das aktuelle Fenster `null` ist. Dies ist der Fall, wenn Sie Ihre App-Ansichten geschlossen haben, um bei der Ausführung im Hintergrund Arbeitsspeicher freizugeben.</span><span class="sxs-lookup"><span data-stu-id="33508-163">Next, check to see if the [**Content**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Window.Content) of the current window is `null`-- which it will be if you disposed of your app views in order to clear up memory while you were running in the background.</span></span> <span data-ttu-id="33508-164">Wenn der Fensterinhalt `null` ist, bauen Sie die App-Ansicht neu auf.</span><span class="sxs-lookup"><span data-stu-id="33508-164">If the window content is `null`, rebuild your app view.</span></span> <span data-ttu-id="33508-165">In diesem Beispiel wird der Fensterinhalt in der Hilfsmethode **CreateRootFrame** erstellt.</span><span class="sxs-lookup"><span data-stu-id="33508-165">In this example, the window content is created in the helper method **CreateRootFrame**.</span></span>

[!code-cs[LeavingBackground](./code/ReduceMemory/cs/App.xaml.cs#SnippetLeavingBackground)]

<span data-ttu-id="33508-166">Durch die **CreateRootFrame**-Hilfsmethode wird der Ansichtsinhalt Ihrer App neu erstellt.</span><span class="sxs-lookup"><span data-stu-id="33508-166">The **CreateRootFrame** helper method recreates the view content for your app.</span></span> <span data-ttu-id="33508-167">Der Code in dieser Methode ist beinahe identisch mit dem [**OnLaunched**](https://msdn.microsoft.com/library/windows/apps/br242335)-Handlercode in der Standardprojektvorlage.</span><span class="sxs-lookup"><span data-stu-id="33508-167">The code in this method is nearly identical to the [**OnLaunched**](https://msdn.microsoft.com/library/windows/apps/br242335) handler code provided in the default project template.</span></span> <span data-ttu-id="33508-168">Der einzige Unterschied besteht darin, dass der **Launching**-Handler den vorherigen Ausführungsstatus anhand der [**PreviousExecutionState**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Activation.LaunchActivatedEventArgs.PreviousExecutionState)-Eigenschaft von [**LaunchActivatedEventArgs**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Activation.LaunchActivatedEventArgs) ermittelt und die **CreateRootFrame**-Methode einfach den vorherigen, als Argument übergebenen Ausführungsstatus abruft.</span><span class="sxs-lookup"><span data-stu-id="33508-168">The one difference is that the **Launching** handler determines the previous execution state from the [**PreviousExecutionState**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Activation.LaunchActivatedEventArgs.PreviousExecutionState) property of the [**LaunchActivatedEventArgs**](https://msdn.microsoft.com/library/windows/apps/Windows.ApplicationModel.Activation.LaunchActivatedEventArgs) and the **CreateRootFrame** method simply gets the previous execution state passed in as an argument.</span></span> <span data-ttu-id="33508-169">Um doppelten Code zu minimieren, können Sie den Standardcode für den Ereignishandler **Launching** umgestalten, so dass **CreateRootFrame** aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="33508-169">To minimize duplicated code, you can refactor the default **Launching** event handler code to call **CreateRootFrame**.</span></span>

[!code-cs[CreateRootFrame](./code/ReduceMemory/cs/App.xaml.cs#SnippetCreateRootFrame)]

## <a name="guidelines"></a><span data-ttu-id="33508-170">Richtlinien</span><span class="sxs-lookup"><span data-stu-id="33508-170">Guidelines</span></span>

### <a name="moving-from-the-foreground-to-the-background"></a><span data-ttu-id="33508-171">Verschieben vom Vordergrund in den Hintergrund</span><span class="sxs-lookup"><span data-stu-id="33508-171">Moving from the foreground to the background</span></span>

<span data-ttu-id="33508-172">Wenn eine App vom Vordergrund in den Hintergrund verschoben wird, sorgt das System für die App dafür, dass Ressourcen, die im Hintergrund nicht benötigt werden, freigegeben werden.</span><span class="sxs-lookup"><span data-stu-id="33508-172">When an app moves from the foreground to the background, the system does work on behalf of the app to free up resources that are not needed in the background.</span></span> <span data-ttu-id="33508-173">Beispielsweise leert das UI-Framework zwischengespeicherte Texturen, und das Video-Subsystem gibt für die App Speicher frei.</span><span class="sxs-lookup"><span data-stu-id="33508-173">For example, the UI frameworks flush cached textures and the video subsystem frees memory allocated on behalf of the app.</span></span> <span data-ttu-id="33508-174">Eine App muss jedoch weiterhin sorgfältig ihre Speichernutzung überwachen, um zu vermeiden, dass sie vom System angehalten oder beendet wird.</span><span class="sxs-lookup"><span data-stu-id="33508-174">However, an app will still need to carefully monitor its memory usage to avoid being suspended or terminated by the system.</span></span>

<span data-ttu-id="33508-175">Wenn eine App vom Vordergrund in den Hintergrund wechselt, erhält sie zuerst ein **EnteredBackground**-Ereignis und dann ein **AppMemoryUsageLimitChanging**-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="33508-175">When an app moves from the foreground to the background it will first get an **EnteredBackground** event and then a **AppMemoryUsageLimitChanging** event.</span></span>

- <span data-ttu-id="33508-176">**Verwenden** Sie das **EnteredBackground**-Ereignis, um UI-Ressourcen freizugeben, von denen Sie wissen, dass Ihre App sie im Hintergrund nicht benötigt.</span><span class="sxs-lookup"><span data-stu-id="33508-176">**Do** use the **EnteredBackground** event to free up UI resources that you know your app does not need while running in the background.</span></span> <span data-ttu-id="33508-177">Beispielsweise könnten Sie das Cover-Bild für einen Song freigeben.</span><span class="sxs-lookup"><span data-stu-id="33508-177">For example, you could free the cover art image for a song.</span></span>
- <span data-ttu-id="33508-178">**Verwenden** Sie das **AppMemoryUsageLimitChanging**-Ereignis, um sicherzustellen, dass Ihre App weniger Speicher verbraucht als der neue Hintergrundgrenzwert vorgibt.</span><span class="sxs-lookup"><span data-stu-id="33508-178">**Do** use the **AppMemoryUsageLimitChanging** event to ensure that your app is using less memory than the new background limit.</span></span> <span data-ttu-id="33508-179">Achten Sie darauf, Ressourcen freizugeben, wenn dies nicht der Fall ist.</span><span class="sxs-lookup"><span data-stu-id="33508-179">Make sure that you free up resources if not.</span></span> <span data-ttu-id="33508-180">Wenn Sie dies nicht tun, kann Ihre App je nach der gerätespezifischen Richtlinie angehalten oder beendet werden.</span><span class="sxs-lookup"><span data-stu-id="33508-180">If you do not, your app may be suspended or terminated according to device specific policy.</span></span>
- <span data-ttu-id="33508-181">**Rufen** Sie manuell den Garbage Collector auf, wenn Ihre App die neue Speichergrenze überschreitet, wenn das **AppMemoryUsageLimitChanging**-Ereignis auslöst.</span><span class="sxs-lookup"><span data-stu-id="33508-181">**Do** manually invoke the garbage collector if your app is over the new memory limit when the **AppMemoryUsageLimitChanging** event is raised.</span></span>
- <span data-ttu-id="33508-182">**Verwenden** Sie das **AppMemoryUsageIncreased**-Ereignis für die weitere Überwachung der Speichernutzung Ihrer App im Hintergrund, wenn Sie erwarten, dass diese sich ändert.</span><span class="sxs-lookup"><span data-stu-id="33508-182">**Do** use the **AppMemoryUsageIncreased** event to continue to monitor your app’s memory usage while running in the background if you expect it to change.</span></span> <span data-ttu-id="33508-183">Wenn die **AppMemoryUsageLevel** **High** oder **OverLimit** ist, geben Sie Ressourcen frei.</span><span class="sxs-lookup"><span data-stu-id="33508-183">If the **AppMemoryUsageLevel** is **High** or **OverLimit** make sure that you free up resources.</span></span>
- <span data-ttu-id="33508-184">**Geben Sie eventuell** UI-Ressourcen im **AppMemoryUsageLimitChanging**-Ereignishandler anstelle des **EnteredBackground**-Handlers frei, um die Leistung zu erhöhen.</span><span class="sxs-lookup"><span data-stu-id="33508-184">**Consider** freeing UI resources in the **AppMemoryUsageLimitChanging** event handler instead of in the **EnteredBackground** handler as a performance optimization.</span></span> <span data-ttu-id="33508-185">Verwenden Sie einen booleschen Wert in den Ereignishandlern **EnteredBackground/LeavingBackground**, um zu verfolgen, ob sich die App im Vordergrund oder im Hintergrund befindet.</span><span class="sxs-lookup"><span data-stu-id="33508-185">Use a boolean value set in the **EnteredBackground/LeavingBackground** event handlers to track whether the app is in the background or foreground.</span></span> <span data-ttu-id="33508-186">Wenn dann im Eventhandler **AppMemoryUsageLimitChanging** **AppMemoryUsage** den Grenzwert überschreitet und sich die App im Hintergrund befindet (nach dem booleschen Wert), können Sie UI-Ressourcen freigeben.</span><span class="sxs-lookup"><span data-stu-id="33508-186">Then in the **AppMemoryUsageLimitChanging** event handler, if **AppMemoryUsage** is over the limit and the app is in the background (based on the Boolean value) you can free UI resources.</span></span>
- <span data-ttu-id="33508-187">**Führen Sie keine** Langzeitaufgaben im **EnteredBackground**-Ereignis durch, da dies dazu führen kann, dass der Übergang zwischen Anwendungen für die Benutzer langsam vor sich geht.</span><span class="sxs-lookup"><span data-stu-id="33508-187">**Do not** perform long running operations in the **EnteredBackground** event because you can cause the transition between applications to appear slow to the user.</span></span>

### <a name="moving-from-the-background-to-the-foreground"></a><span data-ttu-id="33508-188">Verschieben vom Hintergrund in den Vordergrund</span><span class="sxs-lookup"><span data-stu-id="33508-188">Moving from the background to the foreground</span></span>

<span data-ttu-id="33508-189">Wenn eine App vom Hintergrund in den Vordergrund wechselt, erhält sie zuerst ein **AppMemoryUsageLimitChanging**-Ereignis und dann ein **LeavingBackground**-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="33508-189">When an app moves from the background to the foreground, the app will first get an **AppMemoryUsageLimitChanging** event and then a **LeavingBackground** event.</span></span>

- <span data-ttu-id="33508-190">**Verwenden** Sie das **LeavingBackground**-Ereignis, um UI-Ressourcen wiederherzustellen, die Ihre App verworfen hat, als Sie in den Hintergrund wechselte.</span><span class="sxs-lookup"><span data-stu-id="33508-190">**Do** use the **LeavingBackground** event to recreate UI resources that your app discarded when moving into the background.</span></span>

## <a name="related-topics"></a><span data-ttu-id="33508-191">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="33508-191">Related topics</span></span>

* <span data-ttu-id="33508-192">[Abspielbeispiel für Hintergrundmedien](http://go.microsoft.com/fwlink/p/?LinkId=800141) - zeigt, wie Sie Speicher freigeben, wenn ihre App in den Hintergrund wechselt.</span><span class="sxs-lookup"><span data-stu-id="33508-192">[Background media playback sample](http://go.microsoft.com/fwlink/p/?LinkId=800141) - shows how to free memory when your app moves to the background state.</span></span>
* <span data-ttu-id="33508-193">[Diagnosetools](https://blogs.msdn.microsoft.com/visualstudioalm/2015/01/16/diagnostic-tools-debugger-window-in-visual-studio-2015/) - beobachten Sie mit den Diagnosetools die Garbage Collection-Ereignisse, und prüfen Sie, ob Ihre App Speicher in der erwarteten Weise freigibt.</span><span class="sxs-lookup"><span data-stu-id="33508-193">[Diagnostic Tools](https://blogs.msdn.microsoft.com/visualstudioalm/2015/01/16/diagnostic-tools-debugger-window-in-visual-studio-2015/) - use the diagnostic tools to observe garbage collection events and validate that your app is releasing memory the way you expect it to.</span></span>
